<html>  
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" /> 

<script language="javascript">


function toggleDiv(divid) {
var el = document.getElementById(divid);
el.style.display = (el.style.display == 'block') ? 'none' : 'block';
}


function toggleCombined(divid){
    if(document.getElementById(divid).style.display == 'none'){
      document.getElementById(divid).style.display = 'block';
	document.getElementById("toc"+divid).className="hilited";
    }
    else{
      document.getElementById(divid).style.display = 'none';
	document.getElementById("toc"+divid).className="unhilited";
    }
}


function showAll(){
for(i=1; i <= 10000; i++){
    document.getElementById(i).style.display = 'block';
    document.getElementById("toc"+i).className="hilited";
    };
}

function hideAll(){
for(i=1; i <= 10000; i++){
    document.getElementById(i).style.display = 'none';
    document.getElementById("toc"+i).className="unhilited";
    };
}

</script>
<style type="text/css" media="screen">


BODY {
	FONT-SIZE: 10pt;
	<!--FONT-FAMILY: sans-serif -->
	background: #f0f0f0;
	}
FIELDSET {
	BORDER-RIGHT: #000000 1px solid; 
	BORDER-TOP: #000000 1px solid; 
	BORDER-LEFT: #000000 1px solid; 
	BORDER-BOTTOM: #000000 1px solid; 
	PADDING-RIGHT: 5px; 
	PADDING-LEFT: 5px; 
	PADDING-BOTTOM: 2px; 
	PADDING-TOP: 5px;
	MARGIN-BOTTOM: 1px; 
	background: #f5f5f5; 
	color: #000000;
	}
LEGEND {
	BORDER-RIGHT: #a9a9a9 1px solid; 
	BORDER-BOTTOM: #a9a9a9 1px solid;
	BORDER-TOP: #a9a9a9 1px solid; 
	BORDER-LEFT: #a9a9a9 1px solid; 
	PADDING-RIGHT: 20px; 
	PADDING-LEFT: 20px; 
	PADDING-BOTTOM: 5px; 
	PADDING-TOP: 5px; 
	FONT-WEIGHT: bold;  
	BACKGROUND: #fdfdfd; 
	color: #000000;
	}
PRE	{
        PADDING-LEFT: 20px; 
        PADDING-RIGHT: 5px; 
        padding-top: 0px; 
        padding-bottom: 6px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
	background: #fefefe;
	}


.tocfieldset {
	background: #ffffff; 
	color: #000000;
	}

.codefieldset {
	BORDER-RIGHT: #000 1px solid; 
	BORDER-TOP: #000 1px solid; 
	BORDER-LEFT: #000 1px solid; 
	BORDER-BOTTOM: #000 1px solid; 
	background: #ffffff; 
	color: #000;
	MARGIN-BOTTOM: 1px; 
	PADDING-LEFT: 15px; 
	PADDING-RIGHT: 5px; 
	PADDING-BOTTOM: 10px; 
	PADDING-TOP: 1px;
	}
.codelegend {
	BORDER-RIGHT: #777 1px solid; 
	BORDER-TOP: #777 1px solid; 
	BORDER-LEFT: #777 1px solid; 
	BORDER-BOTTOM: #777 1px solid
	PADDING-RIGHT: 10px; 
	PADDING-LEFT: 10px; 
	PADDING-TOP: 2px; 
	PADDING-BOTTOM: 2px; 
	background: #ffffff; 
	color: #00b;
	FONT-WEIGHT: bold;  
	/font-variant: small-caps;
	/font-style: italic;
	}



.chunkref {
        color: #00b;	
        background: #f6f6f6;
        /font-style: italic;
        font-weight: bold;
        /font-variant: small-caps;
	}


.outertable {
	width: 99%; 
	cellpadding: 25; 
	background: #ffffff; 
	border: 1px solid;
	}

.hl	{
	 ;
        PADDING-LEFT: 5px; PADDING-RIGHT: 5px; 
        padding-top: 5px; padding-bottom: 5px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
        background: #f5f5f5;	
        width: 70%;
	}

.hl-wide {
	 ;
        PADDING-LEFT: 5px; 
        PADDING-RIGHT: 5px; 
        padding-top: 15px; 
        padding-bottom: 15px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
        background: #fbfbfb;	
	}

.lnum {

	color: #a0a0a0;
	/background: #fbfbfb;
	}

.unhilited {background-color:white}
.hilited {background-color:#c0c0ff}


</STYLE>

</head>
 <body>  <center><table class='outertable'><tr><td> 
<p><fieldset class='tocfieldset'><legend><b>TABLE OF CONTENTS: outline of the document structure</b></legend>

<ul>
<p>
<br>
<div class='hl' align=center>
<a href="javascript:;" onmousedown="toggleDiv('tochowto');">
<b>HOW TO USE THE FOLDING DOCUMENT [expand/collapse]</b></a>
</div>
<div id='tochowto' style='display:none' style='background:#ffffff'> 
<p>
<ul>
<li><b>Collapsing is necessary when</b> you work on some code and must exclude 
<br>irrelevant sections of the rest of the literate project file. This 
<br>greatly helps to clear thinking by eliminating a general feeling of 
<br>being in a maze of code and unnecessary "housekeeping" tasks.
<br>One can say that there is a limited "buffer capacity" in the human
<br>mind, and relieving it of the need to remember where things are in a 
<br>larger file, at which other points one must fill in values or adjust
<br>invocation etc. <i>immediately makes the user "more intelligent"</i>
</li><li><b>To toggle</b> a section open/closed, click on the corresponding link
<br>Remember to open <i>all sections above it</i> for it to become visible.
</li><li><b>To restore the default view</b> reload the page in the browser.
</li><li>
<b>To keep some sections open</b> upon each reload - 
<br>e.g. you work on the code, update it constantly and cannot reopen it 
<br>again and again - mark their sections in the source file with a plus, 
<br>i.e. write the opening tag (only)  as +h2, +h3 (in &lt; &gt;  or in dots
<br>for dotHTML). Again, all sections above must be marked open too. 
<p><b>Note that</b> "expand all" and "collapse all" disregard these settings.
<br>Reload the page after using those options to again view the text according 
<br>to your preferences.
</li><li>
<b> To use the Index </b>, click on the numbered sections in the TOC above
<br>(opening them; use highlighting as a guide; when sections are visible,
<br>the slider on your browser window  will shorten too), or "expand all", 
<br>and then use your browser's Find function to highlight all chunk name 
<br>instances in the visible text
</li><li>
<b>To search for variables etc.</b>, "expand all" text - or manually 
<br>expand needed sections - and then use your browser's Find function to 
<br>highlight all and jump between the found items.
<p></li>

</div> 
<p>
<br>
<p>
<div class='hl' align=center>
<!--i><font size=-3> expand all -- collapse all</font></i-->
<a href="javascript:;" onmousedown="toggleDiv('tocmain');">
<b>TABLE OF CONTENTS [expand/collapse]</b></a>
</div>

<div id='tocmain' style='display:block' style='background:#ffffff'> 
<p>
<br>
<p>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>1</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(1);" id="toc1"><b> MOLLY.pl module </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>2</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(2);" id="toc2"><b> --THE CHUNK TO TANGLE BY DEFAULT -- </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>3</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(3);" id="toc3"><b> How to use MOLLY.pl </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>4</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(4);" id="toc4"><b> Set up a Literate Source file and project </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>5</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(5);" id="toc5"><b> Prerequisites: "noweb" tools By Norman Ramsey </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>6</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(6);" id="toc6"><b> Setting up the file </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>7</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(7);" id="toc7"><b> Markup of code and documentation sections </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>8</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(8);" id="toc8"><b> Tangling from LSFile </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>9</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(9);" id="toc9"><b> Sample minimal configuration of thttpd </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>10</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(10);" id="toc10"><b> "Mollification" - full template </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>11</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(11);" id="toc11"><b> Create Literate Source file -- markup of documentation chunks </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>12</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(12);" id="toc12"><b> Markup </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>13</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(13);" id="toc13"><b> Markup and Escaping </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>14</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(14);" id="toc14"><b> Read and Search inside a Folding Literate Source file </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>15</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(15);" id="toc15"><b> Opening many relevant subsections together, TOC highlighting </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>16</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(16);" id="toc16"><b> TOC and Code Chunks Index </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>17</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(17);" id="toc17"><b> Searching for symbols, chunks, phrases </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>18</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(18);" id="toc18"><b> Keeping some sections of the LSFile permanently open </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>19</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(19);" id="toc19"><b> TOC/Index unfolding and collapsing </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>20</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(20);" id="toc20"><b> Use for printing </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>21</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(21);" id="toc21"><b> Text browsers and JavaScript </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>22</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(22);" id="toc22"><b> Work with Folding LSFiles - suggested uses </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>23</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(23);" id="toc23"><b> scrap </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>24</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(24);" id="toc24"><b> Literate source of the script </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>25</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(25);" id="toc25"><b> Bugs, status, changes </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>26</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(26);" id="toc26"><b> versions - CHANGES </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>27</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(27);" id="toc27"><b>TO DO current</b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>28</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(28);" id="toc28"><b>DONE </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>29</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(29);" id="toc29"><b> The script layout and idea </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>30</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(30);" id="toc30"><b> MOLLY.pl - top of the script </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>31</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(31);" id="toc31"><b> general settings </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>32</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(32);" id="toc32"><b> main despatcher </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>33</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(33);" id="toc33"><b> With tanglediffs as an option </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>34</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(34);" id="toc34"><b> a skeleton script to test this snippet </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>35</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(35);" id="toc35"><b> With wavediff and tanglediff?? </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>36</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(36);" id="toc36"><b> "Main despatcher kludgy" - first version - no tanglediffs </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>37</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(37);" id="toc37"><b> Tangler </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>38</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(38);" id="toc38"><b> pass-through tangler </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>39</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(39);" id="toc39"><b> Tests and snippets for a built-in tangler </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>40</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(40);" id="toc40"><b> 1. Use MD5 for chunk titles? </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>41</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(41);" id="toc41"><b> 2. First pass of tangling </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>42</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(42);" id="toc42"><b> 4. Another idea for tangling </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>43</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(43);" id="toc43"><b> 6. Lazy iteration over strings in a memory buf </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>44</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(44);" id="toc44"><b> Weaver </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>45</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(45);" id="toc45"><b> How formatting is done in the weaver </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>46</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(46);" id="toc46"><b> actual working test.html </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>47</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(47);" id="toc47"><b> changing text style - the basic JS recipy </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>48</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(48);" id="toc48"><b> Reference - Javascript and DOM </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>49</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(49);" id="toc49"><b> set formatting strings for weaver </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>50</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(50);" id="toc50"><b> JS functions </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>51</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(51);" id="toc51"><b> Stylesheet </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>52</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(52);" id="toc52"><b> Accumulate the result </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>53</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(53);" id="toc53"><b> process code chunks </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>54</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(54);" id="toc54"><b> process section headings </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>55</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(55);" id="toc55"><b> dotHTML formatter and rawHTML </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>56</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(56);" id="toc56"><b> test of &nbsp;&nbsp; s p a c i n g &nbsp;&nbsp; regexp </b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>57</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(57);" id="toc57"><b> Print out the resulting page </b></a><br>
</div>
<p>
<br>
<p>
<!--fieldset><legend-->
<div class='hl' align=center>
<a href="javascript:;" onmousedown="toggleDiv('indbuf');">
<b>INDEX of Code Chunks [expand/collapse]</b></a>
</div>
<!--/legend></fieldset-->
<p>
<div id='indbuf' style='display:none' style='background:#ffffff'> 
<ul>
<p>
<b>"Def" subscript</b> means the chunk is defined, while a bare number means 
<br>the chunk is being used in the given section.
<p>
<br>
<b>&lt;&lt;</b><font class='chunkref'>$2</font><b>&gt;&gt;</b> -- <b> 53</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>(.+)</font><b>&gt;&gt;</b> -- <b> 53<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>*</font><b>&gt;&gt;</b> -- <b> 2<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>*-dis</font><b>&gt;&gt;</b> -- <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>JS script functions</font><b>&gt;&gt;</b> -- <b> 49</b>  <b> 50<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>MOLLY.pl module</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 30<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>accumulate result in a buffer</font><b>&gt;&gt;</b> -- <b> 44</b>  <b> 52<sub>def</sub></b>  <b> 52<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>body HTML formatters</font><b>&gt;&gt;</b> -- <b> 52</b>  <b> 55<sub>def</sub></b>  <b> 55<sub>def</sub></b>  <b> 55<sub>def</sub></b>  <b> 55<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>built-in tangler skeleton</font><b>&gt;&gt;</b> -- <b> 41<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>first pass of tangling - accumulate in RAM</font><b>&gt;&gt;</b> -- <b> 41</b>  <b> 41<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>full MOLLY template</font><b>&gt;&gt;</b> -- <b> 10<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>general settings</font><b>&gt;&gt;</b> -- <b> 30</b>  <b> 31<sub>def</sub></b>  <b> 31<sub>def</sub></b>  <b> 31<sub>def</sub></b>  <b> 31<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher kludgy</font><b>&gt;&gt;</b> -- <b> 32</b>  <b> 36<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher with tanglediffs</font><b>&gt;&gt;</b> -- <b> 33<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher</font><b>&gt;&gt;</b> -- <b> 30</b>  <b> 32<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>matchstring2.pl</font><b>&gt;&gt;</b> -- <b> 43<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>md5 hashing from perl</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 40<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>minimal MOLLY template</font><b>&gt;&gt;</b> -- <b> 6<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>minimal thttpd configuration</font><b>&gt;&gt;</b> -- <b> 9<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>print out</font><b>&gt;&gt;</b> -- <b> 44</b>  <b> 57<sub>def</sub></b>  <b> 57<sub>def</sub></b>  <b> 57<sub>def</sub></b>  <b> 57<sub>def</sub></b>  <b> 57<sub>def</sub></b>  <b> 57<sub>def</sub></b>  <b> 57<sub>def</sub></b>  <b> 57<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process code chunks</font><b>&gt;&gt;</b> -- <b> 52</b>  <b> 53<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process section headings</font><b>&gt;&gt;</b> -- <b> 52</b>  <b> 54<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>run.thttpd.sh</font><b>&gt;&gt;</b> -- <b> 9<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>second pass of tangling - print out</font><b>&gt;&gt;</b> -- <b> 41</b>  <b> 41<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>set formatting strings for weaver</font><b>&gt;&gt;</b> -- <b> 44</b>  <b> 49<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>spacing.pl</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 56<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>stylesheet</font><b>&gt;&gt;</b> -- <b> 49</b>  <b> 51<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tangle me straight</font><b>&gt;&gt;</b> -- <b> 38<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tangle me with filtering</font><b>&gt;&gt;</b> -- <b> 38</b>  <b> 38<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tangle me</font><b>&gt;&gt;</b> -- <b> 30</b>  <b> 38<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tanglediff test 1</font><b>&gt;&gt;</b> -- <b> 34<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tanglediff.test2.pl</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 35<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>test.html</font><b>&gt;&gt;</b> -- <b> 46<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>weave me</font><b>&gt;&gt;</b> -- <b> 30</b>  <b> 44<sub>def</sub></b> <br>
</div>
<p>
<br>
<p><div class='hl' align=center><i>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</i></div><p>
</ul></fieldset><p>
<br><p>

<p>
<center> <b> Licensing </b><br>
MOLLY is licensed under GNU Public License version 3. </center><br>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('1');">
 MOLLY.pl module </a></legend></fieldset>
<p>
<div id="1" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 1).className='hilited';
		    </script>   
<ul>


<p>
<b> What is it? </b><br>
This is a small perl script that implements a new type of "weaver" for Literate Programming, which:<br>
    <ul> <li> is HTML-based,<br>
    </li><li> can produce formatted documents automatically, as a CGI script, as well as in <br>
    a separate step, as a classical weaver and<br>
    </li> <li> creates <i>folding</i> documents</li> </ul><br>
<b>Why?</b><br>
    <ul><li> This greatly simplifies markup, ridding it of TeX entanglement and reducing it <br>
    to basic HTML tagging<br>
    </li><li> while folding allows the programmer to apply a number of code management and <br>
    organizational techiniques not possible before with flat Literate Programming source <br>
    files. </li></ul><br>
<p>
<p>
<b>Below</b> you will find <br>
(a) an explanation of the concepts involved <br>
(b) usage information and <br>
(c) the annotated literate source of the script<br>
<p>
<p>
<p>
<br><br>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('2');">
 --THE CHUNK TO TANGLE BY DEFAULT -- </a></legend></fieldset>
<p>
<div id="2" style="display:none">   
<ul>


<p>
<p>
<font class='lnum'>71</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*&gt;&gt;=</legend>
<font class='lnum'>72</font>   <font class='chunkref'>&lt;&lt;MOLLY.pl module&gt;&gt</font>;
<font class='lnum'>73</font>   </fieldset></pre>
<p>
<font class='lnum'>75</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>76</font>   <font class='chunkref'>&lt;&lt;spacing.pl&gt;&gt</font>;
<font class='lnum'>77</font>   </fieldset></pre>
<font class='lnum'>78</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>79</font>   <font class='chunkref'>&lt;&lt;tanglediff.test2.pl&gt;&gt</font>;
<font class='lnum'>80</font>   </fieldset></pre>
<p>
<font class='lnum'>82</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>83</font>   <font class='chunkref'>&lt;&lt;md5 hashing from perl&gt;&gt</font>;
<font class='lnum'>84</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('2');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('3');">
 How to use MOLLY.pl </a></legend></fieldset>
<p>
<div id="3" style="display:none">   
<ul>


<p>
<b> What is MOLLY.pl ? </b><br>
Traditionally literate programming tools include two major ones, one to "tangle" (i.e. create<br>
machine code from a Literate Source file), and another one to "weave" (formatted <br>
documentation from the same LSFile).<br>
The developer is supposed to run the tangler after each change to be able to re-run (or recompile)<br>
the code.<br>
<p>
This script is a "weaver", and a "pass-through" tangler for use with "noweb" tools by Norman Ramsey,<br>
(by default it passes tangling to the the "notangle" utility).<br>
<p>
Starting from some version it also includes a  simple built-in tangler.<br>
<p>
I called the script "Molly" because I think of it as a "MOdule for LIterate programming".<br>
<p>
<p>
<br><br>
<b> My workflow - literate programming with Molly </b><br>
<ol><br>
    <li> I run a web server on localhost:8000, for myself only. My development directory is under<br>
    the web server - or is linked to the web server document tree.<br>
<p>
    </li> <li> I write my Literate Source file in a vim editor. I mark up the documentation section<br>
    (i.e. not code) with most basic HTML tags (e.g. &lt;h2&gt;, &lt;b&gt;, &lt;ul&gt; ...). <br>
    The code sections live between "&lt; &lt; section name &gt; &gt; =" and "@" (in the first<br>
    position in the line), as is required by "noweb" literate programming tools.<br>
<p>
    </li> <li> I view my file in a web browser, and reload the page after editing updates.<br>
    Because I write my Literate Source with help from the MOLLY.pl script (see below how to <br>
    include it in the file and set it up), every "heading" in HTML (i.e.  h1,  h2  etc. )<br>
    automatically becomes a <b> folding subsection </b> of the document I see in the browser,<br>
    and every code section is automatically formatted with line numbers and a frame.<br>
<p>
    </li> <li> When I think ("globally"), I look at the formatted, immediately updating document<br>
    in the browser, keeping open only the sections relevant to my thinking.<br>
    When I edit, I refer to the line numbers, and avoid navigating "blindly" in the programming<br>
    editor, stressing my memory. I edit "locally".<br>
<p>
    </li> <li> Automatically created folding documents allow me a number of techniques and<br>
    uses impossible previously with flat "literate programming" files.<br>
<p>
    </li> <li> I tangle the created code either directly with "notangle" tools from "noweb", or<br>
    by running "MyProject.tangle", which is a link to "MyProject.weave", the Literate Source file<br>
    turned into a perl script by inclusion of the MOLLY.pl into it in the first lines of the file.<br>
</ol><br>
<p>
See details about this setup and possible uses of it below.<br>
<p>
<p>
<br><br>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('4');">
 Set up a Literate Source file and project </a></legend></fieldset>
<p>
<div id="4" style="display:none">   
<ul>


<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('5');">
 Prerequisites: "noweb" tools By Norman Ramsey </a></legend></fieldset>
<p>
<div id="5" style="display:none">   
<ul>


<p>
    The first version of the script uses a "pass-through" tangler, i.e. delegates actual tangling to <br>
    the "notangle" utility from the "noweb" suite.<br>
<p>
    Please obtain and install it. <b> <i> Make sure the tangler is in your path </i> </b><br>
     <a href= http://www.cs.tufts.edu/~nr/noweb > http://www.cs.tufts.edu/~nr/noweb </a><br>
<p>
    Any version will do, e.g. the one based on shell and awk. I created the MOLLY script to work with<br>
    the overall markup of the "noweb" tools. It means your project file(s) can be directly processed<br>
    with "noweb" tools. MOLLY is just an alternative weaver which creates folding HTML documents <br>
    on the fly.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('5');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('6');">
 Setting up the file </a></legend></fieldset>
<p>
<div id="6" style="display:none">   
<ul>


<p>
<p>
    I aimed at simplifying and eliminating unnecessary steps, and wanted to automate some others.<br>
    Therefore practical work with MOLLY.pl looks like this:<br>
<p>
    <ol> <li> <b> <i> Your Literate Source file must be "mollified" </i> </b>, i.e. you have to add an invocation<br>
    of MOLLY.pl in the first lines of it. Think of it as a template. You will write your Literate Source text<br>
    right after these initial lines.  The minimal template is this:<br>
<p>
<font class='lnum'>177</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;minimal MOLLY template&gt;&gt;=</legend>
<font class='lnum'>178</font>       #!/full/path/to/perl
<font class='lnum'>179</font>       do /full/path/to/script/MOLLY.pl
<font class='lnum'>180</font>   
<font class='lnum'>181</font>       # delete first space in the next line
<font class='lnum'>182</font>       __DATA__
<font class='lnum'>183</font>   
<font class='lnum'>184</font>   
<font class='lnum'>185</font>       &lt;h1&gt; And here I start My Project &lt;/h1&gt;
<font class='lnum'>186</font>       Your Literate Source file can be typed here
<font class='lnum'>187</font>   
<font class='lnum'>188</font>       &lt;h2&gt; Subsection &lt;/h2&gt;
<font class='lnum'>189</font>       level 0-9 of subsections are allowed now.
<font class='lnum'>190</font>   
<font class='lnum'>191</font>       Each subsection will be automatically created as "folding". Javascript must be
<font class='lnum'>192</font>       enabled in your browser to use this functionality
<font class='lnum'>193</font>   </fieldset></pre>
<p>
    The perl invocaton and the "__DATA__"  line must start  &nbsp;   &nbsp;  a t  &nbsp;  t h e  &nbsp;  f i r s t  &nbsp;  p o s i t i o n  &nbsp; <br>
<p>
    You do not need any extra perl modules  as pre-requsites, the script uses core perl.  <br>
<p>
    Full template will also set configuration variables between calling the perl interpreter and<br>
    the inclusion of the MOLLY.pl script, which adjust its behaviour.<br>
<p>
    Save this under some name, e.g. MyProject.txt. This turns your Literate Source file into<br>
    a perl script<br>
<p>
    </li> <li> <b> <i> Make it executable. </i> </b> <br>
	<pre> chmod 755 MyProject.txt </pre><br>
<p>
    </li> <li>  <b> <i> The script behaves according to its name extension </i> </b><br>
    The script will produce HTML-formatted documentation, if its name ends with "weave" <br>
    (default - or whatever you selected when setting configuration variables in the "mollification"<br>
    template). Invoked under any different name (default) it will "tangle", i.e. create machine code.<br>
    So,  name or rename your LSFile "MyProject.weave" and link it to "MyProject.tangle" (or whatever):<br>
    <pre>
	mv MyProject.txt MyProject.weave
	ln -s MyProject.weave MyProject.tangle </pre><br>
<p>
    Now if you run MyProject.weave, it will dump HTML-formatted documentation of your work to STDOUT<br>
	<pre> ./MyProject.weave &gt; MyProject-formatted.foldingdocument.html </pre><br>
    It you run MyProject.tangle, it will dump machine code from your Literate Source file to STDOUT.<br>
	<pre> ./MyProject.tangle &gt; MyProject-runnable.script.pl </pre><br>
    ( Of course, tangling is independent of the language you program in )<br>
<p>
    For example, if you develop in perl, you can run the resulting script like this:<br>
	<pre> ./MyProject.tangle | perl [perl options here] - </pre><br>
<p>
    Additionally, as the markup is the same as that of "noweb" tools. one can use them directly<br>
    on the My.Project.weave file, with all of their flexibility and extra options.<br>
<p>
    However the idea was even to avoid running some of these commands after each change in<br>
    the file and to avoid saving the weaved docs: STDOUT can be picked up by your local web<br>
    server as CGI, and you will have an HTML-formatted and which is more important, <i> folding </i><br>
    document in your browser by simply reloading the page (usually with Ctrt+R or a mouse click)<br>
<p>
    </li> <li> Now, <b> <i>  the only other step  is to run a local web server </i> </b> <br>
    (on localhost, any tiny very simple httpd will do), and tell it to treat "*.weave" as valid cgi <br>
    file extension. (Alternatively, I can set "weaving" to files that end in '*.cgi" or "*.pl" etc. <br>
    in the configuration part of my MOLLY template)<br>
<p>
    One of the simplest WWW servers for such use could be "thttpd", and I will provide you with its<br>
    minimal configuration file below.<br>
    </li> </ol><br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('6');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('7');">
 Markup of code and documentation sections </a></legend></fieldset>
<p>
<div id="7" style="display:none">   
<ul>


<p>
First, <br>
    <ul> <li>  code sections begin with "&lt; &lt;name of the section&gt; &gt;="<br>
    in the first position in the line and end with "@"  in the first position<br>
<p>
    References to other code sections are done with "&lt; &lt;name of the ref sect&gt; &gt;"<br>
    inside the code sections<br>
<p>
    The rest is "documentation chunks" which must be marked up with some formatting tags.<br>
<p>
    </li> <li> <i> [ no spaces between the double angle brackets - I used spaces as escapes here ] </i><br>
<p>
    </li> <li> I do not insert examples here, as the file you are reading provides them ad nauseam.<br>
    </li> </ul><br>
<p>
    THIS IS THE BASIC MARKUP OF THE LITERATE SOURCE FILE, as used by the "noweb" tools.<br>
<p>
    Secondly, how do we format the documentation sections?<br>
    <ul> <li> In the simplest case, with straight HTML markup (default)<br>
<p>
    </li> <li> If a simple subsection is added to the MOLLY.pl script to process it, in any<br>
    markup lingo of your choice (e.g. "wiki") <br>
<p>
    Currently I provide a "dotHTML" formatting subsection as an example. It implements<br>
    a few of the most common HTML tags but with "dots" around them, in place of angle brackets <br>
    "&lt;" and "&gt;" (which is faster, as one does not need to switch register, so is less prone <br>
    to typos). See below for more detailed explanations<br>
    </li> </ul><br>
<p>
    <b> <i> The only difference </i> </b> from the truly "raw" HTML is that except in "pre" sections the MOLLY.pl script will <br>
    add automatic &lt;br&gt; tags at the end of each line of your Literate Source file.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('7');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('8');">
 Tangling from LSFile </a></legend></fieldset>
<p>
<div id="8" style="display:none">   
<ul>


<p>
    <ol> <li> Usually only one file needs to be tangled constantly, the file the developer<br>
    is working on.  It's easiest to do by using the "default root", which is a code chunk<br>
    called "*". When you run <br>
    <pre> MyProject.tangle &gt; source.pl </pre> <br>
    MOLLY will pass the command to "notangle" from Ramsey's "noweb" tools, and print code<br>
    chunks starting from the one named "*". Therefore, I drag along the default root to<br>
    wherever I am editing now and reassigning to it the chunk I need to tangle currently.<br>
    I usually keep the pointer subsection at the top of the Literate Source file. See <br>
    "THE CHUNK TO TANGLE BY DEFAULT" in the file you are reading as an example of this<br>
    technique.<br>
<p>
    This is the task for which MOLLY quick "pass-through tangling" is designed.<br>
<p>
    </li> <li> If, however, you need to tangle out non-"*" root, you might need to run<br>
    "notangle" directly on your MyProject.weave. This is the most flexible way.<br>
<p>
    </li> <li> If you need to tangle out many source files, then probably the easiest way<br>
    to arrange it is through many invocations of "notangle" in a makefile.<br>
    Include "Makefile" subsection into your Literate Source file and create a target that<br>
    combines several "notangle -R ... " commands in it.<br>
    Assing default root "*" to the Makefile, then run "MyProject.tangle &gt; Makefile" to create<br>
    it and next run "make targetname" to tangle (and compile, run etc) many files included<br>
    into your Literate Source project file.<br>
    </li> </ol><br>
<p>
<br><br>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('8');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('9');">
 Sample minimal configuration of thttpd </a></legend></fieldset>
<p>
<div id="9" style="display:none">   
<ul>


<p>
"THTTPD" home is <a href= http://www.acme.com/software/thttpd/ > http://www.acme.com/software/thttpd/ </a> <br>
<p>
From the distro README:<br>
<ul> thttpd is a simple, small, portable, fast, and secure HTTP server. <br>
<b> Simple: </b> It handles only the minimum necessary to implement HTTP/1.1. Well, maybe a <br>
little more than the minimum. <br>
<b> Small: </b>  See the comparison chart. It also has a very small run-time size, since it <br>
does not fork and is very careful about memory allocation. <br>
<b> Portable: </b>  It compiles cleanly on most any Unix-like OS, specifically including FreeBSD, <br>
SunOS 4, Solaris 2, BSD/OS, Linux, OSF. <br>
<b> Fast:  </b>  In typical use it's about as fast as the best full-featured servers (Apache, <br>
NCSA, Netscape). Under extreme load it's much faster. <br>
<b> Secure: </b>  It goes to great lengths to protect the web server machine against attacks and <br>
breakins from other sites. <br>
<p>
It also has one extremely useful feature (URL-traffic-based throttling) that no other server <br>
currently has. Plus, it supports IPv6 out of the box, no patching required.<br>
</ul><br>
<p>
Its compilation is very quick. Its configuration is simpler than that of Apache. <br>
<p>
Supposing I'd like to point my browser at "http://localhost:8000/path/to/MyProject.weave"<br>
Then the minimal configuration will look something like this:<br>
<p>
<p>
<font class='lnum'>341</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;minimal thttpd configuration&gt;&gt;=</legend>
<font class='lnum'>342</font>   #
<font class='lnum'>343</font>   host=localhost
<font class='lnum'>344</font>   port=8000
<font class='lnum'>345</font>   dir=/my/home/00trash/tmp/literate.perl/WORKDIR
<font class='lnum'>346</font>   data_dir=/my/home/00trash/tmp/literate.perl/WORKDIR
<font class='lnum'>347</font>   #chroot
<font class='lnum'>348</font>   
<font class='lnum'>349</font>   # extensions understood as valid "cgi" scripts:
<font class='lnum'>350</font>   #cgipat=/**.cgi|/**.weave|/**.pl
<font class='lnum'>351</font>   #cgipat=/**.tangle
<font class='lnum'>352</font>   cgipat=/**.weave
<font class='lnum'>353</font>   
<font class='lnum'>354</font>   #logfile=/my/home/00trash/tmp/literate.perl/WWW.server/thttpd.log
<font class='lnum'>355</font>   logfile=/dev/null
<font class='lnum'>356</font>   
<font class='lnum'>357</font>   #pidfile=./thttpd.pid
<font class='lnum'>358</font>   pidfile=/home/vedmed/00trash/tmp/literate.perl/WWW.server/thttpd.pid
<font class='lnum'>359</font>   
<font class='lnum'>360</font>   # uncomment this to be able to link from anywhere to your web server document dir 
<font class='lnum'>361</font>   # (unsecure, for local development only)
<font class='lnum'>362</font>   nosymlink
<font class='lnum'>363</font>   #
<font class='lnum'>364</font>   </fieldset></pre>
<b> NOTE </b> that "nosymlink" schizophrenically <i> allows </i> symbolic links in spite of what<br>
thttpd documentation tells you<br>
<p>
The script to start thttpd (it will detach and run as a daemon) is something like this:<br>
<p>
<font class='lnum'>370</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;run.thttpd.sh&gt;&gt;=</legend>
<font class='lnum'>371</font>   #!/bin/sh
<font class='lnum'>372</font>   PROJECT_ADMIN_DIR="/my/home/00trash/tmp/literate.perl/WWW.server";
<font class='lnum'>373</font>   #./thttpd -p 8000 -h localhost -C ./thttpd.config
<font class='lnum'>374</font>   #$PROJECT_ADMIN_DIR/thttpd -nos -C $PROJECT_ADMIN_DIR/thttpd.config
<font class='lnum'>375</font>   $PROJECT_ADMIN_DIR/thttpd -C $PROJECT_ADMIN_DIR/thttpd.config
<font class='lnum'>376</font>   </fieldset></pre>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('9');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('10');">
 "Mollification" - full template </a></legend></fieldset>
<p>
<div id="10" style="display:none">   
<ul>


Should be self-explanatory. May add to this section later.<br>
Uncomment to set, otherwise defaults apply.<br>
<p>
<font class='lnum'>385</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;full MOLLY template&gt;&gt;=</legend>
<font class='lnum'>386</font>   #!/usr/bin/perl
<font class='lnum'>387</font>   
<font class='lnum'>388</font>   # print TOC? 1:0
<font class='lnum'>389</font>   #$print_toc=1;	# default is to print
<font class='lnum'>390</font>   
<font class='lnum'>391</font>   # keep TOC expanded? "block":"none"
<font class='lnum'>392</font>   #$toc_expanded="block";	# default is to unfold
<font class='lnum'>393</font>   
<font class='lnum'>394</font>   # keep Chunks Index expanded? "block":"none"
<font class='lnum'>395</font>   #$ind_expanded="none";	# default is to keep folded
<font class='lnum'>396</font>   
<font class='lnum'>397</font>   # number lines in code sections? 1 : else
<font class='lnum'>398</font>   #$line_numbering = 1;	# default is to number
<font class='lnum'>399</font>   
<font class='lnum'>400</font>   # what is the file extention to weave it? (perms must allow execution!)
<font class='lnum'>401</font>   # e.g. "scriptname.weave" or "scriptname.cgi" etc.
<font class='lnum'>402</font>   #$weave_extension = "weave";	# default is "weave"
<font class='lnum'>403</font>   
<font class='lnum'>404</font>   # what is the file extention to tangle it? (perms must allow execution!)
<font class='lnum'>405</font>   # e.g. "scriptname.tangle",  "scriptname.pl" etc.
<font class='lnum'>406</font>   #$tangle_extension = "tangle";	# default is "tangle"
<font class='lnum'>407</font>   
<font class='lnum'>408</font>   
<font class='lnum'>409</font>   # how are doc sections marked? "dotHTML":"rawHTML"
<font class='lnum'>410</font>   # $weave_markup = "rawHTML"; # default is "rawHTML"
<font class='lnum'>411</font>   
<font class='lnum'>412</font>   
<font class='lnum'>413</font>   # old name of the module
<font class='lnum'>414</font>   #do "LPM-0.53.ffpl" ;
<font class='lnum'>415</font>   
<font class='lnum'>416</font>   do "MOLLY.pl";
<font class='lnum'>417</font>   exit;
<font class='lnum'>418</font>   
<font class='lnum'>419</font>   # delete the space before the __DATA__ marker
<font class='lnum'>420</font>    __DATA__
<font class='lnum'>421</font>   #---------------start of script-------------
<font class='lnum'>422</font>   
<font class='lnum'>423</font>   </fieldset></pre>
<p>
<b> "__DATA__" must start at the first position in its line </b><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('10');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('4');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('11');">
 Create Literate Source file -- markup of documentation chunks </a></legend></fieldset>
<p>
<div id="11" style="display:none">   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('12');">
 Markup </a></legend></fieldset>
<p>
<div id="12" style="display:none">   
<ul>


<p>
<ol> <li> The default is to use ordinary 'html' markup in the document sections<br>
The only difference from "true raw" HTML is that MOLLY adds automatic <br>
&lt;br&gt; linebreaks unless lines are inside the &lt;pre&gt;..&lt;/pre&gt; sections<br>
The script also cuts out vim folding marks -- { { { number ... } } } number<br>
-- without spaces  and "#------------" lines.<br>
<p>
<p>
</li> <li> Any "markdown" or "wiki"-style markup can be added to MOLLY. Another reasonable<br>
suggestion could be a simple translator from basic TeX markup etc.<br>
Some of this functionality is unnecessary to reimplement, as "noweb" or third-party <br>
filters can be run on the document after MOLLY weaving or from inside MOLLY.<br>
<p>
</li> <li> As an example of a simple markup which can be done with regular expressions<br>
I added  "dotHTML", which is several most basic HTML tags inside "dots" instead<br>
of angle brackets.<br>
<p>
Dots do not require switcing the keyboard register, and therefore I can speed up<br>
typing and avoid annoying repeating typos.<br>
<p>
Please see the "dotHTML" subsection below where the source of MOLLY is listed.<br>
<p>
Currently implemented tags are (write them inside "dots", not "&lt;..&gt;"):<br>
<ul> &lt;br&gt; &lt;p&gt; <br>
&lt;s&gt; - &lt;/s&gt;<br>
&lt;pre&gt; - ..<br>
&lt;b&gt; - &lt;/b&gt;<br>
&lt;i&gt; - ..<br>
&lt;ul&gt; - ..<br>
&lt;ol&gt; - ..<br>
&lt;li&gt; - ..<br>
<p>
Special marks are dot-&lt;-dot and dot-&gt;-dot (no dashes, like ". &lt; ." <br>
without spaces) which are needed if the tag includes some options or<br>
is not among the tags "dotHTML" understands already.<br>
These will be converted to single &lt; and &gt; respectively.<br>
This is clumsy, but for quick sample and to speed up typing I found<br>
it sufficient. So far.<br>
<p>
<p>
And there are two special, non-HTML marks I introduced for convenience.<br>
(a) dot-x-dot ... dot-/x-dot <i>on one line only </i> will  &nbsp;   &nbsp;  f o r m a t  &nbsp;  t h e  &nbsp;  p h r a s e  &nbsp;  as spaced<br>
(b) dot-a-dot http://some/URL dot-/a-dot will create a hyperlink <a href= http://some/URL > http://some/URL </a> <br>
<p>
</ul><br>
<p>
etc. I add them as I go, whenever I need them for my current document.<br>
<p>
This formatting also adds &lt;br&gt; linebreaks unless lines are inside the <br>
&lt;pre&gt;..&lt;/pre&gt; sections.<br>
"dotHTML" also cuts out vim folding marks <br>
<pre> { { { number ... } } } number </pre><br>
without spaces, and  comment lines with dashes<br>
<pre> "#------------" </pre><br>
<p>
<p>
</li> </ol><br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('12');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('13');">
 Markup and Escaping </a></legend></fieldset>
<p>
<div id="13" style="display:none">   
<ul>


<p>
As clumsiness in inserting "dot-tags" in the previous subsection proves, a problem of <br>
escaping exists with any markup languages.<br>
<p>
This is not resolved cleanly by MOLLY (at least for now).<br>
In particular, a difficulty exists with double angle brackets (&lt; &lt; ... &gt; &gt;) which make "notangle"<br>
stumble, wherever in the document it finds them. As a result, I usually use "spaces" to break<br>
the bad symbols. For example, this document is written in "dotHTML" notation (not "rawHTML"), so<br>
in explanations I could write the escaped dot-tags as ". b . asdasf . /b ."<br>
<p>
Another side of the same problem is that browsers <i> do </i> interpret HTML tags even inside the<br>
&lt;pre&gt;...&lt;/pre&gt; (which is insane). Therefore if your code processes some HTML (e.g. in regular <br>
expressions), the formatted document in your browser may substitute/spoil the code.<br>
I solved this problem only in part for now.<br>
<p>
Clean escaping in MOLLY still needs work.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('13');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('11');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('14');">
 Read and Search inside a Folding Literate Source file </a></legend></fieldset>
<p>
<div id="14" style="display:none">   
<ul>


<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('15');">
 Opening many relevant subsections together, TOC highlighting </a></legend></fieldset>
<p>
<div id="15" style="display:none">   
<ul>


<p>
One advantage of the folding format is that - in contrast to most other tools - it allows<br>
    the programmer to open <i> many </i> relevant sections from any parts of the file <i> at the <br>
    same time </i><br>
<p>
    This can be done by "walking" the Literate Source file, as its sections and subsections are a <br>
    kind of TOC of themselves.<br>
    This can be done from the TOC section as well. The open sections get a highlighted background,<br>
    and highlighting appears irrespective of whether the section was opened from the TOC or in the<br>
    body of the text.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('15');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('16');">
 TOC and Code Chunks Index </a></legend></fieldset>
<p>
<div id="16" style="display:none">   
<ul>


<p>
Traditional literate programming tools create extensive indeces of variables and code chunks.<br>
<p>
    The approach in this script is as follows:<br>
<p>
    Index of all code chunks in your LSFile exists (unless a configuration opton in the <br>
    template tells MOLLY to skip it) right under TOC. Click on teh line to expand it, and then use<br>
    TOC section numbers to click open the sections which contain or define the chunks you need.<br>
<p>
    Remember that <i> all parent sections </i> above the needed one must be open for you to see <br>
    the innermost subsection in your browser. This is easy to control through TOC highlighting, and<br>
    as an additional indicator, the slider on your web browser will visibly jerk and shorten when <br>
    new sections will become visible in the browser window.<br>
<p>
    It's also convenient to keep some inner subsections open, but click closed the topmost section to<br>
    quickly hide and unhide larger pieces of code (e.g.complete files which live inside the Literate<br>
    Source File when it is used as a common Project file for many source files, test files, makefile(s)<br>
    etc.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('16');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('17');">
 Searching for symbols, chunks, phrases </a></legend></fieldset>
<p>
<div id="17" style="display:none">   
<ul>


<p>
Web browsers "search" functions  will work on open sections only, at least that's the behaviour of<br>
    Opera and Mozilla browsers.<br>
    This means that instead of creating exhaustive indeces of symbols, which clutter program text, <br>
    especially when they display as HTML links in the output of Weaver tools, one can ensure only the<br>
    interesting subsections are open and then search using the built-in browser function. It usually<br>
    highlights the results and iterates over the found items, which is a nice behaviour.<br>
<p>
    To search in the whole of the LSFile, simply click on the "expand all" under any of the subsections,<br>
    and then again use the browser search function.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('17');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('18');">
 Keeping some sections of the LSFile permanently open </a></legend></fieldset>
<p>
<div id="18" style="display:none">   
<ul>


<p>
The behaviour of folding sections in the mollified LSFile is as follows:<br>
    <ul> <li> If you click on the <b> "expand all" </b> link anywhere in the document, all folding <br>
    sections in the body (not TOC/Index) will open. The limitation is 10000 objects per document,<br>
    hardcoded.<br>
    </li> <li> If you click on <b> "collapse all" </b>, all folding sections in the body will fold. <br>
    The limit is 10k objects per document<br>
    </li> <li> If you <b> reload the document </b> in your browser ("Ctrl-R" or an icon click), the<br>
    document will be shown with sections open or closed <b> as marked </b> in the document itself.<br>
    </li> </ul><br>
<p>
    The markup is simple: if you'd like a section to stay open upon load/reload,  add a "+" before<br>
    "h" in the opening  heading tag:<br>
    <pre> &lt;+h1&gt;, or &lt;+h2&gt;, ... </pre><br>
<p>
    This is important when you work on a section or many sections of your LIterate Source file for<br>
    a longer period and could not click them open in teh browser time and time again, after each <br>
    minor code change when you reload the "project.weave" in your browser to see the updates.<br>
<p>
    Such changes - adding or deleting a "+" - can often be done with one command in a programming editor.<br>
    For example, to open the whole subthread in vim, issue a range command, sth like<br>
    <pre> 1024,1150s/&lt;h/&lt;+h/ </pre> (i.e. substitute between lines 1024 and 1150 of your Literate Source file)<br>
<p>
    Another suggestion is, when you, for example, work with several program files inside your LIterate<br>
    Source (project) file, you might keep subthreads marked open, while changing only the topmost <br>
    heading to show/hide the whole of that file/subthread code and notes.<br>
<p>
    Even when you handpick the sections to keep open, I found, this arrangement suits me well, at least<br>
    for medium-sized LSFiles up to several thousand lines long.<br>
    I also use folding inside "vim", and so line ranges are visible at one glance: "z-a" to collapse the<br>
    vim fold, and then see the range and issue the range command.<br>
<p>
    <i> Note </i> <br>
	<ul> Use of folding inside your programming editor  &nbsp;   &nbsp;  i s  &nbsp;  n o t  &nbsp;  a  &nbsp;  s u b s t i t u t e  &nbsp;  for reading <br>
	a well-laid out formatted document in the browser. Vim folding is still "blind" and  navigation<br>
	inside such a file still has to rely on your memory of the full layout. This is a burden one <br>
	wishes to escape when programming, to be able to dedicate attention to thinking and<br>
	programming while avoiding unnecessary "housekeeping" tasks. Short-term memory of humans<br>
	is very small, and switching between remembering where things are and doing programming<br>
	becomes exhausting when your program exceeds a thousand lines or so.<br>
<p>
	MOLLY numbers lines in the code sections by default, making jumps from reading in your browser<br>
	to editing a particular line in your editor painless. I could also put it like this: I view<br>
	the file globally in my browser as a folding document when I am thinking, while editing <br>
	"locally" in a programming editor, without thinking about the overall layout of the file.<br>
<p>
	</ul><br>
<p>
    MOLLY.pl is written to filter out vim folding markups ( {{{number ... }}}number ) and t hose will not<br>
    show on your web page.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('18');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('19');">
 TOC/Index unfolding and collapsing </a></legend></fieldset>
<p>
<div id="19" style="display:none">   
<ul>


<p>
    The TOC and Index at the top of the document can be kept folded or expanded upon initial load<br>
    depending on the configuration variables in the "mollifying" template you add at the top of <br>
    your Literate Project file. Please see the subsection titled '"Mollification" - full template' above<br>
    Of course, those subsections can always be opened/closed manually at any time<br>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('19');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('20');">
 Use for printing </a></legend></fieldset>
<p>
<div id="20" style="display:none">   
<ul>


<p>
Unfolding only the needed sections also seems to work well with printing from the browser window.<br>
    You can therefore avoid picking certain pages manually from "print preview". You'll print only<br>
    the visible part(s) - i.e. the open sections and the topmost folded section names, which do not<br>
    take place if your document is marked in a sane way, and rather help the reader to orient himself<br>
    while looking at the printout.<br>
<p>
    Just remember to check the font size in the "print preview" when preparing to print for the first <br>
    time.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('20');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('21');">
 Text browsers and JavaScript </a></legend></fieldset>
<p>
<div id="21" style="display:none">   
<ul>


<p>
Web page folding seems to work well with text-only www browsers, such as  "lynx" or 'w3m': they do not <br>
understand javascript folding, and so display the whole document.<br>
<p>
Here's an example invocation with w3m:<br>
<pre>  ./MOLLY.weave | w3m -T text/html  </pre><br>
<i> Note </i>MOLLY does not issue HTTP headers, and this may affect browser behaviour. The web server<br>
 and/or browser may add them or not, or ignore them or not. I might need to correct that.<br>
<p>
If JavaScript in your GUI browser is turned off, you'll see only the sections marked in the body<br>
of the Literate Source file as open.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('21');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('14');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('22');">
 Work with Folding LSFiles - suggested uses </a></legend></fieldset>
<p>
<div id="22" style="display:none">   
<ul>


<i> <b>  section unfinished; an outline of major points for now </b> </i><br>
<p>
<ol> <li> Literate Programming proper.<br>
<p>
    Emphasis on note-taking rather than producing a polished "essay" or "documentation"<br>
<p>
    Traditional Literate Programming texts place much emphasis on the fact that it is a means of <br>
    providing <i> documentation </i> (albeit with source code, and reflecting the thinking rather<br>
    than machine-imposed order).<br>
    Knuth first thought of LP as a documentation tool, then upgraded it to a "programming paradigm",<br>
    but insisted on writing programs "like literary essays".<br>
<p>
    However I would like to suggest placing emphasis on NOT documenting and NOT producing <br>
    polished code or an essay in thinking. The first use of this programming technique is <br>
    to  <i> keep a full log of your thinking </i> irrespective of how polished or stupid it is.<br>
<p>
    This is most precious. When you first attack a problem, several directions might come to mind,<br>
    but once you began to work out one of then in detail, everything else is lost. This is the<br>
    way human mind works. Keeping even briefest notes is more valuable than attempting to produce<br>
    polished exposition.<br>
<p>
    Psychological restrain people feel when they are compelled to prepare something for other people<br>
    is probably the third major hurdle to wide spreading of L.P. (the first two were flat file <br>
    structure and formatting languages which doubled the effort of programming and debugging).<br>
<p>
    My MOLLY Literate Source file is a log of my thinking, trials and experiments. I might later offer<br>
    a cleaned version to other people, but I do not give a damn about them in the beginning.<br>
<p>
    Non-folding L.P. source files could not accomodate inclusion of old versions, test files, bad<br>
    versions and skeletons without polutting the file to the degree of becoming unusable.<br>
<p>
    Folding version of L.P. source allows one to relegate bad trials into subsections  nicely folded<br>
    out of the way by merely adding a single header line.<br>
<p>
    When creating documentation, I could double the content of some sections, by copy-pasting the<br>
    "cleaned" versions, and then save a version with the original snippets bypassed, which is<br>
    easy and mechanical with tools like "gema", "awk" or "perl", just put a code word like<br>
    "scrap" in the beginning and end of those sections you'd like to avoid.<br>
<p>
    This ability to bypass marked sections when weaving, by the way, might be incorporated as an<br>
    option into a future version of MOLLY, to produce both 'clean' and 'dirty' versions of the<br>
   formatted Literate Source doc from one file.<br>
<p>
</li> <li> Use as a combined Project file<br>
    <ul> <li> to include tests and snippets that implement skeleton functionality to<br>
    be embedded into the main program<br>
    </li> <li> to include versioning and changes in the way  that does not break what<br>
    has been working so far (there was even a special term for that as a programming <br>
    principle). Keep the old version, put it into a subsection, and rename the chunk<br>
    to bypass it. The newer version of the piece of code that is being reworked will<br>
    get the old chunk name to be included into the chain to tangle out.<br>
    </li> <li> To keep a makefile (split, to which I can add lines from many places in<br>
    my Literate Source as I grow it) together with source file(s)<br>
    </li> <li> To keep several source files related logically in teh same Literate Source file.<br>
    </li> </ul><br>
<p>
    <i> Folding meta-files </i> could be used for larger projects, in which <br>
    the meta-file, a folding document, would describe teh topmost level layout of the <br>
    project, and contain ordinary HTML links to partial Folding Literate Sourcefiles, which<br>
    will keep all the junk as described above.<br>
<p>
    In any case, the use of Folding Literate Source files would considerably simplify tracking<br>
    of the project files in a version control system.<br>
<p>
</li> <li> Use for system administration etc. - as a single file to keep many sysadmin scripts, <br>
    descriptions of conventions and procedures, bugs and changes in the system <b> <i> in one place </i> </b><br>
    from which any of the included source (or texts, if they are kept in the "source chunks") <br>
    can be obtained easily with a single command.<br>
    ALSO: combine LIterate Source project file with a makefile as a simple means to keep <br>
    one-command tangling of multiple targets.<br>
<p>
    This Literate Source can live in a central place (e.g. root home) and be under version control.<br>
    The tangled pieces, config files or scripts could be copied to files on one or many machines.<br>
<p>
</li> <li> Use for non-programming tasks:<br>
    <ul> <li> as a note-keeper. E.g. I kept job listings and followi-up info in a folding<br>
   MOLLY file and found it quite convenient. <br>
    </li> <li> as an outliner for general purpose texts.<br>
    </li> <li> for keeping documentation, books etc. I keep documentation for a number of<br>
    software tools (e.g. "awk", "newlisp", "monotone") in folding format. It <i> is </i> helpful.<br>
    </li> <li> for editorial work on larger texts. The text itself will become "code chunks", <br>
    and editorial remarks and meta-thinking will remain as "documentation" in a Literate <br>
    Source file.<br>
    </li> </ul><br>
<p>
</li> </ol><br>
<p>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('23');">
 scrap </a></legend></fieldset>
<p>
<div id="23" style="display:none">   
<ul>

(a) //CGI and CL invocations - compared to "noweb"<br>
    // dotHTML tagging; alternative tagging, translations<br>
    // alternative tanglers and pass-through tangler; makefile problem<br>
<p>
(b) ideas - how to incorporate tests; how to keep a single project file;<br>
how to set up dummy plugs and alternatives (i.e. to develop without destroying<br>
the old working version)<br>
Maybe: for distribution of a lot of small scripts (admin etc), the  way I used<br>
Makefiles?<br>
<p>
(c) It's possible even to do development in smallest chunks -- and later (e.g. for<br>
outside clients or for higher-level documentation, etc.) to consolidate the tiny fractured <br>
bits and pieces, with plenty of alternatives, dummies, plugs and trials etc. etc.<br>
How? - by tangling those from some certain level and copy-pasting the result into the<br>
Literate Project File.<br>
One could even keep the actual development fractions in a subsection, while retaining<br>
higher-level and cleaner view in higher level sections. I do not care about doubling the<br>
text at all.<br>
<p>
<b>suggestion from a Slashdot 2002 discussion </b>(see ref above) about style or approach:<br>
do not document what the code does (which is redundant, as can be seen from the code itself),<br>
document rather WHY it does it (what's the purpose or the idea).<br>
<p>
<b> Also </b> use this file itself as an example of all illustrated techniques.<br>
<p>
Use <b>"mollify"</b> as  a technical term (insert MOLLY.pl invocation into the LitProject file)<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('23');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('22');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('3');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('24');">
 Literate source of the script </a></legend></fieldset>
<p>
<div id="24" style="display:none">   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('25');">
 Bugs, status, changes </a></legend></fieldset>
<p>
<div id="25" style="display:none">   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('26');">
 versions - CHANGES </a></legend></fieldset>
<p>
<div id="26" style="display:none">   
<ul>


<p>
Current version:<br>
<ul><li> creates folding documents on the fly..<br>
</li><li> ..based on dotHTML or rawHTML markup <br>
(i.e. either to create new docs or convert existing HTML into folding format);<br>
</li><li> and generates dynamically TOC and code chunks index;<br>
</li><li> ties collapsing/expandind of sections with TOC highlighting;<br>
</li><li> .. and provides pass-through tangling with "noweb".<br>
</li></ul><br>
<p>
This script is a test of the concept (LitProg+folding+dynamic web formatting)<br>
Options for future versions --  3 ideas for now:<br>
<ul><li> add a built-in tangler (while retaining the possibility to tangle<br>
through an external tool, such as "notangle" with all its options and filters).<br>
<p>
</li><li>  &nbsp;  c r e a t e  &nbsp;  a  &nbsp;  f u l l y  &nbsp;  s e l f - c o n t a i n e d  &nbsp;  folding web-based  &nbsp;  w e a v e r  &nbsp; <br>
("Lilit") (plus possibly a built-in tangler).<br>
This can be done in newlisp (www.newlisp.org), which has a built-in httpd<br>
and allows creation of 250k+(size of script) standalone executables on all<br>
major platforms (unix/linux, windows mac).<br>
<p>
</li><li> maybe -  &nbsp;  a d d  &nbsp;  " v i e w s "  &nbsp;  ( a  &nbsp;  l a  &nbsp;  L e o  &nbsp;  v i e w s )  &nbsp;  and maybe editing of single<br>
subsections (in a pop-up term window with a running editor).<br>
This - as I see it now - may/will involve storing each subsection in its <br>
own little file and dynamically concatenating them both for dynamic weaving<br>
and for tangling ( keep a third name, some "scriptname.src" for dumping the<br>
full file to STDOUT?? )<br>
This can be done dynamically: a huge project file will be displayed fully<br>
collapsed, and then only the sections marked open will be dumped to the web<br>
browser dynamically.<br>
The whole thingy can be kept either as a bunch of section-files in a subdir,<br>
or (and/or) in a tar file (gzipped or not, indexed or not).<br>
<p>
<i>How to do it</i><br>
/* Basically, to manage sectionfiles I'd have to code as if those are comments<br>
to a blog entry (and dynamic gathering of them is the same, too. Should be<br>
rather obvious and possibly quite easy*/<br>
This 'views_enabled' mode will switch to sect-files in a ./.molly/ and will<br>
add dynamic links to each section: "edit section" (in an external editor);<br>
"update Literate Source Project file". And the script will start to check the<br>
subdir and dynamically reconstruct its HTML output in this mode.<br>
Same must be true for the "tangler" pre-filter, too - it will reconstruct<br>
the whole before passing it to the "notangle" utility.<br>
<p>
</li><li> Is it possible to do  &nbsp;  " p r o m o t i n g / d e m o t i n g "  &nbsp;   &nbsp;  o f  &nbsp;  b r a n c h e s ? ?  &nbsp; <br>
Is it possible in the view-enabled weaver?<br>
<p>
</li><li>  &nbsp;  a d d  &nbsp;  " w e b  &nbsp;  t a n g l e  &nbsp;  m o d e "  &nbsp; , in which MOLLY will dump coloured diff<br>
of the subsections (or the whole file if not too large), of the current version,<br>
tangled via the browser form versus a file on disk.<br>
(I do it all the time firing fldiff after each tangle - would be convenient to<br>
have the functionality before tangling to disk (with file renaming etc), just<br>
by reloading a page in a browser.<br>
Will need to allow saving files (or some branch of chunks) from the browser, then.<br>
<p>
Do I underuse  &nbsp;   &nbsp;  V i m  &nbsp;  ? - it does have <b> some "diff" mode </b> for side-to-side<br>
display. Just open 2 files, current and prev. vers. and toggle btw one-file<br>
view and edit or side-by-side coloured diff ???<br>
<p>
<i>How to do it</i><br>
.. by first (poss) checking that the files are not identical, and then by<br>
filtering into "diff":<br>
<pre> MOLLY.tangle|diff -y -w --left-column xxz - |less </pre><br>
Just wrap it into html-body-pre tags and colour if there's something in the <br>
right half (not necessary, really)<br>
</li> </ul><br>
<p>
<b> Maybe </b>  have the  &nbsp;   &nbsp;  " c o m p o s i t e  &nbsp;  d o c u m e n t "  &nbsp;  (or "fragmented document") <br>
option for  &nbsp;   &nbsp;  t h e  &nbsp;  s e c o n d - l e v e l  &nbsp;  meta-management  &nbsp;   &nbsp;  o f  &nbsp;  p r o j e c t  &nbsp;  f i l e s  &nbsp; <br>
I.e. one project could be split into many file-sections, and MOLLY weaver will <br>
assemble them into the doc.<br>
OR: I maintain logically consistent pieces in medium-size project files, and<br>
keep a meta-project file with the split option enabled.<br>
The "edit" links from it will pop up gvim or another editor of choice with<br>
the full piece in it.<br>
While viewing will present it all as if one LIterate Source project file.<br>
I'll need only to mark the pieces in the TOC, possibly, as a separate doc,<br>
and -- <b> how will I treat TOC compilation then ? </b><br>
<p>
<b> Maybe </b> - if I find an ASCII script (ascii art from commands and <br>
descriptions), I could automatically generate  &nbsp;   &nbsp;  a s c i i - a r t  &nbsp;  " m a p s "  &nbsp;  <br>
of the chunks ??<br>
<p>
<p>
<b> introduce horizontal/vertical layouts? </b> <br>
I.e. TOC and Chunks Index either on top of the file or on the left of it for<br>
"wide screens", like those on notebooks ??<br>
Changes are in  "Print out the resulting page" (currently line 3359)<br>
 - plus options, of course<br>
<p>
Note: will require gluing TOC or the body to stick at the top, not simple table<br>
cells, which will center and resize depending on relative cell content sizes.<br>
May require separate scrolling for the two panes?<br>
<p>
OR: <b> TOC/Index in a floating window? </b> -- should be easy, just  name the<br>
output windows.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('26');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('27');">
TO DO current</a></legend></fieldset>
<p>
<div id="27" style="display:none">   
<ul>


<p>
<b>1. Problem of double diamonds in doc chunks </b><br>
<ul><br>
    change the pass-through tangler to isolate the "notangle" from docs sections???<br>
    (will squash the prob of double angle brackets in documentation chunks)<br>
<p>
    OR - introduce a sort of escape?? Because sol 1 would clobber correct line numbering??<br>
    But I do not number lines in the default pass-through invocation..<br>
    The standalone will be affected, anyway.<br>
<p>
    I could add regex conversion to hexadecimals in the pass-through tangler.<br>
    However it would still break the "notangle" when run standalone.<br>
<p>
    I could collect command-line options in case of "scriptname.tangle" invocation<br>
    and pass them to "notangle" - that could be a sort of solution.<br>
</ul><br>
<p>
2. Change logic of "weave-tangle" ("main despatcher"), as it is stupidly convoluted <br>
and ugly now<br>
<p>
3 and 8. (++) rawHTML mode, done<br>
<p>
4. (++-) see below in "done"<br>
<p>
5. <b> BUG of sorts </b><br>
the "lt" and "gt" escapes in the code chunks right above ("tangle me with filtering") are not <br>
displayed correctly  by the web weaver: the browser displays them as real angle brackets.<br>
<p>
6. <s>TMLize the error message in the main despatcher (if "I am a module", print it as<br>
an html file). Otherwise it won't look good in the browser. </s> <br>
<b> NOT NEEDED </b> as "tangling" is done from CL only<br>
<p>
7. Add another mode - if file ext is "src" - "scriptname.src" - do not pass to "notangle", but<br>
dump the pre-filtered source to STDOUT.<br>
May be needed in some cases, who knows?? - i.e. to escape special symbols, such as double-&lt;'s <br>
etc in documentation chunks.<br>
Ordinarily, this is not needed and the file can be processed by "notangle" directly.<br>
This step is needed to tangle some non-default pieces or to use some extra tangling options.<br>
<p>
9 (++). DATA or ---start of script-- to filter?? - done<br>
<p>
10. Add "expand subthread" ?? - to open only the current branch of the L.T.File?<br>
<p>
11. Add auto-href creation (i.e. posting a URL with minimal markup must create a valid<br>
    HTML link with URL as the name of it.<br>
<p>
12 (+--). and checking <br>
qwer qwer  &nbsp;  s p a c i n g  &nbsp;  of one word and <i> &nbsp;  o f  &nbsp;   &nbsp;  m a n y  &nbsp;   &nbsp;  o n  &nbsp;   &nbsp;  t h e  &nbsp;   &nbsp;  s a m e  &nbsp;  l i n e  &nbsp; </i> asdf asd  <br>
SO: to do word boundaries properly.<br>
DONE although not very cleanly. The tag will break across several lines<br>
<p>
13. Add a full set of HTML escapes to "dotHTML" and "rawHTML" ?<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('27');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('28');">
DONE </a></legend></fieldset>
<p>
<div id="28" style="display:none">   
<ul>


<p>
<b> 1. Adding TOC open/collapsed section indication </b><br>
Changes must be made in:<br>
"weave me" ==&gt; "JS script functions" && "stylesheet"<br>
// as expl in the ref section below <br>
<p>
AND in<br>
"Accumulate the result" ==&gt; "process section headings"<br>
// the actual invocation "onmousedown"<br>
<p>
<p>
<b> 2. Synchronize TOC and sections </b><br>
I have done highlighting; now two more steps:<br>
    <ul> (a) make body sections run "toggleCombined" rather that directly<br>
    open/close the "div"s/sections - to highlight the TOC at the moment<br>
    of change<br>
    (b) make TOC bg. highlighting recognize the "+" signs in the html headings<br>
    markup.<br>
    </ul><br>
This is not difficult, just needs a little attention.<br>
<p>
To do (b) NEED to rewrite <br>
<pre> &lt;div id="$section_num" style="display:$fold_state"&gt;  </pre><br>
in line appr. 370 to add inline javascript invocation of expandDiv<br>
<p>
3. see 8.<br>
Add "pass-through" direct HTML dummy encoder (plus a switch btw rawHTML and dotHTML)<br>
Explain  the user can expand the script in any way he wishes (e.g. with a "wiki" syntax)<br>
<p>
(++-)4. I still need to do at least a <b> stub in tangler </b> to do some pre-filtering before<br>
calling "notangle".<br>
E.g. I might want to reassign the double-&lt; and double-&gt; or other symbols for some esoteric<br>
languages, or filter out escapes from documentation chunks for the notangle not to choke.<br>
<p>
NO SWITCH yet to select from pre-tangle filters or built-in tangler.<br>
<p>
(++) 8. Weaving -- "dotHTML" versus "rawHTML".<br>
Version MOLLY-0.62-BAD.pl is incorrect. It's "dot" markup is OK, but for "raw" to work <br>
<i> regexps must be changed </i> in the main filtering "if - elsif - else", as headers<br>
will too be in angle brackets, not in dots.<br>
<p>
<b> May be a good idea to extract those regexps </b> and assign them to vars, as now<br>
they are coded in, bad.<br>
<p>
9. See "accumulate result in a buffer"<br>
Should I make the "----start of script--" line unnecessary (relying on __DAT A__ ) ??<br>
Or =- both? or no "data" (as it throws off editors highlighting) ???<br>
<b> set to react to DATA not "start of script"</b><br>
<p>
<p>
<b> Bug with setting default for $print_toc fixed</b> --  must check for "defined", the perl operator<br>
xx?aa:bb checks for 0 or non-0, and so if the var equals 0 it will never set it to 0.<br>
Changed and tested.<br>
Maybe should use "yes" and "no" instead of "1" and "0"?<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('28');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('25');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('29');">
 The script layout and idea </a></legend></fieldset>
<p>
<div id="29" style="display:none">   
<ul>

.. are very simple.<br>
<p>
<b>1. </b> It is possible to include an invocation of a  perl script with <br>
<pre> "do script.pl" or "use script.pl"  </pre><br>
as the first lines in a Literate Source file.  This turns the source into a standalone perl script. <br>
If we write the script to process the L.Source file itself ($0 in perl parlance) then the script can do <br>
weaving and tangling of it. The output, which is formatted documentation (which was "weaved" from L.P.) <br>
or the sources usable by a computer ("tangled") can be  saved in a file, as with traditional "literate <br>
programming" tools. But which is more convenient, the formatted documentation can be  picked up by a web  <br>
server, and thus allow us to see work in progress immediately and automatically. <br>
<p>
When I think, I prefer to look at the formatted document, and when I change, I do it "locally" in a good<br>
programming editor (such as "vim"). Even with vim folding the difference in perception is enormous.<br>
<p>
<b> 2. </b>I see three advantages to such an arrangement:  <br>
<ul><li>first, web markup is ubiquitous today, and it is quite sufficient for most publishing needs. <br>
So Literate Programming with HTML will free us from a tie to TeX which so negatively affected <br>
perception of L.P. by the masses of programmers. The markup becomes very, very simple. <br>
<p>
This eliminates a source of one major complaint about the traditional L.P. - that the programmer has <br>
to maintain not one, but two "programming languages" while working with LP, the target one<br>
and the formatting one. This - the complaint goes - becomes a source of errors from an additional layer <br>
of programming in addition to writing the code itself. It taxes the programmer's mind rather than relieving<br>
it.<br>
<p>
In fact, simple HTML is almost self-correcting, as wrong markup becomes immediately obvious in the <br>
browser. <br>
<p>
</li> <li> secondly, this eliminates "weaving" as a separate step during development, but more<br>
importantly, such an arrangement allows a programmer to think about his program while looking<br>
at a <i>folding</i> document, in which only relevant sections are open.<br>
<p>
I perceive <i> folding </i> as a major advantage<br>
<p>
With <i>folding</i> the Literate Source file becomes manageable even for really large texts. This in turn<br>
allows the programmer to keep <i> many files </i> inside the LPSource, including test snippets, the makefile,<br>
preserve old versions of parts of the source etc. etc.<br>
Literate Source file is painlessely turned into a Project File, one file, from which anything can be<br>
easily generated.<br>
It is this one file that my version control system must track now. For really large projects, we can keep<br>
a meta-file (also in the folding format) with largish partial files as links, corresponding to logical <br>
pieces of the project, which will open in the browser as automatically weaved Literate Source Files.<br>
<p>
I attempted to explain this at length in introductory sections above.<br>
</li></ul><br>
<p>
<b>3. </b> The script that programs this functionality can assemble all pieces as buffered strings in RAM: today's <br>
machines routinely contain RAM in Gigabytes, therefore processing in memory a very large source or <br>
project file  in Megabytes, even in tens of Megabytes is not a problem. <br>
<p>
<b>4. </b> How the script works overall<br>
<p>
After figuring out how it was invoked, the script:<br>
<ul><li> <b>when it is supposed to weave</b>, scans into memory the Literate Source file, marked up in "noweb" <br>
notation (and its document sections marked with raw HTML or in "dotHTML") doing necessary substitutions <br>
and conversions along the way.<br>
Then the buffered string thus formed and several auxilliary buffers (for document TOC and Index <br>
sections) are printed out to STDOUT. They can be redirected into files, if LPSource, now also an executable<br>
script itself, is run from command line, or they can be picked up by a local personal web server that is<br>
used by the developer, which  should recognize the LPSource as a valid CGI script<br>
<p>
After any changes in the script, the user can reload the page in his web browser and immediately see the<br>
changes.<br>
<p>
</li><li> <b>If invoked to tangle</b> the source of the program, this version of the script will refer the <br>
actual  tangling to the "notangle" utility from "noweb" suite of tools by Ramsey.<br>
</li></ul><br>
<b>5. </b>  &nbsp;   &nbsp;  A  &nbsp;  f u t u r e  &nbsp;  v e r s i o n  &nbsp;  of the script may be made completely self-contained, i.e. include a mini-web <br>
server as well as a folding weaver and a tangler.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('29');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('30');">
 MOLLY.pl - top of the script </a></legend></fieldset>
<p>
<div id="30" style="display:none">   
<ul>


<p>
<font class='lnum'>1112</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;MOLLY.pl module&gt;&gt;=</legend>
<font class='lnum'>1113</font>   #!/usr/bin/perl
<font class='lnum'>1114</font>   
<font class='lnum'>1115</font>   #---------------------------------------------------------------------------------    
<font class='lnum'>1116</font>   #----------------------Script proper----------------------------------------------
<font class='lnum'>1117</font>   
<font class='lnum'>1118</font>   
<font class='lnum'>1119</font>   <font class='chunkref'>&lt;&lt;general settings&gt;&gt</font>;
<font class='lnum'>1120</font>   <font class='chunkref'>&lt;&lt;main despatcher&gt;&gt</font>;
<font class='lnum'>1121</font>   <font class='chunkref'>&lt;&lt;tangle me&gt;&gt</font>;
<font class='lnum'>1122</font>   <font class='chunkref'>&lt;&lt;weave me&gt;&gt</font>;
<font class='lnum'>1123</font>   
<font class='lnum'>1124</font>   # END OF SCRIPT
<font class='lnum'>1125</font>   </fieldset></pre>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('31');">
 general settings </a></legend></fieldset>
<p>
<div id="31" style="display:none">   
<ul>


<p>
<p>
Some internal script parameters are set here.<br>
E.g. "noweb" tangler gets confused if it finds double angle brackets<br>
anywhere, so sometimes it's possible to fool it by setting a var in the<br>
perl script like this:<br>
<p>
<font class='lnum'>1138</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1139</font>     # need to fool the noweb "notangle" utility, switch markup modes etc.
<font class='lnum'>1140</font>     $lt = "&lt;";
<font class='lnum'>1141</font>     $gt = "&gt;";
<font class='lnum'>1142</font>     $lt_esc = "&lt;";
<font class='lnum'>1143</font>     $gt_esc = "&gt;";
<font class='lnum'>1144</font>     $dash = "-";
<font class='lnum'>1145</font>     $dot = "\.";
<font class='lnum'>1146</font>   </fieldset></pre>
<p>
But more importantly:<br>
There are a number of parameters that can be set from the literate source file<br>
at the very top before loading the module with "do MOLLY.pl" (or "use MOLLY.pl").<br>
These are assigned defaults here. You can refer to this portion of the script<br>
to find out what parameters are settable in your document template and expand the<br>
tunings if you modify MOLLY.pl<br>
<p>
<font class='lnum'>1155</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1156</font>   
<font class='lnum'>1157</font>     # ----- GENERAL settings -----
<font class='lnum'>1158</font>     
<font class='lnum'>1159</font>     # am I a module? 1:0
<font class='lnum'>1160</font>     $i_am_module = 1;
<font class='lnum'>1161</font>   
<font class='lnum'>1162</font>     # print toc? 1:0
<font class='lnum'>1163</font>     $print_toc = 1 unless defined $print_toc;
<font class='lnum'>1164</font>       
<font class='lnum'>1165</font>     # keep TOC expanded on initial load? "block":"none"
<font class='lnum'>1166</font>     $toc_expanded = $toc_expanded || "block";
<font class='lnum'>1167</font>   
<font class='lnum'>1168</font>     # keep TOC expanded in initial load? "block":"none"
<font class='lnum'>1169</font>     $ind_expanded = $ind_expanded || "none";
<font class='lnum'>1170</font>   </fieldset></pre>
<p>
The script will behave differently depending on its own name. One "major" name<br>
can be used with others existing as soft links (although an "thttpd" lightweight<br>
web server insisted on a hard link in one case).<br>
The modes are detected by file extensions, which are set here.<br>
'Weaving' = creating a formatted HTML documentation file on STDOUT<br>
'Tangling' = creating the program/script source on STDOUT<br>
<p>
<font class='lnum'>1179</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1180</font>     # what is the file extention to weave it? (perms must allow execution!)
<font class='lnum'>1181</font>     # e.g. "scriptname.weave" or "scriptname.cgi" etc.
<font class='lnum'>1182</font>     $weave_extension = $weave_extension || "weave";	# default is "weave"
<font class='lnum'>1183</font>   
<font class='lnum'>1184</font>       # what is the file extention to tangle it? (perms must allow execution!)
<font class='lnum'>1185</font>       # e.g. "scriptname.tangle",  "scriptname.pl" etc.
<font class='lnum'>1186</font>       $tangle_extension = $tangle_extension || "tangle";	# default is "tangle"
<font class='lnum'>1187</font>   
<font class='lnum'>1188</font>   
<font class='lnum'>1189</font>   
<font class='lnum'>1190</font>     # tangle? Or run? (perms must allow execution)
<font class='lnum'>1191</font>     $tangle_me = 1;
<font class='lnum'>1192</font>   
<font class='lnum'>1193</font>         # -- not implemented yet --
<font class='lnum'>1194</font>         #
<font class='lnum'>1195</font>         #$run_me = 0;
<font class='lnum'>1196</font>         # what interpreter to run the tangle output with?
<font class='lnum'>1197</font>         #$run_me_with="/usr/bin/perl";
<font class='lnum'>1198</font>   
<font class='lnum'>1199</font>   
<font class='lnum'>1200</font>   # number lines ? 1 : else
<font class='lnum'>1201</font>   $line_numbering = 1;
<font class='lnum'>1202</font>   </fieldset></pre>
<p>
The document sections ("chunks") can be marked with actual HTML tags ("rawHTML") or<br>
with a smaller number of the same tags in "dots" in place of "angle brackets", i.e.<br>
dot-br-dot, not open.angle-br-closing.angle<br>
This is selected here:<br>
<p>
<font class='lnum'>1209</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1210</font>   # how are doc sections marked? "dotHTML":"rawHTML"
<font class='lnum'>1211</font>   $weave_markup = $weave_markup || "rawHTML"; # default is "rawHTML"
<font class='lnum'>1212</font>   
<font class='lnum'>1213</font>       if ($weave_markup eq "dotHTML") {
<font class='lnum'>1214</font>   	$tag_open_symbol = $dot;	# this will take care of default
<font class='lnum'>1215</font>   	$tag_close_symbol = $dot;	# when no var is set in the Lit Src file
<font class='lnum'>1216</font>       }
<font class='lnum'>1217</font>       elsif ($weave_markup eq "rawHTML") { 
<font class='lnum'>1218</font>   	$tag_open_symbol = $lt;
<font class='lnum'>1219</font>   	$tag_close_symbol = $gt;
<font class='lnum'>1220</font>       } #fi
<font class='lnum'>1221</font>   
<font class='lnum'>1222</font>   </fieldset></pre>
<p>
It would make sense to add a few more markups to the program, i.e. some "wiki" many use,<br>
and some TeX basic tags for automatic translation, if the doc is tagged as a TeX file.<br>
<p>
In more detail dotHTML is explained in its own section<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('31');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('32');">
 main despatcher </a></legend></fieldset>
<p>
<div id="32" style="display:none">   
<ul>


<p>
The script figures out how it was invoked and then starts either a tangler<br>
or a weaver, or fails with a usage line.<br>
<p>
If the script name ends in "weave" (e.g. script.weave), it will be weaved to STDOUT.<br>
If the name ends in "tangle", the source starting from the default chunk &lt; &lt;*&gt; &gt;<br>
(without spaces) will be dumped to STDOUT:<br>
<p>
<font class='lnum'>1244</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher&gt;&gt;=</legend>
<font class='lnum'>1245</font>   <font class='chunkref'>&lt;&lt;main despatcher kludgy&gt;&gt</font>;
<font class='lnum'>1246</font>   </fieldset></pre>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('33');">
 With tanglediffs as an option </a></legend></fieldset>
<p>
<div id="33" style="display:none">   
<ul>

<b>To add "tangled diffs"</b>  through a broser - i.e. output of <br>
<pre>  MOLLY.tangle | diff -y -w --left-column xxz - |less </pre><br>
<p>
1. To colour the script must hard-set "width":<br>
<pre> diff -W130 ......... # 130 is the default </pre><br>
The separation line runs at &lt; width/2 (e.g. at pos 63 if W=130, at 87 if W=190 etc<br>
So I can recognize "changed" lines to colour if length($line) &gt;= Width/2 ?? (or strictly more)<br>
But figuring out at which pos the separation line runs without hardcoding W is not obvious to me.<br>
<p>
Another alternative might be to use an external code colourizer, such as vim ??<br>
<p>
<p>
<p>
2. I'll have to redo the despatcher's logic:<br>
<ul> check REQUEST_METHOD if it si GET, then weave for "xx.weave" extensions, <br>
do tanglediffs for the "scriptname.tangle" extension, and do real tangle if <br>
REQUEST_METHOD is not set.<br>
The tanglediffs will be controlled by cgi query string (i.e. disassemble and<br>
match QUERY_STRING).<br>
The tanglediffs will present a form to select a disk file to tanglediff against;<br>
subsequent views of output can be done by reloading the page in a browser.<br>
</ul><br>
<p>
<font class='lnum'>1272</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher with tanglediffs&gt;&gt;=</legend>
<font class='lnum'>1273</font>   ;
<font class='lnum'>1274</font>   
<font class='lnum'>1275</font>   </fieldset></pre>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('34');">
 a skeleton script to test this snippet </a></legend></fieldset>
<p>
<div id="34" style="display:none">   
<ul>

To test: <br>
<ol><li>save as test.weave, hard link to test.tangle and test.pl<br>
</li><li> and set thttpd.conf to treat x.tangle as cgi<br>
</li></ol><br>
<p>
<font class='lnum'>1283</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tanglediff test 1&gt;&gt;=</legend>
<font class='lnum'>1284</font>   #!/usr/bin/perl
<font class='lnum'>1285</font>   
<font class='lnum'>1286</font>   if ( $0 =~ m!\.tangle$! ) { 
<font class='lnum'>1287</font>       if ($ENV{'REQUEST_METHOD'}){ goto TANGLEDIFF_ME }
<font class='lnum'>1288</font>       else { goto TANGLE_ME; }
<font class='lnum'>1289</font>   }
<font class='lnum'>1290</font>   elsif ( $0 =~ m!\.weave$! ) {
<font class='lnum'>1291</font>       goto WEAVE_ME
<font class='lnum'>1292</font>   }
<font class='lnum'>1293</font>   else {
<font class='lnum'>1294</font>       #output error message and usage 
<font class='lnum'>1295</font>       exit;
<font class='lnum'>1296</font>   }
<font class='lnum'>1297</font>   
<font class='lnum'>1298</font>   TANGLE_ME:
<font class='lnum'>1299</font>       print "I am being tangled\n";
<font class='lnum'>1300</font>       exit;
<font class='lnum'>1301</font>   
<font class='lnum'>1302</font>   TANGLEDIFF_ME:
<font class='lnum'>1303</font>       #disassemble and check the query string here
<font class='lnum'>1304</font>       #and accordingly do a primitive protocol:
<font class='lnum'>1305</font>   	# output file selection form of none
<font class='lnum'>1306</font>   	# show the diff if selected, e.g. 
<font class='lnum'>1307</font>   	#   "script.tangle?filename_on_disk_to_tanglediff_against"
<font class='lnum'>1308</font>       
<font class='lnum'>1309</font>       #debug:
<font class='lnum'>1310</font>       print "I am in a tanglediffer\n";
<font class='lnum'>1311</font>       exit;
<font class='lnum'>1312</font>   
<font class='lnum'>1313</font>   WEAVE_ME:
<font class='lnum'>1314</font>       print "I am in a weaver\n";
<font class='lnum'>1315</font>       exit;
<font class='lnum'>1316</font>   
<font class='lnum'>1317</font>   </fieldset></pre>
<p>
<b>also</b> where there were "weaver" and "tangler" before, I'll have one more "tanglediff"<br>
subsection below to set the "diff" invocation and dumping its output.<br>
<p>
<i>Question for the tanglediffe</i>r - should I have an option to directly dump the result <br>
of tangling into a browser, or is it unnecessary?<br>
<p>
<i> NOTE </i> the tanglediffer and tangler may share some pre-processing part needed for<br>
clean tangling. Then the separation will be different:<br>
the tangle-tanglediff switch will live inside TANGLE_ME<br>
<p>
<b><i>NOTE 2</i></b> Should I simplify it even more? -- rather than making distinction by the name<br>
extension and forcing the user to create hard links and reconfigure the web server (imposs.<br>
if it is not a local server, but say an html-served subdir in his home dir) -- why don't I<br>
<i>start the mode from a hyperlink</i> ??<br>
The mode will be identified from the QUERY_STRING (or CL options), and the code providing<br>
it is of course still inside MOLLY.pl.<br>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('34');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('35');">
 With wavediff and tanglediff?? </a></legend></fieldset>
<p>
<div id="35" style="display:none">   
<ul>

I could also do "weavediff" and "tanglediff" for ease of checking in the browser.<br>
<p>
<ul>     &nbsp;  w e a v e d i f f  &nbsp;  - checked, looks bad: huge and not well-readable after a few changes.<br>
    Main prob: executing "weave" produces HTML, so I'll need to execute the other file on<br>
    disk too, or save HTMLs, both are cumbersome options<br>
    SO: no "weavediff"<br>
</ul><br>
<p>
In that case the despatcher will be different:<br>
<p>
<font class='lnum'>1350</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tanglediff.test2.pl&gt;&gt;=</legend>
<font class='lnum'>1351</font>   #!/usr/bin/perl
<font class='lnum'>1352</font>   
<font class='lnum'>1353</font>   $weave_extension = "weave";
<font class='lnum'>1354</font>   $tangle_extension = "tangle";
<font class='lnum'>1355</font>   
<font class='lnum'>1356</font>   
<font class='lnum'>1357</font>   # -- a call for the weaver --
<font class='lnum'>1358</font>   if ( $0 =~ m!\.$weave_extension$! ) {
<font class='lnum'>1359</font>   
<font class='lnum'>1360</font>       # --- a call from CGI ---
<font class='lnum'>1361</font>       if ($ENV{'REQUEST_METHOD'}){
<font class='lnum'>1362</font>   
<font class='lnum'>1363</font>   	print "\nFIRST OF ALL, THIS IS A CALL TO WEAVER\n";
<font class='lnum'>1364</font>   
<font class='lnum'>1365</font>   	#pull and process QUERY_STRING to weave or tanglediff
<font class='lnum'>1366</font>   	
<font class='lnum'>1367</font>   	if ( $ENV{'QUERY_STRING'} eq "" ) {
<font class='lnum'>1368</font>   
<font class='lnum'>1369</font>   	    print "&lt;html&gt;&lt;body&gt;\n";
<font class='lnum'>1370</font>   	    print "a CGI call for weaving&lt;br&gt;\n";
<font class='lnum'>1371</font>   	    print "&lt;/body&gt;&lt;/html";
<font class='lnum'>1372</font>   	}
<font class='lnum'>1373</font>   
<font class='lnum'>1374</font>   
<font class='lnum'>1375</font>   	elsif ( $ENV{'QUERY_STRING'} eq "diff") {
<font class='lnum'>1376</font>   	    print "here I should output the file selection form for tangle-diff\n"
<font class='lnum'>1377</font>   	}
<font class='lnum'>1378</font>   	elsif ($ENV{'QUERY_STRING'} =~ m!^diff&(.*)$! ) {
<font class='lnum'>1379</font>   
<font class='lnum'>1380</font>   	    # check the supposed filename is an allowed alphanumeric:
<font class='lnum'>1381</font>   	    # convert spaces into underscores and check for match to "\w+"
<font class='lnum'>1382</font>   	    print "a call from CGI for a diff with some file.. going to check if it exists..\n";
<font class='lnum'>1383</font>   
<font class='lnum'>1384</font>   	    # for the test - just get the file
<font class='lnum'>1385</font>   	    # /if the file with such a name exists, of course/
<font class='lnum'>1386</font>   	    if (-f $1) {
<font class='lnum'>1387</font>   
<font class='lnum'>1388</font>   		# then run the piped command like
<font class='lnum'>1389</font>   		# scriptname.tangle | diff -y -w --left-column xxz -
<font class='lnum'>1390</font>   		print "here tanglediff pipe will be with the given file\n"
<font class='lnum'>1391</font>   
<font class='lnum'>1392</font>   	    } # fi rung the tanglediff pipe
<font class='lnum'>1393</font>   	} # fi this is CGI GET args for tanglediffing
<font class='lnum'>1394</font>   	else {
<font class='lnum'>1395</font>   	    print "a call from CGI to the weaver -- with unknown arguments&lt;br&gt;\n";
<font class='lnum'>1396</font>   	}
<font class='lnum'>1397</font>   
<font class='lnum'>1398</font>       } # this was a call from CGI
<font class='lnum'>1399</font>   
<font class='lnum'>1400</font>       # --- a call from CL ---
<font class='lnum'>1401</font>       else {
<font class='lnum'>1402</font>   	#process command-line args
<font class='lnum'>1403</font>   	# to weave or weavediff or tanglediff
<font class='lnum'>1404</font>   	print "this is a call from CL\n";
<font class='lnum'>1405</font>   	print " arg1 is $ARGV[0] -- arg2 is $ARGV[1]\n";
<font class='lnum'>1406</font>   	print "The same 3 options will apply: weave, ask for selection and tanglediff\n";
<font class='lnum'>1407</font>       } # esle, fi -- this was a call from command line
<font class='lnum'>1408</font>   }
<font class='lnum'>1409</font>   
<font class='lnum'>1410</font>   # -- a call for the tangler -- 
<font class='lnum'>1411</font>   elsif ( $0 =~ m!\.$tangle_extension$! ) {
<font class='lnum'>1412</font>   
<font class='lnum'>1413</font>       # do direct tangling
<font class='lnum'>1414</font>       # will not execute in the browser, as the web server
<font class='lnum'>1415</font>       # does not allow it?? -- or filter on REQUEST_METHOD, too?
<font class='lnum'>1416</font>       print "a CL call for tangling\n";
<font class='lnum'>1417</font>   
<font class='lnum'>1418</font>   }
<font class='lnum'>1419</font>   
<font class='lnum'>1420</font>   # -- a call for other extensions --
<font class='lnum'>1421</font>   else {
<font class='lnum'>1422</font>       #print usage
<font class='lnum'>1423</font>       print "a call with an unknown extension or a call to 'tangle' from under CGI\n";
<font class='lnum'>1424</font>       print "Not allowed, printing usage..\n";
<font class='lnum'>1425</font>   }
<font class='lnum'>1426</font>   
<font class='lnum'>1427</font>   </fieldset></pre>
<p>
<p>
<b> So </b> this one seems to be Ok, although I still dislike its cludginess. I'd like a<br>
better options processing skeleton script.<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('35');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('33');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('36');">
 "Main despatcher kludgy" - first version - no tanglediffs </a></legend></fieldset>
<p>
<div id="36" style="display:none">   
<ul>

<p>
<i> To add here: </i><br>
command line options parsing??<br>
Error/usage message should be html-ized too??<br>
<p>
<font class='lnum'>1445</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher kludgy&gt;&gt;=</legend>
<font class='lnum'>1446</font>     # -- MAIN DESPATCHER ----
<font class='lnum'>1447</font>   
<font class='lnum'>1448</font>     # check if $i_am_module and set filenames to $0 - or 
<font class='lnum'>1449</font>     # process CL options otherwise
<font class='lnum'>1450</font>   
<font class='lnum'>1451</font>     # (temp) - 2 options, to weave and to tangle in module mode:
<font class='lnum'>1452</font>     #
<font class='lnum'>1453</font>     if ( $0 =~ m!\w+\.$weave_extension$! ) { goto WEAVE_ME }
<font class='lnum'>1454</font>     elsif ( $tangle_me) {goto TANGLE_ME}
<font class='lnum'>1455</font>     else {
<font class='lnum'>1456</font>     print &lt;&lt;end_of_print;
<font class='lnum'>1457</font>   
<font class='lnum'>1458</font>   	USAGE:
<font class='lnum'>1459</font>   	Not set to tangle.
<font class='lnum'>1460</font>   	Set variables at the beginning of the script properly.  
<font class='lnum'>1461</font>   
<font class='lnum'>1462</font>   end_of_print
<font class='lnum'>1463</font>     }
<font class='lnum'>1464</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('36');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('32');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('30');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('37');">
 Tangler </a></legend></fieldset>
<p>
<div id="37" style="display:none">   
<ul>


<p>
This version of the script does not include a built-in tangler, and therefore<br>
if you set "$tangle_me" to 1 in the settings, the script will pass ithe request through<br>
the "notangle" utility of the "noweb" Literate Programming tool to tangle starting with <br>
<i>the default chunk &lt; &lt;*&gt; &gt;</i>   and without other options passed. I only set "notangle" <br>
below to preserve the tabs in case you are tangling Makefiles.<br>
<p>
So, when the script is invoked as "script.tangle" (which can be a link or a soft<br>
link to something like "script.weave", it's "real" name), it will dump the source<br>
to STDOUT, very convenient for development.<br>
<p>
I usually move the root chunk &lt; &lt;*&gt; &gt; along inside the LIterate Source project<br>
file and assign it to the test script or the part I am working on. The Literate Source<br>
project file includes several actual source files usually. By the way, it's quite<br>
nice to be able to keep all partial tests that you do before including those into<br>
the target program all in one place, your common project file.<br>
<p>
To tangle with more specific options, run "notangle" directly on your "mollified"<br>
literate source file, e.g.<br>
<pre>notangle -R my_root_chunk -L script.weave </pre><br>
<p>
Later other modes of operation may be incorporated here.<br>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('38');">
 pass-through tangler </a></legend></fieldset>
<p>
<div id="38" style="display:none">   
<ul>


<p>
Passes the request to "notangle" from the "noweb" literate tools suite.<br>
<p>
<font class='lnum'>1506</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tangle me&gt;&gt;=</legend>
<font class='lnum'>1507</font>   <font class='chunkref'>&lt;&lt;tangle me with filtering&gt;&gt</font>;
<font class='lnum'>1508</font>   </fieldset></pre>
<p>
<p>
<font class='lnum'>1511</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tangle me straight&gt;&gt;=</legend>
<font class='lnum'>1512</font>   
<font class='lnum'>1513</font>   
<font class='lnum'>1514</font>   TANGLE_ME:
<font class='lnum'>1515</font>   
<font class='lnum'>1516</font>   	open TANGLE_PIPE, "| notangle -t4 -";
<font class='lnum'>1517</font>   
<font class='lnum'>1518</font>   	open MYSELF, "&lt;$0";
<font class='lnum'>1519</font>   	while  (&lt;MYSELF&gt;) {
<font class='lnum'>1520</font>   	    # filter here
<font class='lnum'>1521</font>   	    # filter here and
<font class='lnum'>1522</font>   	print TANGLE_PIPE $_;
<font class='lnum'>1523</font>   	}
<font class='lnum'>1524</font>   
<font class='lnum'>1525</font>   	close TANGLE_PIPE;
<font class='lnum'>1526</font>   	close MYSELF;
<font class='lnum'>1527</font>   exit;
<font class='lnum'>1528</font>   
<font class='lnum'>1529</font>   </fieldset></pre>
<p>
Pre-filtering might need to bo done. E.g. "notangle" gets confused by double angle brackets<br>
even when those are inside the document chunks.<br>
Therefore I could escape those before passing them to the tangler.<br>
<p>
This of course is kind of stupid, as running 'notangle' without this pre-filter will still<br>
break it, e.g.<br>
if I want to do it from command-line with some special options or for a non-root chunk,<br>
<p>
This is not a full solution in itself. Consider it as a template for pre-filtering, sort of.<br>
<p>
<font class='lnum'>1541</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tangle me with filtering&gt;&gt;=</legend>
<font class='lnum'>1542</font>   
<font class='lnum'>1543</font>   
<font class='lnum'>1544</font>   TANGLE_ME:
<font class='lnum'>1545</font>   
<font class='lnum'>1546</font>   	open TANGLE_PIPE, "| notangle -t4 -";
<font class='lnum'>1547</font>   
<font class='lnum'>1548</font>   	open MYSELF, "&lt;$0";
<font class='lnum'>1549</font>   	while  (&lt;MYSELF&gt;) {
<font class='lnum'>1550</font>   
<font class='lnum'>1551</font>   	    if ( m!^(goto)?&lt;\&lt;(.*)&gt;\&gt;=! ... m!^@\s*$! ) { # -- CODE CHUNKS -- 
<font class='lnum'>1552</font>   		print TANGLE_PIPE $_;
<font class='lnum'>1553</font>   	    }
<font class='lnum'>1554</font>   	    else {  # -- DOC CHUNKS /and beginning of file, irrelevant / --
<font class='lnum'>1555</font>   
<font class='lnum'>1556</font>   		# filter double angle brackets that confuse "notangle"
<font class='lnum'>1557</font>   		s/&lt;&lt;/$lt_esc$lt_esc/g;
<font class='lnum'>1558</font>   		s/&gt;&gt;/$gt_esc$gt_esc/g;
<font class='lnum'>1559</font>   		print TANGLE_PIPE $_;
<font class='lnum'>1560</font>   	    }
<font class='lnum'>1561</font>   
<font class='lnum'>1562</font>   	} # elihw
<font class='lnum'>1563</font>   
<font class='lnum'>1564</font>   	close TANGLE_PIPE;
<font class='lnum'>1565</font>   	close MYSELF;
<font class='lnum'>1566</font>   exit;
<font class='lnum'>1567</font>   
<font class='lnum'>1568</font>   </fieldset></pre>
<p>
<b> BUG of sorts </b><br>
the "lt" and "gt" escapes in the code chunks right above ("tangle me with filtering") are not <br>
displayed correctly  by the web weaver: the browser displays them as real angle brackets.<br>
<s>I could avoid this  by using $lt and $gt perl vars defined in "general settings" for exactly<br>
cases like this.</s><br>
I <i>cannot</i> avoid this without setting another couple of perl vars: $gt_esc = "& gt;" etc. ...<br>
<p>
I do have lines with the same problem in the "dotHTML formatter" chunk as well.<br>
<p>
<p>
<p>
<b> Immediate execution of the script </b><br>
It did not work exactly, but then I did not try it for real -- if it is needed and if your<br>
language supports taking input from STDIN, it may be possible also to immediately run your<br>
script skipping the stage of "tangling-into-a-file" before running.<br>
To be added (possibly).<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('38');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('39');">
 Tests and snippets for a built-in tangler </a></legend></fieldset>
<p>
<div id="39" style="display:none">   
<ul>


<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('40');">
 1. Use MD5 for chunk titles? </a></legend></fieldset>
<p>
<div id="40" style="display:none">   
<ul>

Chunk names are free phrases in a human lang. I need poss. to make a hash of contents with<br>
the title as  the key. A phrase is not good for that, so could I use MD5 hashes of the titles<br>
instead??<br>
<p>
PErl will require a module then:<br>
<p>
<font class='lnum'>1601</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;md5 hashing from perl&gt;&gt;=</legend>
<font class='lnum'>1602</font>   #!/usr/bin/perl
<font class='lnum'>1603</font>   # Functional style
<font class='lnum'>1604</font>    use Digest::MD5 qw(md5 md5_hex md5_base64);
<font class='lnum'>1605</font>   
<font class='lnum'>1606</font>    #$digest = md5($data);
<font class='lnum'>1607</font>    #$digest = md5_hex($data);
<font class='lnum'>1608</font>    #$digest = md5_base64($data);
<font class='lnum'>1609</font>   
<font class='lnum'>1610</font>    # my test:
<font class='lnum'>1611</font>    $digest1 = md5_base64("md5 hashing from perl");
<font class='lnum'>1612</font>    $digest2 = md5_base64("Chunk names are free phrases in a human lang. I need poss. to make a hash 
<font class='lnum'>1613</font>       of contents with the title as  the key. A phrase is not good for that, so could I use MD5 
<font class='lnum'>1614</font>       hashes of the title");
<font class='lnum'>1615</font>    print "$digest1\n$digest2\n";
<font class='lnum'>1616</font>   </fieldset></pre>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('40');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('41');">
 2. First pass of tangling </a></legend></fieldset>
<p>
<div id="41" style="display:none">   
<ul>


<p>
<pre>Cut out code chunks; 
create hash; 
..concatting parts of the same chunk. </pre><br>
<p>
I will get here if I am "scriptname.tangle" and $builtin_tangler = 1<br>
<p>
<font class='lnum'>1628</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;built-in tangler skeleton&gt;&gt;=</legend>
<font class='lnum'>1629</font>   #!/usr/bin/perl
<font class='lnum'>1630</font>       use Digest::MD5 qw(md5_base64);
<font class='lnum'>1631</font>   
<font class='lnum'>1632</font>       $use_builtin_tangler = 1;
<font class='lnum'>1633</font>       unless ($use_builtin_tangler) {print "not set to tangle in the options\n"; exit}
<font class='lnum'>1634</font>   
<font class='lnum'>1635</font>       <font class='chunkref'>&lt;&lt;first pass of tangling - accumulate in RAM&gt;&gt</font>;
<font class='lnum'>1636</font>       <font class='chunkref'>&lt;&lt;second pass of tangling - print out&gt;&gt</font>;
<font class='lnum'>1637</font>   </fieldset></pre>
<p>
<b> <i> note 1 </i> </b><br>
The following works with implicit understanting of the correct sequencing of the symbols in the<br>
Literate SOurce file. If those are mangled, results are not guaranteed. <br>
I mean, no check is done to complain in case "&lt; &lt;  blabla &gt; &gt;=" and "@" do not follow each other<br>
or if those nest etc.<br>
<p>
<b> <i> note 2 </i> </b><br>
Besides accumulating code, I also need to do indeces (also hashes)?<br>
One idea is to have immediate access to "parent roots", because I foresee 3 modes of tangling:<br>
<ul> <li>the default chunk "*"<br>
</li><li>the specified chunk<br>
</li><li>and "all root chunks" to kind of "check out the whole project" from the Literate Source<br>
</li></ul><br>
If I do not maintain the 3 modes and tangle from the "*" specified in the LitSource file, I won't<br>
need the indeces, I think.<br>
<p>
<font class='lnum'>1655</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;first pass of tangling - accumulate in RAM&gt;&gt;=</legend>
<font class='lnum'>1656</font>       open LITSOURCE, "&lt; $ARGV[$1]" || die "could not open the file to tangle\n";
<font class='lnum'>1657</font>   
<font class='lnum'>1658</font>       $chunk_beg_pattern = "^&lt;\&lt;(.*)&gt;\&gt;=";
<font class='lnum'>1659</font>       $chunk_end_pattern = "^@\s*$";
<font class='lnum'>1660</font>       $chunk_ref_pattern = "&lt;\&lt;(.*?)&gt;\&gt;[^=]"; # can be used several times in a line
<font class='lnum'>1661</font>   
<font class='lnum'>1662</font>       %code_chunks_buf = (); # accumulating chunks bodies
<font class='lnum'>1663</font>       %code_chunks_index = (); # like "goto" stack per chunk
<font class='lnum'>1664</font>   
<font class='lnum'>1665</font>   while (&lt;LITSOURCE&gt;) {
<font class='lnum'>1666</font>   
<font class='lnum'>1667</font>       if ( m!$chunk_beg_pattern! .. m!$chunk_end_pattern! ) { # -- CODE CHUNKS -- 
<font class='lnum'>1668</font>   
<font class='lnum'>1669</font>   	if ( $_ =~ m!$chunk_beg_pattern! ) {
<font class='lnum'>1670</font>   	    # form md5 and push into the hash-stack
<font class='lnum'>1671</font>   	    $title_hash = md5_base64($1);
<font class='lnum'>1672</font>   	    }
<font class='lnum'>1673</font>   	elsif ( $_ =~ m!$chunk_end_pattern! )  {
<font class='lnum'>1674</font>   	    # end of code chunk
<font class='lnum'>1675</font>   	    }
<font class='lnum'>1676</font>   	elsif ( $_ =~ m!$chunk_ref_pattern! ) {
<font class='lnum'>1677</font>   	    # form and push "goto" and "cont" into the hash-stack
<font class='lnum'>1678</font>   	    }
<font class='lnum'>1679</font>   	else { # chunk body: accumulate
<font class='lnum'>1680</font>   	    $code_chunks_buf{$title_hash} .= $_;
<font class='lnum'>1681</font>   	    }
<font class='lnum'>1682</font>       } #fi
<font class='lnum'>1683</font>   
<font class='lnum'>1684</font>   
<font class='lnum'>1685</font>   } #eliwh
<font class='lnum'>1686</font>   </fieldset></pre>
<p>
Now all code chunks, concatenated if they have the same name, are in RAM (inside %title_hash), <br>
I can do the second pass and unravel them.<br>
<p>
<p>
<p>
<p>
<b> 3. Second pass of tangling </b><br>

<p>
Let's do tangling  from "*" only in this skeleton version<br>
<p>
The chunks now are in RAM as a string; I need to match &lt; &lt; chunk refs &gt; &gt; and continue right<br>
after processing them.<br>
Seems it can be done with a regexp which marks the place of its last match.<br>
<p>
err.. multiline matching; only-once + continuation -- the regexp options needed -- ??<br>
<p>
Secondly, it creates a recursive function.<br>
<p>
<font class='lnum'>1707</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;second pass of tangling - print out&gt;&gt;=</legend>
<font class='lnum'>1708</font>   # second pass - tangling from %code_chunks_buf using %code_chunks_index for directions
<font class='lnum'>1709</font>   
<font class='lnum'>1710</font>   $default_root = md5_base64("*");
<font class='lnum'>1711</font>   
<font class='lnum'>1712</font>       # bullshit
<font class='lnum'>1713</font>       #$code_chunks_buf{$default_root} =~ m!!;
<font class='lnum'>1714</font>   
<font class='lnum'>1715</font>   </fieldset></pre>
<b> ...STOP... </b><br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('41');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('42');">
 4. Another idea for tangling </a></legend></fieldset>
<p>
<div id="42" style="display:none">   
<ul>


<p>
Basically, I should create more chunks in $code_chunks_buf than the number of those <br>
existing in reality.<br>
<p>
The idea is to split them at each &lt; &lt;  chunk ref &gt; &gt; to print out without parsing <br>
the string at all.<br>
Then all I need is a parent-child index, that's all??<br>
<p>
The parent-child index must be able to keep multiple offspring then (in case some <br>
chunk is reused, say if it is a func used in several contexts.<br>
<p>
<p>
<p>
<p>
<b> 5. One more idea </b> <br>

if I cannot iterate strings lazily, why not iterate over the file twice?<br>
Operators which work on the files are by their nature lazy both in perl and in newlisp.<br>
I.e. first pass - get offsets, form the "goto-index" hash, second pass - unravel.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('42');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('43');">
 6. Lazy iteration over strings in a memory buf </a></legend></fieldset>
<p>
<div id="43" style="display:none">   
<ul>


<p>
..seems possible after all, check <br>
<a href=http://localhost:8000/perl.docs/perlretut-perldoc.perl.org.weave >http://localhost:8000/perl.docs/perlretut-perldoc.perl.org.weave </a><br>
as a cumbersome combination of "g" option, "pos()" function and \G ancor<br>
see "global matching" subsection in the above doc (under "using regexp in Perl")<br>
<p>
<p>
HEre's a snippet that seems to work:<br>
<p>
<font class='lnum'>1757</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;matchstring2.pl&gt;&gt;=</legend>
<font class='lnum'>1758</font>   #!/usr/bin/perl
<font class='lnum'>1759</font>   
<font class='lnum'>1760</font>   #------JUST a string to test the regexps on ------------
<font class='lnum'>1761</font>   $string = &lt;&lt;end_of_string;
<font class='lnum'>1762</font>   bla-bla-bla /leaving it out/
<font class='lnum'>1763</font>   end_of_string
<font class='lnum'>1764</font>   
<font class='lnum'>1765</font>   #---------------end of string--------------
<font class='lnum'>1766</font>   
<font class='lnum'>1767</font>   =head
<font class='lnum'>1768</font>   # first test, bad:
<font class='lnum'>1769</font>   # match-prematch work, but on the WHOLE string. BAD:
<font class='lnum'>1770</font>     while ( $string =~ m!&lt;\&lt;(.*?)&gt;\&gt;[^=]!gc) {
<font class='lnum'>1771</font>       print "\n\n---PREMATCH---\n$`\n\n";
<font class='lnum'>1772</font>       print "MATCH\n$1\n\n";
<font class='lnum'>1773</font>       }
<font class='lnum'>1774</font>   =cut
<font class='lnum'>1775</font>   
<font class='lnum'>1776</font>   
<font class='lnum'>1777</font>   # --HERE'S ANOTHER IDEA--
<font class='lnum'>1778</font>   # the use of \G ancor and poss the pos() function
<font class='lnum'>1779</font>   #pos($string) = 0;
<font class='lnum'>1780</font>   while ( $string =~ m!\G(.*?)&lt;\&lt;(.*?)&gt;\&gt;!gs) {
<font class='lnum'>1781</font>     
<font class='lnum'>1782</font>     $off = length($2);
<font class='lnum'>1783</font>     $position = pos($string);
<font class='lnum'>1784</font>     #pos($string) = $position + $off;
<font class='lnum'>1785</font>     print "\n\t---title---\n$2 of length $off at $position \n\t----after----\n$1\n========\n";
<font class='lnum'>1786</font>   
<font class='lnum'>1787</font>   }
<font class='lnum'>1788</font>   
<font class='lnum'>1789</font>   # ONE PROBLEM:
<font class='lnum'>1790</font>   # last piece, post-chunk ?? OR not a prob when reading from a file??
<font class='lnum'>1791</font>   
<font class='lnum'>1792</font>   
<font class='lnum'>1793</font>   # Looks like this can solve the prob of parsing a code chunk with included &lt; &lt;references&gt; &gt;
<font class='lnum'>1794</font>   #	when hitting a match:
<font class='lnum'>1795</font>   #		- append $1 to the chunk buffer
<font class='lnum'>1796</font>   #		- get md5, push it into the index
<font class='lnum'>1797</font>   #		- form an md5 for the continuation and start that new chunk
<font class='lnum'>1798</font>   #		- .. and push "goto" this continuation into the prev chunk index
<font class='lnum'>1799</font>   #
<font class='lnum'>1800</font>   # Do this linearly on all cut out code chunks of the Literate Source file (appending those 
<font class='lnum'>1801</font>   # with the same names)
<font class='lnum'>1802</font>   # and print out from memory on pass 2 according to the goto index.
<font class='lnum'>1803</font>   #
<font class='lnum'>1804</font>   # Should preserve all offsets as well.
<font class='lnum'>1805</font>   #
<font class='lnum'>1806</font>   #---------------------------------------------------
<font class='lnum'>1807</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('43');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('39');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('37');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('44');">
 Weaver </a></legend></fieldset>
<p>
<div id="44" style="display:none">   
<ul>


<p>
<p>
The idea of the weaver is simple, again.<br>
<p>
<font class='lnum'>1822</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;weave me&gt;&gt;=</legend>
<font class='lnum'>1823</font>   
<font class='lnum'>1824</font>   
<font class='lnum'>1825</font>   WEAVE_ME:
<font class='lnum'>1826</font>   
<font class='lnum'>1827</font>   #1. Set formatting strings for weaver
<font class='lnum'>1828</font>   <font class='chunkref'>&lt;&lt;set formatting strings for weaver&gt;&gt</font>;
<font class='lnum'>1829</font>   
<font class='lnum'>1830</font>   #2. accumulate result in a buffer
<font class='lnum'>1831</font>   <font class='chunkref'>&lt;&lt;accumulate result in a buffer&gt;&gt</font>;
<font class='lnum'>1832</font>   
<font class='lnum'>1833</font>   #3. print out the TOC, the Chunks Index, the output buffer and close the page.
<font class='lnum'>1834</font>   <font class='chunkref'>&lt;&lt;print out&gt;&gt</font>;
<font class='lnum'>1835</font>   </fieldset></pre>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('45');">
 How formatting is done in the weaver </a></legend></fieldset>
<p>
<div id="45" style="display:none">   
<ul>


<p>
<b>1 The first formatting element </b>  that is  part of the <i> function </i> of the script<br>
rather than formatting decorations is the<br>
<pre> frameset - legend - /legend - /frameset </pre><br>
which create the distinctive look of the documents generated by MOLLY. I do not wish to<br>
change them (although strictly speaking they are not obligatory).<br>
<p>
What can be changed is the Stylesheet (a part of the script, it has its own subsection), so<br>
other people could play with fonts and colors and margins and such by throwing in a simple<br>
switch and copying their alternative stylesheet into the script.<br>
<p>
I do not wish to use external files for any configuration, as the whole idea of MOLLY is to<br>
be a single self-contained script, which does not require any "installation" of many files to<br>
many places.<br>
<p>
<b>2  Secondly,</b> the "actual working test.html" subsection below probably explains best how<br>
<b> text folding and background highlighting </b> which is tied to it (i.e. a TOC click will open the <br>
section + highlight; and click on the section in the body of the doc will toggle it + highlight <br>
the TOC line ) work.<br>
<p>
Actual implementation is spread between several subsections - they are<br>
coded in in the hard way, as I do not expect them to change ever, they are a functional element<br>
not a changeable "skin" or decoration.<br>
<ul><li> vars, JS and styles are set in the weaver "set formatting strings for weaver" subsections;<br>
</li><li> invocations can be seen in "accumulate the result", esp in the "section headings"<br>
</li><li> and more are applied in the "print out the result"<br>
</li></ul><br>
<p>
Some of the vars are set to pieces of formatting strings in the beginning, and later variables<br>
in them are interpolated with "executable" regexs ( the "e" flag at the end of the regex) - see <br>
"process section headings"<br>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('46');">
 actual working test.html </a></legend></fieldset>
<p>
<div id="46" style="display:none">   
<ul>


<p>
Here's the actual script that was used to test the JS folding and<br>
tying of folding to the TOC section highlighting:<br>
<p>
<p>
<font class='lnum'>1882</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;test.html&gt;&gt;=</legend>
<font class='lnum'>1883</font>   
<font class='lnum'>1884</font>   &lt;html&gt;
<font class='lnum'>1885</font>   &lt;head&gt;
<font class='lnum'>1886</font>   
<font class='lnum'>1887</font>   
<font class='lnum'>1888</font>   &lt;style type="text/css"&gt;
<font class='lnum'>1889</font>   
<font class='lnum'>1890</font>   
<font class='lnum'>1891</font>   .unhilited {background-color:white}
<font class='lnum'>1892</font>   .hilited {background-color:yellow; text-decoration:underline}
<font class='lnum'>1893</font>   &lt;/style&gt;
<font class='lnum'>1894</font>   
<font class='lnum'>1895</font>   
<font class='lnum'>1896</font>   &lt;script type="text/javascript"&gt;
<font class='lnum'>1897</font>   
<font class='lnum'>1898</font>       function setHilite(evt) {
<font class='lnum'>1899</font>   	evt = (evt) ? evt : ((window.event) ? window.event : null);
<font class='lnum'>1900</font>   	if (evt) {
<font class='lnum'>1901</font>   	    var elem = (evt.srcElement) ? evt.srcElement : evt.target;
<font class='lnum'>1902</font>   	    elem.className = "hilited";
<font class='lnum'>1903</font>   	}
<font class='lnum'>1904</font>       }
<font class='lnum'>1905</font>   
<font class='lnum'>1906</font>   
<font class='lnum'>1907</font>   function setUnHilite(evt) {
<font class='lnum'>1908</font>       evt = (evt) ? evt : ((window.event) ? window.event : null);
<font class='lnum'>1909</font>   	if (evt) {
<font class='lnum'>1910</font>       	    var elem = (evt.srcElement) ? evt.srcElement : evt.target;
<font class='lnum'>1911</font>       	    elem.className = "unhilited";
<font class='lnum'>1912</font>   	}
<font class='lnum'>1913</font>   }
<font class='lnum'>1914</font>   
<font class='lnum'>1915</font>   function toggleDiv(divid) {
<font class='lnum'>1916</font>   var el = document.getElementById(divid);
<font class='lnum'>1917</font>   el.style.display = (el.style.display == 'block') ? 'none' : 'block';
<font class='lnum'>1918</font>   }
<font class='lnum'>1919</font>   
<font class='lnum'>1920</font>   function toggleCombined(divid){
<font class='lnum'>1921</font>       if(document.getElementById(divid).style.display == 'none'){
<font class='lnum'>1922</font>         document.getElementById(divid).style.display = 'block';
<font class='lnum'>1923</font>   	document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>1924</font>       }
<font class='lnum'>1925</font>       
<font class='lnum'>1926</font>       else{
<font class='lnum'>1927</font>         document.getElementById(divid).style.display = 'none';
<font class='lnum'>1928</font>   	document.getElementById("toc"+divid).className="unhilited";
<font class='lnum'>1929</font>       }
<font class='lnum'>1930</font>   }
<font class='lnum'>1931</font>   
<font class='lnum'>1932</font>   
<font class='lnum'>1933</font>   function expandDiv(divid){
<font class='lnum'>1934</font>   	document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>1935</font>   }
<font class='lnum'>1936</font>   
<font class='lnum'>1937</font>   
<font class='lnum'>1938</font>   
<font class='lnum'>1939</font>   &lt;/script&gt;
<font class='lnum'>1940</font>   &lt;/head&gt;
<font class='lnum'>1941</font>   
<font class='lnum'>1942</font>   &lt;body &gt;
<font class='lnum'>1943</font>   &lt;h2&gt;Here's the tested element&lt;/h2&gt;
<font class='lnum'>1944</font>   Here is some ordinary text&lt;br&gt;
<font class='lnum'>1945</font>   &lt;span class="unhilited" onmouseover="setHilite(event)" 
<font class='lnum'>1946</font>       onmouseout="setUnHilite(event)"&gt; 
<font class='lnum'>1947</font>       &lt;a href="javascript:;" onmousedown="toggleDiv(15);"&gt;&lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>1948</font>       and this is some potentially hot spot text.&lt;/span&gt;
<font class='lnum'>1949</font>   
<font class='lnum'>1950</font>   &lt;div id=15&gt;
<font class='lnum'>1951</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>1952</font>       that should be hidden/collapsed
<font class='lnum'>1953</font>   
<font class='lnum'>1954</font>   &lt;/div&gt;
<font class='lnum'>1955</font>   
<font class='lnum'>1956</font>   
<font class='lnum'>1957</font>   &lt;h2&gt;Here's the tested element 0&lt;/h2&gt;
<font class='lnum'>1958</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>1959</font>   &lt;a href="javascript:;" onmousedown="toggleCombined(13);" id="toc13"&gt;
<font class='lnum'>1960</font>       &lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>1961</font>   
<font class='lnum'>1962</font>   &lt;div id=13 &gt;&lt;script language=javascript&gt; document.getElementById("toc"+13).className='hilited';&lt;/script&gt;
<font class='lnum'>1963</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>1964</font>       that should be hidden/collapsed
<font class='lnum'>1965</font>   
<font class='lnum'>1966</font>   &lt;/div&gt;
<font class='lnum'>1967</font>   
<font class='lnum'>1968</font>   
<font class='lnum'>1969</font>   
<font class='lnum'>1970</font>   
<font class='lnum'>1971</font>   &lt;h2&gt;Here's the tested element 1&lt;/h2&gt;
<font class='lnum'>1972</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>1973</font>   &lt;a href="javascript:;" onmousedown="toggleCombined(14);" id="toc14"&gt;
<font class='lnum'>1974</font>       &lt;script language=javascript&gt; document.getElementById("toc"+14).className='hilited';&lt;/script&gt;
<font class='lnum'>1975</font>       &lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>1976</font>   
<font class='lnum'>1977</font>   &lt;div id=14 &gt;
<font class='lnum'>1978</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>1979</font>       that should be hidden/collapsed
<font class='lnum'>1980</font>   
<font class='lnum'>1981</font>   &lt;/div&gt;
<font class='lnum'>1982</font>   
<font class='lnum'>1983</font>   
<font class='lnum'>1984</font>   &lt;h2&gt;Here's the tested element 2&lt;/h2&gt;
<font class='lnum'>1985</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>1986</font>   &lt;span  id="toc16"&gt; 
<font class='lnum'>1987</font>       &lt;a href="javascript:;" onmousedown="toggleCombined(16);"&gt;&lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>1988</font>       and this is some potentially hot spot text.&lt;/span&gt;
<font class='lnum'>1989</font>   
<font class='lnum'>1990</font>   &lt;div id=16&gt;
<font class='lnum'>1991</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>1992</font>       that should be hidden/collapsed
<font class='lnum'>1993</font>   
<font class='lnum'>1994</font>   &lt;/div&gt;
<font class='lnum'>1995</font>   
<font class='lnum'>1996</font>   
<font class='lnum'>1997</font>   
<font class='lnum'>1998</font>   &lt;/body&gt;
<font class='lnum'>1999</font>   &lt;/html&gt;
<font class='lnum'>2000</font>   
<font class='lnum'>2001</font>   </fieldset></pre>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('46');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('47');">
 changing text style - the basic JS recipy </a></legend></fieldset>
<p>
<div id="47" style="display:none">   
<ul>


<p>
I used this snippet for a start then reworked it into the "working test script" below.<br>
<p>
<ul> <pre>
11.8.2 Solution
First, define two style sheet rules, each with a different class selector. Then design 
an event handler for the element to change the element's className property to the desired 
class selector's identifier: 

		&lt;style type="text/css"&gt;
		.unhilited {background-color:white}
		.hilited {background-color:yellow; text-decoration:underline}
		&lt;/style&gt;
		...
		&lt;script type="text/javascript"&gt;
		function setHilite(evt) {
			evt = (evt) ? evt : ((window.event) ? window.event : null);
			if (evt) {
				var elem = (evt.srcElement) ? evt.srcElement : evt.target;
				elem.className = "hilited";
			}
		}
		function setUnHilite(evt) {
			evt = (evt) ? evt : ((window.event) ? window.event : null);
			if (evt) {
				var elem = (evt.srcElement) ? evt.srcElement : evt.target;
				elem.className = "unhilited";
			}
		}
		...
		&lt;span class="unhilited" onmouseover="setHilite(event)" 
			onmouseout="setUnHilite(event)"&gt;Some potentially hot spot text.&lt;/span&gt;

Adjusting the className property of an element as shown here is a more stable approach 
for early versions of Netscape 6 instead of manipulating styleSheet objects and their 
properties. It is perhaps the most widely used and supported way to implement dynamic styles. 
</pre> </ul><br>
<p>
If I enclose one "onmousedown" inside another, JScript will most probably not pass it into the inner one.<br>
So I should add:<br>
(a) the TOC line IDs ?? Like "toc.1", "toc.2" etc<br>
(b) keep a separate func, not "toggleDiv", but something else like "toggleTOCandDIV", and run 2 things<br>
from there ??<br>
<p>
<b> So, 2 tests: enclosing and if not, then rewriting the collapsing JS func </b><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('47');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('48');">
 Reference - Javascript and DOM </a></legend></fieldset>
<p>
<div id="48" style="display:none">   
<ul>


<p>
<p>
I'll need some javascript and DOM reference for further work;<br>
<p>
a/ http://w3schools.com/htmldom/dom_reference.asp  -- ref from W3C<br>
b/ http://w3schools.com/htmldom/default.asp -- might also be useful<br>
c/ http://www.howtocreate.co.uk/tutorials/javascript/domcss --javascript tutorial (not necessarily best) <br>
d/ http://www.pageresource.com/dhtml/ryan/part4-1.html - another tutorial<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('48');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('45');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('49');">
 set formatting strings for weaver </a></legend></fieldset>
<p>
<div id="49" style="display:none">   
<ul>


<p>
<font class='lnum'>2077</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;set formatting strings for weaver&gt;&gt;=</legend>
<font class='lnum'>2078</font>   
<font class='lnum'>2079</font>     #----SETTING FORMATTING STRINGS-----------
<font class='lnum'>2080</font>     
<font class='lnum'>2081</font>   $html_head = &lt;&lt;head_end;  
<font class='lnum'>2082</font>   
<font class='lnum'>2083</font>   &lt;head&gt;
<font class='lnum'>2084</font>   &lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" /&gt; 
<font class='lnum'>2085</font>   
<font class='lnum'>2086</font>   <font class='chunkref'>&lt;&lt;JS script functions&gt;&gt</font>;
<font class='lnum'>2087</font>   <font class='chunkref'>&lt;&lt;stylesheet&gt;&gt</font>;
<font class='lnum'>2088</font>   
<font class='lnum'>2089</font>   &lt;/head&gt;
<font class='lnum'>2090</font>   head_end
<font class='lnum'>2091</font>   
<font class='lnum'>2092</font>   $html_body_table = "&lt;center&gt;&lt;table class='outertable'&gt;&lt;tr&gt;&lt;td&gt;";
<font class='lnum'>2093</font>   $html_body_table_end = "\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;\n";
<font class='lnum'>2094</font>   
<font class='lnum'>2095</font>   
<font class='lnum'>2096</font>   	
<font class='lnum'>2097</font>   
<font class='lnum'>2098</font>   $folding_section_start1_str = &lt;&lt;'fold_sect_start_1_xxx';
<font class='lnum'>2099</font>   	&lt;fieldset&gt;&lt;legend&gt;&lt;a href="javascript:;" onmousedown="toggleCombined('$section_num');"&gt;
<font class='lnum'>2100</font>   fold_sect_start_1_xxx
<font class='lnum'>2101</font>   
<font class='lnum'>2102</font>   
<font class='lnum'>2103</font>   $folding_section_start2_str = &lt;&lt;'fold_sect_start_2_xxx';
<font class='lnum'>2104</font>   &lt;/a&gt;&lt;/legend&gt;&lt;/fieldset&gt;
<font class='lnum'>2105</font>   &lt;p&gt;
<font class='lnum'>2106</font>   &lt;div id="$section_num" style="display:$fold_state"&gt; $highlight_state  
<font class='lnum'>2107</font>   &lt;ul&gt;
<font class='lnum'>2108</font>   
<font class='lnum'>2109</font>   fold_sect_start_2_xxx
<font class='lnum'>2110</font>   
<font class='lnum'>2111</font>   
<font class='lnum'>2112</font>   $folding_section_end_str = &lt;&lt;'folding_section_end_xxx';
<font class='lnum'>2113</font>   &lt;/ul&gt;
<font class='lnum'>2114</font>   &lt;p&gt;
<font class='lnum'>2115</font>   &lt;br&gt;
<font class='lnum'>2116</font>   &lt;i&gt;&lt;font size=-1&gt;
<font class='lnum'>2117</font>   &lt;a href="javascript:;"onmousedown="toggleCombined('$section_num_prev');"&gt;
<font class='lnum'>2118</font>   Close the subsection&lt;/a&gt;&lt;/font&gt;
<font class='lnum'>2119</font>   &lt;/i&gt; -- &lt;i&gt;&lt;font size=-1&gt;
<font class='lnum'>2120</font>   &lt;a href="javascript:;" onmousedown="showAll();"&gt;
<font class='lnum'>2121</font>   expand all&lt;/a&gt; -- 
<font class='lnum'>2122</font>   &lt;a href="javascript:;" onmousedown="hideAll();"&gt;
<font class='lnum'>2123</font>   collapse all&lt;/a&gt;
<font class='lnum'>2124</font>   &lt;/font&gt;&lt;/i&gt;
<font class='lnum'>2125</font>   
<font class='lnum'>2126</font>   &lt;p&gt;
<font class='lnum'>2127</font>   &lt;/div&gt;
<font class='lnum'>2128</font>   
<font class='lnum'>2129</font>   folding_section_end_xxx
<font class='lnum'>2130</font>   
<font class='lnum'>2131</font>   
<font class='lnum'>2132</font>   $code_frameset_start_pre = "&lt;pre&gt;&lt;fieldset class='codefieldset'&gt;&lt;legend class='codelegend'&gt;";
<font class='lnum'>2133</font>   $code_frameset_start_post = "=&lt;/legend&gt;";
<font class='lnum'>2134</font>   $code_frameset_end = "&lt;/fieldset&gt;&lt;/pre&gt;\n";
<font class='lnum'>2135</font>   
<font class='lnum'>2136</font>   
<font class='lnum'>2137</font>   
<font class='lnum'>2138</font>   
<font class='lnum'>2139</font>   </fieldset></pre>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('50');">
 JS functions </a></legend></fieldset>
<p>
<div id="50" style="display:none">   
<ul>


<p>
<font class='lnum'>2145</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;JS script functions&gt;&gt;=</legend>
<font class='lnum'>2146</font>   &lt;script language="javascript"&gt;
<font class='lnum'>2147</font>   
<font class='lnum'>2148</font>   
<font class='lnum'>2149</font>   function toggleDiv(divid) {
<font class='lnum'>2150</font>   var el = document.getElementById(divid);
<font class='lnum'>2151</font>   el.style.display = (el.style.display == 'block') ? 'none' : 'block';
<font class='lnum'>2152</font>   }
<font class='lnum'>2153</font>   
<font class='lnum'>2154</font>   
<font class='lnum'>2155</font>   function toggleCombined(divid){
<font class='lnum'>2156</font>       if(document.getElementById(divid).style.display == 'none'){
<font class='lnum'>2157</font>         document.getElementById(divid).style.display = 'block';
<font class='lnum'>2158</font>   	document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>2159</font>       }
<font class='lnum'>2160</font>       else{
<font class='lnum'>2161</font>         document.getElementById(divid).style.display = 'none';
<font class='lnum'>2162</font>   	document.getElementById("toc"+divid).className="unhilited";
<font class='lnum'>2163</font>       }
<font class='lnum'>2164</font>   }
<font class='lnum'>2165</font>   
<font class='lnum'>2166</font>   
<font class='lnum'>2167</font>   function showAll(){
<font class='lnum'>2168</font>   for(i=1; i &lt;= 10000; i++){
<font class='lnum'>2169</font>       document.getElementById(i).style.display = 'block';
<font class='lnum'>2170</font>       document.getElementById("toc"+i).className="hilited";
<font class='lnum'>2171</font>       };
<font class='lnum'>2172</font>   }
<font class='lnum'>2173</font>   
<font class='lnum'>2174</font>   function hideAll(){
<font class='lnum'>2175</font>   for(i=1; i &lt;= 10000; i++){
<font class='lnum'>2176</font>       document.getElementById(i).style.display = 'none';
<font class='lnum'>2177</font>       document.getElementById("toc"+i).className="unhilited";
<font class='lnum'>2178</font>       };
<font class='lnum'>2179</font>   }
<font class='lnum'>2180</font>   
<font class='lnum'>2181</font>   &lt;/script&gt;
<font class='lnum'>2182</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('50');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('51');">
 Stylesheet </a></legend></fieldset>
<p>
<div id="51" style="display:none">   
<ul>


<p>
<font class='lnum'>2190</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;stylesheet&gt;&gt;=</legend>
<font class='lnum'>2191</font>   &lt;style type="text/css" media="screen"&gt;
<font class='lnum'>2192</font>   
<font class='lnum'>2193</font>   
<font class='lnum'>2194</font>   BODY {
<font class='lnum'>2195</font>   	FONT-SIZE: 10pt;
<font class='lnum'>2196</font>   	&lt;!--FONT-FAMILY: sans-serif --&gt;
<font class='lnum'>2197</font>   	background: #f0f0f0;
<font class='lnum'>2198</font>   	}
<font class='lnum'>2199</font>   FIELDSET {
<font class='lnum'>2200</font>   	BORDER-RIGHT: #000000 1px solid; 
<font class='lnum'>2201</font>   	BORDER-TOP: #000000 1px solid; 
<font class='lnum'>2202</font>   	BORDER-LEFT: #000000 1px solid; 
<font class='lnum'>2203</font>   	BORDER-BOTTOM: #000000 1px solid; 
<font class='lnum'>2204</font>   	PADDING-RIGHT: 5px; 
<font class='lnum'>2205</font>   	PADDING-LEFT: 5px; 
<font class='lnum'>2206</font>   	PADDING-BOTTOM: 2px; 
<font class='lnum'>2207</font>   	PADDING-TOP: 5px;
<font class='lnum'>2208</font>   	MARGIN-BOTTOM: 1px; 
<font class='lnum'>2209</font>   	background: #f5f5f5; 
<font class='lnum'>2210</font>   	color: #000000;
<font class='lnum'>2211</font>   	}
<font class='lnum'>2212</font>   LEGEND {
<font class='lnum'>2213</font>   	BORDER-RIGHT: #a9a9a9 1px solid; 
<font class='lnum'>2214</font>   	BORDER-BOTTOM: #a9a9a9 1px solid;
<font class='lnum'>2215</font>   	BORDER-TOP: #a9a9a9 1px solid; 
<font class='lnum'>2216</font>   	BORDER-LEFT: #a9a9a9 1px solid; 
<font class='lnum'>2217</font>   	PADDING-RIGHT: 20px; 
<font class='lnum'>2218</font>   	PADDING-LEFT: 20px; 
<font class='lnum'>2219</font>   	PADDING-BOTTOM: 5px; 
<font class='lnum'>2220</font>   	PADDING-TOP: 5px; 
<font class='lnum'>2221</font>   	FONT-WEIGHT: bold;  
<font class='lnum'>2222</font>   	BACKGROUND: #fdfdfd; 
<font class='lnum'>2223</font>   	color: #000000;
<font class='lnum'>2224</font>   	}
<font class='lnum'>2225</font>   PRE	{
<font class='lnum'>2226</font>           PADDING-LEFT: 20px; 
<font class='lnum'>2227</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>2228</font>           padding-top: 0px; 
<font class='lnum'>2229</font>           padding-bottom: 6px;
<font class='lnum'>2230</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>2231</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>2232</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>2233</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>2234</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>2235</font>   	background: #fefefe;
<font class='lnum'>2236</font>   	}
<font class='lnum'>2237</font>   
<font class='lnum'>2238</font>   
<font class='lnum'>2239</font>   .tocfieldset {
<font class='lnum'>2240</font>   	background: #ffffff; 
<font class='lnum'>2241</font>   	color: #000000;
<font class='lnum'>2242</font>   	}
<font class='lnum'>2243</font>   
<font class='lnum'>2244</font>   .codefieldset {
<font class='lnum'>2245</font>   	BORDER-RIGHT: #000 1px solid; 
<font class='lnum'>2246</font>   	BORDER-TOP: #000 1px solid; 
<font class='lnum'>2247</font>   	BORDER-LEFT: #000 1px solid; 
<font class='lnum'>2248</font>   	BORDER-BOTTOM: #000 1px solid; 
<font class='lnum'>2249</font>   	background: #ffffff; 
<font class='lnum'>2250</font>   	color: #000;
<font class='lnum'>2251</font>   	MARGIN-BOTTOM: 1px; 
<font class='lnum'>2252</font>   	PADDING-LEFT: 15px; 
<font class='lnum'>2253</font>   	PADDING-RIGHT: 5px; 
<font class='lnum'>2254</font>   	PADDING-BOTTOM: 10px; 
<font class='lnum'>2255</font>   	PADDING-TOP: 1px;
<font class='lnum'>2256</font>   	}
<font class='lnum'>2257</font>   .codelegend {
<font class='lnum'>2258</font>   	BORDER-RIGHT: #777 1px solid; 
<font class='lnum'>2259</font>   	BORDER-TOP: #777 1px solid; 
<font class='lnum'>2260</font>   	BORDER-LEFT: #777 1px solid; 
<font class='lnum'>2261</font>   	BORDER-BOTTOM: #777 1px solid
<font class='lnum'>2262</font>   	PADDING-RIGHT: 10px; 
<font class='lnum'>2263</font>   	PADDING-LEFT: 10px; 
<font class='lnum'>2264</font>   	PADDING-TOP: 2px; 
<font class='lnum'>2265</font>   	PADDING-BOTTOM: 2px; 
<font class='lnum'>2266</font>   	background: #ffffff; 
<font class='lnum'>2267</font>   	color: #00b;
<font class='lnum'>2268</font>   	FONT-WEIGHT: bold;  
<font class='lnum'>2269</font>   	/font-variant: small-caps;
<font class='lnum'>2270</font>   	/font-style: italic;
<font class='lnum'>2271</font>   	}
<font class='lnum'>2272</font>   
<font class='lnum'>2273</font>   
<font class='lnum'>2274</font>   
<font class='lnum'>2275</font>   .chunkref {
<font class='lnum'>2276</font>           color: #00b;	
<font class='lnum'>2277</font>           background: #f6f6f6;
<font class='lnum'>2278</font>           /font-style: italic;
<font class='lnum'>2279</font>           font-weight: bold;
<font class='lnum'>2280</font>           /font-variant: small-caps;
<font class='lnum'>2281</font>   	}
<font class='lnum'>2282</font>   
<font class='lnum'>2283</font>   
<font class='lnum'>2284</font>   .outertable {
<font class='lnum'>2285</font>   	width: 99%; 
<font class='lnum'>2286</font>   	cellpadding: 25; 
<font class='lnum'>2287</font>   	background: #ffffff; 
<font class='lnum'>2288</font>   	border: 1px solid;
<font class='lnum'>2289</font>   	}
<font class='lnum'>2290</font>   
<font class='lnum'>2291</font>   .hl	{
<font class='lnum'>2292</font>   	 ;
<font class='lnum'>2293</font>           PADDING-LEFT: 5px; PADDING-RIGHT: 5px; 
<font class='lnum'>2294</font>           padding-top: 5px; padding-bottom: 5px;
<font class='lnum'>2295</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>2296</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>2297</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>2298</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>2299</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>2300</font>           background: #f5f5f5;	
<font class='lnum'>2301</font>           width: 70%;
<font class='lnum'>2302</font>   	}
<font class='lnum'>2303</font>   
<font class='lnum'>2304</font>   .hl-wide {
<font class='lnum'>2305</font>   	 ;
<font class='lnum'>2306</font>           PADDING-LEFT: 5px; 
<font class='lnum'>2307</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>2308</font>           padding-top: 15px; 
<font class='lnum'>2309</font>           padding-bottom: 15px;
<font class='lnum'>2310</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>2311</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>2312</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>2313</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>2314</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>2315</font>           background: #fbfbfb;	
<font class='lnum'>2316</font>   	}
<font class='lnum'>2317</font>   
<font class='lnum'>2318</font>   .lnum {
<font class='lnum'>2319</font>   
<font class='lnum'>2320</font>   	color: #a0a0a0;
<font class='lnum'>2321</font>   	/background: #fbfbfb;
<font class='lnum'>2322</font>   	}
<font class='lnum'>2323</font>   
<font class='lnum'>2324</font>   .unhilited {background-color:white}
<font class='lnum'>2325</font>   .hilited {background-color:#c0c0ff}
<font class='lnum'>2326</font>   
<font class='lnum'>2327</font>   
<font class='lnum'>2328</font>   &lt;/STYLE&gt;
<font class='lnum'>2329</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('51');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('49');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('52');">
 Accumulate the result </a></legend></fieldset>
<p>
<div id="52" style="display:none">   
<ul>


<p>
Some of the vars may be unused later (run perl -wc to check?)<br>
<p>
<font class='lnum'>2343</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;accumulate result in a buffer&gt;&gt;=</legend>
<font class='lnum'>2344</font>   #2. accumulate result in a buffer
<font class='lnum'>2345</font>   
<font class='lnum'>2346</font>   
<font class='lnum'>2347</font>   # vars for the main loop over lines of the target file
<font class='lnum'>2348</font>   
<font class='lnum'>2349</font>    $chunkbuf = ''; # collects whole formatted project file in memory
<font class='lnum'>2350</font>    $tocbuf = "";	# will accumulate TOC contents, i.e. small
<font class='lnum'>2351</font>    @indbuf = ();  # accumulates index of code chunks, small
<font class='lnum'>2352</font>    #%indbuf = ();
<font class='lnum'>2353</font>    @headings = ();	# the stack for nested subsections numbers/ids
<font class='lnum'>2354</font>   
<font class='lnum'>2355</font>    $section_num = 0;
<font class='lnum'>2356</font>    $section_num_prev = 0;
<font class='lnum'>2357</font>    $section_level = 0;
<font class='lnum'>2358</font>    $prev_section_level = $section_level;
<font class='lnum'>2359</font>    $line_counter = 0;
<font class='lnum'>2360</font>    $in_pre_tag = 0;
<font class='lnum'>2361</font>   </fieldset></pre>
<p>
<p>
The logic is this: (a) all project files, unless they are machine-generated code, are<br>
much below the sizes of RAM on modern machines. So I accumulate in memoru (in a string<br>
$chunkbuf) a copy of the whole file, with necessary transformations and formatting.<br>
<p>
Only 3 distinctions need to be made while iterating over hte lines of the Literate Source<br>
file, between section headings, chunks of code and the lines from the body of documentation<br>
chunks.<br>
<p>
<font class='lnum'>2372</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;accumulate result in a buffer&gt;&gt;=</legend>
<font class='lnum'>2373</font>   
<font class='lnum'>2374</font>   open FF, "&lt; $0";
<font class='lnum'>2375</font>   
<font class='lnum'>2376</font>   
<font class='lnum'>2377</font>   while (&lt;FF&gt;) {
<font class='lnum'>2378</font>   
<font class='lnum'>2379</font>      $line_counter++;
<font class='lnum'>2380</font>   
<font class='lnum'>2381</font>       # cut out the MOLLY.pl invocation itself, the top of the Lit src file
<font class='lnum'>2382</font>       #if ( m%^#-+\s*?start of script% ... m%^xxxxxxxxxxxx% ) {  
<font class='lnum'>2383</font>       if ( m%^__DATA__% ... m%^xxxxxxxxxxxx% ) {
<font class='lnum'>2384</font>       s!^__DATA__\s*$!!;
<font class='lnum'>2385</font>   
<font class='lnum'>2386</font>   
<font class='lnum'>2387</font>   
<font class='lnum'>2388</font>   <font class='chunkref'>&lt;&lt;process code chunks&gt;&gt</font>;
<font class='lnum'>2389</font>   <font class='chunkref'>&lt;&lt;process section headings&gt;&gt</font>;
<font class='lnum'>2390</font>   <font class='chunkref'>&lt;&lt;body HTML formatters&gt;&gt</font>;
<font class='lnum'>2391</font>   
<font class='lnum'>2392</font>   
<font class='lnum'>2393</font>   	# debug
<font class='lnum'>2394</font>   	#print "---- $_";
<font class='lnum'>2395</font>   
<font class='lnum'>2396</font>      } # fi "start of script"
<font class='lnum'>2397</font>   
<font class='lnum'>2398</font>   } #elihw over the whole input file
<font class='lnum'>2399</font>   
<font class='lnum'>2400</font>   	
<font class='lnum'>2401</font>   
<font class='lnum'>2402</font>   
<font class='lnum'>2403</font>    foreach (@headings)  {
<font class='lnum'>2404</font>   
<font class='lnum'>2405</font>   	($section_level, $section_num_prev) = split /-/, $_;
<font class='lnum'>2406</font>   	$folding_section_end = $folding_section_end_str;
<font class='lnum'>2407</font>   	$folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>2408</font>   	$chunkbuf .= $folding_section_end; 
<font class='lnum'>2409</font>   
<font class='lnum'>2410</font>   	};
<font class='lnum'>2411</font>   
<font class='lnum'>2412</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('53');">
 process code chunks </a></legend></fieldset>
<p>
<div id="53" style="display:none">   
<ul>


<p>
"goto" is from an old version of this script, with perl-specific options, I'll delete it<br>
later.<br>
<p>
I use perl range operator to cut out the code section between &lt; &lt; chunkname &gt; &gt; and the<br>
closing "at" symbol, as is required in "noweb".<br>
This is a use of the "range" operator inside another "while" loop over each line of the<br>
Lit Source file, and they work together, the range just flips some status var ("in" - "out")<br>
while the outside loop continues over the lines.<br>
<p>
Once the section name is extracted with a regexp, the index buffer (indbuf) is formed and<br>
updated.<br>
Then "fieldset" formatting is written around the code chunk and line numbering (if set<br>
in an option var) is written too<br>
<p>
<font class='lnum'>2436</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process code chunks&gt;&gt;=</legend>
<font class='lnum'>2437</font>   
<font class='lnum'>2438</font>   	if ( m!^(goto)?&lt;\&lt;(.*)&gt;\&gt;=! ... m!^@\s*$! ) { # -- CODE CHUNKS -- 
<font class='lnum'>2439</font>   		$chunk_title = $2;
<font class='lnum'>2440</font>   
<font class='lnum'>2441</font>   		s/&lt;/&lt;/g;	# escape &lt;
<font class='lnum'>2442</font>   		s/&gt;/&gt;/g;	# escape &gt;
<font class='lnum'>2443</font>   
<font class='lnum'>2444</font>   		if (m!(&lt;&lt;(.+?)&gt;&gt);(=)?!) 
<font class='lnum'>2445</font>   		  {
<font class='lnum'>2446</font>   		  $reference = $1;
<font class='lnum'>2447</font>   		  $ind_str = "&lt;&lt;$2&gt;&gt; $section_num";
<font class='lnum'>2448</font>   		  if (defined $3) {$ind_str .= "&lt;sub&gt;def&lt;/sub&gt;"}
<font class='lnum'>2449</font>   		  else { s!$reference!&lt;font class='chunkref'&gt;$reference&lt;/font&gt;! }
<font class='lnum'>2450</font>   
<font class='lnum'>2451</font>   		  unshift @indbuf, $ind_str;
<font class='lnum'>2452</font>   
<font class='lnum'>2453</font>   		} # fi - chunks index accumulation
<font class='lnum'>2454</font>   
<font class='lnum'>2455</font>   		# simple fieldset frames around code snippets
<font class='lnum'>2456</font>   		s!^(goto)?&lt;&lt;(.+)&gt;&gt;=!$code_frameset_start_pre$1&lt;&lt;$2&gt;&gt;$code_frameset_start_post!;
<font class='lnum'>2457</font>   		s!^@\s*$!$code_frameset_end!;
<font class='lnum'>2458</font>   
<font class='lnum'>2459</font>   		if ( $line_numbering ) { 
<font class='lnum'>2460</font>   		$chunkbuf .= "&lt;font class='lnum'&gt;" . $line_counter . "&lt;/font&gt;   " . $_;
<font class='lnum'>2461</font>   		}
<font class='lnum'>2462</font>   		else{
<font class='lnum'>2463</font>   		$chunkbuf .= $_;
<font class='lnum'>2464</font>   		}
<font class='lnum'>2465</font>   
<font class='lnum'>2466</font>   	} # fi code chunks
<font class='lnum'>2467</font>   </fieldset></pre>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('53');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('54');">
 process section headings </a></legend></fieldset>
<p>
<div id="54" style="display:none">   
<ul>


<p>
This is where folding sectons are created.<br>
The more complicated logic is needed to <i>close</i> the sections properly, when subsections<br>
are included (i.e. creating a step and forming the "close subsection" at the end in the correct<br>
place.<br>
<p>
1. Several formats were possible for collapsing sections, I chose the one you can observe while<br>
reading the weaved document: subsections are completely enclosed by their supersections;<br>
once a child subsection is initiated, the parent subsection cannot continue its body after<br>
the end of the child.<br>
I.e. once you started 12.2.1 inside your 12.2, you cannot write into 12.2 after 12.2.1 is finished, <br>
but you can add 12.2.2, 12.2.3, 12.2.2.1 - etc. - inside the enclosing section.<br>
<p>
The logic was tested first in an external skeleton script.<br>
<p>
2. I may need to disassemble this code to create "view mode" for my script - see "versions - <br>
CHANGES" subsection<br>
<p>
<p>
<font class='lnum'>2494</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process section headings&gt;&gt;=</legend>
<font class='lnum'>2495</font>   
<font class='lnum'>2496</font>   	# -- SECTION HEADINGS 
<font class='lnum'>2497</font>      #elsif ( m!\.(\+)?h(\d)\.(.*?)\./h\d\.! ) {	# old version, no "rawHTML" enabled yet
<font class='lnum'>2498</font>      elsif ( m!$tag_open_symbol(\+)?h(\d)$tag_close_symbol(.*?)$tag_open_symbol/h\d$tag_close_symbol! ) {	
<font class='lnum'>2499</font>   
<font class='lnum'>2500</font>   
<font class='lnum'>2501</font>   
<font class='lnum'>2502</font>   	# -- using split vars for substitution to avoid
<font class='lnum'>2503</font>   	#	regexps and need to keep old state --	
<font class='lnum'>2504</font>   
<font class='lnum'>2505</font>   	$section_num_prev = $section_num;
<font class='lnum'>2506</font>   	$section_num = $section_num + 1;
<font class='lnum'>2507</font>   
<font class='lnum'>2508</font>   
<font class='lnum'>2509</font>   		#default for fold state in "settings" ??
<font class='lnum'>2510</font>   		if ($1 eq "+") {
<font class='lnum'>2511</font>   		    $fold_state="block";
<font class='lnum'>2512</font>   		    $highlight_state = qq!  &lt;script language=javascript&gt; 
<font class='lnum'>2513</font>   		    document.getElementById("toc"+ $section_num).className='hilited';
<font class='lnum'>2514</font>   		    &lt;/script&gt; !;
<font class='lnum'>2515</font>   		} 
<font class='lnum'>2516</font>   		else {
<font class='lnum'>2517</font>   		    $fold_state="none";
<font class='lnum'>2518</font>   		    $highlight_state = "";
<font class='lnum'>2519</font>   		};
<font class='lnum'>2520</font>   		$section_level = $2;
<font class='lnum'>2521</font>   		$section_title = $3;
<font class='lnum'>2522</font>   
<font class='lnum'>2523</font>   
<font class='lnum'>2524</font>   	
<font class='lnum'>2525</font>   
<font class='lnum'>2526</font>   	
<font class='lnum'>2527</font>   
<font class='lnum'>2528</font>   	$folding_section_start1 = $folding_section_start1_str;
<font class='lnum'>2529</font>   	$folding_section_start2 = $folding_section_start2_str;
<font class='lnum'>2530</font>   	$folding_section_end = $folding_section_end_str;
<font class='lnum'>2531</font>   
<font class='lnum'>2532</font>   
<font class='lnum'>2533</font>   	$folding_section_start1 =~ s!(\$section_num)!$1!ee;
<font class='lnum'>2534</font>   	$folding_section_start2 =~ s!(\$section_num)!$1!ee;
<font class='lnum'>2535</font>   	$folding_section_start2 =~ s!(\$fold_state)!$1!ee;
<font class='lnum'>2536</font>   	$folding_section_start2 =~ s!(\$highlight_state)!$1!ee;
<font class='lnum'>2537</font>   	$folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>2538</font>   
<font class='lnum'>2539</font>   
<font class='lnum'>2540</font>   	$section_id = $section_level . '-' . $section_num;
<font class='lnum'>2541</font>   
<font class='lnum'>2542</font>   
<font class='lnum'>2543</font>   	# finish previous subsection if not the first section in the file
<font class='lnum'>2544</font>   	# ..and deal with nesting of sections according to their "depth level"
<font class='lnum'>2545</font>   
<font class='lnum'>2546</font>   	# this is NOT the first section:
<font class='lnum'>2547</font>   	if ( exists $headings[0] ){
<font class='lnum'>2548</font>   
<font class='lnum'>2549</font>   		($prev_section_level, $prev_section_num)  = split /-/, $headings[0];
<font class='lnum'>2550</font>   
<font class='lnum'>2551</font>   		if ($section_level == $prev_section_level){
<font class='lnum'>2552</font>   
<font class='lnum'>2553</font>   		# close prev, start new
<font class='lnum'>2554</font>   		$chunkbuf .= $folding_section_end;
<font class='lnum'>2555</font>   		shift @headings;
<font class='lnum'>2556</font>   		
<font class='lnum'>2557</font>   		}
<font class='lnum'>2558</font>   
<font class='lnum'>2559</font>   		elsif($section_level &lt; $prev_section_level){
<font class='lnum'>2560</font>   		
<font class='lnum'>2561</font>   		  # close a bunch of them, in a loop -- THEN start a new one.
<font class='lnum'>2562</font>   		  do  {
<font class='lnum'>2563</font>   			($prev_section_level, $section_num_prev) = split /-/, shift @headings;
<font class='lnum'>2564</font>   			
<font class='lnum'>2565</font>   			$folding_section_end = $folding_section_end_str;
<font class='lnum'>2566</font>   			$folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>2567</font>   			$chunkbuf .= $folding_section_end;
<font class='lnum'>2568</font>   
<font class='lnum'>2569</font>   		   } while ( $section_level &lt; $prev_section_level );
<font class='lnum'>2570</font>   		}
<font class='lnum'>2571</font>   	} # fi not the first section
<font class='lnum'>2572</font>   
<font class='lnum'>2573</font>   
<font class='lnum'>2574</font>   	# common operations		
<font class='lnum'>2575</font>   	unshift @headings, $section_id ;
<font class='lnum'>2576</font>   	$chunkbuf .= $folding_section_start1;
<font class='lnum'>2577</font>   	$chunkbuf .= $section_title; 
<font class='lnum'>2578</font>   	$chunkbuf .= $folding_section_start2;
<font class='lnum'>2579</font>   
<font class='lnum'>2580</font>   	$toc_indent = "&nbsp;" x ($section_level * 7);
<font class='lnum'>2581</font>   	#$toc_indent = "&nbsp;" x (($section_level-1) * 7 );
<font class='lnum'>2582</font>   	#$tocbuf .= "\n&lt;p&gt;\n" if ( $section_level == 1 ); 
<font class='lnum'>2583</font>   	$tocbuf .= $toc_indent . 
<font class='lnum'>2584</font>   		"&lt;i&gt;" . $section_num . "&lt;/i&gt;" .
<font class='lnum'>2585</font>   		qq/&nbsp;&lt;a href="javascript:;" onmousedown="toggleCombined(/ .  
<font class='lnum'>2586</font>   		$section_num . 
<font class='lnum'>2587</font>   		qq/);" id="toc/ . $section_num .
<font class='lnum'>2588</font>   		qq/"&gt;&lt;b&gt;/ .
<font class='lnum'>2589</font>   		$section_title . 
<font class='lnum'>2590</font>   		"&lt;/b&gt;&lt;/a&gt;&lt;br&gt;\n";
<font class='lnum'>2591</font>   
<font class='lnum'>2592</font>      } #; fisle: end elif headings
<font class='lnum'>2593</font>   
<font class='lnum'>2594</font>   	
<font class='lnum'>2595</font>   
<font class='lnum'>2596</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('54');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('55');">
 dotHTML formatter and rawHTML </a></legend></fieldset>
<p>
<div id="55" style="display:none">   
<ul>


<p>
It is primitive, and I add needed markup "on the fly", as and when I need it.<br>
The idea is to eliminate angle brackets in html tags, which I cannot type without errors<br>
when typing fast, and substitute those with simple "dots", which do not requre switching<br>
keyboard registers.<br>
<p>
This formatting also has problems with escapes.<br>
<p>
Whether it's the fault of HTML standards or their implementation, web browsers continue to<br>
react to html formatting <b>even inside the "pre" tags</b>, which is obviously insane.<br>
Therefore if your code chunks contain any HTML tags (e.g. processed by your code), you'll<br>
need to escape them to display correctly.<br>
And if you use sth like "& g t ;" in your code, the web page will also lie to you.<br>
This is insane, and there is no good quick solution, one would have to use lengthy escape<br>
tables etc. etc.<br>
<p>
This prototype script fails in some (unimportant to me)  cases.<br>
dotHTML markup would also fail if your programming language uses dot-symbol-dot sequences<br>
Mine do not.<br>
<p>
The formatter is pretty straightforward, but sequencing of regexps is important.<br>
One also needs to remember that once escaped, angle brackets are non-existent any more, <br>
and so the subsequent regexps must match on "& l t ;" not on the angle bracket in some<br>
cases.<br>
<p>
<p>
<font class='lnum'>2629</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>2630</font>   
<font class='lnum'>2631</font>   	elsif( $weave_markup eq "dotHTML" ) {	# dotHTML formatter here
<font class='lnum'>2632</font>   
<font class='lnum'>2633</font>   	      s/^=begin.*$//;	# - eliminate perl escaping, start
<font class='lnum'>2634</font>   	      s/^=cut.*$//;		# - eliminate perl escaping, end
<font class='lnum'>2635</font>      	      #s/^{{{\d+(.*)$/$1/;	# - eliminate vim folding markup, start 
<font class='lnum'>2636</font>   					# - dummy, as it is killed in "headings" processing 
<font class='lnum'>2637</font>   	      s/^}}}\d+//;	# - eliminate vim folding markup, end
<font class='lnum'>2638</font>   
<font class='lnum'>2639</font>   		s/&lt;/&lt;/g;	# escape &lt;
<font class='lnum'>2640</font>   		s/&gt;/&gt;/g;	# escape &gt;
<font class='lnum'>2641</font>   
<font class='lnum'>2642</font>   
<font class='lnum'>2643</font>   	      # Paragraphs and line breaks are automatic now:
<font class='lnum'>2644</font>   	      # ... unless we are dealing with the "preformat" tag
<font class='lnum'>2645</font>   		#--note! that ranges do not work here
<font class='lnum'>2646</font>   		$in_pre_tag = 1 if (m!\.pre\.!);
<font class='lnum'>2647</font>   		$in_pre_tag = 0 if (m!\./pre\.!);;
<font class='lnum'>2648</font>   
<font class='lnum'>2649</font>   		s/\.(\/?)pre\./&lt;$1pre&gt;/g;
<font class='lnum'>2650</font>   
<font class='lnum'>2651</font>   	    unless ($in_pre_tag) {
<font class='lnum'>2652</font>   	    (m/^\s*$/) and s/$_/&lt;p&gt;\n/
<font class='lnum'>2653</font>   	    or s/\n/&lt;br&gt;\n/;
<font class='lnum'>2654</font>   	    }
<font class='lnum'>2655</font>   </fieldset></pre>
<p>
Now the regexps to cut out "#--------" lines and substitute "dot-notation" with angle brackets:<br>
<p>
<font class='lnum'>2659</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>2660</font>   	      # originally I separated header from the body with such a line
<font class='lnum'>2661</font>   	      #s/^#-----.*/starting the table here/;
<font class='lnum'>2662</font>   	      s/^#-----.*//;
<font class='lnum'>2663</font>   
<font class='lnum'>2664</font>   
<font class='lnum'>2665</font>   		# add more here
<font class='lnum'>2666</font>   
<font class='lnum'>2667</font>   		s/\.(\/?)b\./&lt;$1b&gt;/g;
<font class='lnum'>2668</font>   		s/\.(\/?)i\./&lt;$1i&gt;/g;
<font class='lnum'>2669</font>   		s/\.(\/?)ul\./&lt;$1ul&gt;/g;
<font class='lnum'>2670</font>   		s/\.(\/?)li\./&lt;$1li&gt;/g;
<font class='lnum'>2671</font>   		s/\.(\/?)ol\./&lt;$1ol&gt;/g;
<font class='lnum'>2672</font>   		s/\.(\/?)s\./&lt;$1s&gt;/g;
<font class='lnum'>2673</font>   		s/\.(\/?)div\./&lt;$1div&gt;/g;
<font class='lnum'>2674</font>   		s/\.br\./&lt;br&gt;/g;
<font class='lnum'>2675</font>   		s/\.p\./&lt;p&gt;/g;
<font class='lnum'>2676</font>   
<font class='lnum'>2677</font>   
<font class='lnum'>2678</font>   		s/\.(\/?)tab\./&lt;$1ul&gt;/g;	# "tabbing" with "ul"
<font class='lnum'>2679</font>   
<font class='lnum'>2680</font>   
<font class='lnum'>2681</font>   		# this is some bullshit ???
<font class='lnum'>2682</font>   		s/\.hr\./&lt;hr /g;
<font class='lnum'>2683</font>   		s/\.\/hr\./&gt;/g;
<font class='lnum'>2684</font>   
<font class='lnum'>2685</font>   		s!\.a\.(.+?)\.\/a\.!&lt;a href=$1&gt;$1&lt;/a&gt;!g;
<font class='lnum'>2686</font>   
<font class='lnum'>2687</font>   		# rudimentary &nbsp; s p a c i n g &nbsp (one word only)
<font class='lnum'>2688</font>   		#s!\.x\.(.+?)\./x\.!join " ","&nbsp;&nbsp;",(split //, $1),"&nbsp;&nbsp;"!eg;
<font class='lnum'>2689</font>   
<font class='lnum'>2690</font>   		# slightly better spacing (phrases, too):
<font class='lnum'>2691</font>   		# although redundant  with more work than is needed
<font class='lnum'>2692</font>   		if ( m!(\.x\.)(.+?)(\./x\.)!g) {
<font class='lnum'>2693</font>   		    s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>2694</font>   		    s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>2695</font>   		    s!  _  ! &nbsp; !g;
<font class='lnum'>2696</font>   		}
<font class='lnum'>2697</font>   </fieldset></pre>
<p>
<b> BUG! </b> This URL breaks my "ancor" dot-tags: <br>
     <pre> http://www.cs.tufts.edu/~nr/noweb </pre><br>
<b> Got it </b> The substitutions above must explicitly use "slash" for the closing HTML tag<br>
in the regexps - otherwise they match stuff like ".cs." inside URLs<br>
<p>
If an HTML tag is not in the above chunk, either add it or write with the two following generic<br>
tags (slow and not nice on your fingers, though). You might need to use them also when your HTML<br>
tag conntains some options, and so is not of generic simple type.<br>
<p>
<font class='lnum'>2708</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>2709</font>   		# generic for all tags with options
<font class='lnum'>2710</font>   		s!\.&lt;\. !&lt;!g;
<font class='lnum'>2711</font>   		s! \.&gt;\.!&gt;!g;
<font class='lnum'>2712</font>   
<font class='lnum'>2713</font>   
<font class='lnum'>2714</font>   		$chunkbuf .= $_;
<font class='lnum'>2715</font>   
<font class='lnum'>2716</font>   	}
<font class='lnum'>2717</font>   </fieldset></pre>
<p>
<p>
<b> rawHTML formatter</b><br>
Raw HTML formatting can be done - either because it is non-restricted, compared to the stripped-down<br>
"dotHTML" of my invention, or because it allows one to convert existing HTML documentation into the<br>
folding format.<br>
I.e. if you have a longish manual in which section headings are marked with HTML h1, h2, h3, ... tags,<br>
you can convert it in 3 simple steps:<br>
<ul> <li> delete opening and closing "html" and "head" "body" tags at the very top and bottom of your <br>
document<br>
</li> <li> put perl invocation as the first line<br>
</li> <li> set up markup mode in a variable: "$weave_markup = "rawHTML";" and "mollify" the document,<br>
putting  "do MOLLY.pl" and DATA marker<br>
</li> </ul><br>
and if there are no interfering div section etc. - no complicated markup inside the headings, you'll get<br>
an automatically generated folding HTML document.<br>
<p>
If you do, it is sometimes easy to clean headings with a few regexps in a good editor like Vim<br>
<p>
It is very convenient and I keep large manuals as folding HTML documents.<br>
<p>
<p>
<font class='lnum'>2740</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>2741</font>   	elsif( $weave_markup eq "rawHTML" ) {	# if the doc chunks marked up with real HTML
<font class='lnum'>2742</font>   		s!^#-----.*!!;
<font class='lnum'>2743</font>   
<font class='lnum'>2744</font>   
<font class='lnum'>2745</font>   	      # Paragraphs and line breaks are automatic now:
<font class='lnum'>2746</font>   	      # ... unless we are dealing with the "preformat" tag
<font class='lnum'>2747</font>   		#--note! that ranges do not work here
<font class='lnum'>2748</font>   		$in_pre_tag = 1 if (m!&lt;pre&gt;!);
<font class='lnum'>2749</font>   		$in_pre_tag = 0 if (m!&lt;/pre&gt;!);;
<font class='lnum'>2750</font>   
<font class='lnum'>2751</font>   
<font class='lnum'>2752</font>   		unless ($in_pre_tag) {
<font class='lnum'>2753</font>   		(m/^\s*$/) and s/$_/&lt;p&gt;\n/
<font class='lnum'>2754</font>   		or s/\n/&lt;br&gt;\n/;
<font class='lnum'>2755</font>   		}
<font class='lnum'>2756</font>   
<font class='lnum'>2757</font>   
<font class='lnum'>2758</font>   		$chunkbuf .= $_;
<font class='lnum'>2759</font>   	} # esle -- for rest of the body
<font class='lnum'>2760</font>   
<font class='lnum'>2761</font>   
<font class='lnum'>2762</font>   
<font class='lnum'>2763</font>   </fieldset></pre>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('56');">
 test of &nbsp;&nbsp; s p a c i n g &nbsp;&nbsp; regexp </a></legend></fieldset>
<p>
<div id="56" style="display:none">   
<ul>

<p>
1. Hell, the thing is multiple sp /sp markups on one line. I need to iterate over<br>
each separately and then put them in their right places, hedging with "nbsp"-ces each word.<br>
<p>
2. The invocation is OK for $str_sp, but for boundaries of the string and word boundaries, <br>
they must be hedged too<br>
<p>
3. Could subst spaces-betwen-words to sth like _ (space-underscore-space) as placeholders,<br>
then subst them into nbspx2 in a following regexp<br>
<p>
4. This tagging can be done cleanly and span severl lines if I do it in a different place - <br>
not while still reading the Literate Source file line by line,  &nbsp;  b u t  &nbsp;  l a t e r  &nbsp;  when<br>
$chunkbuf is completely formed in RAM.<br>
<p>
<p>
<font class='lnum'>2781</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;spacing.pl&gt;&gt;=</legend>
<font class='lnum'>2782</font>   #!/usr/bin/perl
<font class='lnum'>2783</font>   #
<font class='lnum'>2784</font>   $str = $ARGV[0];
<font class='lnum'>2785</font>   $str_sp = $ARGV[0];
<font class='lnum'>2786</font>   #print "string is $str\n";
<font class='lnum'>2787</font>   
<font class='lnum'>2788</font>       # "sp" dot-markup to intersperse spaces: the basic formula
<font class='lnum'>2789</font>       #$spaced_str =~ s!(asdf)!join " ", (split //, $1)!eg;
<font class='lnum'>2790</font>       #
<font class='lnum'>2791</font>       
<font class='lnum'>2792</font>       # -- idea 3 from above: this works but is cumbersome --
<font class='lnum'>2793</font>       #$str_sp =~ s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>2794</font>       #$str_sp =~ s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>2795</font>       #$str_sp =~ s! _ ! &nbsp;&nbsp; !g;
<font class='lnum'>2796</font>   
<font class='lnum'>2797</font>       # -- first get the matching string in "if", then massage it:
<font class='lnum'>2798</font>       if ($str_sp =~ m!(\.x\.)(.+?)(\./x\.)!g) {
<font class='lnum'>2799</font>   	$str_sp =~ s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>2800</font>           $str_sp =~ s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>2801</font>   	$str_sp =~ s!  _  ! &nbsp; !g;
<font class='lnum'>2802</font>       }
<font class='lnum'>2803</font>   
<font class='lnum'>2804</font>       #print "\nthe string is $str\n";
<font class='lnum'>2805</font>       print "\nthe str_sp is $str_sp\n\n";
<font class='lnum'>2806</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('56');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('55');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('52');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('57');">
 Print out the resulting page </a></legend></fieldset>
<p>
<div id="57" style="display:none">   
<ul>


<p>
Page and the outer formatting table:<br>
<p>
<font class='lnum'>2821</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>2822</font>   
<font class='lnum'>2823</font>     # begin the page:
<font class='lnum'>2824</font>     print "&lt;html&gt;  $html_head &lt;body&gt;  $html_body_table \n";
<font class='lnum'>2825</font>   
<font class='lnum'>2826</font>     # print out the TOC, the Chunks Index, the output buffer and close the page.
<font class='lnum'>2827</font>   
<font class='lnum'>2828</font>   </fieldset></pre>
<p>
Next print the short instructions section (collapsible) at the top:<br>
<p>
<font class='lnum'>2832</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>2833</font>   
<font class='lnum'>2834</font>   print &lt;&lt;end_of_print;
<font class='lnum'>2835</font>   &lt;p&gt;&lt;fieldset class='tocfieldset'&gt;&lt;legend&gt;&lt;b&gt;TABLE OF CONTENTS: outline of the document structure&lt;/b&gt;&lt;/legend&gt;
<font class='lnum'>2836</font>   
<font class='lnum'>2837</font>   &lt;ul&gt;
<font class='lnum'>2838</font>   &lt;p&gt;
<font class='lnum'>2839</font>   &lt;br&gt;
<font class='lnum'>2840</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>2841</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('tochowto');"&gt;
<font class='lnum'>2842</font>   &lt;b&gt;HOW TO USE THE FOLDING DOCUMENT [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>2843</font>   &lt;/div&gt;
<font class='lnum'>2844</font>   &lt;div id='tochowto' style='display:none' style='background:#ffffff'&gt; 
<font class='lnum'>2845</font>   &lt;p&gt;
<font class='lnum'>2846</font>   &lt;ul&gt;
<font class='lnum'>2847</font>   &lt;li&gt;&lt;b&gt;Collapsing is necessary when&lt;/b&gt; you work on some code and must exclude 
<font class='lnum'>2848</font>   &lt;br&gt;irrelevant sections of the rest of the literate project file. This 
<font class='lnum'>2849</font>   &lt;br&gt;greatly helps to clear thinking by eliminating a general feeling of 
<font class='lnum'>2850</font>   &lt;br&gt;being in a maze of code and unnecessary "housekeeping" tasks.
<font class='lnum'>2851</font>   &lt;br&gt;One can say that there is a limited "buffer capacity" in the human
<font class='lnum'>2852</font>   &lt;br&gt;mind, and relieving it of the need to remember where things are in a 
<font class='lnum'>2853</font>   &lt;br&gt;larger file, at which other points one must fill in values or adjust
<font class='lnum'>2854</font>   &lt;br&gt;invocation etc. &lt;i&gt;immediately makes the user "more intelligent"&lt;/i&gt;
<font class='lnum'>2855</font>   &lt;/li&gt;&lt;li&gt;&lt;b&gt;To toggle&lt;/b&gt; a section open/closed, click on the corresponding link
<font class='lnum'>2856</font>   &lt;br&gt;Remember to open &lt;i&gt;all sections above it&lt;/i&gt; for it to become visible.
<font class='lnum'>2857</font>   &lt;/li&gt;&lt;li&gt;&lt;b&gt;To restore the default view&lt;/b&gt; reload the page in the browser.
<font class='lnum'>2858</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>2859</font>   &lt;b&gt;To keep some sections open&lt;/b&gt; upon each reload - 
<font class='lnum'>2860</font>   &lt;br&gt;e.g. you work on the code, update it constantly and cannot reopen it 
<font class='lnum'>2861</font>   &lt;br&gt;again and again - mark their sections in the source file with a plus, 
<font class='lnum'>2862</font>   &lt;br&gt;i.e. write the opening tag (only)  as +h2, +h3 (in &lt; &gt;  or in dots
<font class='lnum'>2863</font>   &lt;br&gt;for dotHTML). Again, all sections above must be marked open too. 
<font class='lnum'>2864</font>   &lt;p&gt;&lt;b&gt;Note that&lt;/b&gt; "expand all" and "collapse all" disregard these settings.
<font class='lnum'>2865</font>   &lt;br&gt;Reload the page after using those options to again view the text according 
<font class='lnum'>2866</font>   &lt;br&gt;to your preferences.
<font class='lnum'>2867</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>2868</font>   &lt;b&gt; To use the Index &lt;/b&gt;, click on the numbered sections in the TOC above
<font class='lnum'>2869</font>   &lt;br&gt;(opening them; use highlighting as a guide; when sections are visible,
<font class='lnum'>2870</font>   &lt;br&gt;the slider on your browser window  will shorten too), or "expand all", 
<font class='lnum'>2871</font>   &lt;br&gt;and then use your browser's Find function to highlight all chunk name 
<font class='lnum'>2872</font>   &lt;br&gt;instances in the visible text
<font class='lnum'>2873</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>2874</font>   &lt;b&gt;To search for variables etc.&lt;/b&gt;, "expand all" text - or manually 
<font class='lnum'>2875</font>   &lt;br&gt;expand needed sections - and then use your browser's Find function to 
<font class='lnum'>2876</font>   &lt;br&gt;highlight all and jump between the found items.
<font class='lnum'>2877</font>   &lt;p&gt;&lt;/li&gt;
<font class='lnum'>2878</font>   
<font class='lnum'>2879</font>   &lt;/div&gt; 
<font class='lnum'>2880</font>   &lt;p&gt;
<font class='lnum'>2881</font>   &lt;br&gt;
<font class='lnum'>2882</font>   &lt;p&gt;
<font class='lnum'>2883</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>2884</font>   &lt;!--i&gt;&lt;font size=-3&gt; expand all -- collapse all&lt;/font&gt;&lt;/i--&gt;
<font class='lnum'>2885</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('tocmain');"&gt;
<font class='lnum'>2886</font>   &lt;b&gt;TABLE OF CONTENTS [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>2887</font>   &lt;/div&gt;
<font class='lnum'>2888</font>   
<font class='lnum'>2889</font>   &lt;div id='tocmain' style='display:$toc_expanded' style='background:#ffffff'&gt; 
<font class='lnum'>2890</font>   &lt;p&gt;
<font class='lnum'>2891</font>   &lt;br&gt;
<font class='lnum'>2892</font>   &lt;p&gt;
<font class='lnum'>2893</font>   end_of_print
<font class='lnum'>2894</font>   
<font class='lnum'>2895</font>   </fieldset></pre>
<p>
Table of Contents from the formed "tocbuf":<br>
<p>
<font class='lnum'>2899</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>2900</font>   
<font class='lnum'>2901</font>    print "$tocbuf" if $print_toc;
<font class='lnum'>2902</font>    #print "$tocbuf";
<font class='lnum'>2903</font>   
<font class='lnum'>2904</font>   print "&lt;/div&gt;\n";
<font class='lnum'>2905</font>   
<font class='lnum'>2906</font>   </fieldset></pre>
<p>
Start the "Index of code chunks", collapsible:<br>
<p>
<font class='lnum'>2910</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>2911</font>   
<font class='lnum'>2912</font>   print &lt;&lt;end_of_print;
<font class='lnum'>2913</font>   &lt;p&gt;
<font class='lnum'>2914</font>   &lt;br&gt;
<font class='lnum'>2915</font>   &lt;p&gt;
<font class='lnum'>2916</font>   &lt;!--fieldset&gt;&lt;legend--&gt;
<font class='lnum'>2917</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>2918</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('indbuf');"&gt;
<font class='lnum'>2919</font>   &lt;b&gt;INDEX of Code Chunks [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>2920</font>   &lt;/div&gt;
<font class='lnum'>2921</font>   &lt;!--/legend&gt;&lt;/fieldset--&gt;
<font class='lnum'>2922</font>   &lt;p&gt;
<font class='lnum'>2923</font>   &lt;div id='indbuf' style='display:$ind_expanded' style='background:#ffffff'&gt; 
<font class='lnum'>2924</font>   &lt;ul&gt;
<font class='lnum'>2925</font>   &lt;p&gt;
<font class='lnum'>2926</font>   &lt;b&gt;"Def" subscript&lt;/b&gt; means the chunk is defined, while a bare number means 
<font class='lnum'>2927</font>   &lt;br&gt;the chunk is being used in the given section.
<font class='lnum'>2928</font>   &lt;p&gt;
<font class='lnum'>2929</font>   end_of_print
<font class='lnum'>2930</font>   
<font class='lnum'>2931</font>   </fieldset></pre>
<p>
<p>
Index of code chunks; calculated in this snippet:<br>
<p>
<font class='lnum'>2936</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>2937</font>   
<font class='lnum'>2938</font>   	 $ind_outbuf = '';
<font class='lnum'>2939</font>   	 $prev_ch_name = '';
<font class='lnum'>2940</font>   
<font class='lnum'>2941</font>   	 #for (sort @indbuf){ print $_, "&lt;br&gt;";}
<font class='lnum'>2942</font>   
<font class='lnum'>2943</font>   	 for (sort @indbuf){
<font class='lnum'>2944</font>   
<font class='lnum'>2945</font>   	   ($ch_name, $closing_bracket, $ref_num) = split /&gt;/, $_; 
<font class='lnum'>2946</font>   		#/ - for editor colouring bug
<font class='lnum'>2947</font>   
<font class='lnum'>2948</font>   	    if ( $ch_name eq $prev_ch_name ){ 
<font class='lnum'>2949</font>   	      $ind_outbuf .= " &lt;b&gt;" . $ref_num . "&lt;/b&gt; ";
<font class='lnum'>2950</font>   	    }
<font class='lnum'>2951</font>   	    else{
<font class='lnum'>2952</font>   	      print  $ind_outbuf, "&lt;br&gt;\n"; 
<font class='lnum'>2953</font>   	      $ch_namestr = $ch_name;
<font class='lnum'>2954</font>   	      $ch_namestr =~ s!&lt;&lt;!!;
<font class='lnum'>2955</font>   	      $ind_outbuf = 
<font class='lnum'>2956</font>   	      	"&lt;b&gt;&lt;&lt;&lt;/b&gt;&lt;font class='chunkref'&gt;" . 
<font class='lnum'>2957</font>   	      	$ch_namestr . 
<font class='lnum'>2958</font>   	      	"&lt;/font&gt;&lt;b&gt;&gt;&gt;&lt;/b&gt; -- &lt;b&gt;" . 
<font class='lnum'>2959</font>   	      	$ref_num . 
<font class='lnum'>2960</font>   	      	"&lt;/b&gt; ";
<font class='lnum'>2961</font>   	    }
<font class='lnum'>2962</font>   	    $prev_ch_name = $ch_name;
<font class='lnum'>2963</font>   
<font class='lnum'>2964</font>   	 }; # rof - forming the code chunks index
<font class='lnum'>2965</font>   
<font class='lnum'>2966</font>   	print $ind_outbuf, "&lt;br&gt;\n";
<font class='lnum'>2967</font>   
<font class='lnum'>2968</font>   </fieldset></pre>
<p>
<p>
"expand all" and "collapse all" at the end of the TOC/Chunk Index section <br>
at the top of the page:<br>
<p>
<font class='lnum'>2974</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>2975</font>   
<font class='lnum'>2976</font>     # The "expand all" "collapse all" control
<font class='lnum'>2977</font>   
<font class='lnum'>2978</font>   print &lt;&lt;end_of_print;
<font class='lnum'>2979</font>   &lt;/div&gt;\n&lt;p&gt;
<font class='lnum'>2980</font>   &lt;br&gt;
<font class='lnum'>2981</font>   &lt;p&gt;&lt;div class='hl' align=center&gt;&lt;i&gt;
<font class='lnum'>2982</font>   &lt;a href="javascript:;" onmousedown="showAll();"&gt;
<font class='lnum'>2983</font>   expand all&lt;/a&gt; -- 
<font class='lnum'>2984</font>   &lt;a href="javascript:;" onmousedown="hideAll();"&gt;
<font class='lnum'>2985</font>   collapse all&lt;/a&gt;
<font class='lnum'>2986</font>   &lt;/i&gt;&lt;/div&gt;&lt;p&gt;
<font class='lnum'>2987</font>   end_of_print
<font class='lnum'>2988</font>   
<font class='lnum'>2989</font>   
<font class='lnum'>2990</font>    print "&lt;/ul&gt;&lt;/fieldset&gt;&lt;p&gt;\n&lt;br&gt;";
<font class='lnum'>2991</font>   
<font class='lnum'>2992</font>   </fieldset></pre>
<p>
<p>
<p>
..and the document itself, formed earlier in the "chunkbuf" string in memory:<br>
<p>
<font class='lnum'>2998</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>2999</font>   
<font class='lnum'>3000</font>   # The FULL OUTPUT, the file body:
<font class='lnum'>3001</font>    	print $chunkbuf;
<font class='lnum'>3002</font>   
<font class='lnum'>3003</font>   </fieldset></pre>
<p>
Close the HTML formatting tags at the end of the page:<br>
<p>
<font class='lnum'>3007</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>3008</font>   
<font class='lnum'>3009</font>   # close the page
<font class='lnum'>3010</font>   	print $html_body_table_end;
<font class='lnum'>3011</font>   	
<font class='lnum'>3012</font>   exit;
<font class='lnum'>3013</font>   
<font class='lnum'>3014</font>   #--- END OF SCRIPT ---
<font class='lnum'>3015</font>   
<font class='lnum'>3016</font>   </fieldset></pre>
<p>
End of the project file<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('57');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('44');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('24');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('1');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>


</td></tr></table></center></body></html>

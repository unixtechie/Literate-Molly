<html>
  
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 



<script language="javascript">

function toggleDiv(divid) {
var el = document.getElementById(divid);
el.style.display = (el.style.display == 'block') ? 'none' : 'block';
}


function toggleCombined(divid){
    if(document.getElementById(divid).style.display == 'none'){
      document.getElementById(divid).style.display = 'block';
	document.getElementById("toc"+divid).className="hilited";
    }
    else{
      document.getElementById(divid).style.display = 'none';
	document.getElementById("toc"+divid).className="unhilited";
    }
}


function showAll(){
for(i=1; i <= 10000; i++){
    document.getElementById(i).style.display = 'block';
    document.getElementById("toc"+i).className="hilited";
    };
}

function hideAll(){
for(i=1; i <= 10000; i++){
    document.getElementById(i).style.display = 'none';
    document.getElementById("toc"+i).className="unhilited";
    };
}

</script>
<style type="text/css" media="screen">


BODY {
	FONT-SIZE: 10pt;
	<!--FONT-FAMILY: sans-serif -->
	background: #f0f0f0;
	}
FIELDSET {
	BORDER-RIGHT: #000000 1px solid; 
	BORDER-TOP: #000000 1px solid; 
	BORDER-LEFT: #000000 1px solid; 
	BORDER-BOTTOM: #000000 1px solid; 
	PADDING-RIGHT: 5px; 
	PADDING-LEFT: 5px; 
	PADDING-BOTTOM: 2px; 
	PADDING-TOP: 5px;
	MARGIN-BOTTOM: 1px; 
	background: #f5f5f5; 
	color: #000000;
	}
LEGEND {
	BORDER-RIGHT: #a9a9a9 1px solid; 
	BORDER-BOTTOM: #a9a9a9 1px solid;
	BORDER-TOP: #a9a9a9 1px solid; 
	BORDER-LEFT: #a9a9a9 1px solid; 
	PADDING-RIGHT: 20px; 
	PADDING-LEFT: 20px; 
	PADDING-BOTTOM: 5px; 
	PADDING-TOP: 5px; 
	FONT-WEIGHT: bold;  
	BACKGROUND: #fdfdfd; 
	color: #000000;
	}
PRE	{
        PADDING-LEFT: 20px; 
        PADDING-RIGHT: 5px; 
        padding-top: 0px; 
        padding-bottom: 6px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
	background: #fefefe;
	}


.tocfieldset {
	background: #ffffff; 
	color: #000000;
	}

.codefieldset {
	BORDER-RIGHT: #000 1px solid; 
	BORDER-TOP: #000 1px solid; 
	BORDER-LEFT: #000 1px solid; 
	BORDER-BOTTOM: #000 1px solid; 
	background: #ffffff; 
	color: #000;
	MARGIN-BOTTOM: 1px; 
	PADDING-LEFT: 15px; 
	PADDING-RIGHT: 5px; 
	PADDING-BOTTOM: 10px; 
	PADDING-TOP: 1px;
	}
.codelegend {
	BORDER-RIGHT: #777 1px solid; 
	BORDER-TOP: #777 1px solid; 
	BORDER-LEFT: #777 1px solid; 
	BORDER-BOTTOM: #777 1px solid
	PADDING-RIGHT: 10px; 
	PADDING-LEFT: 10px; 
	PADDING-TOP: 2px; 
	PADDING-BOTTOM: 2px; 
	background: #ffffff; 
	color: #00b;
	FONT-WEIGHT: bold;  
	/font-variant: small-caps;
	/font-style: italic;
	}



.chunkref {
        color: #00b;	
        background: #f6f6f6;
        /font-style: italic;
        font-weight: bold;
        /font-variant: small-caps;
	}


.outertable {
	width: 99%; 
	cellpadding: 25; 
	background: #ffffff; 
	border: 1px solid;
	}

.hl	{
	 ;
        PADDING-LEFT: 5px; PADDING-RIGHT: 5px; 
        padding-top: 5px; padding-bottom: 5px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
        background: #f5f5f5;	
        width: 70%;
	}

.hl-wide {
	 ;
        PADDING-LEFT: 5px; 
        PADDING-RIGHT: 5px; 
        padding-top: 15px; 
        padding-bottom: 15px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
        background: #fbfbfb;	
	}

.lnum {

	color: #a0a0a0;
	/background: #fbfbfb;
	}

.unhilited {background-color:white}
.hilited {background-color:#c0c0ff}


</STYLE>

</head>

 <body>  <center><table class='outertable'><tr><td> 
<p><fieldset class='tocfieldset'><legend><b>TABLE OF CONTENTS: outline of the document structure</b></legend>

<ul>
<p>
<br>
<div class='hl' align=center>
<a href="javascript:;" onmousedown="toggleDiv('tochowto');">
<b>HOW TO USE THE FOLDING DOCUMENT [expand/collapse]</b></a>
</div>
<div id='tochowto' style='display:none' style='background:#ffffff'> 
<p>
<ul>
<li><b>Collapsing is necessary when</b> you work on some code and must exclude 
<br>irrelevant sections of the rest of the literate project file. This 
<br>greatly helps to clear thinking by eliminating a general feeling of 
<br>being in a maze of code and unnecessary "housekeeping" tasks.
<br>One can say that there is a limited "buffer capacity" in the human
<br>mind, and relieving it of the need to remember where things are in a 
<br>larger file, at which other points one must fill in values or adjust
<br>invocation etc. <i>immediately makes the user "more intelligent"</i>
</li><li><b>To toggle</b> a section open/closed, click on the corresponding link
<br>Remember to open <i>all sections above it</i> for it to become visible.
</li><li><b>To restore the default view</b> reload the page in the browser.
</li><li>
<b>To keep some sections open</b> upon each reload - 
<br>e.g. you work on the code, update it constantly and cannot reopen it 
<br>again and again - mark their sections in the source file with a plus, 
<br>i.e. write the opening tag (only)  as +h2, +h3 (in &lt; &gt;  or in dots
<br>for dotHTML). Again, all sections above must be marked open too. 
<p><b>Note that</b> "expand all" and "collapse all" disregard these settings.
<br>Reload the page after using those options to again view the text according 
<br>to your preferences.
</li><li>
<b> To use the Index </b>, click on the numbered sections in the TOC above
<br>(opening them; use highlighting as a guide; when sections are visible,
<br>the slider on your browser window  will shorten too), or "expand all", 
<br>and then use your browser's Find function to highlight all chunk name 
<br>instances in the visible text
</li><li>
<b>To search for variables etc.</b>, "expand all" text - or manually 
<br>expand needed sections - and then use your browser's Find function to 
<br>highlight all and jump between the found items.
<p></li>

</div> 
<p>
<br>
<p>
<div class='hl' align=center>
<!--i><font size=-3> expand all -- collapse all</font></i-->
<a href="javascript:;" onmousedown="toggleDiv('tocmain');">
<b>TABLE OF CONTENTS [expand/collapse]</b></a>
</div>

<div id='tocmain' style='display:block' style='background:#ffffff'> 
<p>
<br>
<p>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>1</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(1);" id="toc1"><b> MOLLY MODULE </a>&nbsp;<a><font class='lnum' size=-1><i>(line 77)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>2</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(2);" id="toc2"><b> THE CHUNK TO TANGLE BY  DEFAULT </a>&nbsp;<a><font class='lnum' size=-1><i>(line 91)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>3</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(3);" id="toc3"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 124)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>4</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(4);" id="toc4"><b> PART I ----------- Concepts. Controlling human attention.------------ </a>&nbsp;<a><font class='lnum' size=-1><i>(line 127)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>5</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(5);" id="toc5"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 314)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>6</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(6);" id="toc6"><b> PART II ------------ HOW TO USE MOLLY.pl ------------ </a>&nbsp;<a><font class='lnum' size=-1><i>(line 317)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>7</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(7);" id="toc7"><b> My workflow - literate programming with Molly </a>&nbsp;<a><font class='lnum' size=-1><i>(line 322)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>8</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(8);" id="toc8"><b> SET UP a Literate Source file and project </a>&nbsp;<a><font class='lnum' size=-1><i>(line 376)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>9</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(9);" id="toc9"><b> Prerequisites: "noweb" tools By Norman Ramsey </a>&nbsp;<a><font class='lnum' size=-1><i>(line 382)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>10</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(10);" id="toc10"><b> Setting up the file </a>&nbsp;<a><font class='lnum' size=-1><i>(line 406)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>11</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(11);" id="toc11"><b> "Mollification" - full configuration template </a>&nbsp;<a><font class='lnum' size=-1><i>(line 490)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>12</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(12);" id="toc12"><b> Markup of code and documentation sections </a>&nbsp;<a><font class='lnum' size=-1><i>(line 587)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>13</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(13);" id="toc13"><b> Tangling from LSFile </a>&nbsp;<a><font class='lnum' size=-1><i>(line 633)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>14</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(14);" id="toc14"><b> Sample minimal configuration of thttpd </a>&nbsp;<a><font class='lnum' size=-1><i>(line 678)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>15</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(15);" id="toc15"><b> CREATE a Literate Source file -- documentation chunks markup</a>&nbsp;<a><font class='lnum' size=-1><i>(line 746)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>16</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(16);" id="toc16"><b> Doc sections markup </a>&nbsp;<a><font class='lnum' size=-1><i>(line 750)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>17</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(17);" id="toc17"><b> Markup and Escaping </a>&nbsp;<a><font class='lnum' size=-1><i>(line 802)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>18</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(18);" id="toc18"><b> Mathematical Formulae - MathML inside Mollified Literate source files </a>&nbsp;<a><font class='lnum' size=-1><i>(line 832)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>19</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(19);" id="toc19"><b> How to use ASCIIMathML.js in Molly </a>&nbsp;<a><font class='lnum' size=-1><i>(line 854)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>20</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(20);" id="toc20"><b> 6 . Some examples and LaTexMathML.js library versions </a>&nbsp;<a><font class='lnum' size=-1><i>(line 906)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>21</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(21);" id="toc21"><b> 7 .  ASCIIMathML Markup - reference </a>&nbsp;<a><font class='lnum' size=-1><i>(line 989)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>22</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(22);" id="toc22"><b> How to distribute your final folding HTML-formatted work </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1022)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>23</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(23);" id="toc23"><b> READ and SEARCH inside a Folding Literate Source file </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1062)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>24</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(24);" id="toc24"><b> Opening many relevant subsections together, TOC highlighting </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1068)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>25</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(25);" id="toc25"><b> Keeping some sections of the LSFile permanently open </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1084)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>26</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(26);" id="toc26"><b> TOC and Code Chunks Index </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1137)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>27</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(27);" id="toc27"><b> Searching for symbols, chunks, phrases </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1161)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>28</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(28);" id="toc28"><b> TOC/Index unfolding and collapsing </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1177)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>29</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(29);" id="toc29"><b> Use for printing </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1186)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>30</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(30);" id="toc30"><b> Text browsers and JavaScript </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1201)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>31</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(31);" id="toc31"><b> SUGGESTED USES: Work with Folding LSFiles</a>&nbsp;<a><font class='lnum' size=-1><i>(line 1219)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>32</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(32);" id="toc32"><b> scrap </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1312)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>33</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(33);" id="toc33"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1345)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>34</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(34);" id="toc34"><b> PART III ------------ LITERATE SOURCE OF THE SCRIPT ------------ </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1348)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>35</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(35);" id="toc35"><b> Local Reference </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1353)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>36</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(36);" id="toc36"><b> Bugs, status, changes </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1372)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>37</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(37);" id="toc37"><b> Ideas - versions - changes</a>&nbsp;<a><font class='lnum' size=-1><i>(line 1376)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>38</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(38);" id="toc38"><b> first ideas </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1396)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>39</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(39);" id="toc39"><b> more ideas </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1498)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>40</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(40);" id="toc40"><b>  CONTRACT PROGRAMMING and Molly?? </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1544)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>41</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(41);" id="toc41"><b> Editor highlighting, Perl POD and Literate Markup </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1590)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>42</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(42);" id="toc42"><b>Done </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1619)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>43</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(43);" id="toc43"><b> for Tangling </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1624)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>44</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(44);" id="toc44"><b>Todo -  current</a>&nbsp;<a><font class='lnum' size=-1><i>(line 1648)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>45</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(45);" id="toc45"><b> PRELIMINARIES: The script layout and idea </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1707)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>46</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(46);" id="toc46"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1788)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>47</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(47);" id="toc47"><b> MOLLY.pl - top of the script </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1791)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>48</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(48);" id="toc48"><b> general settings </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1819)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>49</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(49);" id="toc49"><b> main despatcher </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1937)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>50</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(50);" id="toc50"><b> "Main despatcher with CL" </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1955)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>51</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(51);" id="toc51"><b> "Main despatcher simple" </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2126)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>52</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(52);" id="toc52"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2168)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>53</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(53);" id="toc53"><b> TANGLER </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2171)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>54</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(54);" id="toc54"><b> Notes on; difference btw built-in and "notangle" </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2175)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>55</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(55);" id="toc55"><b> Code: run pass-through or built-in tangler </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2240)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>56</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(56);" id="toc56"><b> seek-peek tangler (working) </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2299)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>57</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(57);" id="toc57"><b> Advantages, limitations; escapes; the algorithm </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2303)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>58</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(58);" id="toc58"><b>Makefile for s.-p. tangler tests</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2363)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>59</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(59);" id="toc59"><b>todo</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2401)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>60</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(60);" id="toc60"><b>The code</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2429)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>61</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(61);" id="toc61"><b> PAss 1 </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2466)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>62</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(62);" id="toc62"><b> Ref: perl operators </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2520)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>63</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(63);" id="toc63"><b> Pass 1: main while-loop and foffs</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2555)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>64</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(64);" id="toc64"><b> multiple refs on the same line</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2685)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>65</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(65);" id="toc65"><b> first test: how to iterate over regex, using pos</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2763)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>66</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(66);" id="toc66"><b> pass 2 and print </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2808)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>67</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(67);" id="toc67"><b> two debug chunks</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2931)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>68</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(68);" id="toc68"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2969)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>69</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(69);" id="toc69"><b> WEAVER </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2972)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>70</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(70);" id="toc70"><b> How formatting is done in the weaver </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2999)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>71</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(71);" id="toc71"><b> actual working test.html </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3035)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>72</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(72);" id="toc72"><b> changing text style - the basic JS recipy </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3167)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>73</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(73);" id="toc73"><b> Reference - Javascript and DOM </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3218)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>74</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(74);" id="toc74"><b> set formatting strings for weaver </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3234)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>75</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(75);" id="toc75"><b> JS functions </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3311)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>76</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(76);" id="toc76"><b> Stylesheet </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3365)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>77</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(77);" id="toc77"><b> Accumulate the result </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3516)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>78</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(78);" id="toc78"><b> process code chunks </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3595)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>79</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(79);" id="toc79"><b> process section headings </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3650)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>80</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(80);" id="toc80"><b> dotHTML formatter and rawHTML </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3785)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>81</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(81);" id="toc81"><b> test of &nbsp;&nbsp; s p a c i n g &nbsp;&nbsp; regexp </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3963)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>82</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(82);" id="toc82"><b> Print out the resulting page </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4014)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>83</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(83);" id="toc83"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4223)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>84</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(84);" id="toc84"><b> ADD-ON: example of additional markup - dotHTML - change unfinished</a>&nbsp;<a><font class='lnum' size=-1><i>(line 4226)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>85</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(85);" id="toc85"><b> ADD-ON: ASCIIMathML and LaTeXMathML inside Molly  </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4257)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>86</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(86);" id="toc86"><b> Extending the lib with missing LaTeX or HTML symbols </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4281)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>87</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(87);" id="toc87"><b> Testing ASCIIMathML.js -- OK partially </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4354)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>88</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(88);" id="toc88"><b> test one - simple </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4358)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>89</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(89);" id="toc89"><b> test two - from realistic paper, partially failing  </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4418)</i></font></b></a><br>
</div>
<p>
<br>
<p>
<!--fieldset><legend-->
<div class='hl' align=center>
<a href="javascript:;" onmousedown="toggleDiv('indbuf');">
<b>INDEX of Code Chunks [expand/collapse]</b></a>
</div>
<!--/legend></fieldset-->
<p>
<div id='indbuf' style='display:none' style='background:#ffffff'> 
<ul>
<p>
<b>"Def" subscript</b> means the chunk is defined, while a bare number means 
<br>the chunk is being used in the given section.
<p>
<br>
<b>&lt;&lt;</b><font class='chunkref'>*</font><b>&gt;&gt;</b> -- <b> 2<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>*-dis</font><b>&gt;&gt;</b> -- <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>DEBUG check hash keys</font><b>&gt;&gt;</b> -- <b> 67<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>DEBUG print out full hash</font><b>&gt;&gt;</b> -- <b> 67<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>HTML head section javascript add-ons</font><b>&gt;&gt;</b> -- <b> 86<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>JS script functions</font><b>&gt;&gt;</b> -- <b> 74</b>  <b> 75<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>MOLLY.pl module</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 47<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>a thousand-line-long piece of code</font><b>&gt;&gt;</b> -- <b> 4</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>accumulate result in a buffer</font><b>&gt;&gt;</b> -- <b> 69</b>  <b> 77<sub>def</sub></b>  <b> 77<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>another thousand-line-long piece of code</font><b>&gt;&gt;</b> -- <b> 4</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>body HTML formatters</font><b>&gt;&gt;</b> -- <b> 77</b>  <b> 80<sub>def</sub></b>  <b> 80<sub>def</sub></b>  <b> 80<sub>def</sub></b>  <b> 80<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>check strings expansion</font><b>&gt;&gt;</b> -- <b> 2</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>check topo sort</font><b>&gt;&gt;</b> -- <b> 2</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk beginning</font><b>&gt;&gt;</b> -- <b> 63</b>  <b> 63<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk body</font><b>&gt;&gt;</b> -- <b> 63</b>  <b> 63<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk ending</font><b>&gt;&gt;</b> -- <b> 63</b>  <b> 63<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk reference - multiref inside other text</font><b>&gt;&gt;</b> -- <b> 63</b>  <b> 64<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk reference</font><b>&gt;&gt;</b> -- <b> 63</b>  <b> 63<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>condition A</font><b>&gt;&gt;</b> -- <b> 4</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>declarations and initializations</font><b>&gt;&gt;</b> -- <b> 61</b>  <b> 61<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>full MOLLY template</font><b>&gt;&gt;</b> -- <b> 11<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>general settings</font><b>&gt;&gt;</b> -- <b> 47</b>  <b> 48<sub>def</sub></b>  <b> 48<sub>def</sub></b>  <b> 48<sub>def</sub></b>  <b> 48<sub>def</sub></b>  <b> 48<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>logical switch</font><b>&gt;&gt;</b> -- <b> 4<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher simple</font><b>&gt;&gt;</b> -- <b> 51<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher with CL</font><b>&gt;&gt;</b> -- <b> 49</b>  <b> 50<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher</font><b>&gt;&gt;</b> -- <b> 47</b>  <b> 49<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main: call the sub</font><b>&gt;&gt;</b> -- <b> 60</b>  <b> 60<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>md5 hashing from perl</font><b>&gt;&gt;</b> -- <b> 2</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>minimal MOLLY template</font><b>&gt;&gt;</b> -- <b> 10<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>minimal thttpd configuration</font><b>&gt;&gt;</b> -- <b> 14<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>pass 1</font><b>&gt;&gt;</b> -- <b> 60</b>  <b> 61<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>pass 2 and print</font><b>&gt;&gt;</b> -- <b> 60</b>  <b> 66<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>print out</font><b>&gt;&gt;</b> -- <b> 69</b>  <b> 82<sub>def</sub></b>  <b> 82<sub>def</sub></b>  <b> 82<sub>def</sub></b>  <b> 82<sub>def</sub></b>  <b> 82<sub>def</sub></b>  <b> 82<sub>def</sub></b>  <b> 82<sub>def</sub></b>  <b> 82<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process code chunks</font><b>&gt;&gt;</b> -- <b> 77</b>  <b> 78<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process section headings</font><b>&gt;&gt;</b> -- <b> 77</b>  <b> 79<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>run.thttpd.sh</font><b>&gt;&gt;</b> -- <b> 14<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>seek-peek tangler Makefile</font><b>&gt;&gt;</b> -- <b> 58<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>seek-peek tangler</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 55</b>  <b> 60<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>set formatting strings for weaver</font><b>&gt;&gt;</b> -- <b> 69</b>  <b> 74<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>spacing.pl</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 81<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>stylesheet</font><b>&gt;&gt;</b> -- <b> 74</b>  <b> 76<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>sub: tangle recursively - nondestructive</font><b>&gt;&gt;</b> -- <b> 66</b>  <b> 66<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tangle me</font><b>&gt;&gt;</b> -- <b> 47</b>  <b> 55<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tanglediff.test2.pl</font><b>&gt;&gt;</b> -- <b> 2</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>test.html</font><b>&gt;&gt;</b> -- <b> 71<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>the meat</font><b>&gt;&gt;</b> -- <b> 66</b>  <b> 66<sub>def</sub></b>  <b> 66<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>weave me</font><b>&gt;&gt;</b> -- <b> 47</b>  <b> 69<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>while-loop and peek file ofsets</font><b>&gt;&gt;</b> -- <b> 61</b>  <b> 63<sub>def</sub></b> <br>
</div>
<p>
<br>
<p><div class='hl' align=center><i>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</i></div><p>
</ul></fieldset><p>
<br><p>



<p>
<p>
<p>
<center> <b> Licensing </b><br>
MOLLY is licensed under GNU Public License version 3. </center><br>
<p>
<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('1');">
<font class='lnum'><i>(1)</i></font>&nbsp; MOLLY MODULE </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 77)</i></sub></font></a></legend></fieldset>
<p>
<div id="1" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 1).className='hilited';
		    </script>   
<ul>


<p>
<b> What is it? </b><br>
<p>
<i> Answer: </i> Technically, this is "MOLLY.pl", a MO-dule for LI-terate programming, a<br>
    small perl script that implements a new type of "weaver" for Literate Programming.<br>
    This is is an attempt to combine Literate Programming (as practiced with<br>
    "noweb" tools by Norman Ramsey) and autogenerated document folding/outlining with<br>
    Javascript and HTML -- to escape scalability limitation of pure L.P. and enable a number<br>
    of new source file management techniques.<br>
<p>
<br><br>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('2');">
<font class='lnum'><i>(2)</i></font>&nbsp; THE CHUNK TO TANGLE BY  DEFAULT </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 91)</i></sub></font></a></legend></fieldset>
<p>
<div id="2" style="display:none">   
<ul>


<p>
<font class='lnum'>94</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*&gt;&gt;=</legend>
<font class='lnum'>95</font>   <font class='chunkref'>&lt;&lt;MOLLY.pl module&gt;&gt</font>;
<font class='lnum'>96</font>   </fieldset></pre>
<p>
<font class='lnum'>98</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>99</font>   <font class='chunkref'>&lt;&lt;seek-peek tangler&gt;&gt</font>;
<font class='lnum'>100</font>   </fieldset></pre>
<p>
<font class='lnum'>102</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>103</font>   <font class='chunkref'>&lt;&lt;spacing.pl&gt;&gt</font>;
<font class='lnum'>104</font>   </fieldset></pre>
<font class='lnum'>105</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>106</font>   <font class='chunkref'>&lt;&lt;tanglediff.test2.pl&gt;&gt</font>;
<font class='lnum'>107</font>   </fieldset></pre>
<p>
<font class='lnum'>109</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>110</font>   <font class='chunkref'>&lt;&lt;md5 hashing from perl&gt;&gt</font>;
<font class='lnum'>111</font>   </fieldset></pre>
<p>
<font class='lnum'>113</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>114</font>   <font class='chunkref'>&lt;&lt;check topo sort&gt;&gt</font>;
<font class='lnum'>115</font>   </fieldset></pre>
<p>
<p>
<font class='lnum'>118</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>119</font>   <font class='chunkref'>&lt;&lt;check strings expansion&gt;&gt</font>;
<font class='lnum'>120</font>   </fieldset></pre>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('2');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('3');">
<font class='lnum'><i>(3)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 124)</i></sub></font></a></legend></fieldset>
<p>
<div id="3" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('3');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('4');">
<font class='lnum'><i>(4)</i></font>&nbsp; PART I ----------- Concepts. Controlling human attention.------------ </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 127)</i></sub></font></a></legend></fieldset>
<p>
<div id="4" style="display:none">   
<ul>


<p>
<p>
<b> LP as "management of thinking" </b> <br>
<p>
    If you never heard of Literate Programming, please read something like the Wikipedia<br>
    article <a href= http://en.wikipedia.org/wiki/Literate_programming > http://en.wikipedia.org/wiki/Literate_programming </a><br>
    and then something like documentation to Norman Ramsey's "noweb" tools and his old<br>
    but excellent article  on the subject (linked from the site).<br>
    <a href= http://www.cs.tufts.edu/~nr/noweb > http://www.cs.tufts.edu/~nr/noweb </a><br>
<p>
    <b> <i> L.P. is a technique for "management of thinking" that helps to relieve short-term memory<br>
    of "housekeeping" tasks when creating complicated texts and "splits levels" for 'global thinking"<br>
    and "local changing" </i> </b><br>
<p>
    The biggest problem in managing complex texts of any kind - programming simply being the most<br>
    complicated one, where the text is not supposed contain errors at all - is in holding it all<br>
    together in one's mind.<br>
<p>
    Human short-term memory is surprisingly tiny, up to 7 to 9 objects simultaneously at any one<br>
    time, psychologists tell us. Therefore, when faced with larger tasks, humans need to use a number<br>
    of "aoivdance techniques" to dance around the limitation.<br>
<p>
    First, we constantly switch levels. E.g. I need to change my program. I remember the general<br>
    outline of it, so I use that to figure out where to go. On each evel I would probably remember<br>
    details "inside" each of those larger blocks etc.<br>
<p>
    In my experience a script or a program longer than, say 1000 to 1200 lines becomes a major<br>
    problem unless special techniques are used to help one's attention.<br>
<p>
    In programming, probably 90% of "chunking", i.e. division into procedures, or "objects" or<br>
    "functions" are not needed for the machine. They are done <b> simply for the humans not<br>
    to lose the thread of their thinking. </b> Whithout this things would become totally <br>
    unmanageable.<br>
<p>
    Here comes also the idea of "writing domain-specific languages": humans chunk lower-level<br>
    operations into a new 'unit' or 'abstraction', then manipulate with higher-level abstractions<br>
    over abstractions over abstractions over abstractions..<br>
<p>
    "Literate Programming" is not a programming-specific technique that allows us to create arbitrary<br>
    systems of abstractions <i> with phrases in a human language </i> - "in pseudocode" - while staying<br>
    precise in our specification opf the final product. Everyone knows that explanation with<br>
    pseudocode are helpful - that was the way we learned of the subject of programming in the first<br>
    place. Most if not all textbooks are written in this way.<br>
<p>
    So L.P. <b> is an alternative to procedures and subroutines in the machine language </b><br>
<p>
    For example, I can easily write and maintain na LPSource file with<br>
<p>
<font class='lnum'>177</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;logical switch&gt;&gt;=</legend>
<font class='lnum'>178</font>    if (<font class='chunkref'>&lt;&lt;condition A&gt;&gt</font>;) {
<font class='lnum'>179</font>       <font class='chunkref'>&lt;&lt;a thousand-line-long piece of code&gt;&gt</font>;}
<font class='lnum'>180</font>    else { 
<font class='lnum'>181</font>       <font class='chunkref'>&lt;&lt;another thousand-line-long piece of code&gt;&gt</font>;}
<font class='lnum'>182</font>   </fieldset></pre>
<p>
    (and specify all those references elsewhere), while such code written directly would be<br>
    unmaintainable and almost impossible to understand to a human. As a result, a human would<br>
    <i> have to </i> wrap his code into some subs, with inherent limitations and complications<br>
    on their parameters and return result, built into his programming language.<br>
    The machine would slow down its execution because internally it will maintain environment<br>
    to switch to when returning etc.<br>
    Isnt't it ironic that "hand-made optimisations" include "unrolling" programming constructs<br>
    programmers introduced on the first place? The reason most probably was that otherwise<br>
    a human mind would not be able to keep the thread, it would have lost it, while  all the<br>
    introduced paraphenalia is totally unnecessary for the machine execution.<br>
<p>
    Subroutines or functions are sometimes necessary. To give one example: to create a recursive<br>
    invocation the programmer uses the built-in ability of a function to push its current state<br>
    on the stack and then to automatically pick up where left upon returning.<br>
    But probably 90% of all sub-dividing in programming is done just for the humans not to get<br>
    lost in the sea of code.<br>
<p>
    So, <ul> <i> <b> Literate Programming is a system of free-form macros in a natural human <br>
    language used as an alternative to programming language procedures <br>
    (functions) when those serve as props to limit load on human attention<br>
    span, and totally unnecessary for machine execution in themselves </b> </i> </ul><br>
<p>
<p>
<br><br>
<b> Three problems with L.P. -- unification of L.P. and folding </b><br>
<p>
    Donald Knuth first was thinking of how to document his code when he created a mish-mash of<br>
    previous attempts at similar management techniques with macros, which he called "WEB" (at<br>
    the time when no "www-web" existed yet).<br>
    Then he proclaimed this is the best way to write programs he knows, and repositioned it<br>
    as "a programming paradigm", in direct competition to the "structural programming",<br>
    introduced in the previous decade.<br>
<p>
    Acceptance of this new method of program writing however was disappointing. I believe, there<br>
    were and still are three factors at play, which hurt it, even though the name of L.P. creator<br>
    ensured L.P. never fell into complete obscurity.<br>
<p>
    <ul><br>
	<li> <b> First, L.P. used TeX as a formatting tool </b>, which is a sort of programming language in<br>
	itself. Therefore, the first thing to blame L.P. for became "but I'd need to write - <i> and <br>
	debug! </i> - two programs at the same time, in TeX and in my own machine language.<br>
<p>
	Today when much, much simpler markup languages abound - "html" or even "markdown <br>
	html" or even "wiki" for the majority of uses that do not require typesetting complicated<br>
	equations or graphs - this problem has long been solved.<br>
	You do not need to "debug" basic HTML markup - any error is displayed in your browser as a<br>
	distortion of the web page, I do not need to "debug" html when writing with my Molly script<br>
	which uses html markup.<br>
<p>
	</li> <li> <b> Secondly, the first generation of L.P. tools was language-specific. </b> You could <br>
	do Pascal, but not Fortran. Later "C" and "Fortran" literate tools were added, but you could<br>
	not do Lisp or Ada etc.<br>
<p>
	Today with tools like "noweb" by Norman Ramsey this problem has long been solved. Simplified<br>
	to its core idea Literate Programming is now totally language-independent to the degree that<br>
	you can write books or essays with L.P. tools not even knowing how to program for the computer.<br>
<p>
	</li> <li> <b> And the third problem is the flat file structure of Literate Source files </b> and<br>
	(probably that could be listed as the fourth, psychological stumbling block) the insistence<br>
	on "producing clean documentation" or "polished essays" of one's programs other could read<br>
	and enjoy.<br>
<p>
	Flat files continue to limit the size of the literate source files: your mind still <i> has to<br>
	keep internally the overall structure of your program </i> and switch from it to doing concrete<br>
	tasks.<br>
	Technically a Literate Source file can include <i> many </i> program files ( e.g. project.h,<br>
	project.c, a makefile and a README). In reality the size is limited by your "attention horizon"<br>
    </li> </ul><br>
<p>
    <b> I propose to solve  this last problem by combining L.P. with folding or outlining </b> ,<br>
    using html and javascript as the simplest and ubiquitous tools.<br>
<p>
    The Literate Source file is written in basic HTML, or even in "markdown" or "wiki"-style markup<br>
    notation. The script then automatically creates a document with folds at each heading line<br>
    (i.e. "h1", "h2", ...). The file can be "weaved" from command line or produced dynamically <br>
    under a web  server as a CGI document.<br>
<p>
    Folding must allow opening an arbitrary number of sections from any place in the file to create<br>
    a sub-view of the document, a small document which is relevant to some particular sub-task.<br>
    These sub-views must persist for the time of this particular work, i.e. the user should not<br>
    be forced to reopen his subview over and over again. That is, I should in effect be able to read<br>
    snippets constituting 2 pages of text relevant to my immediate task contiguously from  a <br>
    5MB file  and  not even notice that, as the rest is tucked out of the way.<br>
<p>
    Common practice in IDEs and outlining editors is an arrangement of folding in which  a <br>
    programmer is allowed to see only one section at a time, not, say, 5 of them from many places,<br>
    opened as a sort of "view". Opening only a single subsection at a time is the death of the idea<br>
    of folding or outlining. It simply strips it of its usefulness. The human perception then becomes <br>
    "mosaic".<br>
<p>
    <i> As an example of totally wrong presentation, </i> which  fragments perception into poorly<br>
    connected pieces and does not allow a reader to see the forest for the trees and see <br>
    documentation of GNU libavl <a href= http://adtinfo.org/libavl.html/ > http://adtinfo.org/libavl.html/ </a> <br>
    It is not humanly possible to follow the train of thought from such a presentation: one has to<br>
    keep an internal mental map of the document <i> before </i> reading it and inability to see more than<br>
    one snippet puts a stop to perception: once the snippet is left, one has to rely on memory of<br>
    previously read pieces to relate things to each other.<br>
    Nor the split HTML, nor the flat file format provide for human-friendly perception of code<br>
    unless it is  a small short self-contained piece.<br>
<p>
<p>
    <i> A document that is based on a structure of folding subsections </i> drastically increases<br>
    one's attention span, allows to manage easily thousands and thousands of lines of text, and<br>
    makes inclusion of many different types of files into what becomes one <i> Literate Source Project<br>
    file </i> "a cinch".<br>
<p>
    A number of techniques becomes possible which have not been possible before in a flat file. <br>
    Snippets testing language constructs, doubling certain "chunks" while keeping a pointer in a<br>
    "linker chunk" to preserve the previous working version of your program while experimenting<br>
    with a new one (previously one would have to use version control or rename files for that), <br>
    making collections of loosely related documents and script, each still obtainable through<br>
    tangling, such as a collection of system administration policies, readmes, config files and <br>
    many scripts -- all become easy with a folding literate source file.<br>
<p>
    And consequently emphasis moves from the creation of usually comparatively compact programs<br>
    exposed as a sort of polished essays (or documented for their logic in the order of thinking)<br>
    --  to using Literate Source folding files as your "work log" or "a log of thinking" when<br>
    developing a program, like a scientist might keep a log of his experiments.<br>
<p>
    Clean version of documentation or program presentation might emerge from it, later, but at the<br>
    moment of conception the most urgent task is to preserve your thinking, however "clever" or<br>
    "stupid" that might be and unload all "houskeeping" from your mind, to stop straining to<br>
    remember where which change must go.<br>
<p>
    Such literate project files however do become good documentation, it seems, even without much<br>
    further polishing, as polishing occurs naturally with developing and rewriting your program.<br>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('4');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('5');">
<font class='lnum'><i>(5)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 314)</i></sub></font></a></legend></fieldset>
<p>
<div id="5" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('5');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('6');">
<font class='lnum'><i>(6)</i></font>&nbsp; PART II ------------ HOW TO USE MOLLY.pl ------------ </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 317)</i></sub></font></a></legend></fieldset>
<p>
<div id="6" style="display:none">   
<ul>


<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('7');">
<font class='lnum'><i>(7)</i></font>&nbsp; My workflow - literate programming with Molly </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 322)</i></sub></font></a></legend></fieldset>
<p>
<div id="7" style="display:none">   
<ul>


<p>
 <img src=eeerotate.jpg align=right hspace=5 width=200 border=2><br>
<i> <b> A prerequisite of sorts </b><br>
Use a vertically rotated screen (with an external keyboard and mouse on<br>
a notebook) or a large  enough screen to see a vertically positioned A4<br>
sheet of paper to obtain full advantages of outlining and folding <br>
Psychologically, the more we see, the more "clever" we are. Stop reading<br>
compicated documents through a slit: with mental perception crippled, <br>
you'll just jump between fragments, and never truly "get" them in whole. </i> <b> &gt;&gt;&gt; </b><br>
<p>
Rotation on Linux is done by running <pre> xrandr -o right|left|normal </pre><br>
from an X terminal window. Most modern video cards support this.<br>
<p>
<b> The Workflow </b> :<br>
<ol><br>
    <li> I run a web server on localhost:8000, for myself only. My<br>
    development directory is under the web server - or is linked to<br>
    the web server document tree.<br>
<p>
    </li> <li> I write my Literate Source file in a vim editor. I mark up<br>
    the documentation section (i.e. not code) with most basic HTML tags<br>
    (e.g. &lt;h2&gt;, &lt;b&gt;, &lt;ul&gt; ...). <br>
    The code sections live between "&lt; &lt; section name &gt; &gt; =" and "@" <br>
    (in the first position in the line), as is required by "noweb"<br>
    literate programming tools. Other code sections can be referred to<br>
    from inside code section with &lt; &lt;name of section referred to&gt; &gt;.<br>
<p>
    </li> <li> I view my file in a web browser, and reload the page after editing updates.<br>
    Because I write my Literate Source with help from the MOLLY.pl script (see below how to <br>
    set it up), every "heading" in HTML (i.e.  h1,  h2  etc. ) automatically becomes a <b> <br>
    folding subsection </b> of the document I see in the browser, and every code section is <br>
    automatically formatted with line numbers and a frame.<br>
<p>
    </li> <li> When I think ("globally"), I look at the formatted, immediately updating document<br>
    in the browser, keeping open only the sections relevant to my thinking.<br>
    When I edit, I refer to the line numbers, and avoid navigating "blindly" in the programming<br>
    editor, stressing my memory. I edit "locally".<br>
    This is what makes all the difference.<br>
<p>
    </li> <li> Automatically created folding documents allow me a number of techniques and<br>
    uses impossible previously with flat "literate programming" files.<br>
<p>
    </li> <li> I tangle the created code either directly with a built-in Molly tangler, with<br>
    "notangle" tools from "noweb", or by running "MyProject.tangle", which is a link to <br>
    "MyProject.weave", the actual main Literate Source file turned into a perl script by inclusion<br>
    of the MOLLY.pl into it.<br>
</ol><br>
<p>
See details about this setup and possible uses of it below.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('7');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('8');">
<font class='lnum'><i>(8)</i></font>&nbsp; SET UP a Literate Source file and project </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 376)</i></sub></font></a></legend></fieldset>
<p>
<div id="8" style="display:none">   
<ul>


<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('9');">
<font class='lnum'><i>(9)</i></font>&nbsp; Prerequisites: "noweb" tools By Norman Ramsey </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 382)</i></sub></font></a></legend></fieldset>
<p>
<div id="9" style="display:none">   
<ul>


<p>
    The script now has a built-in simple tangler, which can tangle arbitrary roots<br>
    from the Literate Source file.<br>
<p>
    However it is possible to  use a "pass-through" tangler, i.e. delegate actual<br>
    tangling to the "notangle" utility from the "noweb" suite.<br>
<p>
    "Noweb" set of tools has been around for more than 10 years, and is well tested.<br>
    It is also more flexible, at least for now.<br>
    It would be prudent to compare tangled output of Molly with that of noweb, until you<br>
    feel sure you can trust it.<br>
<p>
    Please obtain and install "noweb" . <b> <i> Make sure the tangler is in your path </i> </b><br>
     <a href= http://www.cs.tufts.edu/~nr/noweb > http://www.cs.tufts.edu/~nr/noweb </a><br>
<p>
    Any version will do, e.g. the one based on shell and awk. I created the MOLLY script <br>
    to work with the overall markup of the "noweb" tools. It means your project file(s) <br>
    can be directly processed with "noweb" tools. MOLLY is mostly intended as an alternative<br>
    weaver which creates folding HTML documents on the fly.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('9');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('10');">
<font class='lnum'><i>(10)</i></font>&nbsp; Setting up the file </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 406)</i></sub></font></a></legend></fieldset>
<p>
<div id="10" style="display:none">   
<ul>


<p>
<p>
    I aimed at simplifying and eliminating unnecessary steps, and wanted to automate some others.<br>
    Therefore practical work with MOLLY.pl looks like this:<br>
<p>
    <ol> <li> <b> <i> Your Literate Source file must be "mollified" </i> </b>, i.e. you have<br>
    to add an invocation of MOLLY.pl as the first lines of it. Think of it as a template. You<br>
    will write your Literate Source text right after these initial lines.  The minimal template<br>
    is this:<br>
<p>
<font class='lnum'>418</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;minimal MOLLY template&gt;&gt;=</legend>
<font class='lnum'>419</font>       #!/full/path/to/perl
<font class='lnum'>420</font>       do "/full/path/to/script/MOLLY.pl";
<font class='lnum'>421</font>       exit;
<font class='lnum'>422</font>       # delete first space(s) in the next line
<font class='lnum'>423</font>       __DATA__
<font class='lnum'>424</font>       #----------------start of the script------------
<font class='lnum'>425</font>   
<font class='lnum'>426</font>       &lt;h1&gt; And here I start My Project &lt;/h1&gt;
<font class='lnum'>427</font>       Your Literate Source file can be typed here
<font class='lnum'>428</font>   
<font class='lnum'>429</font>       &lt;h2&gt; Subsection &lt;/h2&gt;
<font class='lnum'>430</font>       level 0-9 of subsections are allowed now.
<font class='lnum'>431</font>   
<font class='lnum'>432</font>       Each subsection will be automatically created as "folding". 
<font class='lnum'>433</font>       Javascript must be enabled in your browser to use this functionality
<font class='lnum'>434</font>   </fieldset></pre>
<p>
    The perl invocaton and the "__DATA__"  line must start  &nbsp;   &nbsp;  a t  &nbsp;  t h e  &nbsp;  f i r s t  &nbsp;  p o s i t i o n  &nbsp; <br>
<p>
    You do not need any extra perl modules  as pre-requsites, the script uses core perl.  <br>
<p>
    Full template will also set configuration variables which adjust its behaviour.<br>
<p>
    Save this under some name, e.g. MyProject.txt. This turns your Literate Source file into<br>
    a perl script<br>
<p>
    </li> <li> <b> <i> Make it executable. </i> </b> <br>
	<pre> chmod 755 MyProject.txt </pre><br>
<p>
    </li> <li>  <b> <i> The script behaves according to its name extension </i> </b><br>
    The script will produce HTML-formatted documentation, if its name ends with "weave" <br>
    (default - or whatever you selected when setting configuration variables in the <br>
    "mollification" template). <br>
    Invoked under a name with file extension of "*.tangle" (default) it will "tangle",<br>
    i.e. create machine code.<br>
    So,  name or rename your LSFile "MyProject.weave" and create a soft link to it named<br>
    "MyProject.tangle" (or whatever alternative you set in configuration for tangling):<br>
    <pre>
	mv MyProject.txt MyProject.weave
	ln -s MyProject.weave MyProject.tangle </pre><br>
<p>
    Now if you run MyProject.weave, it will dump HTML-formatted documentation of your work to STDOUT<br>
	<pre> ./MyProject.weave &gt; MyProject-formatted.foldingdocument.html </pre><br>
    It you run MyProject.tangle, it will dump machine code from your Literate Source file to STDOUT.<br>
	<pre> ./MyProject.tangle &gt; MyProject-runnable.script.pl </pre><br>
    ( Of course, tangling is independent of the language you program in )<br>
<p>
    For example, if you develop in perl, you can run the resulting script like this:<br>
	<pre> ./MyProject.tangle | perl [perl options here] - </pre><br>
<p>
    Additionally, as the markup is the same as that of "noweb" tools. one can use them directly<br>
    on the My.Project.weave file, with all of their flexibility and extra options.<br>
<p>
    However the idea was to avoid running some of these commands after each change in<br>
    the file manually and to avoid saving the weaved docs: STDOUT can be picked up by<br>
    your local web server as CGI, and you will have an HTML-formatted and which is more<br>
    important, <i> folding </i> document in your browser by simply reloading the page <br>
    (usually with Ctrt+R or a mouse click)<br>
<p>
    </li> <li> Now, <b> <i>  the only other step is to run a local web server </i> </b> <br>
    on localhost, any tiny very simple httpd will do, and tell it to treat "*.weave" as<br>
    valid cgi file extension. (Alternatively, I can set "weaving" to files that end in <br>
    '*.cgi" or "*.pl" etc. in the configuration part of my MOLLY template)<br>
<p>
    One of the simplest WWW servers for such use could be "thttpd", and I will provide you with its<br>
    minimal configuration file below.<br>
    </li> </ol><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('10');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('11');">
<font class='lnum'><i>(11)</i></font>&nbsp; "Mollification" - full configuration template </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 490)</i></sub></font></a></legend></fieldset>
<p>
<div id="11" style="display:none">   
<ul>


Should be self-explanatory, at least after reading this documentation section ;). <br>
May add to this section later. Uncomment to set, otherwise defaults apply.<br>
<p>
<p>
<font class='lnum'>496</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;full MOLLY template&gt;&gt;=</legend>
<font class='lnum'>497</font>   #!/usr/bin/perl
<font class='lnum'>498</font>   
<font class='lnum'>499</font>   #-------------------------------------
<font class='lnum'>500</font>   # -------TOC and INDEX behaviour------
<font class='lnum'>501</font>   
<font class='lnum'>502</font>   # print TOC? 1:0
<font class='lnum'>503</font>   #$print_toc=1;	# default is to print
<font class='lnum'>504</font>   
<font class='lnum'>505</font>   # should we keep TOC expanded? "block":"none"
<font class='lnum'>506</font>   #$toc_expanded="block";	# default is to unfold
<font class='lnum'>507</font>   
<font class='lnum'>508</font>   # should we keep Chunks Index expanded? "block":"none"
<font class='lnum'>509</font>   #$ind_expanded="none";	# default is to keep folded
<font class='lnum'>510</font>   
<font class='lnum'>511</font>   
<font class='lnum'>512</font>   # should we number lines in code sections? 1 : else
<font class='lnum'>513</font>   #$line_numbering = 1;	# default is to number
<font class='lnum'>514</font>   
<font class='lnum'>515</font>   
<font class='lnum'>516</font>   #-------------------------------------
<font class='lnum'>517</font>   #---------MathML options--------------
<font class='lnum'>518</font>   
<font class='lnum'>519</font>   # should we enable MathML via ASCIIMathML.js or LaTeXMathML.js library? 1:0
<font class='lnum'>520</font>   #$enable_ASCIIMathML = 0; #default is to disable as it slows Molly down a lot
<font class='lnum'>521</font>   #$enable_ASCIIMathML = 1;
<font class='lnum'>522</font>   
<font class='lnum'>523</font>   # If yes, what is the full path to the lib? Remember to get the one with proper
<font class='lnum'>524</font>   # escapes for your work, default or modified (see documenation)
<font class='lnum'>525</font>   # CAN BE: (a) local "/full/path/from/root/to/ASCIIMathML_with_modified_escapes.js" or 
<font class='lnum'>526</font>   # (b) in current dir "ASCIIMathML_with_modified_escapes.js" or
<font class='lnum'>527</font>   # (c) on the web, e.g. the original site of the library (unmodified) is:
<font class='lnum'>528</font>   #$path_to_ASCIIMathML = "http://www1.chapman.edu/~jipsen/mathml/ASCIIMathML.js";
<font class='lnum'>529</font>   #$path_to_ASCIIMathML = "ASCIIMathML_with_modified_escapes.js"; # default is current dir
<font class='lnum'>530</font>   
<font class='lnum'>531</font>   
<font class='lnum'>532</font>   #-------------------------------------
<font class='lnum'>533</font>   #--------Document Markup lang---------
<font class='lnum'>534</font>   
<font class='lnum'>535</font>   # how are doc sections marked? "dotHTML":"rawHTML"
<font class='lnum'>536</font>   #$weave_markup = "rawHTML"; # default is "rawHTML"
<font class='lnum'>537</font>   
<font class='lnum'>538</font>   
<font class='lnum'>539</font>   #--------------------------------------
<font class='lnum'>540</font>   #---------File extensions setting------
<font class='lnum'>541</font>    
<font class='lnum'>542</font>   # what is the file extention to weave it? (perms must allow execution!)
<font class='lnum'>543</font>   # e.g. "scriptname.weave" or "scriptname.cgi" etc.
<font class='lnum'>544</font>   #$weave_extension = "weave";	# default is "weave"
<font class='lnum'>545</font>   
<font class='lnum'>546</font>   # what is the file extention to tangle it? (perms must allow execution!)
<font class='lnum'>547</font>   # e.g. "scriptname.tangle",  "scriptname.pl" etc.
<font class='lnum'>548</font>   #$tangle_extension = "tangle";	# default is "tangle"
<font class='lnum'>549</font>   
<font class='lnum'>550</font>   #When tangling, should I use the built-in tangler? 0:1
<font class='lnum'>551</font>   # (if 0, the "pass-through" tangling will call "notangle"
<font class='lnum'>552</font>   # from Ramsey's "noweb" tools, must be installed and in your path)
<font class='lnum'>553</font>   # $use_builtin_tangler = 0; # default for now is to use external "notangle"
<font class='lnum'>554</font>   
<font class='lnum'>555</font>   
<font class='lnum'>556</font>   #--------------------------------------
<font class='lnum'>557</font>   #---------invocation of MOLLY.pl-------
<font class='lnum'>558</font>   
<font class='lnum'>559</font>   # make sure to provide correct and full path to the script here
<font class='lnum'>560</font>   # (default is "current directory"):
<font class='lnum'>561</font>   do "MOLLY.pl";
<font class='lnum'>562</font>   exit;
<font class='lnum'>563</font>   
<font class='lnum'>564</font>   # delete the space before the __DATA__ marker
<font class='lnum'>565</font>    __DATA__
<font class='lnum'>566</font>   #---------------start of script-------------
<font class='lnum'>567</font>   
<font class='lnum'>568</font>   &lt;h1&gt; MY PROJECT &lt;/h1&gt;
<font class='lnum'>569</font>   
<font class='lnum'>570</font>   The main idea for my new project is ..
<font class='lnum'>571</font>   
<font class='lnum'>572</font>   &lt;h2&gt; Subsection 1 &lt;/h2&gt;
<font class='lnum'>573</font>   
<font class='lnum'>574</font>   Here I explain things that come first
<font class='lnum'>575</font>   ................................
<font class='lnum'>576</font>   
<font class='lnum'>577</font>   </fieldset></pre>
<p>
<b> "__DATA__" must start at the first position in its line </b><br>
<p>
A better example can be seen in a new project template file that comes with<br>
MOLLY distribution. Copy it to a different name and start editing.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('11');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('12');">
<font class='lnum'><i>(12)</i></font>&nbsp; Markup of code and documentation sections </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 587)</i></sub></font></a></legend></fieldset>
<p>
<div id="12" style="display:none">   
<ul>


<p>
<b> First, </b><br>
    <ul> <li>  code sections begin with "&lt; &lt;name of the section&gt; &gt;="<br>
    in the first position in the line and end with "@"  in the first position<br>
    <i> no spaces between the double angle brackets - I used spaces as escapes here </i><br>
<p>
    </li> <li> References to other code sections are done with "&lt; &lt;name of the ref sect&gt; &gt;"<br>
    inside the code sections<br>
<p>
    </li> <li> The rest is "documentation chunks" which must be marked up with some formatting<br>
    tags. (The default is html).<br>
<p>
     I do not insert examples here, as the file you are reading provides them ad nauseam.<br>
<p>
    THIS IS THE BASIC MARKUP OF THE LITERATE SOURCE FILE, as used by the <br>
    "noweb" tools.<br>
<p>
    <i> <b> NOTE </b> </i> While Molly uses the same markup. <b> "notangle" allows to skip <br>
    "@" signs</b> in the first position on the line if the next chunk is also code.<br>
    <b> Molly insists on full markup. </b> Molly tangled examples from 'noweb' distribution <br>
    correctly when those were canonized to use full notation.<br>
<p>
<p>
    </ul><br>
<p>
<b> Secondly,</b> how do we format the documentation sections?<br>
<p>
    <ul> <li> In the simplest case, with straight HTML markup (default)<br>
<p>
    </li> <li> If a simple subsection is added to the MOLLY.pl script to process it, in any<br>
    markup lingo of your choice (e.g. "wiki") <br>
<p>
    Currently I provide a "dotHTML" formatting subsection as an example. It implements<br>
    a few of the most common HTML tags but with "dots" around them, in place of angle brackets <br>
    "&lt;" and "&gt;" (which is faster, as one does not need to switch register, so is less prone <br>
    to typos). See below for more detailed explanations<br>
    </li> </ul><br>
<p>
    <b> <i> The only difference </i> </b> from the truly "raw" HTML is that except in "pre" sections the MOLLY.pl script will <br>
    add automatic &lt;br&gt; tags at the end of each line of your Literate Source file.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('12');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('13');">
<font class='lnum'><i>(13)</i></font>&nbsp; Tangling from LSFile </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 633)</i></sub></font></a></legend></fieldset>
<p>
<div id="13" style="display:none">   
<ul>


<p>
    <ol> <li> Usually only one file needs to be tangled constantly, the file the developer<br>
    is working on.  It's easiest to do by using the "default root", which is a code chunk<br>
    called "*". When you run <br>
    <pre> MyProject.tangle &gt; source.pl </pre> <br>
    MOLLY will pass the command to "notangle" from Ramsey's "noweb" tools, or tangle it<br>
    itself if configured at the top of your project file and then it will print code<br>
    chunks starting from the one named "*". Therefore, I drag along the default root to<br>
    wherever I am editing now and reassigning to it the chunk I need to tangle currently.<br>
    I usually keep the pointer subsection at the top of the Literate Source file. See <br>
    "THE CHUNK TO TANGLE BY DEFAULT" in the file you are reading as an example of this<br>
    technique.<br>
<p>
    This is the task for which MOLLY "quick tangling" is designed.<br>
<p>
    </li> <li> If, however, you need to tangle out non-"*" root, you have two options:<br>
<p>
    (a) run MOLLY.pl from command line:<br>
   <pre> MOLLY.pl -R 'root chunk name' literate_project_file </pre><br>
    If chunk name is not supplied, the script will tangle from "*", the default root. <br>
<p>
    (b) ..or you might run N.Ramsey's "notangle" utility directly on your Lit.Source file. <br>
    <pre> notangle -R 'root chunk name' literate_project_file </pre><br>
    This is the most flexible way, as "noweave" allows for extra pre- and post-processing.<br>
<p>
    </li> <li> If you need to tangle out many source files, then probably the easiest way<br>
    to arrange it is through many invocations of Molly.pl or "notangle" in a makefile.<br>
    Include "Makefile" subsection into your Literate Source file and create a target that<br>
    combines several "notangle -R ... " commands in it.<br>
    Assing default root "*" to the Makefile, then run "MyProject.tangle &gt; Makefile" to create<br>
    it and next run "make targetname" to tangle (and compile, run etc) many files included<br>
    into your Literate Source project file.<br>
    </li> </ol><br>
<p>
    <i> <b> NOTE </b> </i><br>
    that Molly uses the same markup for document and code sections as "noweb".<br>
    Nowever <b> "notangle" allows to skip "@" signs</b> in the first position on the line if<br>
    the next chunk is also code.<br>
    <b> Molly insists on full markup. </b> Molly tangled examples from 'noweb' distribution correctly<br>
    when those were canonized to use full notation.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('13');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('14');">
<font class='lnum'><i>(14)</i></font>&nbsp; Sample minimal configuration of thttpd </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 678)</i></sub></font></a></legend></fieldset>
<p>
<div id="14" style="display:none">   
<ul>


<p>
"THTTPD" home is <a href= http://www.acme.com/software/thttpd/ > http://www.acme.com/software/thttpd/ </a> <br>
<p>
From the distro README:<br>
<ul> thttpd is a simple, small, portable, fast, and secure HTTP server. <br>
<b> Simple: </b> It handles only the minimum necessary to implement HTTP/1.1. Well, maybe a <br>
little more than the minimum. <br>
<b> Small: </b>  See the comparison chart. It also has a very small run-time size, since it <br>
does not fork and is very careful about memory allocation. <br>
<b> Portable: </b>  It compiles cleanly on most any Unix-like OS, specifically including FreeBSD, <br>
SunOS 4, Solaris 2, BSD/OS, Linux, OSF. <br>
<b> Fast:  </b>  In typical use it's about as fast as the best full-featured servers (Apache, <br>
NCSA, Netscape). Under extreme load it's much faster. <br>
<b> Secure: </b>  It goes to great lengths to protect the web server machine against attacks and <br>
breakins from other sites. <br>
<p>
It also has one extremely useful feature (URL-traffic-based throttling) that no other server <br>
currently has. Plus, it supports IPv6 out of the box, no patching required.<br>
</ul><br>
<p>
Its compilation is very quick. Its configuration is simpler than that of Apache. <br>
<p>
Supposing I'd like to point my browser at "http://localhost:8000/path/to/MyProject.weave"<br>
Then the minimal configuration will look something like this:<br>
<p>
<p>
<font class='lnum'>706</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;minimal thttpd configuration&gt;&gt;=</legend>
<font class='lnum'>707</font>   #
<font class='lnum'>708</font>   host=localhost
<font class='lnum'>709</font>   port=8000
<font class='lnum'>710</font>   dir=/my/home/00trash/tmp/literate.perl/WORKDIR
<font class='lnum'>711</font>   data_dir=/my/home/00trash/tmp/literate.perl/WORKDIR
<font class='lnum'>712</font>   #chroot
<font class='lnum'>713</font>   
<font class='lnum'>714</font>   # extensions understood as valid "cgi" scripts:
<font class='lnum'>715</font>   #cgipat=/**.cgi|/**.weave|/**.pl
<font class='lnum'>716</font>   #cgipat=/**.tangle
<font class='lnum'>717</font>   cgipat=/**.weave
<font class='lnum'>718</font>   
<font class='lnum'>719</font>   #logfile=/my/home/00trash/tmp/literate.perl/WWW.server/thttpd.log
<font class='lnum'>720</font>   logfile=/dev/null
<font class='lnum'>721</font>   
<font class='lnum'>722</font>   #pidfile=./thttpd.pid
<font class='lnum'>723</font>   pidfile=/home/vedmed/00trash/tmp/literate.perl/WWW.server/thttpd.pid
<font class='lnum'>724</font>   
<font class='lnum'>725</font>   # uncomment this to be able to link from anywhere to your web server document dir 
<font class='lnum'>726</font>   # (unsecure, for local development only)
<font class='lnum'>727</font>   nosymlink
<font class='lnum'>728</font>   #
<font class='lnum'>729</font>   </fieldset></pre>
<b> NOTE </b> that "nosymlink" schizophrenically <i> allows </i> symbolic links in spite of what<br>
thttpd documentation tells you<br>
<p>
The script to start thttpd (it will detach and run as a daemon) is something like this:<br>
<p>
<font class='lnum'>735</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;run.thttpd.sh&gt;&gt;=</legend>
<font class='lnum'>736</font>   #!/bin/sh
<font class='lnum'>737</font>   PROJECT_ADMIN_DIR="/my/home/00trash/tmp/literate.perl/WWW.server";
<font class='lnum'>738</font>   #./thttpd -p 8000 -h localhost -C ./thttpd.config
<font class='lnum'>739</font>   #$PROJECT_ADMIN_DIR/thttpd -nos -C $PROJECT_ADMIN_DIR/thttpd.config
<font class='lnum'>740</font>   $PROJECT_ADMIN_DIR/thttpd -C $PROJECT_ADMIN_DIR/thttpd.config
<font class='lnum'>741</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('14');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('8');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('15');">
<font class='lnum'><i>(15)</i></font>&nbsp; CREATE a Literate Source file -- documentation chunks markup</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 746)</i></sub></font></a></legend></fieldset>
<p>
<div id="15" style="display:none">   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('16');">
<font class='lnum'><i>(16)</i></font>&nbsp; Doc sections markup </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 750)</i></sub></font></a></legend></fieldset>
<p>
<div id="16" style="display:none">   
<ul>


<p>
<ol> <li> <b> The default is to use ordinary 'html' markup </b> in the document sections<br>
The only difference from "true raw" HTML is that MOLLY adds automatic <br>
&lt;br&gt; linebreaks unless lines are inside the &lt;pre&gt;..&lt;/pre&gt; sections<br>
The script also cuts out vim folding marks -- { { { number ... } } } number<br>
-- without spaces  and "#------------" lines.<br>
<p>
<p>
</li> <li> <b> Any "markdown" or "wiki"-style markup can be added </b> to MOLLY. Another <br>
reasonable suggestion could be a simple translator from basic TeX markup etc.<br>
Some of this functionality is unnecessary to reimplement, as "noweb" or third-party <br>
filters can be run on the document after MOLLY weaving or from inside MOLLY.<br>
<p>
</li> <li> <b> dotHTML is an example of a simple markup </b> which can be done with regular<br>
expressions, which is several most basic HTML tags inside "dots" instead <br>
of angle brackets.<br>
<p>
Dots do not require switching the keyboard register, and therefore I can speed up<br>
typing and avoid annoying repeating typos. This is my own "markdown" of sorts.<br>
<p>
Currently implemented tags are (write them inside "dots", not "&lt;..&gt;"):<br>
<ul> &lt;br&gt; &lt;p&gt;  &lt;s&gt; - &lt;/s&gt; &lt;pre&gt; - .. &lt;b&gt; - &lt;/b&gt; &lt;i&gt; - .. &lt;ul&gt; - .. &lt;ol&gt; - ..<br>
&lt;li&gt; - ..<br>
<p>
Special marks are dot-&lt;-dot and dot-&gt;-dot (no dashes, like ". &lt; ." <br>
without spaces) which are needed if the tag includes some options or<br>
is not among the tags "dotHTML" understands already.<br>
These will be converted to single &lt; and &gt; respectively.<br>
This is clumsy, but for quick sample and to speed up typing I found<br>
it sufficient. So far.<br>
<p>
<p>
And there are three special, non-HTML marks I introduced for convenience.<br>
(a) dot-x-dot ... dot-/x-dot <i>on one line only </i> will  &nbsp;   &nbsp;  f o r m a t  &nbsp;  t h e  &nbsp;  p h r a s e  &nbsp;  as spaced<br>
(b) dot-a-dot http://some/URL dot-/a-dot will create a hyperlink <a href= http://some/URL > http://some/URL </a> <br>
(c) dot-sp-dot - creates a space<br>
</ul><br>
<p>
etc. I add them as I go, whenever I need them for my current document.<br>
<p>
This formatting also adds &lt;br&gt; linebreaks unless lines are inside the <br>
&lt;pre&gt;..&lt;/pre&gt; sections.<br>
"dotHTML" also cuts out vim folding marks <br>
<pre> { { { number ... } } } number </pre><br>
without spaces, and  comment lines with dashes<br>
<pre> "#------------" </pre><br>
</li> </ol><br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('16');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('17');">
<font class='lnum'><i>(17)</i></font>&nbsp; Markup and Escaping </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 802)</i></sub></font></a></legend></fieldset>
<p>
<div id="17" style="display:none">   
<ul>


<p>
Escaping in files marked in multiple ways is a big source of all kinds of errors.<br>
Currently Molly should be able to take care of most cases.<br>
<p>
Exceptions include:<br>
<p>
1.  <b> double angle brackets ("&lt; &lt;" and "&gt; &gt;" without spaces in between) and the "at" sign </b><br>
Those confuse the "notangle" tool from Ramsey's "noweb". While Molly treats<br>
double angle brackets and "at" as a switch between documentation and a code chunk <i> only<br>
if those are in the first position in the line </i>, "noweb" stumbles.<br>
<p>
If you tangle through Molly (by running "my_project.tangle &gt; source.code"), Molly will<br>
filter these out. If you run "notangle" directly on the project file ("notangle -R'some <br>
root chunk' my_project.weave &gt; source.code"), it will fail.<br>
<p>
Therefore in this file I always <i> use extra white space btw angle brackets as an escape </i><br>
<p>
2. If you enabled the use of ASCIIMathML.js library to display mathematical exressions in<br>
you document, then <b> double backticks </b> on both sides of any expression pass <br>
processing to the library. (It also processes everything between "a m a t h" and<br>
"e n d a m a t h" tags - no spaces btw letters - in you file).<br>
Make sure that your target programming language or any future "markdown" you are going to <br>
add to Molly does not use these signs at all -- or re-edit the javascript library to<br>
substitute all inclusions of double backticks to sth else.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('17');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('15');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('18');">
<font class='lnum'><i>(18)</i></font>&nbsp; Mathematical Formulae - MathML inside Mollified Literate source files </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 832)</i></sub></font></a></legend></fieldset>
<p>
<div id="18" style="display:none">   
<ul>


<p>
<i> The most common reason users put forward for the continued use of (La)TeX in this day <br>
is its facility in dealing with mathematical notation. However today much <b> simpler HTML </b> <br>
(which is often further reduced to "markdown" level) if <b> used with MathML </b> can cover <br>
most of such needs</i><br>
<p>
<b> 1 </b> There are two libraries in JavaScript, ASCIIMathML.js and LaTeXMathML.js (derived <br>
from the former) which do translation "on the fly" in the reader's browser. Those provide <br>
almost a drop-in  functionality and can be used with Molly.<br>
<p>
The latest version of the ASCIIMathML.js library (2.0.1) includes <b> <i> both </i> </b> <br>
ASCII and LaTex processing. <br>
<p>
<b> 2 </b> There is a very nice "mimeTeX" application which is a C program that can be run<br>
as CGI (i.e. under the same web browser you use for Molly), which produces GIF renderings<br>
of LaTeX formulas on the fly. It is more complete that ASCIIMathML.js.<br>
I will include an option to use it with Molly if it is dropped into your work directory in<br>
a next version.<br>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('19');">
<font class='lnum'><i>(19)</i></font>&nbsp; How to use ASCIIMathML.js in Molly </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 854)</i></sub></font></a></legend></fieldset>
<p>
<div id="19" style="display:none">   
<ul>


<p>
<b> 1 </b>. To enable MathML one needs to use a compliant browser. Currently MathML is built in<br>
Firefox, or it can be enabled in Internet Explorer with a (free) plugin.<br>
<p>
For Opera the support is also built-in, however the library actually checks for the browser type<br>
and then it seems disallows Opera. The Opera browser, however, has another feature to bypass<br>
exactly that and lie about its identity. If "identify as Firefox" is set in your Opera browser,<br>
the MathML output is caught and rendered.<br>
I did not see any difference between Firefox and Opera_pretending_to_be_Firefox in rendering<br>
output of the library.<br>
<p>
<b> 2 </b>. To enable MathML while dynamically creating the folding-html file, I use an LGPLed<br>
Javascript library called "ASCIIMathML.js" from <br>
<a href= http://www1.chapman.edu/~jipsen/mathml/asciimath.html > http://www1.chapman.edu/~jipsen/mathml/asciimath.html </a><br>
(the home page), while only the library itself can be copied from<br>
<a href= http://www1.chapman.edu/~jipsen/mathml/ASCIIMathML.js > http://www1.chapman.edu/~jipsen/mathml/ASCIIMathML.js </a><br>
<p>
<b> 3 </b>. The use of MathML must be <b> enabled in the "mollifying" template </b> at the top of your<br>
Literate Project file, and the path to the ASCIIMathML.js added. See the config. <br>
template subsection above<br>
<p>
<b> 4 </b>. I had to <b> change escape symbols </b> in the library not to conflict with <br>
<i> programming symbols </i> - now it's double backticks instead of single ones -- and <br>
change config option enabling "preservation of $ and $$"<br>
<p>
Therefore a copy of modified library is distributed with the Molly script.<br>
The default location for Molly to work with is in the same directory as the Molly.pl.<br>
Adjust configuration as needed at the top of your script.<br>
<p>
If the rest of your file does not conflict with default ASCIIMathML.js escapes, i.e. does not use<br>
$ signs and single backtics, you can point to the original unmodified library and distribute that<br>
one with your work (see detailed explanations below).<br>
<p>
<b> 5 </b>. This javascript library allows a user <b> to type math formulas in simple calculator-<br>
like ASCII notation with LaTeX constants </b> if needed.<br>
<p>
The interpreted parts of the text must be either:<br>
<p>
(a) <b> <i> between "a m a t h" ...... "e n d a m a t h" tags (no brackets). </i> </b> The script<br>
then tries to differentiate between ordinary text and math expressions and renders the latter<br>
dynamically as MathML - which is then displayed by your browser.<br>
<p>
It might get confused etc. (e.g. because you used underscores somewhere); then your math<br>
could be<br>
<p>
(b) <i> <b> escaped (the math expressions only) with DOUBLE BACKTICKS around them. </b> </i><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('19');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('20');">
<font class='lnum'><i>(20)</i></font>&nbsp; 6 . Some examples and LaTexMathML.js library versions </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 906)</i></sub></font></a></legend></fieldset>
<p>
<div id="20" style="display:none">   
<ul>


<p>
<p>
..are quite intuitive:<br>
<p>
Let's try some interesting formulas: <br>
E=m c^2 ---&gt; ``E=m c^2`` and e^(i pi)=-1 ---&gt; ``e^(i pi)=-1``<br>
<p>
and AA x in CC (sin^2x+cos^2x=1) ---&gt; ``AA x in CC (sin^2x+cos^2x=1)``<br>
and one more: sum_(i=1)^n i^3=((n(n+1))/2)^2 ---&gt; ``sum_(i=1)^n i^3=((n(n+1))/2)^2``<br>
<p>
..and here are <b> more realistic math expressions </b> taken from a depository of some math <br>
    student and written in TeX notation. I drop $$ .. $$ wrapping the in-lined expressions <br>
    though and delimit it with double backticks instead. Here's the test:<br>
<p>
    Hover your mouse over the expression to see the ASCII/TeX coding:<br>
<p>
Freudental Formula<br>
``mult(\xi)=\frac{2}{(\mu+\rho|\mu+\rho)-(\xi+\rho|\xi+\rho)}\sum_{\alpha\in\Delta^{+}} mult(\alpha) \sum_{k=1}^{\infty}mult(\xi+k\alpha)(\xi+k\alpha|\alpha)``<br>
It includes roots ``\Delta=\left\{k\delta+\alpha|k\in Z,\; \alpha\in \Delta_0\right\}``<br>
positive roots ``\Delta^{+}=\{k\delta+\alpha|k\geq 0,\; \alpha\in \Delta_0^{+}\}\cup \{k\delta+\alpha|k\geq 1,\; \alpha\in \Delta_0\setminus \Delta_0^{+}\}``<br>
<p>
<i> NOTE </i> If you hover with your mouse over some interpreted expression, a baloon<br>
will appear showing the original ASCII markup for the expression. Very nice.<br>
<p>
<i> NOTE 2 </i> the "pre" (preformat) "/pre" HTML tags prevent the library from<br>
rendering the expressions and might even be used as a quick escape tool when you are writing<br>
your page.<br>
<p>
<p>
<p>
<b> Some TeX operators are not understood by ASCIIMathML.js </b><br>
(the failing test is in the ADD-ON MAthML subsection of the Source Code<br>
 section in this document). The reason is most likely that the lib was <br>
never told about those 1 or 2 constants and operators on which it fails<br>
<p>
<b> To solve </b> the problem one might explore another version of the library, "LaTexMathML.js"<br>
(of which there are 2 or 3 versions) changed to  interpret  the actual LaTex code:<br>
<a href= http://www.maths.nottingham.ac.uk/personal/drw/lm.html > http://www.maths.nottingham.ac.uk/personal/drw/lm.html </a><br>
<p>
One more version is here:<br>
<a href= http://math.etsu.edu/LaTeXMathML/ > http://math.etsu.edu/LaTeXMathML/ </a><br>
<p>
One more version (related) of LaTexMathML.js is here:<br>
<a href= http://pillars.che.pitt.edu/LaTeXMathML/ > http://pillars.che.pitt.edu/LaTeXMathML/ </a><br>
<a href= http://pillars.che.pitt.edu/LaTeXMathML/latexmathmlguide.xhtml > http://pillars.che.pitt.edu/LaTeXMathML/latexmathmlguide.xhtml </a><br>
<p>
.. and there is even a perl port for that<br>
<a href= http://pillars.che.pitt.edu/LaTeXMathML/ > http://pillars.che.pitt.edu/LaTeXMathML/ </a><br>
(which also can potentially be used from MOLLY)<br>
<p>
<p>
I have not tested those in full, but the use of JavaScript libraries from MOLLY should be<br>
identical (and so it says in the documentation inside the libraries) to that of ASCIIMathML.js<br>
They are directly interchangeable in a standalone HTML-based editor. Just point to a copy of the <br>
needed lib in the configuration section of your Literate Source file.<br>
<p>
<b> Secondly </b> the home page for the library mentions (at the very bottom) that the library<br>
encoding in its JavaScript source file is straightforward and more translations can be added<br>
as needed.<br>
Here is the URL: <a href= http://www1.chapman.edu/~jipsen/mathml/asciimathextend.html > http://www1.chapman.edu/~jipsen/mathml/asciimathextend.html </a><br>
<p>
I will provide a section in the Literater Source of Molly (in the ADD-ON section for MathML) <br>
to add all necessary definitions. It <b> <i> is </i> </b> very easy ;))<br>
<p>
<b> NOTE </b> <br>
<ul> <li> I had to adjust the lib (double backticks and preservation of $) because I was concerned<br>
with programming languages. The source code must stay untouched by the math library <br>
(mis)translations. That is why I provide a copy of the lib with MOLLY.<br>
<p>
</li> <li> If one wishes to use MOLLY for writing mathematical notation without conflicting computer\<br>
language code sections, one can always <b> link to an unmodified copy of the same lib </b><br>
and distribute that one with your work ( in *.mht files, see below) or even link to an <br>
address on the web.<br>
<p>
</li> <li>The same applies to a version of the lib to interpret TeX rather than ASCII math notation: <br>
MOLLY inclusion of the library is generic, just point to the correct javascript library.<br>
</li> </ul><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('20');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('21');">
<font class='lnum'><i>(21)</i></font>&nbsp; 7 .  ASCIIMathML Markup - reference </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 989)</i></sub></font></a></legend></fieldset>
<p>
<div id="21" style="display:none">   
<ul>


<p>
The full set of ASCII notation conventions for the library can be found on its<br>
home page.<br>
<a href= http://www1.chapman.edu/~jipsen/mathml/asciimathsyntax.html > http://www1.chapman.edu/~jipsen/mathml/asciimathsyntax.html </a><br>
<p>
There are 2 pages there, the first describes the syntax, and the second one shows allowed <br>
LaTex escapes.<br>
<p>
The easiest way to see the ascii code and to use any interpreted page as a reference is to<br>
hover your mouse over an interpreted math symbol or expression. In about a second a baloon <br>
appears  with the ascii source in it.<br>
<p>
There is an on-line tutorial in the use of ASCII math notation  for the library at<br>
<a href= http://www.wjagray.co.uk/maths/ASCIIMathTutorial.html > http://www.wjagray.co.uk/maths/ASCIIMathTutorial.html </a><br>
and <a href= http://www.wjagray.co.uk/maths/ASCIIMathMLinfo.html > http://www.wjagray.co.uk/maths/ASCIIMathMLinfo.html </a><br>
<p>
<b> One more URL </b><br>
"an on-line ASCIIMathEditor" is here<br>
<a href= http://www1.chapman.edu/~jipsen/mathml/asciimatheditor/ > http://www1.chapman.edu/~jipsen/mathml/asciimatheditor/ </a><br>
<p>
It is great to quickly test your expressions. <br>
<p>
Works in my case (firefox on Linux) if I save the page ("full page") and use it from<br>
local files. Could immediately see what I am typing, next copy and paste expressions<br>
into my target file.<br>
<p>
Useful. Just delete the spy from google, "the urchin tracker" from the page ;)) .<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('21');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('22');">
<font class='lnum'><i>(22)</i></font>&nbsp; How to distribute your final folding HTML-formatted work </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1022)</i></sub></font></a></legend></fieldset>
<p>
<div id="22" style="display:none">   
<ul>


<p>
<b> 8 . To distribute your HTML-weaved folding files with MathML notation </b><br>
afterwards you'll have to provide a copy of the JavaScript library with the weaved html <br>
file, as well as any images you might have used there.<br>
This can be done by creating <b> *.mht archives </b> from them.<br>
<p>
(to explain: MHT is a base64-encoded concatenation of elements of a page<br>
    and its images, scripts etc.;<br>
    MAF is a Mozilla zip-comression of page or several with all images etc into one<br>
    archive file).<br>
<p>
Note that because I had to modify escapes in the library for it not to clobber single <br>
backticks and $ symbols, so common in programming, one has to provide a copy of the <br>
modified lib with your HTML work.  You cannot simply link to any copy ot ASCIIMathML.js <br>
found on the Net. (You could if you use an unmodified copy though).<br>
<p>
Internet Explorer has built-in support for *.mht (as it is a MSoft standard).<br>
For Firefox the problem is solved easily by installing either<br>
"UnMHT" add-on: <a href= http://www.unmht.org/unmht/en_index.html > http://www.unmht.org/unmht/en_index.html </a><br>
or "MAF" add-on: <a href= http://maf.mozdev.org/ > http://maf.mozdev.org/ </a><br>
<p>
Then just open the weaved html file in your browser, and "Save As" *.MHT, it will <br>
include all images and the library with it.<br>
<p>
So: (a) weave an HTML file from Molly<br>
    (b) open it in IE or Firefox with MHT add-on, and <br>
    (c) save it as one file.<br>
<p>
This will allow you to distribute your MathML marked files with included images, plots<br>
etc. in a convenient manner.<br>
If you are strictly Firefox-based, you can also use the open zip-based MAF format.<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('22');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('18');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('23');">
<font class='lnum'><i>(23)</i></font>&nbsp; READ and SEARCH inside a Folding Literate Source file </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1062)</i></sub></font></a></legend></fieldset>
<p>
<div id="23" style="display:none">   
<ul>


<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('24');">
<font class='lnum'><i>(24)</i></font>&nbsp; Opening many relevant subsections together, TOC highlighting </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1068)</i></sub></font></a></legend></fieldset>
<p>
<div id="24" style="display:none">   
<ul>


<p>
One advantage of the folding format is that - in contrast to most other tools - it allows<br>
    the programmer to open <i> many </i> relevant sections from any parts of the file <i> at the <br>
    same time </i><br>
<p>
    This can be done by "walking" the Literate Source file, as its sections and subsections are a <br>
    kind of TOC of themselves.<br>
    This can be done from the TOC section as well. The open sections get a highlighted background,<br>
    and highlighting appears irrespective of whether the section was opened from the TOC or in the<br>
    body of the text.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('24');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('25');">
<font class='lnum'><i>(25)</i></font>&nbsp; Keeping some sections of the LSFile permanently open </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1084)</i></sub></font></a></legend></fieldset>
<p>
<div id="25" style="display:none">   
<ul>


<p>
The behaviour of folding sections in the mollified LSFile is as follows:<br>
    <ul> <li> If you click on the <b> "expand all" </b> link anywhere in the document, all folding <br>
    sections in the body (not TOC/Index) will open. The limitation is 10000 objects per document,<br>
    hardcoded.<br>
    </li> <li> If you click on <b> "collapse all" </b>, all folding sections in the body will fold. <br>
    The limit is 10k objects per document<br>
    </li> <li> If you <b> reload the document </b> in your browser ("Ctrl-R" or an icon click), the<br>
    document will be shown with sections open or closed <b> as marked </b> in the document itself.<br>
    </li> </ul><br>
<p>
    <b> The markup </b> is simple: if you'd like a section to stay open upon load/reload,  <br>
    add a "+" before "h" in the opening  heading tag:<br>
    <pre> &lt;+h1&gt;, or &lt;+h2&gt;, ... </pre><br>
<p>
    This is important when you work on a section or many sections of your LIterate Source file for<br>
    a longer period and could not click them open in teh browser time and time again, after each <br>
    minor code change when you reload the "project.weave" in your browser to see the updates.<br>
<p>
    Such changes - adding or deleting a "+" - can often be done with one command in a programming editor.<br>
    For example, to open the whole subthread in vim, issue a range command, sth like<br>
    <pre> 1024,1150s/&lt;h/&lt;+h/ </pre> (i.e. substitute between lines 1024 and 1150 of your Literate Source file)<br>
<p>
    Another suggestion is, when you, for example, work with several program files inside your LIterate<br>
    Source (project) file, you might keep subthreads marked open, while changing only the topmost <br>
    heading to show/hide the whole of that file/subthread code and notes.<br>
<p>
    Even when you handpick the sections to keep open, I found, this arrangement suits me well, at least<br>
    for medium-sized LSFiles up to several thousand lines long.<br>
    I also use folding inside "vim", and so line ranges are visible at one glance: "z-a" to collapse the<br>
    vim fold, and then see the range and issue the range command.<br>
<p>
    <i> Note </i> <br>
	<ul> Use of folding inside your programming editor  &nbsp;   &nbsp;  i s  &nbsp;  n o t  &nbsp;  a  &nbsp;  s u b s t i t u t e  &nbsp;  for reading <br>
	a well-laid out formatted document in the browser. Vim folding is still "blind" and  navigation<br>
	inside such a file still has to rely on your memory of the full layout. <br>
<p>
	MOLLY numbers lines in the code sections by default, making jumps from reading in your browser<br>
	to editing a particular line in your editor painless. I could also put it like this: <b> I view<br>
	the file globally </b> in my browser as a folding document when I am thinking, <b> while editing <br>
	"locally" </b> in a programming editor, without thinking about the overall layout of the file.<br>
<p>
	</ul><br>
<p>
    MOLLY.pl is written to filter out vim folding markups ( {{{number ... }}}number ) and those <br>
    will not show on your web page.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('25');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('26');">
<font class='lnum'><i>(26)</i></font>&nbsp; TOC and Code Chunks Index </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1137)</i></sub></font></a></legend></fieldset>
<p>
<div id="26" style="display:none">   
<ul>


<p>
Traditional literate programming tools create extensive indeces of variables and code chunks.<br>
<p>
    The approach in this script is as follows:<br>
<p>
    Index of all code chunks in your LSFile exists (unless a configuration opton in the <br>
    template tells MOLLY to skip it) right under TOC. Click on teh line to expand it, and then use<br>
    TOC section numbers to click open the sections which contain or define the chunks you need.<br>
<p>
    Remember that <i> all parent sections </i> above the needed one must be open for you to see <br>
    the innermost subsection in your browser. This is easy to control through TOC highlighting, and<br>
    as an additional indicator, the slider on your web browser will visibly jerk and shorten when <br>
    new sections will become visible in the browser window.<br>
<p>
    It's also convenient to keep some inner subsections open, but click closed the topmost section to<br>
    quickly hide and unhide larger pieces of code (e.g.complete files which live inside the Literate<br>
    Source File when it is used as a common Project file for many source files, test files, makefile(s)<br>
    etc.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('26');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('27');">
<font class='lnum'><i>(27)</i></font>&nbsp; Searching for symbols, chunks, phrases </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1161)</i></sub></font></a></legend></fieldset>
<p>
<div id="27" style="display:none">   
<ul>


<p>
Web browsers "search" functions  will work on open sections only, at least that's the behaviour of<br>
    Opera and Mozilla browsers.<br>
    This means that instead of creating exhaustive indeces of symbols, which clutter program text, <br>
    especially when they display as HTML links in the output of Weaver tools, one can ensure only the<br>
    interesting subsections are open and then search using the built-in browser function. It usually<br>
    highlights the results and iterates over the found items, which is a nice behaviour.<br>
<p>
    To search in the whole of the LSFile, simply click on the "expand all" under any of the subsections,<br>
    and then again use the browser search function.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('27');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('28');">
<font class='lnum'><i>(28)</i></font>&nbsp; TOC/Index unfolding and collapsing </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1177)</i></sub></font></a></legend></fieldset>
<p>
<div id="28" style="display:none">   
<ul>


<p>
    The TOC and Index at the top of the document can be kept folded or expanded upon initial load<br>
    depending on the configuration variables in the "mollifying" template you add at the top of <br>
    your Literate Project file. Please see the subsection titled '"Mollification" - full template' above<br>
    Of course, those subsections can always be opened/closed manually at any time<br>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('28');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('29');">
<font class='lnum'><i>(29)</i></font>&nbsp; Use for printing </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1186)</i></sub></font></a></legend></fieldset>
<p>
<div id="29" style="display:none">   
<ul>


<p>
Unfolding only the needed sections also seems to work well with printing from the browser window.<br>
    You can therefore avoid picking certain pages manually from "print preview". You'll print only<br>
    the visible part(s) - i.e. the open sections and the topmost folded section names, which do not<br>
    take place if your document is marked in a sane way, and rather help the reader to orient himself<br>
    while looking at the printout.<br>
<p>
    Just remember to check the font size in the "print preview" when preparing to print for the first <br>
    time.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('29');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('30');">
<font class='lnum'><i>(30)</i></font>&nbsp; Text browsers and JavaScript </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1201)</i></sub></font></a></legend></fieldset>
<p>
<div id="30" style="display:none">   
<ul>


<p>
Web page folding seems to work well with text-only www browsers, such as  "lynx" or 'w3m': they do not <br>
understand javascript folding, and so display the whole document.<br>
<p>
Here's an example invocation with w3m:<br>
<pre>  ./MOLLY.weave | w3m -T text/html  </pre><br>
<i> Note </i>MOLLY does not issue HTTP headers, and this may affect browser behaviour. The web server<br>
 and/or browser may add them or not, or ignore them or not. I might need to correct that.<br>
<p>
If JavaScript in your GUI browser is turned off, you'll see only the sections marked in the body<br>
of the Literate Source file as open.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('30');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('23');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('31');">
<font class='lnum'><i>(31)</i></font>&nbsp; SUGGESTED USES: Work with Folding LSFiles</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1219)</i></sub></font></a></legend></fieldset>
<p>
<div id="31" style="display:none">   
<ul>


<i> <b>  section unfinished; an outline of major points for now </b> </i><br>
<p>
I do not show examples below, as the document you are reading itself is an example of the<br>
techniques (and that may be the reason it is too bloated and somewhat unorderly ;)) ).<br>
<p>
<ol> <li> Literate Programming proper.<br>
<p>
    Emphasis on note-taking rather than producing a polished "essay" or "documentation"<br>
<p>
    Traditional Literate Programming texts place much emphasis on the fact that it is a means of <br>
    providing <i> documentation </i> (albeit with source code, and reflecting the thinking rather<br>
    than machine-imposed order).<br>
    Knuth first thought of LP as a documentation tool, then upgraded it to a "programming paradigm",<br>
    but insisted on writing programs "like literary essays".<br>
<p>
    However I would like to suggest placing emphasis on NOT documenting and NOT producing <br>
    polished code or an essay in thinking. The first use of this programming technique is <br>
    to  <i> keep a full log of your thinking </i> irrespective of how polished or stupid it is.<br>
<p>
    This is most precious. When you first attack a problem, several directions might come to mind,<br>
    but once you began to work out one of then in detail, everything else is lost. This is the<br>
    way human mind works. Keeping even briefest notes is more valuable than attempting to produce<br>
    polished exposition.<br>
<p>
    Psychological restrain people feel when they are compelled to prepare something for other people<br>
    is probably the third major hurdle to wide spreading of L.P. (the first two were flat file <br>
    structure and formatting languages which doubled the effort of programming and debugging).<br>
<p>
    My MOLLY Literate Source file is a log of my thinking, trials and experiments. I might later offer<br>
    a cleaned version to other people, but I do not give a damn about them in the beginning.<br>
<p>
    Non-folding L.P. source files could not accomodate inclusion of old versions, test files, bad<br>
    versions and skeletons without polutting the file to the degree of becoming unusable.<br>
<p>
    Folding version of L.P. source allows one to relegate bad trials into subsections  nicely folded<br>
    out of the way by merely adding a single header line.<br>
<p>
    When creating documentation, I could double the content of some sections, by copy-pasting the<br>
    "cleaned" versions, and then save a version with the original snippets bypassed, which is<br>
    easy and mechanical with tools like "gema", "awk" or "perl", just put a code word like<br>
    "scrap" in the beginning and end of those sections you'd like to avoid.<br>
<p>
    This ability to bypass marked sections when weaving, by the way, might be incorporated as an<br>
    option into a future version of MOLLY, to produce both 'clean' and 'dirty' versions of the<br>
   formatted Literate Source doc from one file.<br>
<p>
</li> <li> Use as a combined Project file<br>
    <ul> <li> to include tests and snippets that implement skeleton functionality to<br>
    be embedded into the main program<br>
    </li> <li> to include versioning and changes in the way  that does not break what<br>
    has been working so far (there was even a special term for that as a programming <br>
    principle). Keep the old version, put it into a subsection, and rename the chunk<br>
    to bypass it. The newer version of the piece of code that is being reworked will<br>
    get the old chunk name to be included into the chain to tangle out.<br>
    </li> <li> To keep a makefile (split, to which I can add lines from many places in<br>
    my Literate Source as I grow it) together with source file(s)<br>
    </li> <li> To keep several source files related logically in teh same Literate Source file.<br>
    </li> </ul><br>
<p>
    <i> Folding meta-files </i> could be used for larger projects, in which <br>
    the meta-file, a folding document, would describe teh topmost level layout of the <br>
    project, and contain ordinary HTML links to partial Folding Literate Sourcefiles, which<br>
    will keep all the junk as described above.<br>
<p>
    In any case, the use of Folding Literate Source files would considerably simplify tracking<br>
    of the project files in a version control system.<br>
<p>
</li> <li> Use for system administration etc. - as a single file to keep many sysadmin scripts, <br>
    descriptions of conventions and procedures, bugs and changes in the system <b> <i> in one place </i> </b><br>
    from which any of the included source (or texts, if they are kept in the "source chunks") <br>
    can be obtained easily with a single command.<br>
    ALSO: combine LIterate Source project file with a makefile as a simple means to keep <br>
    one-command tangling of multiple targets.<br>
<p>
    This Literate Source can live in a central place (e.g. root home) and be under version control.<br>
    The tangled pieces, config files or scripts could be copied to files on one or many machines.<br>
<p>
</li> <li> Use for non-programming tasks:<br>
    <ul> <li> as a note-keeper. E.g. I kept job listings and followi-up info in a folding<br>
   MOLLY file and found it quite convenient. <br>
    </li> <li> as an outliner for general purpose texts.<br>
    </li> <li> for keeping documentation, books etc. I keep documentation for a number of<br>
    software tools (e.g. "awk", "newlisp", "monotone") in folding format. It <i> is </i> helpful.<br>
    </li> <li> for editorial work on larger texts. The text itself will become "code chunks", <br>
    and editorial remarks and meta-thinking will remain as "documentation" in a Literate <br>
    Source file.<br>
    </li> </ul><br>
<p>
</li> </ol><br>
<p>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('32');">
<font class='lnum'><i>(32)</i></font>&nbsp; scrap </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1312)</i></sub></font></a></legend></fieldset>
<p>
<div id="32" style="display:none">   
<ul>

(a) //CGI and CL invocations - compared to "noweb"<br>
    // dotHTML tagging; alternative tagging, translations<br>
    // alternative tanglers and pass-through tangler; makefile problem<br>
<p>
(b) ideas - how to incorporate tests; how to keep a single project file;<br>
how to set up dummy plugs and alternatives (i.e. to develop without destroying<br>
the old working version)<br>
Maybe: for distribution of a lot of small scripts (admin etc), the  way I used<br>
Makefiles?<br>
<p>
(c) It's possible even to do development in smallest chunks -- and later (e.g. for<br>
outside clients or for higher-level documentation, etc.) to consolidate the tiny fractured <br>
bits and pieces, with plenty of alternatives, dummies, plugs and trials etc. etc.<br>
How? - by tangling those from some certain level and copy-pasting the result into the<br>
Literate Project File.<br>
One could even keep the actual development fractions in a subsection, while retaining<br>
higher-level and cleaner view in higher level sections. I do not care about doubling the<br>
text at all.<br>
<p>
<b>suggestion from a Slashdot 2002 discussion </b>(see ref above) about style or approach:<br>
do not document what the code does (which is redundant, as can be seen from the code itself),<br>
document rather WHY it does it (what's the purpose or the idea).<br>
<p>
<b> Also </b> use this file itself as an example of all illustrated techniques.<br>
<p>
Use <b>"mollify"</b> as  a technical term (insert MOLLY.pl invocation into the LitProject file)<br>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('32');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('31');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('6');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('33');">
<font class='lnum'><i>(33)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1345)</i></sub></font></a></legend></fieldset>
<p>
<div id="33" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('33');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('34');">
<font class='lnum'><i>(34)</i></font>&nbsp; PART III ------------ LITERATE SOURCE OF THE SCRIPT ------------ </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1348)</i></sub></font></a></legend></fieldset>
<p>
<div id="34" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 34).className='hilited';
		    </script>   
<ul>


<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('35');">
<font class='lnum'><i>(35)</i></font>&nbsp; Local Reference </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1353)</i></sub></font></a></legend></fieldset>
<p>
<div id="35" style="display:none">   
<ul>


<p>
<b> VIM regexp to highlight literate code sections only: </b><br>
<i> HAD TO spoil it because "notangle" complained about double diamonds <br>
"in documentation chunk", bastard </i> <b> delete spaces btw angl brckrs </b><br>
<pre> ^&lt; &lt;.*&gt; &gt;=\_.\{-1,}\n^@/e </pre><br>
.. and vice versa, highlight text, leave only code unhighlighted:<br>
<pre> ^@\_.\{-1,}\n^&lt; &lt;.*&gt; &gt;=/e </pre><br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('35');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('36');">
<font class='lnum'><i>(36)</i></font>&nbsp; Bugs, status, changes </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1372)</i></sub></font></a></legend></fieldset>
<p>
<div id="36" style="display:none">   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('37');">
<font class='lnum'><i>(37)</i></font>&nbsp; Ideas - versions - changes</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1376)</i></sub></font></a></legend></fieldset>
<p>
<div id="37" style="display:none">   
<ul>


<p>
Current version:<br>
<ul><br>
    <li> creates folding documents on the fly..<br>
    </li><li> ..based on dotHTML or rawHTML markup <br>
    (i.e. either to create new docs or convert existing HTML into folding format);<br>
    </li><li> and generates dynamically TOC and code chunks index;<br>
    </li><li> ties collapsing/expandind of sections with TOC highlighting;<br>
    </li><li> ..provides pass-through tangling with "noweb".<br>
    </li><li> provides built-in simple tangler which does not clobber tabs<br>
    </li><li> provides a tie to ASCIIMathML.js library for inclusion of <br>
	    mathematical expressions in your documents.<br>
    </li></ul><br>
<p>
    This script is a test of the concept (LitProg+folding+dynamic web formatting)<br>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('38');">
<font class='lnum'><i>(38)</i></font>&nbsp; first ideas </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1396)</i></sub></font></a></legend></fieldset>
<p>
<div id="38" style="display:none">   
<ul>


<p>
<p>
    Options for future versions --  3 ideas for now:<br>
    <ul><br>
    <li> <s> add a built-in tangler (while retaining the possibility to tangle<br>
    through an external tool, such as "notangle" with all its options and filters). </s><br>
    -- DONE<br>
<p>
    </li><li>  &nbsp;  c r e a t e  &nbsp;  a  &nbsp;  f u l l y  &nbsp;  s e l f - c o n t a i n e d  &nbsp;  folding web-based  &nbsp;  w e a v e r  &nbsp; <br>
    ("Lilit") (plus possibly a built-in tangler).<br>
    This can be done in newlisp (www.newlisp.org), which has a built-in httpd<br>
    and allows creation of 250k+(size of script) standalone executables on all<br>
    major platforms (unix/linux, windows mac).<br>
<p>
    </li><li> maybe -  &nbsp;  a d d  &nbsp;  " v i e w s "  &nbsp;  ( a  &nbsp;  l a  &nbsp;  L e o  &nbsp;  v i e w s )  &nbsp;  and maybe editing of single<br>
    subsections (in a pop-up term window with a running editor).<br>
    This - as I see it now - may/will involve storing each subsection in its <br>
    own little file and dynamically concatenating them both for dynamic weaving<br>
    and for tangling ( keep a third name, some "scriptname.src" for dumping the<br>
    full file to STDOUT?? )<br>
    This can be done dynamically: a huge project file will be displayed fully<br>
    collapsed, and then only the sections marked open will be dumped to the web<br>
    browser dynamically.<br>
    The whole thingy can be kept either as a bunch of section-files in a subdir,<br>
    or (and/or) in a tar file (gzipped or not, indexed or not).<br>
<p>
    <b> One possible implementation </b> is with <a href= http://www.wikiwyg.net > http://www.wikiwyg.net </a><br>
    - the "wikiwyg" library, which can turn any "div" into an editable section.<br>
<p>
    The lib as it is distribted does not save (no sub that saves, actually), but<br>
    one can "save in the browser" and next save the page from the browser to a <br>
    local file<br>
<p>
    For a local programming setup ( thttpd on localhost:8000 for example) this<br>
    will do. However one still needs to figure out if there is a possible post-<br>
    processing of the dynamically created (and then saved from the browser) page<br>
    with some script that would strip back the "frameset" decorations and the <br>
    invocations of folding plus the html head and TOC/chunks index sections.<br>
<p>
    I might say, I need the "reverse weaver" (although not as thorough ?)<br>
<p>
    .. and, secondly, after post-processing, if there is an invocation of "patch"<br>
    which would apply the diffs back to the Literate SOurce file.<br>
<p>
    <ul> <li> Will a "context patch" do? Can I postprocess<br>
    </li> <li> Can I postprocess the dynamically generated HTML to mimic some<br>
    sort of diff markup (unified? Context? ...)<br>
    </li> <li> Third, the exact invocation to apply it to an LSF.<br>
    Is manual restoration of this kind possible? Is it poss to run through a GUI<br>
    merge tool? An "apply all left to the right one" automatic tool?<br>
    </li> <li> This can be presented as buttons on the page (when the wikiwyg<br>
    option is enabled) etc.<br>
    The script then would take another option (your_filename?apply_changes) to<br>
    run this, and fail with a request to do a manual merge if not possible.<br>
    </li> </ul><br>
<p>
    Then the question   remains, how practically useful/convenient that is.<br>
<p>
<p>
    <i>How to do it</i><br>
    /* Basically, to manage sectionfiles I'd have to code as if those are comments<br>
    to a blog entry (and dynamic gathering of them is the same, too. Should be<br>
    rather obvious and possibly quite easy*/<br>
    This 'views_enabled' mode will switch to sect-files in a ./.molly/ and will<br>
    add dynamic links to each section: "edit section" (in an external editor);<br>
    "update Literate Source Project file". And the script will start to check the<br>
    subdir and dynamically reconstruct its HTML output in this mode.<br>
    Same must be true for the "tangler" pre-filter, too - it will reconstruct<br>
    the whole before passing it to the "notangle" utility.<br>
<p>
    </li><li> Is it possible to do  &nbsp;  " p r o m o t i n g / d e m o t i n g "  &nbsp;   &nbsp;  o f  &nbsp;  b r a n c h e s ? ?  &nbsp; <br>
    Is it possible in the view-enabled weaver?<br>
<p>
    </li><li>  &nbsp;  a d d  &nbsp;  " w e b  &nbsp;  t a n g l e  &nbsp;  m o d e "  &nbsp; , in which MOLLY will dump coloured diff<br>
    of the subsections (or the whole file if not too large), of the current version,<br>
    tangled via the browser form versus a file on disk.<br>
    (I do it all the time firing fldiff after each tangle - would be convenient to<br>
    have the functionality before tangling to disk (with file renaming etc), just<br>
    by reloading a page in a browser.<br>
    Will need to allow saving files (or some branch of chunks) from the browser, then.<br>
<p>
    Do I underuse  &nbsp;   &nbsp;  V i m  &nbsp;  ? - it does have <b> some "diff" mode </b> for side-to-side<br>
    display. Just open 2 files, current and prev. vers. and toggle btw one-file<br>
    view and edit or side-by-side coloured diff ???<br>
<p>
    <i>How to do it</i><br>
    .. by first (poss) checking that the files are not identical, and then by<br>
    filtering into "diff":<br>
    <pre> MOLLY.tangle|diff -y -w --left-column xxz - |less </pre><br>
    Just wrap it into html-body-pre tags and colour if there's something in the <br>
    right half (not necessary, really)<br>
<p>
</li> <li> <b> context diffs and sections editing </b>   <br>
</li> </ul><br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('38');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('39');">
<font class='lnum'><i>(39)</i></font>&nbsp; more ideas </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1498)</i></sub></font></a></legend></fieldset>
<p>
<div id="39" style="display:none">   
<ul>


<p>
<b> More ideas: </b><br>
<p>
<b> 1. Maybe </b>  have the  &nbsp;   &nbsp;  " c o m p o s i t e  &nbsp;  d o c u m e n t "  &nbsp;  (or "fragmented document") <br>
    option for  &nbsp;   &nbsp;  t h e  &nbsp;  s e c o n d - l e v e l  &nbsp;  meta-management  &nbsp;   &nbsp;  o f  &nbsp;  p r o j e c t  &nbsp;  f i l e s  &nbsp; <br>
    I.e. one project could be split into many file-sections, and MOLLY weaver will <br>
    assemble them into the doc.<br>
    OR: I maintain logically consistent pieces in medium-size project files, and<br>
    keep a meta-project file with the split option enabled.<br>
    The "edit" links from it will pop up gvim or another editor of choice with<br>
    the full piece in it.<br>
    While viewing will present it all as if one LIterate Source project file.<br>
    I'll need only to mark the pieces in the TOC, possibly, as a separate doc,<br>
    and -- <b> how will I treat TOC compilation then ? </b><br>
<p>
<b> 2. Maybe </b> - if I find an ASCII script (ascii art from commands and <br>
    descriptions), I could automatically generate  &nbsp;   &nbsp;  a s c i i - a r t  &nbsp;  " m a p s "  &nbsp;  <br>
    of the chunks ??<br>
<p>
<p>
<b> 3. introduce horizontal/vertical layouts? </b> <br>
    I.e. TOC and Chunks Index either on top of the file or on the left of it for<br>
    "wide screens", like those on notebooks ??<br>
    Changes are in  "Print out the resulting page" (currently line 3359)<br>
     - plus options, of course<br>
<p>
    Note: will require gluing TOC or the body to stick at the top, not simple table<br>
    cells, which will center and resize depending on relative cell content sizes.<br>
    May require separate scrolling for the two panes?<br>
<p>
OR: <b> TOC/Index in a floating window? </b> -- should be easy, just  name the<br>
    output windows.<br>
<p>
<b> 4. Maybe </b> add ancors to folding section names to be able to 'hyperlink' <br>
    and refer to them from other parts of the document??<br>
    // no jumps from the TOC? or with a separate 'jump' icon? //<br>
    // no jumps to closed sections will work anyway, then what to do? //<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('39');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('40');">
<font class='lnum'><i>(40)</i></font>&nbsp;  CONTRACT PROGRAMMING and Molly?? </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1544)</i></sub></font></a></legend></fieldset>
<p>
<div id="40" style="display:none">   
<ul>


<p>
possibly add conditional tangling to produce a contract-assertion-littereted prog during<br>
development and debugging --<br>
versus a "clean" copy -- ???<br>
<p>
<b> OR </b> just keep an "assertion-full" skeleton  by using a simple "rename" or a <br>
meta-chunk which is a dispatcher??<br>
<pre> [chunk_to_do_sth]=
 code code code code
 [another_chunk_ref]
 more code more code
 @
</pre><br>
...NO, I cannot do that without conditional tangling<br>
...or - do it in the target language using a "lazy and" for conditionals:<br>
(and (debug_assert_flag) (block .....with some code.....))<br>
<p>
<b> Well, this is what I can do: </b><br>
<pre>
&lt; &lt; main code chunk &gt; &gt; =
if ($DEBUG) {
&lt; &lt; pre-chunk assertions and if-checks &gt; &gt;
} # fi DEBUG

# main chunk code goes here

if ($DEBUG) {
&lt; &lt; post-chunk assertions and if-checks &gt;&gt;
} # fi DEBUG
#end of chunk here @
</pre><br>
<p>
Then I'll be able to produce debug code by tangling:<br>
<pre> notangle -R"some root" project.weave </pre><br>
and the "clean code" without assertion checks I'll get from it<br>
by simply filtering with<br>
<pre> perl -ne 'print unless m!^if ($DEBUG) {! .. m!^\} # fi DEBUG!' tangled.code \
&gt; clean.distribution.code </pre><br>
<p>
Should be easy enough ;))<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('40');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('41');">
<font class='lnum'><i>(41)</i></font>&nbsp; Editor highlighting, Perl POD and Literate Markup </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1590)</i></sub></font></a></legend></fieldset>
<p>
<div id="41" style="display:none">   
<ul>


<p>
The editor highlighting and literate marks  - is <i> bullshit </i><br>
The way I danced around it in Molly is half-insane.<br>
<p>
<b> SO: the solution might be </b> to configure POD marks as <br>
alternative literate markup boundaries, and/or filter the shit<br>
substituting for the real ones in the "pass-through tangler".<br>
Will be Ok at least for quick development, won't it?<br>
<p>
The namess of the POD sections are the names of literate chunks, then.<br>
<p>
I coould try "=pod Name of the Chunk"<br>
as simple PODs stand for nothing<br>
<p>
	(a) need empty lines around all POD markers<br>
	(b) =pod is ignored unless there is a =meaningful_mark<br>
	before<br>
	(c) =pod SOME TEXT -- text is ignored<br>
<p>
So, I could use it, it seems? OR: is there any sense in that??<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('41');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('37');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('42');">
<font class='lnum'><i>(42)</i></font>&nbsp;Done </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1619)</i></sub></font></a></legend></fieldset>
<p>
<div id="42" style="display:none">   
<ul>


<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('43');">
<font class='lnum'><i>(43)</i></font>&nbsp; for Tangling </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1624)</i></sub></font></a></legend></fieldset>
<p>
<div id="43" style="display:none">   
<ul>


<p>
1. command-line options (for weaver, too?) to imitate "noweb" (?)<br>
Options: <br>
    <ul> -to show all roots??<br>
    - mark refline nums and offsets of the Lit Source in the tangled code<br>
    - root to tangle <br>
    - keep docs in comments (and/or Pod sections?? </ul><br>
<p>
2. ability   to tangle over several file. I.e.<br>
    <ul> I grow my LitSource for a while, then split it almost<br>
    mechanically, not making splinters self-contained<br>
    I then supply all splinter file names to "MOLLY.pl my.project-*.weave"<br>
    and it tangles them out, however my prog is going through the splinters.<br>
    </ul><br>
<p>
3. <br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('43');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('42');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('44');">
<font class='lnum'><i>(44)</i></font>&nbsp;Todo -  current</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1648)</i></sub></font></a></legend></fieldset>
<p>
<div id="44" style="display:none">   
<ul>


<p>
<b>1. Problem of double diamonds in doc chunks </b><br>
<ul><br>
    <s> change the pass-through tangler to isolate the "notangle" from docs sections???<br>
    (will squash the prob of double angle brackets in documentation chunks)<br>
<p>
    OR - introduce a sort of escape?? Because sol 1 would clobber correct line numbering??<br>
    But I do not number lines in the default pass-through invocation..<br>
    The standalone will be affected, anyway.<br>
<p>
    I could add regex conversion to hexadecimals in the pass-through tangler.<br>
    However it would still break the "notangle" when run standalone. </s> -- DONE<br>
<p>
    I could collect command-line options in case of "scriptname.tangle" invocation<br>
    and pass them to "notangle" - that could be a sort of solution.<br>
</ul><br>
<p>
2. <s> Change logic of "weave-tangle" ("main despatcher"), as it is stupidly convoluted <br>
and ugly now </s> -- DONE<br>
<p>
3 and 8. (++) <s> rawHTML mode </s> -- done<br>
<p>
4. (++-) see below in "done"<br>
<p>
5. <s> <b> BUG of sorts </b><br>
the "lt" and "gt" escapes in the code chunks right above ("tangle me with filtering") are not <br>
displayed correctly  by the web weaver: the browser displays them as real angle brackets. </s> <br>
-- DONE<br>
<p>
6. <s>HTMLize the error message in the main despatcher (if "I am a module", print it as<br>
an html file). Otherwise it won't look good in the browser. </s> <br>
<b> NOT NEEDED </b> as "tangling" is done from CL only<br>
<p>
9 (++). DATA or ---start of script-- to filter?? - done<br>
<p>
10. Add "expand subthread" ?? - to open only the current branch of the L.T.File?<br>
<p>
11. <s> Add auto-href creation (i.e. posting a URL with minimal markup must create a valid<br>
    HTML link with URL as the name of it. </s> -- done<br>
<p>
12 (+--). and checking <br>
<s> qwer qwer  &nbsp;  s p a c i n g  &nbsp;  of one word and <i> &nbsp;  o f  &nbsp;   &nbsp;  m a n y  &nbsp;   &nbsp;  o n  &nbsp;   &nbsp;  t h e  &nbsp;   &nbsp;  s a m e  &nbsp;  l i n e  &nbsp; </i> asdf asd  <br>
SO: to do word boundaries properly. </s><br>
DONE although not very cleanly. The tag will break across several lines<br>
<p>
13. Add a full set of HTML escapes to "dotHTML" and "rawHTML" ?<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('44');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('36');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('45');">
<font class='lnum'><i>(45)</i></font>&nbsp; PRELIMINARIES: The script layout and idea </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1707)</i></sub></font></a></legend></fieldset>
<p>
<div id="45" style="display:none">   
<ul>


<p>
.. are very simple.<br>
<p>
<b>1. </b> It is possible to include an invocation of a  perl script with <br>
<pre> "do script.pl" or "use script.pl"  </pre><br>
as the first lines in a Literate Source file.  This turns the source into a standalone perl script. <br>
If we write the script to process the L.Source file itself ($0 in perl parlance) then the script can do <br>
weaving and tangling of it. The output, which is formatted documentation (which was "weaved" from L.P.) <br>
or the sources usable by a computer ("tangled") can be  saved in a file, as with traditional literate <br>
programming tools. But which is more convenient, the formatted documentation on STDOUT can <br>
be  picked up by a web  server.  We'll see formatted representation of work in progress immediately<br>
upon reload of the page in a web browser. <br>
<p>
When I think, I prefer to look at the formatted document, and when I edit, I do it "locally" in a good<br>
programming editor (such as "vim"). Even with vim folding the difference in perception is enormous.<br>
<p>
<b> 2. </b>I see three advantages to such an arrangement:  <br>
<ul><li>first, web markup is ubiquitous today, and it is quite sufficient for most publishing needs. <br>
So Literate Programming with HTML will free us from a tie to TeX which so negatively affected <br>
perception of L.P. by the masses of programmers. The markup becomes very, very simple. <br>
<p>
This eliminates a source of one major complaint about the traditional L.P. - that the programmer<br>
has to maintain not one, but two "programming languages" while working with LP, the target one<br>
and the formatting one. This - the complaint goes - becomes a source of errors from an additional<br>
layer of programming in addition to writing the code itself. It taxes the programmer's mind rather<br>
than relieving it.<br>
<p>
In fact, simple HTML is almost self-correcting, as wrong markup becomes immediately obvious<br>
in the browser. <br>
<p>
</li> <li> secondly, this eliminates "weaving" as a separate step during development, but more<br>
importantly, such an arrangement allows a programmer to think about his program while looking<br>
at a <i>folding</i> document, in which only relevant sections are open.<br>
<p>
I perceive <i> folding </i> as a major advantage<br>
<p>
With <i>folding</i> the Literate Source file becomes manageable even for really large texts. <br>
This in turn allows the programmer to keep <i> many files </i> inside the LPSource, including<br>
test snippets, the makefile, preserve old versions of parts of the source etc. etc.<br>
Literate Source file is painlessely turned into a Project File, one file, from which anything<br>
can be easily generated.<br>
It is this one file that my version control system must track now. For really large projects,<br>
we can keep a meta-file (also in the folding format) with largish partial files as links,<br>
corresponding to logical pieces of the project, which will open in the browser as automatically<br>
weaved Literate Source Files.<br>
<p>
I attempted to explain this at length in introductory sections above.<br>
</li></ul><br>
<p>
<b>3. </b> How the script works overall<br>
<p>
After figuring out how it was invoked, the script:<br>
<ul><li> <b>when it is supposed to weave</b>, scans into memory the Literate Source <br>
file, marked up in "noweb" notation (and its document sections marked with raw HTML <br>
or in "dotHTML") doing necessary substitutions and conversions along the way.<br>
Then the buffered string thus formed and several auxilliary buffers (for document TOC <br>
and Index sections) are printed out to STDOUT. They can be redirected into files, if <br>
LPSource, now also an executable script itself, is run from command line, or they can <br>
be picked up by a local personal web server that is used by the developer, which  should <br>
recognize the LPSource as a valid CGI script<br>
<p>
After any changes in the script, the user can reload the page in his web browser and <br>
immediately see the changes.<br>
<p>
</li><li> <b>If invoked to tangle</b> the source of the program, this version of the <br>
script will either use the built-in tangler, or refer the actual tangling to the <br>
"notangle" utility from "noweb" suite of  tools by Ramsey, depending on configuration <br>
at the top of your litsource file<br>
<p>
The built-in tangler does not scan the file into memory. Rather, it does a first pass over<br>
the file noting the offsets where code chunks start, end or get referred to.<br>
The second pass then recursively prints them to STDOUT.<br>
</li></ul><br>
<b>5. </b>  &nbsp;   &nbsp;  A  &nbsp;  f u t u r e  &nbsp;  v e r s i o n  &nbsp;  of the script may be made completely self-contained, i.e. <br>
include a mini-web server as well as a folding weaver and a tangler.<br>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('45');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('46');">
<font class='lnum'><i>(46)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1788)</i></sub></font></a></legend></fieldset>
<p>
<div id="46" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('46');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('47');">
<font class='lnum'><i>(47)</i></font>&nbsp; MOLLY.pl - top of the script </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1791)</i></sub></font></a></legend></fieldset>
<p>
<div id="47" style="display:none">   
<ul>


<p>
<font class='lnum'>1794</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;MOLLY.pl module&gt;&gt;=</legend>
<font class='lnum'>1795</font>   #!/usr/bin/perl
<font class='lnum'>1796</font>   
<font class='lnum'>1797</font>   #---------------------------------------------------------------------------------    
<font class='lnum'>1798</font>   #
<font class='lnum'>1799</font>   #	This script is licensed under GPL version 3
<font class='lnum'>1800</font>   #
<font class='lnum'>1801</font>   #----------------------Script proper----------------------------------------------
<font class='lnum'>1802</font>   
<font class='lnum'>1803</font>   
<font class='lnum'>1804</font>   <font class='chunkref'>&lt;&lt;general settings&gt;&gt</font>;
<font class='lnum'>1805</font>   <font class='chunkref'>&lt;&lt;main despatcher&gt;&gt</font>;
<font class='lnum'>1806</font>   <font class='chunkref'>&lt;&lt;tangle me&gt;&gt</font>;
<font class='lnum'>1807</font>   <font class='chunkref'>&lt;&lt;weave me&gt;&gt</font>;
<font class='lnum'>1808</font>   
<font class='lnum'>1809</font>   # just in case:
<font class='lnum'>1810</font>   close LITSOURCE;
<font class='lnum'>1811</font>   exit;
<font class='lnum'>1812</font>   
<font class='lnum'>1813</font>   # END OF SCRIPT
<font class='lnum'>1814</font>   
<font class='lnum'>1815</font>   </fieldset></pre>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('48');">
<font class='lnum'><i>(48)</i></font>&nbsp; general settings </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1819)</i></sub></font></a></legend></fieldset>
<p>
<div id="48" style="display:none">   
<ul>


<p>
<p>
Some internal script parameters are set here.<br>
E.g. "noweb" tangler gets confused if it finds double angle brackets<br>
anywhere, so sometimes it's possible to fool it by setting a var in the<br>
perl script like this:<br>
<p>
<font class='lnum'>1828</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1829</font>     # need to fool the noweb "notangle" utility, switch markup modes etc.
<font class='lnum'>1830</font>     $lt = "&lt;";
<font class='lnum'>1831</font>     $gt = "&gt;";
<font class='lnum'>1832</font>     $lt_esc = "&amp;lt;";
<font class='lnum'>1833</font>     $gt_esc = "&amp;gt;";
<font class='lnum'>1834</font>     $dash = "-";
<font class='lnum'>1835</font>     $dot = "\.";
<font class='lnum'>1836</font>   </fieldset></pre>
<p>
But more importantly:<br>
There are a number of parameters that can be set from the literate source file<br>
at the very top before loading the module with "do MOLLY.pl" (or "use MOLLY.pl").<br>
These are assigned defaults here. You can refer to this portion of the script<br>
to find out what parameters are settable in your document template and expand the<br>
tunings if you modify MOLLY.pl<br>
<p>
<font class='lnum'>1845</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1846</font>   
<font class='lnum'>1847</font>     # ----- GENERAL settings -----
<font class='lnum'>1848</font>     
<font class='lnum'>1849</font>     # am I a module? 1:0
<font class='lnum'>1850</font>     $i_am_module = 1;
<font class='lnum'>1851</font>   
<font class='lnum'>1852</font>     # print toc? 1:0
<font class='lnum'>1853</font>     $print_toc = 1 unless defined $print_toc;
<font class='lnum'>1854</font>       
<font class='lnum'>1855</font>     # keep TOC expanded on initial load? "block":"none"
<font class='lnum'>1856</font>     $toc_expanded = $toc_expanded || "block";
<font class='lnum'>1857</font>   
<font class='lnum'>1858</font>     # keep TOC expanded in initial load? "block":"none"
<font class='lnum'>1859</font>     $ind_expanded = $ind_expanded || "none";
<font class='lnum'>1860</font>   </fieldset></pre>
<p>
The script will behave differently depending on its own name. One "major" name<br>
can be used with others existing as soft links (although an "thttpd" lightweight<br>
web server insisted on a hard link in one case).<br>
The modes are detected by file extensions, which are set here.<br>
'Weaving' = creating a formatted HTML documentation file on STDOUT<br>
'Tangling' = creating the program/script source on STDOUT<br>
<p>
<font class='lnum'>1869</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1870</font>     # what is the file extention to weave it? (perms must allow execution!)
<font class='lnum'>1871</font>     # e.g. "scriptname.weave" or "scriptname.cgi" etc.
<font class='lnum'>1872</font>     $weave_extension = $weave_extension || "weave";	# default is "weave"
<font class='lnum'>1873</font>   
<font class='lnum'>1874</font>       # what is the file extention to tangle it? (perms must allow execution!)
<font class='lnum'>1875</font>       # e.g. "scriptname.tangle",  "scriptname.pl" etc.
<font class='lnum'>1876</font>       $tangle_extension = $tangle_extension || "tangle";	# default is "tangle"
<font class='lnum'>1877</font>   
<font class='lnum'>1878</font>   
<font class='lnum'>1879</font>       #When tangling, should I use the built-in tangler? 0:1
<font class='lnum'>1880</font>       # (if 0, the "pass-through" tangling will call "notangle"
<font class='lnum'>1881</font>       # from Ramsey's "noweb" tools, must be installed and in your path)
<font class='lnum'>1882</font>       # use_builtin_tangler = 0; # default for now is to use external "notangle"
<font class='lnum'>1883</font>       $use_builtin_tangler = $use_builtin_tangler || 0; 
<font class='lnum'>1884</font>   
<font class='lnum'>1885</font>       # Actually, let's always do it and disallow unsetting
<font class='lnum'>1886</font>       # number lines ? 1 : else
<font class='lnum'>1887</font>       $line_numbering = 1;
<font class='lnum'>1888</font>   
<font class='lnum'>1889</font>   </fieldset></pre>
<p>
The document sections ("chunks") can be marked with actual HTML tags ("rawHTML") or<br>
with a smaller number of the same tags in "dots" in place of "angle brackets", i.e.<br>
dot-br-dot, not open.angle-br-closing.angle<br>
This is selected here:<br>
<p>
<font class='lnum'>1896</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1897</font>       # how are doc sections marked? "dotHTML":"rawHTML"
<font class='lnum'>1898</font>       $weave_markup = $weave_markup || "rawHTML"; # default is "rawHTML"
<font class='lnum'>1899</font>   
<font class='lnum'>1900</font>       if ($weave_markup eq "dotHTML") {
<font class='lnum'>1901</font>   	$tag_open_symbol = $dot;	# this will take care of default
<font class='lnum'>1902</font>   	$tag_close_symbol = $dot;	# when no var is set in the Lit Src file
<font class='lnum'>1903</font>       }
<font class='lnum'>1904</font>       elsif ($weave_markup eq "rawHTML") { 
<font class='lnum'>1905</font>   	$tag_open_symbol = $lt;
<font class='lnum'>1906</font>   	$tag_close_symbol = $gt;
<font class='lnum'>1907</font>       } #fi
<font class='lnum'>1908</font>   
<font class='lnum'>1909</font>   </fieldset></pre>
<p>
<p>
Do we need to enable MathML functionality? If "yes", set the path to the js library<br>
"ASCIIMathML.js" and enable the switch.<br>
This slows down interpretation of the file on reload drastically (from nothing to<br>
3 seconds with 4-5 example formulas), so for sfw development usually this should be off.<br>
<p>
<font class='lnum'>1917</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1918</font>   
<font class='lnum'>1919</font>       # enable MathML interpretation? 1 : 0
<font class='lnum'>1920</font>       $enable_ASCIIMathML = $enable_ASCIIMathML || 0;
<font class='lnum'>1921</font>       # If enabled, set the path; default is local in current dir
<font class='lnum'>1922</font>       $path_to_ASCIIMathML = $path_to_ASCIIMathML || "ASCIIMathML_with_modified_escapes.js";
<font class='lnum'>1923</font>   
<font class='lnum'>1924</font>   </fieldset></pre>
<p>
<p>
It would make sense to add a few more markups to the program, i.e. some "wiki" many use,<br>
and some TeX basic tags for automatic translation, if the doc is tagged as a TeX file.<br>
<p>
In more detail dotHTML is explained in its own section<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('48');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('49');">
<font class='lnum'><i>(49)</i></font>&nbsp; main despatcher </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1937)</i></sub></font></a></legend></fieldset>
<p>
<div id="49" style="display:none">   
<ul>


<p>
The script figures out how it was invoked and then starts either a tangler<br>
or a weaver, or fails with a usage line.<br>
<p>
If the script name ends in "weave" (e.g. script.weave), it will be weaved to STDOUT.<br>
If the name ends in "tangle", the source starting from the default chunk &lt; &lt;*&gt; &gt;<br>
(without spaces) will be dumped to STDOUT:<br>
<p>
<font class='lnum'>1947</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher&gt;&gt;=</legend>
<font class='lnum'>1948</font>   <font class='chunkref'>&lt;&lt;main despatcher with CL&gt;&gt</font>;
<font class='lnum'>1949</font>   </fieldset></pre>
<p>
There later may be other versions of despatchers to take care of command-line invocations<br>
of Molly etc.<br>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('50');">
<font class='lnum'><i>(50)</i></font>&nbsp; "Main despatcher with CL" </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1955)</i></sub></font></a></legend></fieldset>
<p>
<div id="50" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 50).className='hilited';
		    </script>   
<ul>


<p>
Adding command-line processing.<br>
For now the logic is as described below in sub "usage".<br>
<p>
More options are typed below, but they are disabled for now.<br>
This version allows using MOLLY.pl from command line to tangle from any root<br>
in addition to the standard "mollified" file weaving and tangling as described<br>
in the docs.<br>
<p>
<font class='lnum'>1966</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher with CL&gt;&gt;=</legend>
<font class='lnum'>1967</font>     # -- MAIN DESPATCHER WITH CL----
<font class='lnum'>1968</font>     use Getopt::Std;
<font class='lnum'>1969</font>   
<font class='lnum'>1970</font>   sub usage {
<font class='lnum'>1971</font>   
<font class='lnum'>1972</font>       print STDERR&lt;&lt;'end_of_usage';
<font class='lnum'>1973</font>   
<font class='lnum'>1974</font>       USAGE: MOLLY.pl [options] [--] filename
<font class='lnum'>1975</font>   
<font class='lnum'>1976</font>   	-h, or no filename
<font class='lnum'>1977</font>   		get this help message
<font class='lnum'>1978</font>   
<font class='lnum'>1979</font>   	-R "root_chunk_name", 
<font class='lnum'>1980</font>   		tangle starting from this chunk. if omitted, "*" is default.
<font class='lnum'>1981</font>   		
<font class='lnum'>1982</font>   
<font class='lnum'>1983</font>       FOR INTERNALLY MOLLIFIED FILES:
<font class='lnum'>1984</font>   	shortcut invocation - depending on file extension. If run as script
<font class='lnum'>1985</font>   
<font class='lnum'>1986</font>   	"lit_prog_file.tangle" 
<font class='lnum'>1987</font>   		tangle to STDOUT, from default root "*" only. 
<font class='lnum'>1988</font>   	"lit_prog_file.weave" 
<font class='lnum'>1989</font>   		weave to STDOUT as folding HTML; usable under CGI
<font class='lnum'>1990</font>   	
<font class='lnum'>1991</font>   	/ OR: whatever extensions are set in the lit.source configuraton /
<font class='lnum'>1992</font>   
<font class='lnum'>1993</font>   end_of_usage
<font class='lnum'>1994</font>   
<font class='lnum'>1995</font>    exit;
<font class='lnum'>1996</font>   }
<font class='lnum'>1997</font>   
<font class='lnum'>1998</font>       # ---
<font class='lnum'>1999</font>       # -1- shortcut invocations for "mollified" LitSrc file depending on its extension ---
<font class='lnum'>2000</font>       #
<font class='lnum'>2001</font>   
<font class='lnum'>2002</font>     if ( $0 =~ m!\w+\.$weave_extension$! ) { 
<font class='lnum'>2003</font>   
<font class='lnum'>2004</font>   	open LITSOURCE, "&lt; $0" or die "could not open the target file\n";
<font class='lnum'>2005</font>   	goto WEAVE_ME;
<font class='lnum'>2006</font>       }
<font class='lnum'>2007</font>       elsif ( $0 =~ m!\w+\.$tangle_extension$! )  {
<font class='lnum'>2008</font>   
<font class='lnum'>2009</font>   	open LITSOURCE, "&lt; $0" or die "could not open the target file\n";
<font class='lnum'>2010</font>   	goto TANGLE_ME;
<font class='lnum'>2011</font>     }
<font class='lnum'>2012</font>   
<font class='lnum'>2013</font>       # ---
<font class='lnum'>2014</font>       # -2- MOLLY.pl as applied to an external target file. --- 
<font class='lnum'>2015</font>       # check if MOLLY.pl was called from CL or under CGI, and despatch accordingly.
<font class='lnum'>2016</font>   
<font class='lnum'>2017</font>     else {
<font class='lnum'>2018</font>   
<font class='lnum'>2019</font>       if (-t STDIN) { # running on interactive TTY
<font class='lnum'>2020</font>   	#print STDERR "$0 was called from command line..\n";
<font class='lnum'>2021</font>   
<font class='lnum'>2022</font>   	#getopts("hwu:l:d:R:", \%cl_args);
<font class='lnum'>2023</font>   	getopts("hR:", \%cl_args);
<font class='lnum'>2024</font>   
<font class='lnum'>2025</font>   	# -- print USAGE if not evoked correctly
<font class='lnum'>2026</font>   	if( (! defined $ARGV[0] ) or  ( $cl_args{h} ) ) { usage(); exit };
<font class='lnum'>2027</font>   
<font class='lnum'>2028</font>   	# -- does target file exist?
<font class='lnum'>2029</font>   	if ( -f $ARGV[0] ) {
<font class='lnum'>2030</font>   	    ; # nop, a debug printout
<font class='lnum'>2031</font>   	    #print STDERR "target file to operate on is $ARGV[0]\n";
<font class='lnum'>2032</font>   	}
<font class='lnum'>2033</font>   	else { 
<font class='lnum'>2034</font>   	    print STDERR "No target file found\n";
<font class='lnum'>2035</font>   	};
<font class='lnum'>2036</font>   
<font class='lnum'>2037</font>   
<font class='lnum'>2038</font>   	# -- process other args for tangling an external file from CL --
<font class='lnum'>2039</font>   	#	disabled for most of then now
<font class='lnum'>2040</font>   
<font class='lnum'>2041</font>   	if($cl_args{d}) { 
<font class='lnum'>2042</font>   	    #print STDERR "doc sections in coments; comment char is $cl_args{d}\n" 
<font class='lnum'>2043</font>   	    };
<font class='lnum'>2044</font>   
<font class='lnum'>2045</font>   	if($cl_args{l}) { 
<font class='lnum'>2046</font>   	    #print STDERR "will add reflines; comment char is $cl_args{l}\n" 
<font class='lnum'>2047</font>   	    };
<font class='lnum'>2048</font>   
<font class='lnum'>2049</font>   	if($cl_args{u}) { 
<font class='lnum'>2050</font>   	    #print STDERR "applying UN-tangling with script char is $cl_args{u}\n" 
<font class='lnum'>2051</font>   	    };
<font class='lnum'>2052</font>   
<font class='lnum'>2053</font>   
<font class='lnum'>2054</font>   	# -- getting the root chunk for tangling --
<font class='lnum'>2055</font>   	#
<font class='lnum'>2056</font>   	if($cl_args{R}) { 
<font class='lnum'>2057</font>   	    $root_chunk = $cl_args{R};
<font class='lnum'>2058</font>   	    print STDERR "tangling root chunk '$root_chunk'\n"
<font class='lnum'>2059</font>          	};
<font class='lnum'>2060</font>   
<font class='lnum'>2061</font>   
<font class='lnum'>2062</font>   	# -- Final CL despatch, do it: --
<font class='lnum'>2063</font>   	
<font class='lnum'>2064</font>   	open LITSOURCE, "&lt; $ARGV[0]" || die "could not open the file to tangle\n";
<font class='lnum'>2065</font>   
<font class='lnum'>2066</font>   	if($cl_args{w}) { 
<font class='lnum'>2067</font>   
<font class='lnum'>2068</font>   	    ; # nop, weaving is mangled at the moment	
<font class='lnum'>2069</font>   	    #print STDERR "weaving from CL, got $cl_args{w}\n"; 
<font class='lnum'>2070</font>   	    #goto WEAVE_ME;
<font class='lnum'>2071</font>   
<font class='lnum'>2072</font>   	}
<font class='lnum'>2073</font>   	else {
<font class='lnum'>2074</font>   	    
<font class='lnum'>2075</font>   	    goto SEEK_PEEK_TANGLER;
<font class='lnum'>2076</font>   
<font class='lnum'>2077</font>       	} # fi - CL final despatch
<font class='lnum'>2078</font>   
<font class='lnum'>2079</font>   
<font class='lnum'>2080</font>       exit; #redundant and unused
<font class='lnum'>2081</font>       }
<font class='lnum'>2082</font>   
<font class='lnum'>2083</font>   
<font class='lnum'>2084</font>       # -3- MOLLY.pl as a standalone script is called from CGI, nothing in here yet ---
<font class='lnum'>2085</font>       #
<font class='lnum'>2086</font>     elsif (defined $ENV{'REQUEST_METHOD'}) {
<font class='lnum'>2087</font>   
<font class='lnum'>2088</font>   	print "Content-Type: text/html; charset=utf-8\n\n";
<font class='lnum'>2089</font>   	print &lt;&lt;_XXX_;
<font class='lnum'>2090</font>   	&lt;html&gt;&lt;body&gt;
<font class='lnum'>2091</font>   	&lt;p&gt;
<font class='lnum'>2092</font>   	&lt;b&gt;I was caled as CGI, but this invocation seems to be meaningless.&lt;/b&gt;&lt;br&gt;
<font class='lnum'>2093</font>   	Maybe you meant to "weave", but set a wrong file extension.&lt;br&gt;
<font class='lnum'>2094</font>   	Goodbye.&lt;br&gt;
<font class='lnum'>2095</font>   	&lt;i&gt;-- MOLLY.pl --&lt;/i&gt;
<font class='lnum'>2096</font>   	&lt;p&gt;
<font class='lnum'>2097</font>   	&lt;/body&gt;&lt;/html&gt;
<font class='lnum'>2098</font>   _XXX_
<font class='lnum'>2099</font>   
<font class='lnum'>2100</font>     exit;
<font class='lnum'>2101</font>   
<font class='lnum'>2102</font>     }
<font class='lnum'>2103</font>   
<font class='lnum'>2104</font>     # -4- other cases ---
<font class='lnum'>2105</font>     #
<font class='lnum'>2106</font>     else {
<font class='lnum'>2107</font>   
<font class='lnum'>2108</font>   	print STDERR "MOLLY.pl: I do not know how I was called, exiting anyway\n";
<font class='lnum'>2109</font>   	exit;
<font class='lnum'>2110</font>   
<font class='lnum'>2111</font>       }
<font class='lnum'>2112</font>   
<font class='lnum'>2113</font>     exit;
<font class='lnum'>2114</font>   
<font class='lnum'>2115</font>     } # fi, end of despatcher
<font class='lnum'>2116</font>   
<font class='lnum'>2117</font>   exit;  
<font class='lnum'>2118</font>     
<font class='lnum'>2119</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('50');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('51');">
<font class='lnum'><i>(51)</i></font>&nbsp; "Main despatcher simple" </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2126)</i></sub></font></a></legend></fieldset>
<p>
<div id="51" style="display:none">   
<ul>


<p>
<p>
This one is for "mollified" file processing only; no use of MOLLY.pl as<br>
a standalone script on external files will be possible.<br>
For that enable the "main despatcher with CL" chunk.<br>
<p>
<b> Note </b> Now that I'm redoing target file opening there, this despatcher<br>
needs to be adjusted too, or it will break (open $0 as LITSOURCE here)<br>
<p>
<font class='lnum'>2137</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher simple&gt;&gt;=</legend>
<font class='lnum'>2138</font>     # -- MAIN DESPATCHER ----
<font class='lnum'>2139</font>   
<font class='lnum'>2140</font>     # check if $i_am_module and set filenames to $0 - or 
<font class='lnum'>2141</font>     # process CL options otherwise
<font class='lnum'>2142</font>   
<font class='lnum'>2143</font>     # (temp) - 2 options, to weave and to tangle in module mode:
<font class='lnum'>2144</font>     #
<font class='lnum'>2145</font>     if ( $0 =~ m!\w+\.$weave_extension$! ) { goto WEAVE_ME }
<font class='lnum'>2146</font>     elsif ( $0 =~ m!\w+\.$tangle_extension$! )  {goto TANGLE_ME}
<font class='lnum'>2147</font>     else {
<font class='lnum'>2148</font>     print &lt;&lt;end_of_print;
<font class='lnum'>2149</font>   
<font class='lnum'>2150</font>   	USAGE:
<font class='lnum'>2151</font>   	Not set to tangle (wrong file extension).
<font class='lnum'>2152</font>   	Set config variables at the top of the script.  
<font class='lnum'>2153</font>   
<font class='lnum'>2154</font>   end_of_print
<font class='lnum'>2155</font>   
<font class='lnum'>2156</font>   exit;
<font class='lnum'>2157</font>     }
<font class='lnum'>2158</font>   
<font class='lnum'>2159</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('51');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('49');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('47');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('52');">
<font class='lnum'><i>(52)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2168)</i></sub></font></a></legend></fieldset>
<p>
<div id="52" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('52');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('53');">
<font class='lnum'><i>(53)</i></font>&nbsp; TANGLER </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2171)</i></sub></font></a></legend></fieldset>
<p>
<div id="53" style="display:none">   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('54');">
<font class='lnum'><i>(54)</i></font>&nbsp; Notes on; difference btw built-in and "notangle" </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2175)</i></sub></font></a></legend></fieldset>
<p>
<div id="54" style="display:none">   
<ul>


<p>
<p>
<p>
    This version of the script includes a built-in tangler. However if you set<br>
    "$use_builtin_tangler" to 0 in the settings, the script will pass ithe request <br>
    through to the "notangle" utility of the "noweb" Literate Programming tool <br>
    to tangle starting with <i>the default chunk &lt; &lt;*&gt; &gt;</i>   and without other <br>
    options passed. I only set "notangle" below to preserve the tabs in case you <br>
    are tangling Makefiles.<br>
<p>
    If you set $use_builtin_tangler to 1, the "seek-peek" tangler will be used.<br>
    It does not clobber tabs at all, so tangling out Makefiles is possible.<br>
    It does not choke on double &lt; &lt; in text chunks, either.<br>
<p>
    It is:<br>
   <ul> <li> not so much tested (but seem to handle example from "noweb" distribution<br>
    after those have been brought to "canonical form", i.e. <b> all code chunks<br>
    end with "@", no exceptions </b> <br>
    </li> <li> can handle multiple refs on the same line surrounded by other text,<br>
    </li> <li> and tangles only the default chunk "*" (again, for now),  <br>
    </li> </ul><br>
    so you might want to use the Ramsey's tool, at least to check the output.<br>
    Norman Ramsey's "noweb" has been around for more than 10 years and been used<br>
    on thousands of lines of other projects.<br>
    You will also have to run "notangle" for getting non-default-root ("*") chunks<br>
    until I have supplied command line processing.<br>
<p>
	<ul> <b>  1. Note</b> that for <b> "notangle" </b> you have   to make sure your <br>
	double angle brackets are broken by spaces "&lt; &lt;"  or with actual escapes <br>
	"&lt;\&lt;" even in doc chunks (and escape them in your code, too. "Notangle" <br>
	reacts to them NOT only at the beginning of the line, as my tangler does, <br>
	but everywhere and chokes if finds them.<br>
<p>
	<b> 2.  Note</b> that the built-in tangler </b> uses "noweb" markup, but it is <br>
	<i> more restrictive </i> in one sense: <b> all code chunks MUST end with "@"</b> <br>
	    <pre>&lt; &lt;name of chunk&gt; &gt;=
	    ......
	    @ </pre><br>
	Norman Ramsey's convention was: <i> you are allowed not to close the code chunk<br>
	with "@" if the next code chunk is coming right after it </i><br>
	</ul><br>
<p>
<p>
    So, when the script is invoked as "script.tangle" (which can be a link or a soft<br>
    link to something like "script.weave", it's "real" name), it will dump the source<br>
    to STDOUT, very convenient for development.<br>
<p>
    I usually move the root chunk &lt; &lt;*&gt; &gt; along inside the LIterate Source project<br>
    file and assign it to the test script or the part I am working on. The Literate Source<br>
    project file includes several actual source files usually. By the way, it's quite<br>
    nice to be able to keep all partial tests that you do before including those into<br>
    the target program all in one place, your common project file.<br>
<p>
    To tangle with more specific options, run "notangle" directly on your "mollified"<br>
    literate source file, e.g.<br>
    <pre>notangle -R my_root_chunk -L script.weave </pre><br>
<p>
    Later other modes of operation may be incorporated here.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('54');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('55');">
<font class='lnum'><i>(55)</i></font>&nbsp; Code: run pass-through or built-in tangler </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2240)</i></sub></font></a></legend></fieldset>
<p>
<div id="55" style="display:none">   
<ul>


<p>
    Passes the request to "notangle" from the "noweb" literate tools suite -<br>
    OR starts the built-in tangler chunks.<br>
<p>
    1. Pre-filtering needs to be done. E.g. "notangle" gets confused by double angle <br>
    brackets even when those are inside the document chunks.<br>
    Therefore I will simply cut out document chunks altogether and not pass them to the<br>
    tangler.<br>
<p>
    Test line (delete spaces to test): &lt; &lt; get it, choke on this, bastard &gt; &gt;<br>
    &lt; &lt; or this&gt; &gt;=<br>
	or even this<br>
    @<br>
<p>
<p>
<font class='lnum'>2257</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tangle me&gt;&gt;=</legend>
<font class='lnum'>2258</font>   
<font class='lnum'>2259</font>   TANGLE_ME:
<font class='lnum'>2260</font>   
<font class='lnum'>2261</font>   #open LITSOURCE, "&lt;$0";
<font class='lnum'>2262</font>   
<font class='lnum'>2263</font>     if ( $use_builtin_tangler ) {
<font class='lnum'>2264</font>   
<font class='lnum'>2265</font>       <font class='chunkref'>&lt;&lt;seek-peek tangler&gt;&gt</font>;
<font class='lnum'>2266</font>   
<font class='lnum'>2267</font>     } 
<font class='lnum'>2268</font>     else { # pass to "notangle" from "noweb" tools by Ramsey
<font class='lnum'>2269</font>   
<font class='lnum'>2270</font>       open TANGLE_PIPE, "| notangle -t4 -";
<font class='lnum'>2271</font>   
<font class='lnum'>2272</font>       while  (&lt;LITSOURCE&gt;) {
<font class='lnum'>2273</font>   
<font class='lnum'>2274</font>   	    if ( m!^&lt;\&lt;(.*)&gt;\&gt;=! ... m!^@\s*$! ) { # -- CODE CHUNKS ONLY -- 
<font class='lnum'>2275</font>   		print TANGLE_PIPE $_;
<font class='lnum'>2276</font>   	    }
<font class='lnum'>2277</font>   
<font class='lnum'>2278</font>       } # elihw
<font class='lnum'>2279</font>   
<font class='lnum'>2280</font>       close TANGLE_PIPE;
<font class='lnum'>2281</font>   
<font class='lnum'>2282</font>     } #; esle, pass-through clause end
<font class='lnum'>2283</font>   
<font class='lnum'>2284</font>   close LITSOURCE;
<font class='lnum'>2285</font>    exit;
<font class='lnum'>2286</font>   
<font class='lnum'>2287</font>   </fieldset></pre>
<p>
    <b> Speculative: Immediate execution of the script ? Do I need it?  </b><br>
    It did not work exactly, but then I did not try it for real -- if it is needed and if your<br>
    language supports taking input from STDIN, it may be possible also to immediately run your<br>
    script skipping the stage of "tangling-into-a-file" before running.<br>
    To be added (possibly).<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('55');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('56');">
<font class='lnum'><i>(56)</i></font>&nbsp; seek-peek tangler (working) </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2299)</i></sub></font></a></legend></fieldset>
<p>
<div id="56" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 56).className='hilited';
		    </script>   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('57');">
<font class='lnum'><i>(57)</i></font>&nbsp; Advantages, limitations; escapes; the algorithm </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2303)</i></sub></font></a></legend></fieldset>
<p>
<div id="57" style="display:none">   
<ul>


<p>
<b> Advantages, limitations and escapes </b><br>
<p>
(a) <s> The first version can only take care of one litprog chunk reference per line, and<br>
this ref cannot be surrounded by other text. </s><br>
Built-in tangler can handle multiple references per line surrounded by other text<br>
<p>
(b) However it does not clobber tabs, so you can tangle out Makefiles with it.<br>
<p>
(c) Built-in tangler insists on ending every code block with an explicit "@"<br>
("notangle" allows to drop them if the next chunk is code, too)<br>
<p>
(d) "notangle" by Ramsey is confused by &lt; &lt;  even inside documentation chunk, in any position.<br>
My default "pass-through" tangler filters those out and treats as "real" only the dbl-angle<br>
bracketed stuff <i> in the first position in its line </i><br>
<p>
This 'seek-peek' tangler also filters out all of documentation chunks and looks only for <br>
<b> dbl angles and the @ sign in the first position of the line </b><br>
<p>
(e) The used regexps ensure that if you have both opening and closing double brackets<br>
somewhere in your code, the S-P tangler will get screwed.<br>
This and the first-positioned symbols are the only escapes one needs to observe as<br>
far as I understand.<br>
<p>
(f) The S-P tangler only reads files on disk, two times actually. So for now at least<br>
you cannot pipe into it. (It works roughly 3 times faster though and can potentially<br>
work across several litsource files (not implemented yet))<br>
<p>
<b>The idea/algorithm is to:</b><br>
<p>
(a) run a first pass over the file collecting a list of <br>
	chunk offsets, or "addresses"<br>
<p>
(b) run a second pass recursively, already knowing where to read the<br>
	bits and pieces from . That's all there is to "tangling".<br>
<p>
(c) Filters could apply to some chunks for:<br>
	/weaving/<br>
	* feeding the text to a markdown lang<br>
	* cutting sth out for a math processor <br>
		(e.g. mimeTeX, or to ASCIIMathML.js)<br>
	/tangling/<br>
	* for conditional tangling of certain chunks<br>
	(e.g. those whose names start with DEBUG, negative<br>
	or the opposint, CLEAN, for a positive filtering)<br>
/none of the above are used now/	<br>
<p>
This type of tangler will not be able to get input via pipes,<br>
but - it should be fine working across <b>several literate source<br>
files</b>, the only requirement is that their chunk namespace should be<br>
flat (unique names across your whole project). <br>
It can be managed by prepending the chunk names by their file IDs, for<br>
example.<br>
/* command line option to get several files and their processing by the <br>
script are not implemented yet */<br>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('58');">
<font class='lnum'><i>(58)</i></font>&nbsp;Makefile for s.-p. tangler tests</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2363)</i></sub></font></a></legend></fieldset>
<p>
<div id="58" style="display:none">   
<ul>


<p>
a small informal test for now; to be expanded to:<br>
    - "make" --&gt; "help"<br>
    - "make target" -&gt; for tests, tangling out parts of the project etc<br>
<p>
<p>
<p>
<font class='lnum'>2372</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;seek-peek tangler Makefile&gt;&gt;=</legend>
<font class='lnum'>2373</font>   
<font class='lnum'>2374</font>   all: tangle  perl-check run compare
<font class='lnum'>2375</font>   #-
<font class='lnum'>2376</font>   
<font class='lnum'>2377</font>   tangle:
<font class='lnum'>2378</font>   	./zz-seek-peek.tangle &gt; zz.pl;
<font class='lnum'>2379</font>   #-
<font class='lnum'>2380</font>   
<font class='lnum'>2381</font>   perl-check:
<font class='lnum'>2382</font>   	perl -c zz.pl;
<font class='lnum'>2383</font>   #-
<font class='lnum'>2384</font>   
<font class='lnum'>2385</font>   
<font class='lnum'>2386</font>   run:
<font class='lnum'>2387</font>   	perl zz.pl zyy-test.litsource.txt &gt;test.out;
<font class='lnum'>2388</font>   #-	
<font class='lnum'>2389</font>   
<font class='lnum'>2390</font>   compare:
<font class='lnum'>2391</font>   		fldiff zyy-test.litsource.txt test.out;
<font class='lnum'>2392</font>   #-
<font class='lnum'>2393</font>   
<font class='lnum'>2394</font>    
<font class='lnum'>2395</font>   </fieldset></pre>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('58');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('59');">
<font class='lnum'><i>(59)</i></font>&nbsp;todo</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2401)</i></sub></font></a></legend></fieldset>
<p>
<div id="59" style="display:none">   
<ul>


<s> Now, the next step is to fix the trailing line with @<br>
<p>
<i> HOW: </i><br>
I'll "tell" on each line and use as my end-of-splinter address<br>
the one from the previous line (i.e. just before the last line, <br>
which contains the trailing rubbish).  </s> -- DONE<br>
<p>
<s> NEXT is many chunk refs on teh same line surrounded by other text/code </s><br>
--done--<br>
<p>
NEXT is command-line processing for tangling any given root<br>
<p>
NEXT is adding comments with line nums and offsets in teh original Lit Source<br>
into the tangled out code<br>
<p>
NEXT is "un-tangling", i.e. reimporting code, changed during testing back into<br>
LitSource (? possibly)<br>
<p>
NEXT possibly - processing over several files, which are mechanical splinters<br>
of the same Literate Project<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('59');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('57');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('60');">
<font class='lnum'><i>(60)</i></font>&nbsp;The code</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2429)</i></sub></font></a></legend></fieldset>
<p>
<div id="60" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 60).className='hilited';
		    </script>   
<ul>


<p>
<font class='lnum'>2432</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;seek-peek tangler&gt;&gt;=</legend>
<font class='lnum'>2433</font>   
<font class='lnum'>2434</font>   SEEK_PEEK_TANGLER:
<font class='lnum'>2435</font>   
<font class='lnum'>2436</font>   	<font class='chunkref'>&lt;&lt;pass 1&gt;&gt</font>;
<font class='lnum'>2437</font>   	<font class='chunkref'>&lt;&lt;pass 2 and print&gt;&gt</font>;
<font class='lnum'>2438</font>   	<font class='chunkref'>&lt;&lt;main: call the sub&gt;&gt</font>;
<font class='lnum'>2439</font>   
<font class='lnum'>2440</font>   close LITSOURCE;
<font class='lnum'>2441</font>   exit;
<font class='lnum'>2442</font>   
<font class='lnum'>2443</font>   </fieldset></pre>
<p>
"pass 1" "goes through the file collecting addresses.<br>
<p>
Then "pass 2" sets a recursive sub to "untangle" the chunks with<br>
their included references.<br>
<p>
The "main" sets the root chunk and calls the sub<br>
<p>
I'll ' add command-line and CGI arguments processing later.<br>
<p>
<font class='lnum'>2454</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main: call the sub&gt;&gt;=</legend>
<font class='lnum'>2455</font>   
<font class='lnum'>2456</font>   	#~ $root_chunk = "chunk 1";
<font class='lnum'>2457</font>   	#~ $root_chunk = "DEBUG print one reference";
<font class='lnum'>2458</font>   	$root_chunk = $root_chunk || "*";
<font class='lnum'>2459</font>   
<font class='lnum'>2460</font>   	print_chunk($root_chunk); 
<font class='lnum'>2461</font>   
<font class='lnum'>2462</font>   </fieldset></pre>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('61');">
<font class='lnum'><i>(61)</i></font>&nbsp; PAss 1 </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2466)</i></sub></font></a></legend></fieldset>
<p>
<div id="61" style="display:none">   
<ul>


<p>
declare and initialize some vars<br>
<p>
<font class='lnum'>2471</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;pass 1&gt;&gt;=</legend>
<font class='lnum'>2472</font>   
<font class='lnum'>2473</font>   	<font class='chunkref'>&lt;&lt;declarations and initializations&gt;&gt</font>;
<font class='lnum'>2474</font>   	<font class='chunkref'>&lt;&lt;while-loop and peek file ofsets&gt;&gt</font>;
<font class='lnum'>2475</font>   
<font class='lnum'>2476</font>   </fieldset></pre>
<p>
<font class='lnum'>2478</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;declarations and initializations&gt;&gt;=</legend>
<font class='lnum'>2479</font>   
<font class='lnum'>2480</font>       my $chunk_beg_pattern = q(^&lt;\&lt;(.*)&gt;\&gt;=);
<font class='lnum'>2481</font>       my $chunk_end_pattern = q(^@\s.*$);
<font class='lnum'>2482</font>       my $chunk_ref_pattern = q(&lt;\&lt;(.*?)&gt;\&gt;[^=]); # can be used several times in a line
<font class='lnum'>2483</font>   
<font class='lnum'>2484</font>       my $current_chunk_name = "";
<font class='lnum'>2485</font>   	my $current_chunk_start_foff = ""; # "foff" is a "file offset"
<font class='lnum'>2486</font>   	my %file_offsets_hash = ();
<font class='lnum'>2487</font>   	my %left_margin_hash = ();
<font class='lnum'>2488</font>   
<font class='lnum'>2489</font>       my $line_num = 0;
<font class='lnum'>2490</font>   	my $previous_line_foff = 0; # "foff" is a "file offset"
<font class='lnum'>2491</font>   
<font class='lnum'>2492</font>   </fieldset></pre>
<p>
<p>
<b>Main loop</b><br>
Need to collect chunk addresses (with "tell"), and keep <i> a hash of lists</i><br>
with addresses of all chunk continuations (if any)<br>
    <pre> (beg_offset, end_offset) </pre><br>
<p>
I'll need to push them in, and in pass 2 I'll iterate over them, <br>
and so ensure all of a split chunk is read.<br>
<p>
<b>Anyway,</b> to deal with references to chunks from inside chunks I <br>
will insert ("ref", "referred_chunk_name", left_indentation) into my <br>
    <pre>%file_offsets_hash </pre><br>
during the first pass. This pair is different from numeric beg-end offset pairs,<br>
and I'll start a recursive printout of the chunk referred to when I detect it.<br>
<p>
I'll need to keep "left margin", the indent for the reference as a next value<br>
in the list/array, so it is<br>
    <ul><li>pairs (beg_chunk_offset, end_chunk_offset) for regular chunks<br>
    </li><li> and a triple ("ref", name_of_referred_chnk, its_left_indent) for refs<br>
    </li></ul><br>
<p>
I might need to keep more information (e.g. "line numbers in the Literate Source),<br>
then those become quadruples and quintil.. whatever ;)<br>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('62');">
<font class='lnum'><i>(62)</i></font>&nbsp; Ref: perl operators </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2520)</i></sub></font></a></legend></fieldset>
<p>
<div id="62" style="display:none">   
<ul>


<p>
<b>---Perl operators----</b><br>
<p>
<b>pos</b><br>
<p>
<ul><br>
3253   while ( $string =~ m!\G(.*?)&lt;\&lt;(.*?)&gt;\&gt;!gs) {<br>
3254     <br>
3255     $off = length($2);<br>
3256     $position = pos($string);<br>
3257     #pos($string) = $position + $off;<br>
3258     print "\n\t---title---\n$2 of length $off at $position \n\t----after----\n$1\n========\n";<br>
3259   <br>
3260   }<br>
</ul><br>
<p>
<b>tell filehandle</b> (if omitted, the last file read)<br>
<p>
<b>seek FILEHANDLE,POSITION,WHENCE </b><br>
Sets FILEHANDLE's position, just like the fseek call of stdio . <br>
FILEHANDLE may be an expression whose value gives the name of the filehandle. <br>
The values for WHENCE are 0 to set the new position in bytes to POSITION,<br>
<p>
<b>read FROM_FILEHANDLE, IN_SCALAR_BUFER_VAR_OR_STREM, LENGTH_IN_BYTES_OR_CHARS</b><br>
There <b>may be problems</b> if FH is opened in non-bytes mode, or if some pragma is used<br>
<p>
-------------------<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('62');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('61');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('63');">
<font class='lnum'><i>(63)</i></font>&nbsp; Pass 1: main while-loop and foffs</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2555)</i></sub></font></a></legend></fieldset>
<p>
<div id="63" style="display:none">   
<ul>


<p>
<p>
<i> A loop over the doc starts here </i><br>
Process inside doc sections:<br>
<p>
<font class='lnum'>2562</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;while-loop and peek file ofsets&gt;&gt;=</legend>
<font class='lnum'>2563</font>   
<font class='lnum'>2564</font>    while (&lt;LITSOURCE&gt;) {
<font class='lnum'>2565</font>       $line_num++;
<font class='lnum'>2566</font>   
<font class='lnum'>2567</font>   	# --- CODE CHUNKS -- not inside documentation section
<font class='lnum'>2568</font>       if ( m!$chunk_beg_pattern! .. m!$chunk_end_pattern! ) {
<font class='lnum'>2569</font>   
<font class='lnum'>2570</font>   	<font class='chunkref'>&lt;&lt;chunk beginning&gt;&gt</font>;
<font class='lnum'>2571</font>   	<font class='chunkref'>&lt;&lt;chunk ending&gt;&gt</font>;
<font class='lnum'>2572</font>   	<font class='chunkref'>&lt;&lt;chunk reference&gt;&gt</font>;
<font class='lnum'>2573</font>   	<font class='chunkref'>&lt;&lt;chunk body&gt;&gt</font>;
<font class='lnum'>2574</font>   
<font class='lnum'>2575</font>   
<font class='lnum'>2576</font>       } #fi
<font class='lnum'>2577</font>   
<font class='lnum'>2578</font>   	$previous_line_foff = tell LITSOURCE;
<font class='lnum'>2579</font>   
<font class='lnum'>2580</font>     } #eliwh
<font class='lnum'>2581</font>   
<font class='lnum'>2582</font>   </fieldset></pre>
<p>
<b>A later adjustement, actually to rid of the last line trash</b><br>
    "tell" gives addr <i> at the end of the matched line</i> So,<br>
    I'll have to use <i> offset from the previous match</i> to<br>
    rid of the current line rubbish - this is what the last<br>
    var assignement in the loop is about.<br>
<p>
<p>
<b>First, the chunk body</b> <br>
It closes the "if" opened in "chunk beginning", The rest of then are<br>
"elsif" clauses. <br>
<p>
There's nothing to do here in pass 1; just here not to leave it<br>
implicit and hidden<br>
<p>
<font class='lnum'>2598</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk body&gt;&gt;=</legend>
<font class='lnum'>2599</font>   
<font class='lnum'>2600</font>       else { # chunk body
<font class='lnum'>2601</font>   
<font class='lnum'>2602</font>   	; # nop; here just not to hide an implicit case
<font class='lnum'>2603</font>   	#~ print "."; # debug: show dots for lines 
<font class='lnum'>2604</font>       }
<font class='lnum'>2605</font>   
<font class='lnum'>2606</font>   </fieldset></pre>
<p>
<p>
<b>Next, match for a first line of a new chunk</b> (which can continue<br>
some previous splinters of the same chunk in the LitSource file)<br>
<p>
If a chunk begins (or continues) here, <br>
	- set the current chunk name<br>
	-pick up its "peeked" offset in  the file <br>
	- and push it in the hash of f_offs under the current chunk name<br>
<p>
Hmm.. The perl "tell" gives the position after the read line, I understand.<br>
No adjustment is needed for the beginning chunk match, and it'll eliminate<br>
the title from the later output.<br>
<p>
<font class='lnum'>2621</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk beginning&gt;&gt;=</legend>
<font class='lnum'>2622</font>   
<font class='lnum'>2623</font>       if ( $_ =~ m!$chunk_beg_pattern! ) {
<font class='lnum'>2624</font>   	$current_chunk_name = $1;
<font class='lnum'>2625</font>   	$current_chunk_start_foff = tell LITSOURCE;
<font class='lnum'>2626</font>   
<font class='lnum'>2627</font>   	push @{$file_offsets_hash{$current_chunk_name}}, $current_chunk_start_foff;
<font class='lnum'>2628</font>   	#~ print "[***debug: I am chunk $1 -- I start at $current_chunk_start_foff***]\n";
<font class='lnum'>2629</font>   	#~ print "----&gt; chunk $1 line $. offset $current_chunk_start_foff\n";
<font class='lnum'>2630</font>   
<font class='lnum'>2631</font>       }
<font class='lnum'>2632</font>   
<font class='lnum'>2633</font>   </fieldset></pre>
<p>
<p>
<b>If a chunk ends,</b> peek its end offset in the file ("f_off") Actually, not to pick<br>
up the closing "at" signs, get the previous line's told offset.<br>
<p>
.. and push it in the hash of lists<br>
Plus - set $current_chunk_name=""; # just in case<br>
<p>
<font class='lnum'>2642</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk ending&gt;&gt;=</legend>
<font class='lnum'>2643</font>   
<font class='lnum'>2644</font>       elsif ( $_ =~ m!$chunk_end_pattern! )  {
<font class='lnum'>2645</font>   
<font class='lnum'>2646</font>   	$current_chunk_end_foff = $previous_line_foff;
<font class='lnum'>2647</font>   	push @{$file_offsets_hash{$current_chunk_name}}, $current_chunk_end_foff;
<font class='lnum'>2648</font>   	#~ print "[+++debug: $current_chunk_name ends at off $current_chunk_end_foff++++]\n\n";
<font class='lnum'>2649</font>   	#~ print "\tline $. offset $current_chunk_end_foff&lt;------\n";
<font class='lnum'>2650</font>   
<font class='lnum'>2651</font>       	$current_chunk_name = "";
<font class='lnum'>2652</font>       }
<font class='lnum'>2653</font>   
<font class='lnum'>2654</font>   </fieldset></pre>
<p>
<b>Ok, so we put the foffs  in the (beg, end) order</b>.<br>
Now, "pop" will get them in the pop1 -&gt; (end), then pop2 -&gt; beg order<br>
While  shift_first -&gt; beg, shift_second -&gt; end. This will be the right one<br>
for later tangling.<br>
<p>
<p>
<b>Now, the chunk refs </b><br>
<p>
If we get a reference, regex-split the line <br>
	- set the end offset of the current chunk<br>
	- push it in the hash of lists<br>
	- figure the offset after the chunk ref<br>
	- push it into the hash of lists using the current chunkname<br>
	- IMPORTANT COMPLICATION<br>
		deal with the case when several chunk refs on the same<br>
		line are present;<br>
		do <i>not</i> do it for the first version of the script.<br>
<p>
for many matches on a line - <br>
Here we'll have to match with continuation and repeat matching in a loop until the line <br>
with matches is exhausted.<br>
<p>
<font class='lnum'>2678</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk reference&gt;&gt;=</legend>
<font class='lnum'>2679</font>       <font class='chunkref'>&lt;&lt;chunk reference - multiref inside other text&gt;&gt</font>;
<font class='lnum'>2680</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('63');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('64');">
<font class='lnum'><i>(64)</i></font>&nbsp; multiple refs on the same line</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2685)</i></sub></font></a></legend></fieldset>
<p>
<div id="64" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 64).className='hilited';
		    </script>   
<ul>


<p>
<p>
<b> Multiple references on the same line surrounded by other text</b><br>
<p>
First, I'll need to change the regexp pattern:<br>
mm.. I probably needn't. I'll get to it on a normal regexp, and use the<br>
multiref regexp only within<br>
The "chunk_ref_pattern" is set to q(&lt;\&lt;(.*?)&gt;\&gt;[^=])<br>
<p>
So, if I got (one, first) reference using a normal regex,<br>
start iterating on this line using a multi-match regex.<br>
'The rest of the line' can be got right after the while{} loop.<br>
I'll need to subtract<br>
<s>"told offset" - "line length" + "pos-given offset".</s><br>
I have $previous_line_foff<br>
<p>
<i> NOTE: "pos" does not work intuitively, so I do not use it below </i><br>
<p>
I'll write out logic later, after I have tested and adjusted it enough<br>
<p>
<font class='lnum'>2707</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk reference - multiref inside other text&gt;&gt;=</legend>
<font class='lnum'>2708</font>   
<font class='lnum'>2709</font>    elsif ( $_ =~ m!$chunk_ref_pattern!g ) {
<font class='lnum'>2710</font>   
<font class='lnum'>2711</font>       my $line = $_;
<font class='lnum'>2712</font>       my $current_foff_pos =  $previous_line_foff;
<font class='lnum'>2713</font>       my $initial_margin = 0;
<font class='lnum'>2714</font>   	my $homegrown_pos = 0;
<font class='lnum'>2715</font>   
<font class='lnum'>2716</font>       while ($line =~ m!(.*?)&lt;\&lt;(.*?)&gt;\&gt;!g) {
<font class='lnum'>2717</font>   
<font class='lnum'>2718</font>   	# "end" of prev pair
<font class='lnum'>2719</font>   	push @{$file_offsets_hash{$current_chunk_name}}, 
<font class='lnum'>2720</font>   	    $current_foff_pos + (length $1); 
<font class='lnum'>2721</font>   
<font class='lnum'>2722</font>   	#-------deal with pushing ("ref", "chunkname") pair -----
<font class='lnum'>2723</font>   	# special id string for refs
<font class='lnum'>2724</font>   	push @{$file_offsets_hash{$current_chunk_name}}, "ref";
<font class='lnum'>2725</font>   	# name of reference
<font class='lnum'>2726</font>   	push @{$file_offsets_hash{$current_chunk_name}}, $2; 
<font class='lnum'>2727</font>   
<font class='lnum'>2728</font>   	# -- next a special entry for refs: (left_margin)
<font class='lnum'>2729</font>   	$initial_margin += (length $1);
<font class='lnum'>2730</font>   	push @{$file_offsets_hash{$current_chunk_name}}, $initial_margin; 
<font class='lnum'>2731</font>   
<font class='lnum'>2732</font>   	my $homegrown_pos = (length $1) + (length $2) + 2*(length "&lt;&gt;");
<font class='lnum'>2733</font>   	my $end_of_match_pos = $current_foff_pos + $homegrown_pos;
<font class='lnum'>2734</font>   
<font class='lnum'>2735</font>   	# "start" a new pair.. - ok, let's not use "pos" at all, if it fails
<font class='lnum'>2736</font>   	push @{$file_offsets_hash{$current_chunk_name}}, $end_of_match_pos;
<font class='lnum'>2737</font>   
<font class='lnum'>2738</font>   	#  I'll need to reset current_foff_pos to the pos
<font class='lnum'>2739</font>   	#   (or to the directly caclucalted offset, if I prefer that):
<font class='lnum'>2740</font>   	$current_foff_pos = $end_of_match_pos; 
<font class='lnum'>2741</font>   	$initial_margin += (length $2) + 2*( length "&lt;&gt;"); 	
<font class='lnum'>2742</font>   
<font class='lnum'>2743</font>       } # elihw
<font class='lnum'>2744</font>   
<font class='lnum'>2745</font>       # This is where chunk refs get an extra newline ?
<font class='lnum'>2746</font>   
<font class='lnum'>2747</font>    } # fisle
<font class='lnum'>2748</font>   
<font class='lnum'>2749</font>   </fieldset></pre>
<p>
 <b>This works.</b><br>
<p>
  Handles Ramsey's test progs <b>when those are cleaned of an annoying<br>
 irregularity in his notation</b>, i.e. when <b>all</b> prog chunks start<br>
 with title in dbl brackets and end with an "at" (exactly in the first<br>
 position on the line)<br>
<p>
<b> aligning printout</b><br>
Need to save left margin (here) and apply it in the sub print_chunk below<br>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('65');">
<font class='lnum'><i>(65)</i></font>&nbsp; first test: how to iterate over regex, using pos</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2763)</i></sub></font></a></legend></fieldset>
<p>
<div id="65" style="display:none">   
<ul>


<p>
<p>
This is a snippet showing how it can be treated:<br>
<p>
<pre>

#~ Nope, they use it inside "while" 
#~ OK, this is how it will work in the script:
#~ /the while loop is over the line that contained at least 
#~ one ref; the loop body includes pushes into the hash/

	$line = "asdfas asd &lt;&lt;qewrqw&gt;&gt; opiopiopi &lt;&lt;2345&gt;&gt; asdasdf";
	$llen = length $line;
	print "the original line:: [$line] -- of length $llen\n";


	while ($line =~ m!(.*?)&lt;&lt;(.*?)&gt;&gt;!g) {
		print "$1 -- $2\n";
		$ancor_off  = pos $line;

		print "ancor position is $ancor_off\n";
	}

	print "THE LAST PART IS  ", (substr $line, $ancor_off), "\n";

</pre><br>
<p>
And this is its output:<br>
<p>
<pre>
the original line:: [asdfas asd &lt;&lt;qewrqw&gt;&gt; opiopiopi &lt;&lt;2345&gt;&gt; asdasdf] -- of length 48
asdfas asd  -- qewrqw
ancor position is 21
 opiopiopi  -- 2345
ancor position is 40
THE LAST PART IS   asdasdf
</pre><br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('65');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('64');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('66');">
<font class='lnum'><i>(66)</i></font>&nbsp; pass 2 and print </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2808)</i></sub></font></a></legend></fieldset>
<p>
<div id="66" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 66).className='hilited';
		    </script>   
<ul>


<p>
OK, now we have a hash of pairs (beg_chunk_offset, end_chunk_offset) with triples <br>
("ref", "ref_chunkname", left_indent) interspersed where there were references included.<br>
    - start from the given root<br>
    - iterate over subchunks of a given chunk - beg_f_off, end_f_off<br>
    - print out the file verbatim<br>
    ...<br>
      IF there WAS a ref, RECURSE on the new chunk name<br>
<p>
That should be it<br>
<p>
<font class='lnum'>2821</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;pass 2 and print&gt;&gt;=</legend>
<font class='lnum'>2822</font>   	<font class='chunkref'>&lt;&lt;sub: tangle recursively - nondestructive&gt;&gt</font>;
<font class='lnum'>2823</font>   </fieldset></pre>
<p>
<p>
Now - the RECURSIVE PRINTOUT untangling from the default/given root.<br>
--seek, then "read" into some $buf, which then is printed--<br>
<p>
    (a) if the pair got from the hash of lists is digits, print out <br>
    (b) if the first is a specia string "ref", get the ref name from<br>
    the second item in the pair and go there recursively<br>
<p>
<p>
<font class='lnum'>2834</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;sub: tangle recursively - nondestructive&gt;&gt;=</legend>
<font class='lnum'>2835</font>   
<font class='lnum'>2836</font>   # USAGE: print_chunk(name_of_chunk, left_margin, print_newline_flag)
<font class='lnum'>2837</font>   
<font class='lnum'>2838</font>    sub print_chunk {
<font class='lnum'>2839</font>   
<font class='lnum'>2840</font>    #defaults just in case - naa, will just mask errors with call args 
<font class='lnum'>2841</font>    my $snippet_left_margin = 0;
<font class='lnum'>2842</font>    my $snippet_print_newline_flag = 1;
<font class='lnum'>2843</font>   
<font class='lnum'>2844</font>    (my $chunk_being_printed,
<font class='lnum'>2845</font>       my $snippet_left_margin, 
<font class='lnum'>2846</font>   	  my $snippet_print_newline_flag, @rest) = @_; 
<font class='lnum'>2847</font>   
<font class='lnum'>2848</font>   
<font class='lnum'>2849</font>    #~ print "\n---- printing chunk $chunk_being_printed --------\n";
<font class='lnum'>2850</font>    #~ print "DEBUG: got left.m. $snippet_left_margin nl. flag $snippet_print_newline_flag \n";
<font class='lnum'>2851</font>   
<font class='lnum'>2852</font>    # -- error mess. not to fail silently --
<font class='lnum'>2853</font>    unless ( defined $file_offsets_hash{$chunk_being_printed} ) {
<font class='lnum'>2854</font>       #print STDOUT "\t\nERROR: chunk $chunk_being_printed not found in file $ARGV[0]\n";
<font class='lnum'>2855</font>       print STDERR "\n\tERROR: chunk $chunk_being_printed not found in file $ARGV[0]\n\n";
<font class='lnum'>2856</font>    }
<font class='lnum'>2857</font>   
<font class='lnum'>2858</font>   
<font class='lnum'>2859</font>    # iterate over splinters of a chunk, which are foff pairs
<font class='lnum'>2860</font>    for ( my $iterate_foffs = 0;
<font class='lnum'>2861</font>   	    exists $file_offsets_hash{$chunk_being_printed}[$iterate_foffs];)
<font class='lnum'>2862</font>    {
<font class='lnum'>2863</font>   
<font class='lnum'>2864</font>       my $snippet_position =  $file_offsets_hash{$chunk_being_printed}[$iterate_foffs++];
<font class='lnum'>2865</font>       my $snippet_end = $file_offsets_hash{$chunk_being_printed}[$iterate_foffs++];
<font class='lnum'>2866</font>       #~ print "debug got: beg $snippet_position -- end $snippet_end\n";
<font class='lnum'>2867</font>   
<font class='lnum'>2868</font>       <font class='chunkref'>&lt;&lt;the meat&gt;&gt</font>;
<font class='lnum'>2869</font>   
<font class='lnum'>2870</font>    } # rof non-destructive
<font class='lnum'>2871</font>   	
<font class='lnum'>2872</font>        return 1;
<font class='lnum'>2873</font>       } # bus -- ends the recursive sub
<font class='lnum'>2874</font>   
<font class='lnum'>2875</font>   </fieldset></pre>
<p>
ok, if we got a chunk ref in our array of pairs, then the next entry after it is <br>
	(left_margin) <br>
(that is my nano-protocol here ;)  ). I use these numbers to keep the <br>
"printer state" before recursively calling this function for the referred <br>
chunk.<br>
<p>
<font class='lnum'>2883</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;the meat&gt;&gt;=</legend>
<font class='lnum'>2884</font>   
<font class='lnum'>2885</font>       if ($snippet_position eq "ref") {
<font class='lnum'>2886</font>   
<font class='lnum'>2887</font>   	my $snippet_left_margin_ref = 
<font class='lnum'>2888</font>       	    $file_offsets_hash{$chunk_being_printed}[$iterate_foffs++];
<font class='lnum'>2889</font>   	#~ print "DEBUG: got a ref $snippet_end here -- nl flag $snippet_print_newline_flag_ref\n";
<font class='lnum'>2890</font>   
<font class='lnum'>2891</font>   	# any call to a ref uncurs "print newline" flag of 0
<font class='lnum'>2892</font>   	print_chunk($snippet_end, $snippet_left_margin_ref, 0);
<font class='lnum'>2893</font>       
<font class='lnum'>2894</font>       }
<font class='lnum'>2895</font>   </fieldset></pre>
<p>
if the next data you got from your list is pairs of offsets (beg, end), <br>
print them out, observing (a) left margine this chunk is at, and<br>
(b) skipping newlines after a chunk (could be an in-lined ref) unless <br>
this chunk is last in the referring line.<br>
<p>
For that I'll have to keep "a printer state" wth two flags for (a) and (b).<br>
<p>
<font class='lnum'>2904</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;the meat&gt;&gt;=</legend>
<font class='lnum'>2905</font>       else { # .. print it here
<font class='lnum'>2906</font>   	seek LITSOURCE, $snippet_position,  0;
<font class='lnum'>2907</font>   	read LITSOURCE, $buffer_out, ($snippet_end - $snippet_position);
<font class='lnum'>2908</font>   
<font class='lnum'>2909</font>   	#----Newlines at the end of chunks and refs. 
<font class='lnum'>2910</font>   	# only for the last splinter of a chunk, do newline control:
<font class='lnum'>2911</font>   	if ( ((scalar @{$file_offsets_hash{$chunk_being_printed}}) - $iterate_foffs ) == 0 )
<font class='lnum'>2912</font>   	{ 
<font class='lnum'>2913</font>   		# works, but is suspicious logically:
<font class='lnum'>2914</font>   		# maybe I just have not invented a counterexample yet, and
<font class='lnum'>2915</font>   		# it's a trap waiting for its quarry
<font class='lnum'>2916</font>   		$buffer_out =~ s!\n([\s]*)$!$1! unless ($snippet_print_newline_flag);
<font class='lnum'>2917</font>   	}
<font class='lnum'>2918</font>   
<font class='lnum'>2919</font>   	#----Left indent/margin. Seems OK
<font class='lnum'>2920</font>   
<font class='lnum'>2921</font>   	$chunk_left_margin = " " x $snippet_left_margin;
<font class='lnum'>2922</font>   	$buffer_out =~ s!(\n)!$1$chunk_left_margin!sg;
<font class='lnum'>2923</font>   
<font class='lnum'>2924</font>   	print $buffer_out;
<font class='lnum'>2925</font>       }
<font class='lnum'>2926</font>   
<font class='lnum'>2927</font>   </fieldset></pre>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('67');">
<font class='lnum'><i>(67)</i></font>&nbsp; two debug chunks</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2931)</i></sub></font></a></legend></fieldset>
<p>
<div id="67" style="display:none">   
<ul>


<p>
<p>
<font class='lnum'>2935</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;DEBUG print out full hash&gt;&gt;=</legend>
<font class='lnum'>2936</font>   
<font class='lnum'>2937</font>   	for $k (keys %file_offsets_hash) {
<font class='lnum'>2938</font>   		#~ print @{$file_offsets_hash{$k}}, "\n";
<font class='lnum'>2939</font>   
<font class='lnum'>2940</font>   	 while (scalar @{$file_offsets_hash{$k}}){
<font class='lnum'>2941</font>   		print "beg $k foff - ", shift @{$file_offsets_hash{$k}};
<font class='lnum'>2942</font>   		print " -- end foff - ", shift @{$file_offsets_hash{$k}}, "\n";
<font class='lnum'>2943</font>   		}
<font class='lnum'>2944</font>   	}
<font class='lnum'>2945</font>   </fieldset></pre>
<p>
<font class='lnum'>2947</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;DEBUG check hash keys&gt;&gt;=</legend>
<font class='lnum'>2948</font>   
<font class='lnum'>2949</font>    #~ for $k (keys  %file_offsets_hash){
<font class='lnum'>2950</font>   	#~ print $k, "\n";
<font class='lnum'>2951</font>   	#~ }
<font class='lnum'>2952</font>   
<font class='lnum'>2953</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
/* end of tangler part of script in the litsource file */<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('67');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('66');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('60');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('56');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('53');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('68');">
<font class='lnum'><i>(68)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2969)</i></sub></font></a></legend></fieldset>
<p>
<div id="68" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('68');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('69');">
<font class='lnum'><i>(69)</i></font>&nbsp; WEAVER </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2972)</i></sub></font></a></legend></fieldset>
<p>
<div id="69" style="display:none">   
<ul>


<p>
<p>
The idea of the weaver is simple, again.<br>
<p>
<font class='lnum'>2978</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;weave me&gt;&gt;=</legend>
<font class='lnum'>2979</font>   
<font class='lnum'>2980</font>   
<font class='lnum'>2981</font>   WEAVE_ME:
<font class='lnum'>2982</font>   
<font class='lnum'>2983</font>   #1. Set formatting strings for weaver
<font class='lnum'>2984</font>   <font class='chunkref'>&lt;&lt;set formatting strings for weaver&gt;&gt</font>;
<font class='lnum'>2985</font>   
<font class='lnum'>2986</font>   #2. accumulate result in a buffer
<font class='lnum'>2987</font>   <font class='chunkref'>&lt;&lt;accumulate result in a buffer&gt;&gt</font>;
<font class='lnum'>2988</font>   
<font class='lnum'>2989</font>   #3. print out the TOC, the Chunks Index, the output buffer and close the page.
<font class='lnum'>2990</font>   <font class='chunkref'>&lt;&lt;print out&gt;&gt</font>;
<font class='lnum'>2991</font>   
<font class='lnum'>2992</font>   close LITSOURCE;
<font class='lnum'>2993</font>   exit;
<font class='lnum'>2994</font>   
<font class='lnum'>2995</font>   </fieldset></pre>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('70');">
<font class='lnum'><i>(70)</i></font>&nbsp; How formatting is done in the weaver </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2999)</i></sub></font></a></legend></fieldset>
<p>
<div id="70" style="display:none">   
<ul>


<p>
<b>1 The first formatting element </b>  that is  part of the <i> function </i> of the script<br>
rather than formatting decorations is the<br>
<pre> frameset - legend - /legend - /frameset </pre><br>
which create the distinctive look of the documents generated by MOLLY. I do not wish to<br>
change them (although strictly speaking they are not obligatory).<br>
<p>
What can be changed is the Stylesheet (a part of the script, it has its own subsection), so<br>
other people could play with fonts and colors and margins and such by throwing in a simple<br>
switch and copying their alternative stylesheet into the script.<br>
<p>
I do not wish to use external files for any configuration, as the whole idea of MOLLY is to<br>
be a single self-contained script, which does not require any "installation" of many files to<br>
many places.<br>
<p>
<b>2  Secondly,</b> the "actual working test.html" subsection below probably explains best how<br>
<b> text folding and background highlighting </b> which is tied to it (i.e. a TOC click will open the <br>
section + highlight; and click on the section in the body of the doc will toggle it + highlight <br>
the TOC line ) work.<br>
<p>
Actual implementation is spread between several subsections - they are<br>
coded in in the hard way, as I do not expect them to change ever, they are a functional element<br>
not a changeable "skin" or decoration.<br>
<ul><li> vars, JS and styles are set in the weaver "set formatting strings for weaver" subsections;<br>
</li><li> invocations can be seen in "accumulate the result", esp in the "section headings"<br>
</li><li> and more are applied in the "print out the result"<br>
</li></ul><br>
<p>
Some of the vars are set to pieces of formatting strings in the beginning, and later variables<br>
in them are interpolated with "executable" regexs ( the "e" flag at the end of the regex) - see <br>
"process section headings"<br>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('71');">
<font class='lnum'><i>(71)</i></font>&nbsp; actual working test.html </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3035)</i></sub></font></a></legend></fieldset>
<p>
<div id="71" style="display:none">   
<ul>


<p>
Here's the actual script that was used to test the JS folding and<br>
tying of folding to the TOC section highlighting:<br>
<p>
<p>
<font class='lnum'>3042</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;test.html&gt;&gt;=</legend>
<font class='lnum'>3043</font>   
<font class='lnum'>3044</font>   &lt;html&gt;
<font class='lnum'>3045</font>   &lt;head&gt;
<font class='lnum'>3046</font>   
<font class='lnum'>3047</font>   
<font class='lnum'>3048</font>   &lt;style type="text/css"&gt;
<font class='lnum'>3049</font>   
<font class='lnum'>3050</font>   
<font class='lnum'>3051</font>   .unhilited {background-color:white}
<font class='lnum'>3052</font>   .hilited {background-color:yellow; text-decoration:underline}
<font class='lnum'>3053</font>   &lt;/style&gt;
<font class='lnum'>3054</font>   
<font class='lnum'>3055</font>   
<font class='lnum'>3056</font>   &lt;script type="text/javascript"&gt;
<font class='lnum'>3057</font>   
<font class='lnum'>3058</font>       function setHilite(evt) {
<font class='lnum'>3059</font>   	evt = (evt) ? evt : ((window.event) ? window.event : null);
<font class='lnum'>3060</font>   	if (evt) {
<font class='lnum'>3061</font>   	    var elem = (evt.srcElement) ? evt.srcElement : evt.target;
<font class='lnum'>3062</font>   	    elem.className = "hilited";
<font class='lnum'>3063</font>   	}
<font class='lnum'>3064</font>       }
<font class='lnum'>3065</font>   
<font class='lnum'>3066</font>   
<font class='lnum'>3067</font>   function setUnHilite(evt) {
<font class='lnum'>3068</font>       evt = (evt) ? evt : ((window.event) ? window.event : null);
<font class='lnum'>3069</font>   	if (evt) {
<font class='lnum'>3070</font>       	    var elem = (evt.srcElement) ? evt.srcElement : evt.target;
<font class='lnum'>3071</font>       	    elem.className = "unhilited";
<font class='lnum'>3072</font>   	}
<font class='lnum'>3073</font>   }
<font class='lnum'>3074</font>   
<font class='lnum'>3075</font>   function toggleDiv(divid) {
<font class='lnum'>3076</font>   var el = document.getElementById(divid);
<font class='lnum'>3077</font>   el.style.display = (el.style.display == 'block') ? 'none' : 'block';
<font class='lnum'>3078</font>   }
<font class='lnum'>3079</font>   
<font class='lnum'>3080</font>   function toggleCombined(divid){
<font class='lnum'>3081</font>       if(document.getElementById(divid).style.display == 'none'){
<font class='lnum'>3082</font>         document.getElementById(divid).style.display = 'block';
<font class='lnum'>3083</font>   	document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>3084</font>       }
<font class='lnum'>3085</font>       
<font class='lnum'>3086</font>       else{
<font class='lnum'>3087</font>         document.getElementById(divid).style.display = 'none';
<font class='lnum'>3088</font>   	document.getElementById("toc"+divid).className="unhilited";
<font class='lnum'>3089</font>       }
<font class='lnum'>3090</font>   }
<font class='lnum'>3091</font>   
<font class='lnum'>3092</font>   
<font class='lnum'>3093</font>   function expandDiv(divid){
<font class='lnum'>3094</font>   	document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>3095</font>   }
<font class='lnum'>3096</font>   
<font class='lnum'>3097</font>   
<font class='lnum'>3098</font>   
<font class='lnum'>3099</font>   &lt;/script&gt;
<font class='lnum'>3100</font>   &lt;/head&gt;
<font class='lnum'>3101</font>   
<font class='lnum'>3102</font>   &lt;body &gt;
<font class='lnum'>3103</font>   &lt;h2&gt;Here's the tested element&lt;/h2&gt;
<font class='lnum'>3104</font>   Here is some ordinary text&lt;br&gt;
<font class='lnum'>3105</font>   &lt;span class="unhilited" onmouseover="setHilite(event)" 
<font class='lnum'>3106</font>       onmouseout="setUnHilite(event)"&gt; 
<font class='lnum'>3107</font>       &lt;a href="javascript:;" onmousedown="toggleDiv(15);"&gt;&lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>3108</font>       and this is some potentially hot spot text.&lt;/span&gt;
<font class='lnum'>3109</font>   
<font class='lnum'>3110</font>   &lt;div id=15&gt;
<font class='lnum'>3111</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>3112</font>       that should be hidden/collapsed
<font class='lnum'>3113</font>   
<font class='lnum'>3114</font>   &lt;/div&gt;
<font class='lnum'>3115</font>   
<font class='lnum'>3116</font>   
<font class='lnum'>3117</font>   &lt;h2&gt;Here's the tested element 0&lt;/h2&gt;
<font class='lnum'>3118</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>3119</font>   &lt;a href="javascript:;" onmousedown="toggleCombined(13);" id="toc13"&gt;
<font class='lnum'>3120</font>       &lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>3121</font>   
<font class='lnum'>3122</font>   &lt;div id=13 &gt;&lt;script language=javascript&gt; document.getElementById("toc"+13).className='hilited';&lt;/script&gt;
<font class='lnum'>3123</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>3124</font>       that should be hidden/collapsed
<font class='lnum'>3125</font>   
<font class='lnum'>3126</font>   &lt;/div&gt;
<font class='lnum'>3127</font>   
<font class='lnum'>3128</font>   
<font class='lnum'>3129</font>   
<font class='lnum'>3130</font>   
<font class='lnum'>3131</font>   &lt;h2&gt;Here's the tested element 1&lt;/h2&gt;
<font class='lnum'>3132</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>3133</font>   &lt;a href="javascript:;" onmousedown="toggleCombined(14);" id="toc14"&gt;
<font class='lnum'>3134</font>       &lt;script language=javascript&gt; document.getElementById("toc"+14).className='hilited';&lt;/script&gt;
<font class='lnum'>3135</font>       &lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>3136</font>   
<font class='lnum'>3137</font>   &lt;div id=14 &gt;
<font class='lnum'>3138</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>3139</font>       that should be hidden/collapsed
<font class='lnum'>3140</font>   
<font class='lnum'>3141</font>   &lt;/div&gt;
<font class='lnum'>3142</font>   
<font class='lnum'>3143</font>   
<font class='lnum'>3144</font>   &lt;h2&gt;Here's the tested element 2&lt;/h2&gt;
<font class='lnum'>3145</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>3146</font>   &lt;span  id="toc16"&gt; 
<font class='lnum'>3147</font>       &lt;a href="javascript:;" onmousedown="toggleCombined(16);"&gt;&lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>3148</font>       and this is some potentially hot spot text.&lt;/span&gt;
<font class='lnum'>3149</font>   
<font class='lnum'>3150</font>   &lt;div id=16&gt;
<font class='lnum'>3151</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>3152</font>       that should be hidden/collapsed
<font class='lnum'>3153</font>   
<font class='lnum'>3154</font>   &lt;/div&gt;
<font class='lnum'>3155</font>   
<font class='lnum'>3156</font>   
<font class='lnum'>3157</font>   
<font class='lnum'>3158</font>   &lt;/body&gt;
<font class='lnum'>3159</font>   &lt;/html&gt;
<font class='lnum'>3160</font>   
<font class='lnum'>3161</font>   </fieldset></pre>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('71');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('72');">
<font class='lnum'><i>(72)</i></font>&nbsp; changing text style - the basic JS recipy </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3167)</i></sub></font></a></legend></fieldset>
<p>
<div id="72" style="display:none">   
<ul>


<p>
I used this snippet for a start then reworked it into the "working test script" below.<br>
<p>
<ul> <pre>
11.8.2 Solution
First, define two style sheet rules, each with a different class selector. Then design 
an event handler for the element to change the element's className property to the desired 
class selector's identifier: 

		&lt;style type="text/css"&gt;
		.unhilited {background-color:white}
		.hilited {background-color:yellow; text-decoration:underline}
		&lt;/style&gt;
		...
		&lt;script type="text/javascript"&gt;
		function setHilite(evt) {
			evt = (evt) ? evt : ((window.event) ? window.event : null);
			if (evt) {
				var elem = (evt.srcElement) ? evt.srcElement : evt.target;
				elem.className = "hilited";
			}
		}
		function setUnHilite(evt) {
			evt = (evt) ? evt : ((window.event) ? window.event : null);
			if (evt) {
				var elem = (evt.srcElement) ? evt.srcElement : evt.target;
				elem.className = "unhilited";
			}
		}
		...
		&lt;span class="unhilited" onmouseover="setHilite(event)" 
			onmouseout="setUnHilite(event)"&gt;Some potentially hot spot text.&lt;/span&gt;

Adjusting the className property of an element as shown here is a more stable approach 
for early versions of Netscape 6 instead of manipulating styleSheet objects and their 
properties. It is perhaps the most widely used and supported way to implement dynamic styles. 
</pre> </ul><br>
<p>
If I enclose one "onmousedown" inside another, JScript will most probably not pass it into the inner one.<br>
So I should add:<br>
(a) the TOC line IDs ?? Like "toc.1", "toc.2" etc<br>
(b) keep a separate func, not "toggleDiv", but something else like "toggleTOCandDIV", and run 2 things<br>
from there ??<br>
<p>
<b> So, 2 tests: enclosing and if not, then rewriting the collapsing JS func </b><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('72');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('73');">
<font class='lnum'><i>(73)</i></font>&nbsp; Reference - Javascript and DOM </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3218)</i></sub></font></a></legend></fieldset>
<p>
<div id="73" style="display:none">   
<ul>


<p>
<p>
I'll need some javascript and DOM reference for further work;<br>
<p>
a/ http://w3schools.com/htmldom/dom_reference.asp  -- ref from W3C<br>
b/ http://w3schools.com/htmldom/default.asp -- might also be useful<br>
c/ http://www.howtocreate.co.uk/tutorials/javascript/domcss --javascript tutorial (not necessarily best) <br>
d/ http://www.pageresource.com/dhtml/ryan/part4-1.html - another tutorial<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('73');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('70');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('74');">
<font class='lnum'><i>(74)</i></font>&nbsp; set formatting strings for weaver </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3234)</i></sub></font></a></legend></fieldset>
<p>
<div id="74" style="display:none">   
<ul>


<p>
<font class='lnum'>3237</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;set formatting strings for weaver&gt;&gt;=</legend>
<font class='lnum'>3238</font>   
<font class='lnum'>3239</font>     #----SETTING FORMATTING STRINGS-----------
<font class='lnum'>3240</font>     
<font class='lnum'>3241</font>   $html_head = &lt;&lt;head_end_1;  
<font class='lnum'>3242</font>   
<font class='lnum'>3243</font>   &lt;head&gt;
<font class='lnum'>3244</font>   &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt; 
<font class='lnum'>3245</font>   
<font class='lnum'>3246</font>   head_end_1
<font class='lnum'>3247</font>   
<font class='lnum'>3248</font>   #switch on ASCIIMathML.js library if enabled in template options:
<font class='lnum'>3249</font>   if ($enable_ASCIIMathML) {
<font class='lnum'>3250</font>   $html_head .= "\n" . qq(&lt;script type="text/javascript" src="$path_to_ASCIIMathML"&gt;&lt;/script&gt;) . "\n";
<font class='lnum'>3251</font>       }
<font class='lnum'>3252</font>   
<font class='lnum'>3253</font>   $html_head .= &lt;&lt;head_end;
<font class='lnum'>3254</font>   
<font class='lnum'>3255</font>   <font class='chunkref'>&lt;&lt;JS script functions&gt;&gt</font>;
<font class='lnum'>3256</font>   <font class='chunkref'>&lt;&lt;stylesheet&gt;&gt</font>;
<font class='lnum'>3257</font>   
<font class='lnum'>3258</font>   &lt;/head&gt;
<font class='lnum'>3259</font>   head_end
<font class='lnum'>3260</font>   
<font class='lnum'>3261</font>   $html_body_table = "&lt;center&gt;&lt;table class='outertable'&gt;&lt;tr&gt;&lt;td&gt;";
<font class='lnum'>3262</font>   $html_body_table_end = "\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;\n";
<font class='lnum'>3263</font>   
<font class='lnum'>3264</font>   
<font class='lnum'>3265</font>   	
<font class='lnum'>3266</font>   
<font class='lnum'>3267</font>   $folding_section_start1_str = &lt;&lt;'fold_sect_start_1_xxx';
<font class='lnum'>3268</font>   	&lt;fieldset&gt;&lt;legend&gt;&lt;a href="javascript:;" onmousedown="toggleCombined('$section_num');"&gt;
<font class='lnum'>3269</font>   fold_sect_start_1_xxx
<font class='lnum'>3270</font>   
<font class='lnum'>3271</font>   
<font class='lnum'>3272</font>   $folding_section_start2_str = &lt;&lt;'fold_sect_start_2_xxx';
<font class='lnum'>3273</font>   &lt;/a&gt;&lt;/legend&gt;&lt;/fieldset&gt;
<font class='lnum'>3274</font>   &lt;p&gt;
<font class='lnum'>3275</font>   &lt;div id="$section_num" style="display:$fold_state"&gt; $highlight_state  
<font class='lnum'>3276</font>   &lt;ul&gt;
<font class='lnum'>3277</font>   
<font class='lnum'>3278</font>   fold_sect_start_2_xxx
<font class='lnum'>3279</font>   
<font class='lnum'>3280</font>   
<font class='lnum'>3281</font>   $folding_section_end_str = &lt;&lt;'folding_section_end_xxx';
<font class='lnum'>3282</font>   &lt;/ul&gt;
<font class='lnum'>3283</font>   &lt;p&gt;
<font class='lnum'>3284</font>   &lt;br&gt;
<font class='lnum'>3285</font>   &lt;i&gt;&lt;font size=-1&gt;
<font class='lnum'>3286</font>   &lt;a href="javascript:;"onmousedown="toggleCombined('$section_num_prev');"&gt;
<font class='lnum'>3287</font>   Close the subsection&lt;/a&gt;&lt;/font&gt;
<font class='lnum'>3288</font>   &lt;/i&gt; -- &lt;i&gt;&lt;font size=-1&gt;
<font class='lnum'>3289</font>   &lt;a href="javascript:;" onmousedown="showAll();"&gt;
<font class='lnum'>3290</font>   expand all&lt;/a&gt; -- 
<font class='lnum'>3291</font>   &lt;a href="javascript:;" onmousedown="hideAll();"&gt;
<font class='lnum'>3292</font>   collapse all&lt;/a&gt;
<font class='lnum'>3293</font>   &lt;/font&gt;&lt;/i&gt;
<font class='lnum'>3294</font>   
<font class='lnum'>3295</font>   &lt;p&gt;
<font class='lnum'>3296</font>   &lt;/div&gt;
<font class='lnum'>3297</font>   
<font class='lnum'>3298</font>   folding_section_end_xxx
<font class='lnum'>3299</font>   
<font class='lnum'>3300</font>   
<font class='lnum'>3301</font>   $code_frameset_start_pre = "&lt;pre&gt;&lt;fieldset class='codefieldset'&gt;&lt;legend class='codelegend'&gt;";
<font class='lnum'>3302</font>   $code_frameset_start_post = "=&lt;/legend&gt;";
<font class='lnum'>3303</font>   $code_frameset_end = "&lt;/fieldset&gt;&lt;/pre&gt;\n";
<font class='lnum'>3304</font>   
<font class='lnum'>3305</font>   
<font class='lnum'>3306</font>   
<font class='lnum'>3307</font>   
<font class='lnum'>3308</font>   </fieldset></pre>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('75');">
<font class='lnum'><i>(75)</i></font>&nbsp; JS functions </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3311)</i></sub></font></a></legend></fieldset>
<p>
<div id="75" style="display:none">   
<ul>


<p>
In my attempts to insert ASCIIMathML.js, I have tried some variations of<br>
math sections markup (with "a m a t h" -- "e n d a m a t h" words and<br>
with backquotes) -- but the stinking lib insists on garbling my file, as<br>
sth triggers it on earlier.<br>
<p>
So a next step is to change regexps inside the Javascript lib and forse it<br>
to sane markups. Probably by adding ancoring the key word to the beginning<br>
of the line and/or insisting that it is there alone.<br>
<p>
<font class='lnum'>3323</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;JS script functions&gt;&gt;=</legend>
<font class='lnum'>3324</font>   
<font class='lnum'>3325</font>   &lt;script language="javascript"&gt;
<font class='lnum'>3326</font>   
<font class='lnum'>3327</font>   function toggleDiv(divid) {
<font class='lnum'>3328</font>   var el = document.getElementById(divid);
<font class='lnum'>3329</font>   el.style.display = (el.style.display == 'block') ? 'none' : 'block';
<font class='lnum'>3330</font>   }
<font class='lnum'>3331</font>   
<font class='lnum'>3332</font>   
<font class='lnum'>3333</font>   function toggleCombined(divid){
<font class='lnum'>3334</font>       if(document.getElementById(divid).style.display == 'none'){
<font class='lnum'>3335</font>         document.getElementById(divid).style.display = 'block';
<font class='lnum'>3336</font>   	document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>3337</font>       }
<font class='lnum'>3338</font>       else{
<font class='lnum'>3339</font>         document.getElementById(divid).style.display = 'none';
<font class='lnum'>3340</font>   	document.getElementById("toc"+divid).className="unhilited";
<font class='lnum'>3341</font>       }
<font class='lnum'>3342</font>   }
<font class='lnum'>3343</font>   
<font class='lnum'>3344</font>   
<font class='lnum'>3345</font>   function showAll(){
<font class='lnum'>3346</font>   for(i=1; i &lt;= 10000; i++){
<font class='lnum'>3347</font>       document.getElementById(i).style.display = 'block';
<font class='lnum'>3348</font>       document.getElementById("toc"+i).className="hilited";
<font class='lnum'>3349</font>       };
<font class='lnum'>3350</font>   }
<font class='lnum'>3351</font>   
<font class='lnum'>3352</font>   function hideAll(){
<font class='lnum'>3353</font>   for(i=1; i &lt;= 10000; i++){
<font class='lnum'>3354</font>       document.getElementById(i).style.display = 'none';
<font class='lnum'>3355</font>       document.getElementById("toc"+i).className="unhilited";
<font class='lnum'>3356</font>       };
<font class='lnum'>3357</font>   }
<font class='lnum'>3358</font>   
<font class='lnum'>3359</font>   &lt;/script&gt;
<font class='lnum'>3360</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('75');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('76');">
<font class='lnum'><i>(76)</i></font>&nbsp; Stylesheet </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3365)</i></sub></font></a></legend></fieldset>
<p>
<div id="76" style="display:none">   
<ul>


<p>
<font class='lnum'>3368</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;stylesheet&gt;&gt;=</legend>
<font class='lnum'>3369</font>   &lt;style type="text/css" media="screen"&gt;
<font class='lnum'>3370</font>   
<font class='lnum'>3371</font>   
<font class='lnum'>3372</font>   BODY {
<font class='lnum'>3373</font>   	FONT-SIZE: 10pt;
<font class='lnum'>3374</font>   	&lt;!--FONT-FAMILY: sans-serif --&gt;
<font class='lnum'>3375</font>   	background: #f0f0f0;
<font class='lnum'>3376</font>   	}
<font class='lnum'>3377</font>   FIELDSET {
<font class='lnum'>3378</font>   	BORDER-RIGHT: #000000 1px solid; 
<font class='lnum'>3379</font>   	BORDER-TOP: #000000 1px solid; 
<font class='lnum'>3380</font>   	BORDER-LEFT: #000000 1px solid; 
<font class='lnum'>3381</font>   	BORDER-BOTTOM: #000000 1px solid; 
<font class='lnum'>3382</font>   	PADDING-RIGHT: 5px; 
<font class='lnum'>3383</font>   	PADDING-LEFT: 5px; 
<font class='lnum'>3384</font>   	PADDING-BOTTOM: 2px; 
<font class='lnum'>3385</font>   	PADDING-TOP: 5px;
<font class='lnum'>3386</font>   	MARGIN-BOTTOM: 1px; 
<font class='lnum'>3387</font>   	background: #f5f5f5; 
<font class='lnum'>3388</font>   	color: #000000;
<font class='lnum'>3389</font>   	}
<font class='lnum'>3390</font>   LEGEND {
<font class='lnum'>3391</font>   	BORDER-RIGHT: #a9a9a9 1px solid; 
<font class='lnum'>3392</font>   	BORDER-BOTTOM: #a9a9a9 1px solid;
<font class='lnum'>3393</font>   	BORDER-TOP: #a9a9a9 1px solid; 
<font class='lnum'>3394</font>   	BORDER-LEFT: #a9a9a9 1px solid; 
<font class='lnum'>3395</font>   	PADDING-RIGHT: 20px; 
<font class='lnum'>3396</font>   	PADDING-LEFT: 20px; 
<font class='lnum'>3397</font>   	PADDING-BOTTOM: 5px; 
<font class='lnum'>3398</font>   	PADDING-TOP: 5px; 
<font class='lnum'>3399</font>   	FONT-WEIGHT: bold;  
<font class='lnum'>3400</font>   	BACKGROUND: #fdfdfd; 
<font class='lnum'>3401</font>   	color: #000000;
<font class='lnum'>3402</font>   	}
<font class='lnum'>3403</font>   PRE	{
<font class='lnum'>3404</font>           PADDING-LEFT: 20px; 
<font class='lnum'>3405</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>3406</font>           padding-top: 0px; 
<font class='lnum'>3407</font>           padding-bottom: 6px;
<font class='lnum'>3408</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>3409</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>3410</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>3411</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>3412</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>3413</font>   	background: #fefefe;
<font class='lnum'>3414</font>   	}
<font class='lnum'>3415</font>   
<font class='lnum'>3416</font>   
<font class='lnum'>3417</font>   .tocfieldset {
<font class='lnum'>3418</font>   	background: #ffffff; 
<font class='lnum'>3419</font>   	color: #000000;
<font class='lnum'>3420</font>   	}
<font class='lnum'>3421</font>   
<font class='lnum'>3422</font>   .codefieldset {
<font class='lnum'>3423</font>   	BORDER-RIGHT: #000 1px solid; 
<font class='lnum'>3424</font>   	BORDER-TOP: #000 1px solid; 
<font class='lnum'>3425</font>   	BORDER-LEFT: #000 1px solid; 
<font class='lnum'>3426</font>   	BORDER-BOTTOM: #000 1px solid; 
<font class='lnum'>3427</font>   	background: #ffffff; 
<font class='lnum'>3428</font>   	color: #000;
<font class='lnum'>3429</font>   	MARGIN-BOTTOM: 1px; 
<font class='lnum'>3430</font>   	PADDING-LEFT: 15px; 
<font class='lnum'>3431</font>   	PADDING-RIGHT: 5px; 
<font class='lnum'>3432</font>   	PADDING-BOTTOM: 10px; 
<font class='lnum'>3433</font>   	PADDING-TOP: 1px;
<font class='lnum'>3434</font>   	}
<font class='lnum'>3435</font>   .codelegend {
<font class='lnum'>3436</font>   	BORDER-RIGHT: #777 1px solid; 
<font class='lnum'>3437</font>   	BORDER-TOP: #777 1px solid; 
<font class='lnum'>3438</font>   	BORDER-LEFT: #777 1px solid; 
<font class='lnum'>3439</font>   	BORDER-BOTTOM: #777 1px solid
<font class='lnum'>3440</font>   	PADDING-RIGHT: 10px; 
<font class='lnum'>3441</font>   	PADDING-LEFT: 10px; 
<font class='lnum'>3442</font>   	PADDING-TOP: 2px; 
<font class='lnum'>3443</font>   	PADDING-BOTTOM: 2px; 
<font class='lnum'>3444</font>   	background: #ffffff; 
<font class='lnum'>3445</font>   	color: #00b;
<font class='lnum'>3446</font>   	FONT-WEIGHT: bold;  
<font class='lnum'>3447</font>   	/font-variant: small-caps;
<font class='lnum'>3448</font>   	/font-style: italic;
<font class='lnum'>3449</font>   	}
<font class='lnum'>3450</font>   
<font class='lnum'>3451</font>   
<font class='lnum'>3452</font>   
<font class='lnum'>3453</font>   .chunkref {
<font class='lnum'>3454</font>           color: #00b;	
<font class='lnum'>3455</font>           background: #f6f6f6;
<font class='lnum'>3456</font>           /font-style: italic;
<font class='lnum'>3457</font>           font-weight: bold;
<font class='lnum'>3458</font>           /font-variant: small-caps;
<font class='lnum'>3459</font>   	}
<font class='lnum'>3460</font>   
<font class='lnum'>3461</font>   
<font class='lnum'>3462</font>   .outertable {
<font class='lnum'>3463</font>   	width: 99%; 
<font class='lnum'>3464</font>   	cellpadding: 25; 
<font class='lnum'>3465</font>   	background: #ffffff; 
<font class='lnum'>3466</font>   	border: 1px solid;
<font class='lnum'>3467</font>   	}
<font class='lnum'>3468</font>   
<font class='lnum'>3469</font>   .hl	{
<font class='lnum'>3470</font>   	 ;
<font class='lnum'>3471</font>           PADDING-LEFT: 5px; PADDING-RIGHT: 5px; 
<font class='lnum'>3472</font>           padding-top: 5px; padding-bottom: 5px;
<font class='lnum'>3473</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>3474</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>3475</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>3476</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>3477</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>3478</font>           background: #f5f5f5;	
<font class='lnum'>3479</font>           width: 70%;
<font class='lnum'>3480</font>   	}
<font class='lnum'>3481</font>   
<font class='lnum'>3482</font>   .hl-wide {
<font class='lnum'>3483</font>   	 ;
<font class='lnum'>3484</font>           PADDING-LEFT: 5px; 
<font class='lnum'>3485</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>3486</font>           padding-top: 15px; 
<font class='lnum'>3487</font>           padding-bottom: 15px;
<font class='lnum'>3488</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>3489</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>3490</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>3491</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>3492</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>3493</font>           background: #fbfbfb;	
<font class='lnum'>3494</font>   	}
<font class='lnum'>3495</font>   
<font class='lnum'>3496</font>   .lnum {
<font class='lnum'>3497</font>   
<font class='lnum'>3498</font>   	color: #a0a0a0;
<font class='lnum'>3499</font>   	/background: #fbfbfb;
<font class='lnum'>3500</font>   	}
<font class='lnum'>3501</font>   
<font class='lnum'>3502</font>   .unhilited {background-color:white}
<font class='lnum'>3503</font>   .hilited {background-color:#c0c0ff}
<font class='lnum'>3504</font>   
<font class='lnum'>3505</font>   
<font class='lnum'>3506</font>   &lt;/STYLE&gt;
<font class='lnum'>3507</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('76');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('74');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('77');">
<font class='lnum'><i>(77)</i></font>&nbsp; Accumulate the result </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3516)</i></sub></font></a></legend></fieldset>
<p>
<div id="77" style="display:none">   
<ul>


<p>
Some of the vars may be unused later (run perl -wc to check?)<br>
<p>
<font class='lnum'>3521</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;accumulate result in a buffer&gt;&gt;=</legend>
<font class='lnum'>3522</font>   #2. accumulate result in a buffer
<font class='lnum'>3523</font>   
<font class='lnum'>3524</font>   
<font class='lnum'>3525</font>   # vars for the main loop over lines of the target file
<font class='lnum'>3526</font>   
<font class='lnum'>3527</font>    $chunkbuf = ''; # collects whole formatted project file in memory
<font class='lnum'>3528</font>    $tocbuf = "";	# will accumulate TOC contents, i.e. small
<font class='lnum'>3529</font>    @indbuf = ();  # accumulates index of code chunks, small
<font class='lnum'>3530</font>    #%indbuf = ();
<font class='lnum'>3531</font>    @headings = ();	# the stack for nested subsections numbers/ids
<font class='lnum'>3532</font>   
<font class='lnum'>3533</font>    $section_num = 0;
<font class='lnum'>3534</font>    $section_num_prev = 0;
<font class='lnum'>3535</font>    $section_level = 0;
<font class='lnum'>3536</font>    $prev_section_level = $section_level;
<font class='lnum'>3537</font>    $line_counter = 0;
<font class='lnum'>3538</font>    $in_pre_tag = 0;
<font class='lnum'>3539</font>   </fieldset></pre>
<p>
<p>
The logic is this: (a) all project files, unless they are machine-generated code, are<br>
much below the sizes of RAM on modern machines. So I accumulate in memoru (in a string<br>
$chunkbuf) a copy of the whole file, with necessary transformations and formatting.<br>
<p>
Only 3 distinctions need to be made while iterating over hte lines of the Literate Source<br>
file, between section headings, chunks of code and the lines from the body of documentation<br>
chunks.<br>
<p>
<font class='lnum'>3550</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;accumulate result in a buffer&gt;&gt;=</legend>
<font class='lnum'>3551</font>   
<font class='lnum'>3552</font>   
<font class='lnum'>3553</font>   while (&lt;LITSOURCE&gt;) {
<font class='lnum'>3554</font>   
<font class='lnum'>3555</font>      $line_counter++;
<font class='lnum'>3556</font>   
<font class='lnum'>3557</font>       # cut out the MOLLY.pl invocation itself, the top of the Lit src file
<font class='lnum'>3558</font>       #if ( m%^#-+\s*?start of script% ... m%^xxxxxxxxxxxx% ) {  
<font class='lnum'>3559</font>       if ( m%^__DATA__% ... m%^xxxxxxxxxxxx% ) {
<font class='lnum'>3560</font>       s!^__DATA__\s*$!!;
<font class='lnum'>3561</font>   
<font class='lnum'>3562</font>   
<font class='lnum'>3563</font>   
<font class='lnum'>3564</font>   <font class='chunkref'>&lt;&lt;process code chunks&gt;&gt</font>;
<font class='lnum'>3565</font>   <font class='chunkref'>&lt;&lt;process section headings&gt;&gt</font>;
<font class='lnum'>3566</font>   <font class='chunkref'>&lt;&lt;body HTML formatters&gt;&gt</font>;
<font class='lnum'>3567</font>   
<font class='lnum'>3568</font>   
<font class='lnum'>3569</font>   	# debug
<font class='lnum'>3570</font>   	#print "---- $_";
<font class='lnum'>3571</font>   
<font class='lnum'>3572</font>      } # fi "start of script"
<font class='lnum'>3573</font>   
<font class='lnum'>3574</font>   } #elihw over the whole input file
<font class='lnum'>3575</font>   
<font class='lnum'>3576</font>   	
<font class='lnum'>3577</font>   
<font class='lnum'>3578</font>   
<font class='lnum'>3579</font>    foreach (@headings)  {
<font class='lnum'>3580</font>   
<font class='lnum'>3581</font>   	($section_level, $section_num_prev) = split /-/, $_;
<font class='lnum'>3582</font>   	$folding_section_end = $folding_section_end_str;
<font class='lnum'>3583</font>   	$folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>3584</font>   	$chunkbuf .= $folding_section_end; 
<font class='lnum'>3585</font>   
<font class='lnum'>3586</font>   	};
<font class='lnum'>3587</font>   
<font class='lnum'>3588</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('78');">
<font class='lnum'><i>(78)</i></font>&nbsp; process code chunks </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3595)</i></sub></font></a></legend></fieldset>
<p>
<div id="78" style="display:none">   
<ul>


<p>
"goto" is from an old version of this script, with perl-specific options, I'll delete it<br>
later.<br>
<p>
I use perl range operator to cut out the code section between &lt; &lt; chunkname &gt; &gt; and the<br>
closing "at" symbol, as is required in "noweb".<br>
This is a use of the "range" operator inside another "while" loop over each line of the<br>
Lit Source file, and they work together, the range just flips some status var ("in" - "out")<br>
while the outside loop continues over the lines.<br>
<p>
Once the section name is extracted with a regexp, the index buffer (indbuf) is formed and<br>
updated.<br>
Then "fieldset" formatting is written around the code chunk and line numbering (if set<br>
in an option var) is written too<br>
<p>
<font class='lnum'>3612</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process code chunks&gt;&gt;=</legend>
<font class='lnum'>3613</font>   
<font class='lnum'>3614</font>   	if ( m!^(goto)?&lt;\&lt;(.*)&gt;\&gt;=! ... m!^@\s*$! ) { # -- CODE CHUNKS -- 
<font class='lnum'>3615</font>   		$chunk_title = $2;
<font class='lnum'>3616</font>   
<font class='lnum'>3617</font>   		s/&amp;/&amp;amp;/g;	# escape &amp;
<font class='lnum'>3618</font>   		s/&lt;/&amp;lt;/g;	# escape &lt;
<font class='lnum'>3619</font>   		s/&gt;/&amp;gt;/g;	# escape &gt;
<font class='lnum'>3620</font>   
<font class='lnum'>3621</font>   		if (m!(&amp;lt;&amp;lt;(.+?)&amp;gt;&amp;gt);(=)?!) 
<font class='lnum'>3622</font>   		  {
<font class='lnum'>3623</font>   		  $reference = $1;
<font class='lnum'>3624</font>   		  $ind_str = "&amp;lt;&amp;lt;$2&amp;gt;&amp;gt; $section_num";
<font class='lnum'>3625</font>   		  if (defined $3) {$ind_str .= "&lt;sub&gt;def&lt;/sub&gt;"}
<font class='lnum'>3626</font>   		  else { s!$reference!&lt;font class='chunkref'&gt;$reference&lt;/font&gt;! }
<font class='lnum'>3627</font>   
<font class='lnum'>3628</font>   		  unshift @indbuf, $ind_str;
<font class='lnum'>3629</font>   
<font class='lnum'>3630</font>   		} # fi - chunks index accumulation
<font class='lnum'>3631</font>   
<font class='lnum'>3632</font>   		# simple fieldset frames around code snippets
<font class='lnum'>3633</font>   		s!^(goto)?&amp;lt;&amp;lt;(.+)&amp;gt;&amp;gt;=!$code_frameset_start_pre$1&amp;lt;&amp;lt;$2&amp;gt;&amp;gt;$code_frameset_start_post!;
<font class='lnum'>3634</font>   		s!^@\s*$!$code_frameset_end!;
<font class='lnum'>3635</font>   
<font class='lnum'>3636</font>   		if ( $line_numbering ) { 
<font class='lnum'>3637</font>   		$chunkbuf .= "&lt;font class='lnum'&gt;" . $line_counter . "&lt;/font&gt;   " . $_;
<font class='lnum'>3638</font>   		}
<font class='lnum'>3639</font>   		else{
<font class='lnum'>3640</font>   		$chunkbuf .= $_;
<font class='lnum'>3641</font>   		}
<font class='lnum'>3642</font>   
<font class='lnum'>3643</font>   	} # fi code chunks
<font class='lnum'>3644</font>   </fieldset></pre>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('78');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('79');">
<font class='lnum'><i>(79)</i></font>&nbsp; process section headings </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3650)</i></sub></font></a></legend></fieldset>
<p>
<div id="79" style="display:none">   
<ul>


<p>
This is where folding sectons are created.<br>
The more complicated logic is needed to <i>close</i> the sections properly, when subsections<br>
are included (i.e. creating a step and forming the "close subsection" at the end in the correct<br>
place.<br>
<p>
1. Several formats were possible for collapsing sections, I chose the one you can observe while<br>
reading the weaved document: subsections are completely enclosed by their supersections;<br>
once a child subsection is initiated, the parent subsection cannot continue its body after<br>
the end of the child.<br>
I.e. once you started 12.2.1 inside your 12.2, you cannot write into 12.2 after 12.2.1 is finished, <br>
but you can add 12.2.2, 12.2.3, 12.2.2.1 - etc. - inside the enclosing section.<br>
<p>
The logic was tested first in an external skeleton script.<br>
<p>
2. I may need to disassemble this code to create "view mode" for my script - see "versions - <br>
CHANGES" subsection<br>
<p>
<p>
<font class='lnum'>3671</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process section headings&gt;&gt;=</legend>
<font class='lnum'>3672</font>   
<font class='lnum'>3673</font>   	# -- SECTION HEADINGS 
<font class='lnum'>3674</font>      #elsif ( m!\.(\+)?h(\d)\.(.*?)\./h\d\.! ) {	# old version, no "rawHTML" enabled yet
<font class='lnum'>3675</font>      elsif ( m!$tag_open_symbol(\+)?h(\d{1,2})$tag_close_symbol(.*?)$tag_open_symbol/h\d{1,2}$tag_close_symbol! ) {	
<font class='lnum'>3676</font>   
<font class='lnum'>3677</font>   
<font class='lnum'>3678</font>   
<font class='lnum'>3679</font>   	# -- using split vars for substitution to avoid
<font class='lnum'>3680</font>   	#	regexps and need to keep old state --	
<font class='lnum'>3681</font>   
<font class='lnum'>3682</font>   	$section_num_prev = $section_num;
<font class='lnum'>3683</font>   	$section_num = $section_num + 1;
<font class='lnum'>3684</font>   
<font class='lnum'>3685</font>   
<font class='lnum'>3686</font>   		#default for fold state in "settings" ??
<font class='lnum'>3687</font>   		if ($1 eq "+") {
<font class='lnum'>3688</font>   		    $fold_state="block";
<font class='lnum'>3689</font>   		    $highlight_state = qq!  &lt;script language=javascript&gt; 
<font class='lnum'>3690</font>   		    document.getElementById("toc"+ $section_num).className='hilited';
<font class='lnum'>3691</font>   		    &lt;/script&gt; !;
<font class='lnum'>3692</font>   		} 
<font class='lnum'>3693</font>   		else {
<font class='lnum'>3694</font>   		    $fold_state="none";
<font class='lnum'>3695</font>   		    $highlight_state = "";
<font class='lnum'>3696</font>   		};
<font class='lnum'>3697</font>   		$section_level = $2;
<font class='lnum'>3698</font>   		$section_title = $3;
<font class='lnum'>3699</font>   
<font class='lnum'>3700</font>   
<font class='lnum'>3701</font>   	
<font class='lnum'>3702</font>   
<font class='lnum'>3703</font>   	
<font class='lnum'>3704</font>   
<font class='lnum'>3705</font>   	$folding_section_start1 = $folding_section_start1_str;
<font class='lnum'>3706</font>   	$folding_section_start2 = $folding_section_start2_str;
<font class='lnum'>3707</font>   	$folding_section_end = $folding_section_end_str;
<font class='lnum'>3708</font>   
<font class='lnum'>3709</font>   
<font class='lnum'>3710</font>   	$folding_section_start1 =~ s!(\$section_num)!$1!ee;
<font class='lnum'>3711</font>   	$folding_section_start2 =~ s!(\$section_num)!$1!ee;
<font class='lnum'>3712</font>   	$folding_section_start2 =~ s!(\$fold_state)!$1!ee;
<font class='lnum'>3713</font>   	$folding_section_start2 =~ s!(\$highlight_state)!$1!ee;
<font class='lnum'>3714</font>   	$folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>3715</font>   
<font class='lnum'>3716</font>   
<font class='lnum'>3717</font>   	$section_id = $section_level . '-' . $section_num;
<font class='lnum'>3718</font>   
<font class='lnum'>3719</font>   
<font class='lnum'>3720</font>   	# finish previous subsection if not the first section in the file
<font class='lnum'>3721</font>   	# ..and deal with nesting of sections according to their "depth level"
<font class='lnum'>3722</font>   
<font class='lnum'>3723</font>   	# this is NOT the first section:
<font class='lnum'>3724</font>   	if ( exists $headings[0] ){
<font class='lnum'>3725</font>   
<font class='lnum'>3726</font>   		($prev_section_level, $prev_section_num)  = split /-/, $headings[0];
<font class='lnum'>3727</font>   
<font class='lnum'>3728</font>   		if ($section_level == $prev_section_level){
<font class='lnum'>3729</font>   
<font class='lnum'>3730</font>   		# close prev, start new
<font class='lnum'>3731</font>   		$chunkbuf .= $folding_section_end;
<font class='lnum'>3732</font>   		shift @headings;
<font class='lnum'>3733</font>   		
<font class='lnum'>3734</font>   		}
<font class='lnum'>3735</font>   
<font class='lnum'>3736</font>   		elsif($section_level &lt; $prev_section_level){
<font class='lnum'>3737</font>   		
<font class='lnum'>3738</font>   		  # close a bunch of them, in a loop -- THEN start a new one.
<font class='lnum'>3739</font>   		  do  {
<font class='lnum'>3740</font>   			($prev_section_level, $section_num_prev) = split /-/, shift @headings;
<font class='lnum'>3741</font>   			
<font class='lnum'>3742</font>   			$folding_section_end = $folding_section_end_str;
<font class='lnum'>3743</font>   			$folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>3744</font>   			$chunkbuf .= $folding_section_end;
<font class='lnum'>3745</font>   
<font class='lnum'>3746</font>   		   } while ( $section_level &lt; $prev_section_level );
<font class='lnum'>3747</font>   		}
<font class='lnum'>3748</font>   	} # fi not the first section
<font class='lnum'>3749</font>   
<font class='lnum'>3750</font>   
<font class='lnum'>3751</font>   	# common operations		
<font class='lnum'>3752</font>   	unshift @headings, $section_id ;
<font class='lnum'>3753</font>   	$chunkbuf .= $folding_section_start1;
<font class='lnum'>3754</font>   	$chunkbuf .= "&lt;font class='lnum'&gt;&lt;i&gt;(" . $section_num . ")&lt;/i&gt;&lt;/font&gt;" . "&amp;nbsp;" . $section_title .
<font class='lnum'>3755</font>   	    "&lt;/a&gt;&amp;nbsp;&lt;a&gt;&lt;font class='lnum' size=-1&gt;&lt;sub&gt;&lt;i&gt;(line " .
<font class='lnum'>3756</font>   	    $line_counter . ")&lt;/i&gt;&lt;/sub&gt;&lt;/font&gt;"; 
<font class='lnum'>3757</font>   	$chunkbuf .= $folding_section_start2;
<font class='lnum'>3758</font>   
<font class='lnum'>3759</font>   	#$chunkbuf .= "\n" . "&lt;font class='lnum'&gt;&lt;i&gt;------ line " . $line_counter . 
<font class='lnum'>3760</font>   	#	    " ------&lt;/i&gt;&lt;/font&gt;&lt;br&gt;\n";
<font class='lnum'>3761</font>   
<font class='lnum'>3762</font>   
<font class='lnum'>3763</font>   	$toc_indent = "&amp;nbsp;" x ($section_level * 7);
<font class='lnum'>3764</font>   	#$toc_indent = "&amp;nbsp;" x (($section_level-1) * 7 );
<font class='lnum'>3765</font>   	#$tocbuf .= "\n&lt;p&gt;\n" if ( $section_level == 1 ); 
<font class='lnum'>3766</font>   	$tocbuf .= $toc_indent . 
<font class='lnum'>3767</font>   		"&lt;i&gt;" . $section_num . "&lt;/i&gt;" .
<font class='lnum'>3768</font>   		qq/&amp;nbsp;&lt;a href="javascript:;" onmousedown="toggleCombined(/ .  
<font class='lnum'>3769</font>   		$section_num . 
<font class='lnum'>3770</font>   		qq/);" id="toc/ . $section_num .
<font class='lnum'>3771</font>   		qq/"&gt;&lt;b&gt;/ .
<font class='lnum'>3772</font>   		$section_title . "&lt;/a&gt;&amp;nbsp;&lt;a&gt;&lt;font class='lnum' size=-1&gt;&lt;i&gt;(line " .
<font class='lnum'>3773</font>   		    $line_counter . ")&lt;/i&gt;&lt;/font&gt;" .
<font class='lnum'>3774</font>   		    "&lt;/b&gt;&lt;/a&gt;&lt;br&gt;\n";
<font class='lnum'>3775</font>   
<font class='lnum'>3776</font>      } #; fisle: end elif headings
<font class='lnum'>3777</font>   
<font class='lnum'>3778</font>   	
<font class='lnum'>3779</font>   
<font class='lnum'>3780</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('79');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('80');">
<font class='lnum'><i>(80)</i></font>&nbsp; dotHTML formatter and rawHTML </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3785)</i></sub></font></a></legend></fieldset>
<p>
<div id="80" style="display:none">   
<ul>


<p>
It is primitive, and I add needed markup "on the fly", as and when I need it.<br>
The idea is to eliminate angle brackets in html tags, which I cannot type without errors<br>
when typing fast, and substitute those with simple "dots", which do not requre switching<br>
keyboard registers.<br>
<p>
<s> This formatting also has problems with escapes.<br>
<p>
Whether it's the fault of HTML standards or their implementation, web browsers continue to<br>
react to html formatting <b>even inside the "pre" tags</b>, which is obviously insane.<br>
Therefore if your code chunks contain any HTML tags (e.g. processed by your code), you'll<br>
need to escape them to display correctly.<br>
And if you use sth like "&amp; g t ;" in your code, the web page will also lie to you.<br>
This is insane, and there is no good quick solution, one would have to use lengthy escape<br>
tables etc. etc. </s><br>
<p>
<ul> /* OFFTOPIC, ALSO: add &lt; &gt; and &amp; escapes to the weaved code chunks -- for proper display */<br>
    --- DONE ---<br>
    These escapes exist in two places in the Weaver code:<br>
    "process code sections"  and "body HTML formatters"<br>
</ul><br>
<p>
<br><br>
This prototype script fails in some (unimportant to me)  cases.<br>
dotHTML markup would also fail if your programming language uses dot-symbol-dot sequences<br>
Mine do not.<br>
<p>
The formatter is pretty straightforward, but sequencing of regexps is important.<br>
One also needs to remember that once escaped, angle brackets are non-existent any more, <br>
and so the subsequent regexps must match on "&amp; l t ;" not on the angle bracket in some<br>
cases.<br>
<p>
<p>
<font class='lnum'>3820</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>3821</font>   
<font class='lnum'>3822</font>   	elsif( $weave_markup eq "dotHTML" ) {	# dotHTML formatter here
<font class='lnum'>3823</font>   
<font class='lnum'>3824</font>   	      s/^=begin.*$//;	# - eliminate perl escaping, start
<font class='lnum'>3825</font>   	      s/^=cut.*$//;		# - eliminate perl escaping, end
<font class='lnum'>3826</font>      	      #s/^{{{\d+(.*)$/$1/;	# - eliminate vim folding markup, start 
<font class='lnum'>3827</font>   					# - dummy, as it is killed in "headings" processing 
<font class='lnum'>3828</font>   	      s/^}}}\d+//;	# - eliminate vim folding markup, end
<font class='lnum'>3829</font>   
<font class='lnum'>3830</font>   		s/&amp;/&amp;amp;/g;	# escape &amp;
<font class='lnum'>3831</font>   		s/&lt;/&amp;lt;/g;	# escape &lt;
<font class='lnum'>3832</font>   		s/&gt;/&amp;gt;/g;	# escape &gt;
<font class='lnum'>3833</font>   
<font class='lnum'>3834</font>   
<font class='lnum'>3835</font>   	      # Paragraphs and line breaks are automatic now:
<font class='lnum'>3836</font>   	      # ... unless we are dealing with the "preformat" tag
<font class='lnum'>3837</font>   		#--note! that ranges do not work here
<font class='lnum'>3838</font>   		$in_pre_tag = 1 if (m!\.pre\.!);
<font class='lnum'>3839</font>   		$in_pre_tag = 0 if (m!\./pre\.!);;
<font class='lnum'>3840</font>   
<font class='lnum'>3841</font>   		s/\.(\/?)pre\./&lt;$1pre&gt;/g;
<font class='lnum'>3842</font>   
<font class='lnum'>3843</font>   	    unless ($in_pre_tag) {
<font class='lnum'>3844</font>   	    (m/^\s*$/) and s/$_/&lt;p&gt;\n/
<font class='lnum'>3845</font>   	    or s/\n/&lt;br&gt;\n/;
<font class='lnum'>3846</font>   	    }
<font class='lnum'>3847</font>   </fieldset></pre>
<p>
Now the regexps to cut out "#--------" lines and substitute "dot-notation" with angle brackets:<br>
<p>
<font class='lnum'>3851</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>3852</font>   	      # originally I separated header from the body with such a line
<font class='lnum'>3853</font>   	      #s/^#-----.*/starting the table here/;
<font class='lnum'>3854</font>   	      s/^#-----.*//;
<font class='lnum'>3855</font>   
<font class='lnum'>3856</font>   
<font class='lnum'>3857</font>   		# add more here
<font class='lnum'>3858</font>   
<font class='lnum'>3859</font>   		s/\.(\/?)b\./&lt;$1b&gt;/g;
<font class='lnum'>3860</font>   		s/\.(\/?)i\./&lt;$1i&gt;/g;
<font class='lnum'>3861</font>   		s/\.(\/?)ul\./&lt;$1ul&gt;/g;
<font class='lnum'>3862</font>   		s/\.(\/?)li\./&lt;$1li&gt;/g;
<font class='lnum'>3863</font>   		s/\.(\/?)ol\./&lt;$1ol&gt;/g;
<font class='lnum'>3864</font>   		s/\.(\/?)s\./&lt;$1s&gt;/g;
<font class='lnum'>3865</font>   		s/\.(\/?)div\./&lt;$1div&gt;/g;
<font class='lnum'>3866</font>   		s/\.br\./&lt;br&gt;/g;
<font class='lnum'>3867</font>   		s/\.p\./&lt;p&gt;/g;
<font class='lnum'>3868</font>   		s/\.sp\./&amp;nbsp;/g;
<font class='lnum'>3869</font>   
<font class='lnum'>3870</font>   		s/\.(\/?)tab\./&lt;$1ul&gt;/g;	# "tabbing" with "ul"
<font class='lnum'>3871</font>   
<font class='lnum'>3872</font>   
<font class='lnum'>3873</font>   		# this is some bullshit ???
<font class='lnum'>3874</font>   		s/\.hr\./&lt;hr /g;
<font class='lnum'>3875</font>   		s/\.\/hr\./&gt;/g;
<font class='lnum'>3876</font>   
<font class='lnum'>3877</font>   		s!\.a\.(.+?)\.\/a\.!&lt;a href=$1&gt;$1&lt;/a&gt;!g;
<font class='lnum'>3878</font>   
<font class='lnum'>3879</font>   		# rudimentary &amp;nbsp; s p a c i n g &amp;nbsp (one word only)
<font class='lnum'>3880</font>   		#s!\.x\.(.+?)\./x\.!join " ","&amp;nbsp;&amp;nbsp;",(split //, $1),"&amp;nbsp;&amp;nbsp;"!eg;
<font class='lnum'>3881</font>   
<font class='lnum'>3882</font>   		# slightly better spacing (phrases, too):
<font class='lnum'>3883</font>   		# although redundant  with more work than is needed
<font class='lnum'>3884</font>   		if ( m!(\.x\.)(.+?)(\./x\.)!g) {
<font class='lnum'>3885</font>   		    s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>3886</font>   		    s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>3887</font>   		    s!  _  ! &amp;nbsp; !g;
<font class='lnum'>3888</font>   		}
<font class='lnum'>3889</font>   </fieldset></pre>
<p>
<b> BUG! </b> This URL breaks my "ancor" dot-tags: <br>
     <pre> http://www.cs.tufts.edu/~nr/noweb </pre><br>
<b> Got it </b> The substitutions above must explicitly use "slash" for the closing HTML tag<br>
in the regexps - otherwise they match stuff like ".cs." inside URLs<br>
<p>
If an HTML tag is not in the above chunk, either add it or write with the two following generic<br>
tags (slow and not nice on your fingers, though). You might need to use them also when your HTML<br>
tag conntains some options, and so is not of generic simple type.<br>
<p>
<font class='lnum'>3900</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>3901</font>   
<font class='lnum'>3902</font>   
<font class='lnum'>3903</font>   		# generic for all tags with options
<font class='lnum'>3904</font>   		s!\.&amp;lt;\. !&lt;!g;
<font class='lnum'>3905</font>   		s! \.&amp;gt;\.!&gt;!g;
<font class='lnum'>3906</font>   
<font class='lnum'>3907</font>   
<font class='lnum'>3908</font>   		$chunkbuf .= $_;
<font class='lnum'>3909</font>   
<font class='lnum'>3910</font>   	}
<font class='lnum'>3911</font>   </fieldset></pre>
<p>
<p>
<b> rawHTML formatter</b><br>
Raw HTML formatting can be done - either because it is non-restricted, compared to the stripped-down<br>
"dotHTML" of my invention, or because it allows one to convert existing HTML documentation into the<br>
folding format.<br>
I.e. if you have a longish manual in which section headings are marked with HTML h1, h2, h3, ... tags,<br>
you can convert it in 3 simple steps:<br>
<ul> <li> delete opening and closing "html" and "head" "body" tags at the very top and bottom of your <br>
document<br>
</li> <li> put perl invocation as the first line<br>
</li> <li> set up markup mode in a variable: "$weave_markup = "rawHTML";" and "mollify" the document,<br>
putting  "do MOLLY.pl" and DATA marker<br>
</li> </ul><br>
and if there are no interfering div section etc. - no complicated markup inside the headings, you'll get<br>
an automatically generated folding HTML document.<br>
<p>
If you do, it is sometimes easy to clean headings with a few regexps in a good editor like Vim<br>
<p>
It is very convenient and I keep large manuals as folding HTML documents.<br>
<p>
<p>
<font class='lnum'>3934</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>3935</font>   	elsif( $weave_markup eq "rawHTML" ) {	# if the doc chunks marked up with real HTML
<font class='lnum'>3936</font>   		s!^#-----.*!!;
<font class='lnum'>3937</font>   
<font class='lnum'>3938</font>   	      #s/^{{{\d+(.*)$/$1/;	# - eliminate vim folding markup, start 
<font class='lnum'>3939</font>   					# - dummy, as it's killed in "headings" processing 
<font class='lnum'>3940</font>   	      s/^}}}\d+//;	# - eliminate vim folding markup, end
<font class='lnum'>3941</font>   
<font class='lnum'>3942</font>   
<font class='lnum'>3943</font>   	      # Paragraphs and line breaks are automatic now:
<font class='lnum'>3944</font>   	      # ... unless we are dealing with the "preformat" tag
<font class='lnum'>3945</font>   		#--note! that ranges do not work here
<font class='lnum'>3946</font>   		$in_pre_tag = 1 if (m!&lt;pre&gt;!);
<font class='lnum'>3947</font>   		$in_pre_tag = 0 if (m!&lt;/pre&gt;!);;
<font class='lnum'>3948</font>   
<font class='lnum'>3949</font>   
<font class='lnum'>3950</font>   		unless ($in_pre_tag) {
<font class='lnum'>3951</font>   		(m/^\s*$/) and s/$_/&lt;p&gt;\n/
<font class='lnum'>3952</font>   		or s/\n/&lt;br&gt;\n/;
<font class='lnum'>3953</font>   		}
<font class='lnum'>3954</font>   
<font class='lnum'>3955</font>   
<font class='lnum'>3956</font>   		$chunkbuf .= $_;
<font class='lnum'>3957</font>   	} # esle -- for rest of the body
<font class='lnum'>3958</font>   
<font class='lnum'>3959</font>   
<font class='lnum'>3960</font>   
<font class='lnum'>3961</font>   </fieldset></pre>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('81');">
<font class='lnum'><i>(81)</i></font>&nbsp; test of &nbsp;&nbsp; s p a c i n g &nbsp;&nbsp; regexp </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3963)</i></sub></font></a></legend></fieldset>
<p>
<div id="81" style="display:none">   
<ul>

<p>
1. Hell, the thing is multiple sp /sp markups on one line. I need to iterate over<br>
each separately and then put them in their right places, hedging with "nbsp"-ces each word.<br>
<p>
2. The invocation is OK for $str_sp, but for boundaries of the string and word boundaries, <br>
they must be hedged too<br>
<p>
3. Could subst spaces-betwen-words to sth like _ (space-underscore-space) as placeholders,<br>
then subst them into nbspx2 in a following regexp<br>
<p>
4. This tagging can be done cleanly and span severl lines if I do it in a different place - <br>
not while still reading the Literate Source file line by line,  &nbsp;  b u t  &nbsp;  l a t e r  &nbsp;  when<br>
$chunkbuf is completely formed in RAM.<br>
<p>
<p>
<font class='lnum'>3979</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;spacing.pl&gt;&gt;=</legend>
<font class='lnum'>3980</font>   #!/usr/bin/perl
<font class='lnum'>3981</font>   #
<font class='lnum'>3982</font>   $str = $ARGV[0];
<font class='lnum'>3983</font>   $str_sp = $ARGV[0];
<font class='lnum'>3984</font>   #print "string is $str\n";
<font class='lnum'>3985</font>   
<font class='lnum'>3986</font>       # "sp" dot-markup to intersperse spaces: the basic formula
<font class='lnum'>3987</font>       #$spaced_str =~ s!(asdf)!join " ", (split //, $1)!eg;
<font class='lnum'>3988</font>       #
<font class='lnum'>3989</font>       
<font class='lnum'>3990</font>       # -- idea 3 from above: this works but is cumbersome --
<font class='lnum'>3991</font>       #$str_sp =~ s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>3992</font>       #$str_sp =~ s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>3993</font>       #$str_sp =~ s! _ ! &amp;nbsp;&amp;nbsp; !g;
<font class='lnum'>3994</font>   
<font class='lnum'>3995</font>       # -- first get the matching string in "if", then massage it:
<font class='lnum'>3996</font>       if ($str_sp =~ m!(\.x\.)(.+?)(\./x\.)!g) {
<font class='lnum'>3997</font>   	$str_sp =~ s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>3998</font>           $str_sp =~ s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>3999</font>   	$str_sp =~ s!  _  ! &amp;nbsp; !g;
<font class='lnum'>4000</font>       }
<font class='lnum'>4001</font>   
<font class='lnum'>4002</font>       #print "\nthe string is $str\n";
<font class='lnum'>4003</font>       print "\nthe str_sp is $str_sp\n\n";
<font class='lnum'>4004</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('81');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('80');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('77');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('82');">
<font class='lnum'><i>(82)</i></font>&nbsp; Print out the resulting page </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4014)</i></sub></font></a></legend></fieldset>
<p>
<div id="82" style="display:none">   
<ul>


<p>
Page and the outer formatting table:<br>
<p>
<font class='lnum'>4019</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4020</font>   
<font class='lnum'>4021</font>     # begin the page:
<font class='lnum'>4022</font>     #print '&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;', "\n";
<font class='lnum'>4023</font>     print "&lt;html&gt;\n  $html_head\n &lt;body&gt;  $html_body_table \n";
<font class='lnum'>4024</font>   
<font class='lnum'>4025</font>     # print out the TOC, the Chunks Index, the output buffer and close the page.
<font class='lnum'>4026</font>   
<font class='lnum'>4027</font>   </fieldset></pre>
<p>
Next print the short instructions section (collapsible) at the top:<br>
<p>
<font class='lnum'>4031</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4032</font>   
<font class='lnum'>4033</font>   print &lt;&lt;end_of_print;
<font class='lnum'>4034</font>   &lt;p&gt;&lt;fieldset class='tocfieldset'&gt;&lt;legend&gt;&lt;b&gt;TABLE OF CONTENTS: outline of the document structure&lt;/b&gt;&lt;/legend&gt;
<font class='lnum'>4035</font>   
<font class='lnum'>4036</font>   &lt;ul&gt;
<font class='lnum'>4037</font>   &lt;p&gt;
<font class='lnum'>4038</font>   &lt;br&gt;
<font class='lnum'>4039</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>4040</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('tochowto');"&gt;
<font class='lnum'>4041</font>   &lt;b&gt;HOW TO USE THE FOLDING DOCUMENT [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>4042</font>   &lt;/div&gt;
<font class='lnum'>4043</font>   &lt;div id='tochowto' style='display:none' style='background:#ffffff'&gt; 
<font class='lnum'>4044</font>   &lt;p&gt;
<font class='lnum'>4045</font>   &lt;ul&gt;
<font class='lnum'>4046</font>   &lt;li&gt;&lt;b&gt;Collapsing is necessary when&lt;/b&gt; you work on some code and must exclude 
<font class='lnum'>4047</font>   &lt;br&gt;irrelevant sections of the rest of the literate project file. This 
<font class='lnum'>4048</font>   &lt;br&gt;greatly helps to clear thinking by eliminating a general feeling of 
<font class='lnum'>4049</font>   &lt;br&gt;being in a maze of code and unnecessary "housekeeping" tasks.
<font class='lnum'>4050</font>   &lt;br&gt;One can say that there is a limited "buffer capacity" in the human
<font class='lnum'>4051</font>   &lt;br&gt;mind, and relieving it of the need to remember where things are in a 
<font class='lnum'>4052</font>   &lt;br&gt;larger file, at which other points one must fill in values or adjust
<font class='lnum'>4053</font>   &lt;br&gt;invocation etc. &lt;i&gt;immediately makes the user "more intelligent"&lt;/i&gt;
<font class='lnum'>4054</font>   &lt;/li&gt;&lt;li&gt;&lt;b&gt;To toggle&lt;/b&gt; a section open/closed, click on the corresponding link
<font class='lnum'>4055</font>   &lt;br&gt;Remember to open &lt;i&gt;all sections above it&lt;/i&gt; for it to become visible.
<font class='lnum'>4056</font>   &lt;/li&gt;&lt;li&gt;&lt;b&gt;To restore the default view&lt;/b&gt; reload the page in the browser.
<font class='lnum'>4057</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>4058</font>   &lt;b&gt;To keep some sections open&lt;/b&gt; upon each reload - 
<font class='lnum'>4059</font>   &lt;br&gt;e.g. you work on the code, update it constantly and cannot reopen it 
<font class='lnum'>4060</font>   &lt;br&gt;again and again - mark their sections in the source file with a plus, 
<font class='lnum'>4061</font>   &lt;br&gt;i.e. write the opening tag (only)  as +h2, +h3 (in &amp;lt; &amp;gt;  or in dots
<font class='lnum'>4062</font>   &lt;br&gt;for dotHTML). Again, all sections above must be marked open too. 
<font class='lnum'>4063</font>   &lt;p&gt;&lt;b&gt;Note that&lt;/b&gt; "expand all" and "collapse all" disregard these settings.
<font class='lnum'>4064</font>   &lt;br&gt;Reload the page after using those options to again view the text according 
<font class='lnum'>4065</font>   &lt;br&gt;to your preferences.
<font class='lnum'>4066</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>4067</font>   &lt;b&gt; To use the Index &lt;/b&gt;, click on the numbered sections in the TOC above
<font class='lnum'>4068</font>   &lt;br&gt;(opening them; use highlighting as a guide; when sections are visible,
<font class='lnum'>4069</font>   &lt;br&gt;the slider on your browser window  will shorten too), or "expand all", 
<font class='lnum'>4070</font>   &lt;br&gt;and then use your browser's Find function to highlight all chunk name 
<font class='lnum'>4071</font>   &lt;br&gt;instances in the visible text
<font class='lnum'>4072</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>4073</font>   &lt;b&gt;To search for variables etc.&lt;/b&gt;, "expand all" text - or manually 
<font class='lnum'>4074</font>   &lt;br&gt;expand needed sections - and then use your browser's Find function to 
<font class='lnum'>4075</font>   &lt;br&gt;highlight all and jump between the found items.
<font class='lnum'>4076</font>   &lt;p&gt;&lt;/li&gt;
<font class='lnum'>4077</font>   
<font class='lnum'>4078</font>   &lt;/div&gt; 
<font class='lnum'>4079</font>   &lt;p&gt;
<font class='lnum'>4080</font>   &lt;br&gt;
<font class='lnum'>4081</font>   &lt;p&gt;
<font class='lnum'>4082</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>4083</font>   &lt;!--i&gt;&lt;font size=-3&gt; expand all -- collapse all&lt;/font&gt;&lt;/i--&gt;
<font class='lnum'>4084</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('tocmain');"&gt;
<font class='lnum'>4085</font>   &lt;b&gt;TABLE OF CONTENTS [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>4086</font>   &lt;/div&gt;
<font class='lnum'>4087</font>   
<font class='lnum'>4088</font>   &lt;div id='tocmain' style='display:$toc_expanded' style='background:#ffffff'&gt; 
<font class='lnum'>4089</font>   &lt;p&gt;
<font class='lnum'>4090</font>   &lt;br&gt;
<font class='lnum'>4091</font>   &lt;p&gt;
<font class='lnum'>4092</font>   end_of_print
<font class='lnum'>4093</font>   
<font class='lnum'>4094</font>   </fieldset></pre>
<p>
Table of Contents from the formed "tocbuf":<br>
<p>
<font class='lnum'>4098</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4099</font>   
<font class='lnum'>4100</font>    print "$tocbuf" if $print_toc;
<font class='lnum'>4101</font>    #print "$tocbuf";
<font class='lnum'>4102</font>   
<font class='lnum'>4103</font>   print "&lt;/div&gt;\n";
<font class='lnum'>4104</font>   
<font class='lnum'>4105</font>   </fieldset></pre>
<p>
Start the "Index of code chunks", collapsible:<br>
<p>
<font class='lnum'>4109</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4110</font>   
<font class='lnum'>4111</font>   print &lt;&lt;end_of_print;
<font class='lnum'>4112</font>   &lt;p&gt;
<font class='lnum'>4113</font>   &lt;br&gt;
<font class='lnum'>4114</font>   &lt;p&gt;
<font class='lnum'>4115</font>   &lt;!--fieldset&gt;&lt;legend--&gt;
<font class='lnum'>4116</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>4117</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('indbuf');"&gt;
<font class='lnum'>4118</font>   &lt;b&gt;INDEX of Code Chunks [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>4119</font>   &lt;/div&gt;
<font class='lnum'>4120</font>   &lt;!--/legend&gt;&lt;/fieldset--&gt;
<font class='lnum'>4121</font>   &lt;p&gt;
<font class='lnum'>4122</font>   &lt;div id='indbuf' style='display:$ind_expanded' style='background:#ffffff'&gt; 
<font class='lnum'>4123</font>   &lt;ul&gt;
<font class='lnum'>4124</font>   &lt;p&gt;
<font class='lnum'>4125</font>   &lt;b&gt;"Def" subscript&lt;/b&gt; means the chunk is defined, while a bare number means 
<font class='lnum'>4126</font>   &lt;br&gt;the chunk is being used in the given section.
<font class='lnum'>4127</font>   &lt;p&gt;
<font class='lnum'>4128</font>   end_of_print
<font class='lnum'>4129</font>   
<font class='lnum'>4130</font>   </fieldset></pre>
<p>
<p>
Index of code chunks; calculated in this snippet:<br>
<p>
<font class='lnum'>4135</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4136</font>   
<font class='lnum'>4137</font>   	 $ind_outbuf = '';
<font class='lnum'>4138</font>   	 $prev_ch_name = '';
<font class='lnum'>4139</font>   
<font class='lnum'>4140</font>   	 #for (sort @indbuf){ print $_, "&lt;br&gt;";}
<font class='lnum'>4141</font>   
<font class='lnum'>4142</font>   	 for (sort @indbuf){
<font class='lnum'>4143</font>   
<font class='lnum'>4144</font>   	   ($ch_name, $closing_bracket, $ref_num) = split /&amp;gt;/, $_; 
<font class='lnum'>4145</font>   		#/ - for editor colouring bug
<font class='lnum'>4146</font>   
<font class='lnum'>4147</font>   	    if ( $ch_name eq $prev_ch_name ){ 
<font class='lnum'>4148</font>   	      $ind_outbuf .= " &lt;b&gt;" . $ref_num . "&lt;/b&gt; ";
<font class='lnum'>4149</font>   	    }
<font class='lnum'>4150</font>   	    else{
<font class='lnum'>4151</font>   	      print  $ind_outbuf, "&lt;br&gt;\n"; 
<font class='lnum'>4152</font>   	      $ch_namestr = $ch_name;
<font class='lnum'>4153</font>   	      $ch_namestr =~ s!&amp;lt;&amp;lt;!!;
<font class='lnum'>4154</font>   	      $ind_outbuf = 
<font class='lnum'>4155</font>   	      	"&lt;b&gt;&amp;lt;&amp;lt;&lt;/b&gt;&lt;font class='chunkref'&gt;" . 
<font class='lnum'>4156</font>   	      	$ch_namestr . 
<font class='lnum'>4157</font>   	      	"&lt;/font&gt;&lt;b&gt;&amp;gt;&amp;gt;&lt;/b&gt; -- &lt;b&gt;" . 
<font class='lnum'>4158</font>   	      	$ref_num . 
<font class='lnum'>4159</font>   	      	"&lt;/b&gt; ";
<font class='lnum'>4160</font>   	    }
<font class='lnum'>4161</font>   	    $prev_ch_name = $ch_name;
<font class='lnum'>4162</font>   
<font class='lnum'>4163</font>   	 }; # rof - forming the code chunks index
<font class='lnum'>4164</font>   
<font class='lnum'>4165</font>   	print $ind_outbuf, "&lt;br&gt;\n";
<font class='lnum'>4166</font>   
<font class='lnum'>4167</font>   </fieldset></pre>
<p>
<p>
"expand all" and "collapse all" at the end of the TOC/Chunk Index section <br>
at the top of the page:<br>
<p>
<font class='lnum'>4173</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4174</font>   
<font class='lnum'>4175</font>     # The "expand all" "collapse all" control
<font class='lnum'>4176</font>   
<font class='lnum'>4177</font>   print &lt;&lt;end_of_print;
<font class='lnum'>4178</font>   &lt;/div&gt;\n&lt;p&gt;
<font class='lnum'>4179</font>   &lt;br&gt;
<font class='lnum'>4180</font>   &lt;p&gt;&lt;div class='hl' align=center&gt;&lt;i&gt;
<font class='lnum'>4181</font>   &lt;a href="javascript:;" onmousedown="showAll();"&gt;
<font class='lnum'>4182</font>   expand all&lt;/a&gt; -- 
<font class='lnum'>4183</font>   &lt;a href="javascript:;" onmousedown="hideAll();"&gt;
<font class='lnum'>4184</font>   collapse all&lt;/a&gt;
<font class='lnum'>4185</font>   &lt;/i&gt;&lt;/div&gt;&lt;p&gt;
<font class='lnum'>4186</font>   end_of_print
<font class='lnum'>4187</font>   
<font class='lnum'>4188</font>   
<font class='lnum'>4189</font>    print "&lt;/ul&gt;&lt;/fieldset&gt;&lt;p&gt;\n&lt;br&gt;";
<font class='lnum'>4190</font>   
<font class='lnum'>4191</font>   </fieldset></pre>
<p>
<p>
<p>
..and the document itself, formed earlier in the "chunkbuf" string in memory:<br>
<p>
<font class='lnum'>4197</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4198</font>   
<font class='lnum'>4199</font>   # The FULL OUTPUT, the file body:
<font class='lnum'>4200</font>    	print $chunkbuf;
<font class='lnum'>4201</font>   
<font class='lnum'>4202</font>   </fieldset></pre>
<p>
Close the HTML formatting tags at the end of the page:<br>
<p>
<font class='lnum'>4206</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4207</font>   
<font class='lnum'>4208</font>   # close the page
<font class='lnum'>4209</font>   	print $html_body_table_end;
<font class='lnum'>4210</font>   	
<font class='lnum'>4211</font>   
<font class='lnum'>4212</font>   #--- END OF SCRIPT ---
<font class='lnum'>4213</font>   
<font class='lnum'>4214</font>   </fieldset></pre>
<p>
End of the project file<br>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('82');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('69');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('83');">
<font class='lnum'><i>(83)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4223)</i></sub></font></a></legend></fieldset>
<p>
<div id="83" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('83');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('84');">
<font class='lnum'><i>(84)</i></font>&nbsp; ADD-ON: example of additional markup - dotHTML - change unfinished</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4226)</i></sub></font></a></legend></fieldset>
<p>
<div id="84" style="display:none">   
<ul>


<p>
<i> This subsection is a good example of the "out-of-order" processing that is<br>
enabled in Literate Programming. Pieces for this subsection come from different<br>
parts of the script and are laid out logically rather than in the order imposed<br>
by the machine </i><br>
<p>
<b> <i> Notes </i> </b><br>
<ul><br>
Implementation of a simple "dotHTML" markup  in which angle brackets are substituted<br>
with dots for some of the commonest HTML tags (to speed up typing and eliminate typos).<br>
<p>
To add your own markup, such as "wiki" or one of the "markdowns", copy this section<br>
and adjust contents. The idea is that MOLLY iterates over documentation sections<br>
line by line, so your filter can use regular expressions for a line-by-line processing<br>
of the documentation chunk text.<br>
<p>
Make sure your new "markdown" does not interfere with the 3 major escapes used in <br>
the "mollified" Literate Source file: the double angle brackets and the "at" symbol<br>
(imposed by "noweb" tools markup) and the double backticks ( MathML interpretation<br>
if you enable it) plus words "a m a t h" and "e n d a m a t h" without spaces btw letters.<br>
</ul><br>
<p>
<p>
<b> <i> ...unfinished... </i> </b><br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('84');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('85');">
<font class='lnum'><i>(85)</i></font>&nbsp; ADD-ON: ASCIIMathML and LaTeXMathML inside Molly  </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4257)</i></sub></font></a></legend></fieldset>
<p>
<div id="85" style="display:none">   
<ul>


<p>
<b> 1 </b> <i> STATUS </i> - Ok, but may be brittle if escapes (double backticks)<br>
get in conflict with the target prog language or some "markdown" <br>
introduced later into Molly.<br>
<p>
Also - may have lost LaTex functionality because of my need to<br>
preserve $ for programming language use.<br>
<p>
<b> WILL NEED TO DISTRIBUTE THE MODIFIED LIBRARY NOW with Molly </b><br>
<p>
<b> 2  Implementation </b><br>
.. was straightforward: I simply cut in an invocation of ASCIIMathML.js into the header of <br>
my generated output folding-HTML file. That's it.<br>
<p>
Then I tested the lib and found that it reacts to backticks and $ signs in my code sections etc.<br>
Then I made a customized copy.<br>
<p>
If some symbols are missing, you can customize it by simply adding a line to teh MOLLY.weave<br>
source code and re-tangling the MOLLY.pl<br>
<p>
Here is how:<br>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('86');">
<font class='lnum'><i>(86)</i></font>&nbsp; Extending the lib with missing LaTeX or HTML symbols </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4281)</i></sub></font></a></legend></fieldset>
<p>
<div id="86" style="display:none">   
<ul>

<p>
Documentation to the library explains how to add lines in JavaScript to your html file which will<br>
extend the list of symbols known to the library.<br>
<a href= http://www1.chapman.edu/~jipsen/mathml/asciimathextend.html  > http://www1.chapman.edu/~jipsen/mathml/asciimathextend.html  </a><br>
A copy of the page:<br>
<ul><br>
<b>ASCIIMathML.js: Extending the symbol table</b><br>
<p>
The standard symbol table of ASCIIMathML.js does not contain many symbols. <br>
It can be extended by adding additional symbols on any webpage that requires<br>
them. This is done by adding a few lines of JavaScript code.<br>
<p>
<b> 1. For example </b> , suppose we want to add symbols for "not less or equal"<br>
    and "not greater or equal".<br>
<p>
<ul> <li> We first have to find the four-digit hexadecimal Unicode value for these symbols<br>
by looking them up at, say, <br>
<a href= http://www.w3.org/TR/MathML2/chapter6.html#chars.entity.tables > http://www.w3.org/TR/MathML2/chapter6.html#chars.entity.tables </a><br>
<p>
</li> <li> Next we have to decide what input strings we want to associate with these<br>
symbols, say "!&lt;=" and "!&gt;=".<br>
<p>
</li> <li> Finally we add the following lines to the head or body of our HTML file:<br>
<pre>
&lt;script type="text/javascript"&gt;
define("!&lt;=","\u2270")
define("!&gt;=","\u2271")
&lt;/script&gt;
</pre><br>
</li> </ul><br>
<p>
Here we test the modified symbol table: a !&lt;= b !&gt;= c produces ``a !&lt;= b !&gt;= c``<br>
<p>
<b> 2. To add a symbol to the LaTeX commands </b>, use the following alternate syntax:<br>
<p>
<pre>
&lt;script type="text/javascript"&gt;
newcommand("\\nle","\u2270")
newcommand("\\nge","\u2271")
&lt;/script&gt;
</pre><br>
<p>
Now \$a \nle b \nge c\$ produces $a \nle b \nge c$.<br>
<p>
<p>
<b> 3. If you know the numeric entity reference </b>  of the symbol you want <br>
to use on an ASCIIMathML webpage, you can also refer to the symbol <b> directly </b> <br>
by using that reference. <br>
<p>
E.g &amp;#x2270; produces  ``&amp;#x2270;`` . If a symbol is only used occasionally, this is certainly <br>
the simplest way to include it. <br>
</ul><br>
<p>
<i> /error/ My copy of the page in MOLLY does not let ampersand invocations through <br>
ALSO: my copy of the lib, in which I mechanically changed single backticks to double backticks<br>
may have clobbered something, too.<br>
CHECK IT. </i><br>
<p>
Therefore, <b> to extend it in MOLLY </b>, just continue this chunk here (the "script .." --- "/script"<br>
tags are already provided in the code, do NOT retype them, input only the contents):<br>
<p>
<font class='lnum'>4343</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;HTML head section javascript add-ons&gt;&gt;=</legend>
<font class='lnum'>4344</font>   
<font class='lnum'>4345</font>   //type in commands to extend ASCIIMathML.js here;
<font class='lnum'>4346</font>   // no "script" "/script" wrappers needed
<font class='lnum'>4347</font>   // ....NOT FUNCTIONAL YET.....
<font class='lnum'>4348</font>   
<font class='lnum'>4349</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('86');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('87');">
<font class='lnum'><i>(87)</i></font>&nbsp; Testing ASCIIMathML.js -- OK partially </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4354)</i></sub></font></a></legend></fieldset>
<p>
<div id="87" style="display:none">   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('88');">
<font class='lnum'><i>(88)</i></font>&nbsp; test one - simple </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4358)</i></sub></font></a></legend></fieldset>
<p>
<div id="88" style="display:none">   
<ul>


<p>
Let's test if it works by adding some formulae here:<br>
<b> I changed the ASCIIMathML.js to use <i> double backticks </i> as escapes </b><br>
So strings wrapped in double-backticks or chunks of text with formulae inside<br>
"a m a t h" .... "e n d a m a t h" are the only ones that should be interpreted.<br>
<p>
NOTE: they appear in blue, so errors, if the math lib picks up other parts of <br>
your LitProg file unnecessarily and mangles them, one could see it with<br>
"expand all" and checking for blue insertions.<br>
<p>
NOTE 2: the math lib stops working between the "pre" - "/pre" tags<br>
<p>
NOTE 3: Rolling the mouse over the interpreted formula will display<br>
a baloon with the ascii coding of the expression (very convenient)<br>
<p>
<ul><br>
Let's try some interesting formulas: ``E=m c^2``<br>
and ``e^(i pi)=-1`` <br>
and ``AA x in CC (sin^2x+cos^2x=1)`` <br>
and one more: ``sum_(i=1)^n i^3=((n(n+1))/2)^2``<br>
<p>
(add your own -- note that text-tokens are only recognized if separated by spaces)<br>
</ul><br>
OK, here we are - in between 2 math sections<br>
<p>
<ul><br>
<p>
amath<br>
Example: Solving the quadratic equation.<br>
Suppose a x^2+b x+c=0 and a!=0. We first divide by \a to get x^2+b/a x+c/a=0. <br>
<p>
Then we complete the square and obtain x^2+b/a x+(b/(2a))^2-(b/(2a))^2+c/a=0. <br>
The first three terms factor to give (x+b/(2a))^2=(b^2)/(4a^2)-c/a.<br>
Now we take square roots on both sides and get x+b/(2a)=+-sqrt((b^2)/(4a^2)-c/a).<br>
<p>
Finally we move the b/(2a) to the right and simplify to get <br>
the two solutions: x_(1,2)=(-b+-sqrt(b^2-4a c))/(2a) <br>
endamath<br>
<p>
</ul><br>
<p>
..and now let's check some LaTeX constants:<br>
<ul><br>
<pre> \int &nbsp; \oint &nbsp; \partial &nbsp; \nabla </pre> <br>
``\int`` &nbsp; ``\oint`` &nbsp; ``\partial`` &nbsp; ``\nabla``<br>
<pre> \pm &nbsp; \emptyset &nbsp; \infty &nbsp; \aleph </pre><br>
``\pm`` &nbsp; ``\emptyset`` &nbsp; ``\infty`` &nbsp; ``\aleph`` <br>
<pre> |\ldots| &nbsp; |\cdots| </pre><br>
``|\ldots|`` &nbsp; ``|\cdots|`` <br>
<pre> |\ | &nbsp; |\quad| &nbsp; \diamond </pre><br>
&nbsp; ``|\ |`` &nbsp; ``|\quad|`` &nbsp; ``\diamond`` <br>
</ul> <br>
<p>
<i> <b> end of math test </b> </i><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('88');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('89');">
<font class='lnum'><i>(89)</i></font>&nbsp; test two - from realistic paper, partially failing  </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4418)</i></sub></font></a></legend></fieldset>
<p>
<div id="89" style="display:none">   
<ul>


<p>
<hr width=30% align=left><br>
<p>
<b> ..MORE from some paper: </b><br>
<p>
<b> 1. Freudental Formula </b><br>
``mult(\xi)=\frac{2}{(\mu+\rho|\mu+\rho)-(\xi+\rho|\xi+\rho)}\sum_{\alpha\in\Delta^{+}} mult(\alpha) \sum_{k=1}^{\infty}mult(\xi+k\alpha)(\xi+k\alpha|\alpha)``<br>
It includes roots ``\Delta=\left\{k\delta+\alpha|k\in Z,\; \alpha\in \Delta_0\right\}``<br>
positive roots ``\Delta^{+}=\{k\delta+\alpha|k\geq 0,\; \alpha\in \Delta_0^{+}\}\cup \{k\delta+\alpha|k\geq 1,\; \alpha\in \Delta_0\setminus \Delta_0^{+}\}``<br>
<p>
<b> The above is rendered correctly by ASCIIMathML.js and LaTeXMathML.js </b> <br>
libraries from the standalone Editor.It is rendered correctly with <br>
ASCIIMathML_with_modified_escapes.js from Molly <br>
(Testing with LaTeXMathML.js requires wrapping the formulas in dollar signs)<br>
<p>
<p>
<b> 2. The following long formulas <i> fail on both </i> ASCII and LaTeX libraries </b> tested<br>
from the standalone Editor and ASCII_with_modified_escapes from Molly<br>
The number of incorrect renderings is small (1 or 2 elements left unrendered), and<br>
suggests those elemens are simply missing in definitions.<br>
<p>
<p>
 The idea is to use recurrent relations for anomalous branching<br>
coefficients based on the summation over the special set of vectors <br>
``\Gamma_{\fr ak{a}\subset \fr ak{g}}``  called ````fan''. We<br>
need to introduce some notations. Let's consider the reduction of the<br>
representation of the affine Lie algebra ``\math \fr ak{g}`` to <br>
representations of affine Lie algebra ``\math \fr ak{a}``. By<br>
``\pi_{\math \fr ak{a}}`` we denote the projection of the root space<br>
``\fr ak{h}_{\fr ak{g}}^{\ast } to \fr ak{h}_{\fr ak{a}}^{\ast }``. The<br>
set ``\Gamma_{\fr ak{a}\subset \fr ak{g}}``  is introduced as the<br>
combination of projection of positive roots ``\Delta^{+}`` of algebra<br>
``\fr ak{g}`` using formulae:<br>
<p>
<b> <i> The above paragraph is OK </i> </b><br>
The following is rendered incompletely:<br>
<p>
{eq:7}<br>
<p>
 ``\prod_{\alpha \in \left( \pi _{\fr ak{a}}\circ \Delta ^{+}\right) }\left( 1-e^{-\alpha }\right) ^{\mathrm{{mult}\left( \alpha \right) -{mult}}_{\fr ak{a% }}\mathrm{\left( \alpha \right) }}=-\sum_{\gamma \in \Phi _{\fr ak{a}\subset \fr ak{g}}}s\left( \gamma \right) e^{-\gamma }``.  <br>
<p>
 {{{5<br>
<p>
{eq:18}<br>
<p>
 `` \Phi _{\frak{a}\subset \frak{g}}=\left\{ \gamma \in P_{\frak{a}}\mid s\left( \gamma \right) \neq 0\right\} ``;  <br>
<p>
<p>
{eq:19}<br>
<p>
 `` \Gamma_{\frak{a}\subset \frak{g}}=\left\{ \xi -\gamma _{0}|\xi \in \Phi _{% \frak{a}\subset \frak{g}}\right\} \setminus \left\{ 0\right\} .`` <br>
<p>
<p>
{recurrent-relation}<br>
<p>
``  k_{\xi }^{\left( \mu \right) }=-\frac{1}{s\left( \gamma _{0}\right) }\left( \sum_{w\in W}\epsilon \left( w\right) \delta _{\xi ,\pi _{\frak{a}}\circ \left( w\circ (\mu +\rho )-\rho \right) +\gamma _{0}}+\sum_{\gamma \in \Gamma _{\frak{a}\subset \frak{g}}}s\left( \gamma +\gamma _{0}\right) k_{\xi +\gamma }^{\left( \mu \right) }\right)   <br>
``<br>
{{{5<br>
<p>
Fan doesn't depend on the module, but<br>
is determined by the injection of sub-algebra into the algebra. If <br>
sub-algebra is Cartan sub-algebra, this relation gives...<br>
<p>
<p>
<p>
<p>
<hr width=30% align=left><br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('89');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('87');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('85');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('34');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('1');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>


</td></tr></table></center></body></html>

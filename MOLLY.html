<html>
  
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 


<script type="text/javascript" src="ASCIIMathML_with_modified_escapes.js"></script>


<script language="javascript">

function toggleDiv(divid) {
var el = document.getElementById(divid);
el.style.display = (el.style.display == 'block') ? 'none' : 'block';
}


function toggleCombined(divid){
    if(document.getElementById(divid).style.display == 'none'){
      document.getElementById(divid).style.display = 'block';
	document.getElementById("toc"+divid).className="hilited";
    }
    else{
      document.getElementById(divid).style.display = 'none';
	document.getElementById("toc"+divid).className="unhilited";
    }
}


function showAll(){
for(i=1; i <= 10000; i++){
    document.getElementById(i).style.display = 'block';
    document.getElementById("toc"+i).className="hilited";
    };
}

function hideAll(){
for(i=1; i <= 10000; i++){
    document.getElementById(i).style.display = 'none';
    document.getElementById("toc"+i).className="unhilited";
    };
}

</script>
<style type="text/css" media="screen">


BODY {
	FONT-SIZE: 10pt;
	<!--FONT-FAMILY: sans-serif -->
	background: #f0f0f0;
	}
FIELDSET {
	BORDER-RIGHT: #000000 1px solid; 
	BORDER-TOP: #000000 1px solid; 
	BORDER-LEFT: #000000 1px solid; 
	BORDER-BOTTOM: #000000 1px solid; 
	PADDING-RIGHT: 5px; 
	PADDING-LEFT: 5px; 
	PADDING-BOTTOM: 2px; 
	PADDING-TOP: 5px;
	MARGIN-BOTTOM: 1px; 
	background: #f5f5f5; 
	color: #000000;
	}
LEGEND {
	BORDER-RIGHT: #a9a9a9 1px solid; 
	BORDER-BOTTOM: #a9a9a9 1px solid;
	BORDER-TOP: #a9a9a9 1px solid; 
	BORDER-LEFT: #a9a9a9 1px solid; 
	PADDING-RIGHT: 20px; 
	PADDING-LEFT: 20px; 
	PADDING-BOTTOM: 5px; 
	PADDING-TOP: 5px; 
	FONT-WEIGHT: bold;  
	BACKGROUND: #fdfdfd; 
	color: #000000;
	}
PRE	{
        PADDING-LEFT: 20px; 
        PADDING-RIGHT: 5px; 
        padding-top: 0px; 
        padding-bottom: 6px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
	background: #fefefe;
	}


.tocfieldset {
	background: #ffffff; 
	color: #000000;
	}

.codefieldset {
	BORDER-RIGHT: #000 1px solid; 
	BORDER-TOP: #000 1px solid; 
	BORDER-LEFT: #000 1px solid; 
	BORDER-BOTTOM: #000 1px solid; 
	background: #ffffff; 
	color: #000;
	MARGIN-BOTTOM: 1px; 
	PADDING-LEFT: 15px; 
	PADDING-RIGHT: 5px; 
	PADDING-BOTTOM: 10px; 
	PADDING-TOP: 1px;
	}
.codelegend {
	BORDER-RIGHT: #777 1px solid; 
	BORDER-TOP: #777 1px solid; 
	BORDER-LEFT: #777 1px solid; 
	BORDER-BOTTOM: #777 1px solid
	PADDING-RIGHT: 10px; 
	PADDING-LEFT: 10px; 
	PADDING-TOP: 2px; 
	PADDING-BOTTOM: 2px; 
	background: #ffffff; 
	color: #00b;
	FONT-WEIGHT: bold;  
	/font-variant: small-caps;
	/font-style: italic;
	}



.chunkref {
        color: #00b;	
        background: #f6f6f6;
        /font-style: italic;
        font-weight: bold;
        /font-variant: small-caps;
	}


.outertable {
	width: 99%; 
	cellpadding: 25; 
	background: #ffffff; 
	border: 1px solid;
	}

.hl	{
	 ;
        PADDING-LEFT: 5px; PADDING-RIGHT: 5px; 
        padding-top: 5px; padding-bottom: 5px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
        background: #f5f5f5;	
        width: 70%;
	}

.hl-wide {
	 ;
        PADDING-LEFT: 5px; 
        PADDING-RIGHT: 5px; 
        padding-top: 15px; 
        padding-bottom: 15px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
        background: #fbfbfb;	
	}

.lnum {

	color: #a0a0a0;
	/background: #fbfbfb;
	}

.unhilited {background-color:white}
.hilited {background-color:#c0c0ff}


</STYLE>

</head>

 <body>  <center><table class='outertable'><tr><td> 
<p><fieldset class='tocfieldset'><legend><b>TABLE OF CONTENTS: outline of the document structure</b></legend>

<ul>
<p>
<br>
<div class='hl' align=center>
<a href="javascript:;" onmousedown="toggleDiv('tochowto');">
<b>HOW TO USE THE FOLDING DOCUMENT [expand/collapse]</b></a>
</div>
<div id='tochowto' style='display:none' style='background:#ffffff'> 
<p>
<ul>
<li><b>Collapsing is necessary when</b> you work on some code and must exclude 
<br>irrelevant sections of the rest of the literate project file. This 
<br>greatly helps to clear thinking by eliminating a general feeling of 
<br>being in a maze of code and unnecessary "housekeeping" tasks.
<br>One can say that there is a limited "buffer capacity" in the human
<br>mind, and relieving it of the need to remember where things are in a 
<br>larger file, at which other points one must fill in values or adjust
<br>invocation etc. <i>immediately makes the user "more intelligent"</i>
</li><li><b>To toggle</b> a section open/closed, click on the corresponding link
<br>Remember to open <i>all sections above it</i> for it to become visible.
</li><li><b>To restore the default view</b> reload the page in the browser.
</li><li>
<b>To keep some sections open</b> upon each reload - 
<br>e.g. you work on the code, update it constantly and cannot reopen it 
<br>again and again - mark their sections in the source file with a plus, 
<br>i.e. write the opening tag (only)  as +h2, +h3 (in &lt; &gt;  or in dots
<br>for dotHTML). Again, all sections above must be marked open too. 
<p><b>Note that</b> "expand all" and "collapse all" disregard these settings.
<br>Reload the page after using those options to again view the text according 
<br>to your preferences.
</li><li>
<b> To use the Index </b>, click on the numbered sections in the TOC above
<br>(opening them; use highlighting as a guide; when sections are visible,
<br>the slider on your browser window  will shorten too), or "expand all", 
<br>and then use your browser's Find function to highlight all chunk name 
<br>instances in the visible text
</li><li>
<b>To search for variables etc.</b>, "expand all" text - or manually 
<br>expand needed sections - and then use your browser's Find function to 
<br>highlight all and jump between the found items.
<p></li>

</div> 
<p>
<br>
<p>
<div class='hl' align=center>
<!--i><font size=-3> expand all -- collapse all</font></i-->
<a href="javascript:;" onmousedown="toggleDiv('tocmain');">
<b>TABLE OF CONTENTS [expand/collapse]</b></a>
</div>

<div id='tocmain' style='display:block' style='background:#ffffff'> 
<p>
<br>
<p>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>1</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(1);" id="toc1"><b> MOLLY MODULE </a>&nbsp;<a><font class='lnum' size=-1><i>(line 70)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>2</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(2);" id="toc2"><b> THE CHUNK TO TANGLE BY  DEFAULT </a>&nbsp;<a><font class='lnum' size=-1><i>(line 109)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>3</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(3);" id="toc3"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 142)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>4</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(4);" id="toc4"><b> PART I ----------- History and concepts. "Management of thinking" ------------ </a>&nbsp;<a><font class='lnum' size=-1><i>(line 145)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>5</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(5);" id="toc5"><b> What is Literate Programming? </a>&nbsp;<a><font class='lnum' size=-1><i>(line 148)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>6</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(6);" id="toc6"><b> My example from ru_perl (in Russian) </a>&nbsp;<a><font class='lnum' size=-1><i>(line 155)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>7</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(7);" id="toc7"><b> Invented example (an urban legend) - unfinished </a>&nbsp;<a><font class='lnum' size=-1><i>(line 273)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>8</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(8);" id="toc8"><b> Controlling human attention </a>&nbsp;<a><font class='lnum' size=-1><i>(line 322)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>9</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(9);" id="toc9"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 486)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>10</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(10);" id="toc10"><b> PART II ------------ HOW TO USE MOLLY.pl ------------ </a>&nbsp;<a><font class='lnum' size=-1><i>(line 489)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>11</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(11);" id="toc11"><b> My workflow - literate programming with Molly </a>&nbsp;<a><font class='lnum' size=-1><i>(line 494)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>12</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(12);" id="toc12"><b> SET UP a Literate Source file and project </a>&nbsp;<a><font class='lnum' size=-1><i>(line 546)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>13</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(13);" id="toc13"><b> Prerequisites: "noweb" tools By Norman Ramsey </a>&nbsp;<a><font class='lnum' size=-1><i>(line 552)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>14</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(14);" id="toc14"><b> Setting up the file </a>&nbsp;<a><font class='lnum' size=-1><i>(line 568)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>15</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(15);" id="toc15"><b> "Mollification" - full configuration template </a>&nbsp;<a><font class='lnum' size=-1><i>(line 648)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>16</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(16);" id="toc16"><b> Markup of code and documentation sections </a>&nbsp;<a><font class='lnum' size=-1><i>(line 737)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>17</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(17);" id="toc17"><b> Tangling from LSFile </a>&nbsp;<a><font class='lnum' size=-1><i>(line 778)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>18</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(18);" id="toc18"><b> Sample minimal configuration of thttpd </a>&nbsp;<a><font class='lnum' size=-1><i>(line 809)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>19</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(19);" id="toc19"><b> CREATE a Literate Source file -- markup of documentation chunks </a>&nbsp;<a><font class='lnum' size=-1><i>(line 877)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>20</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(20);" id="toc20"><b> Markup </a>&nbsp;<a><font class='lnum' size=-1><i>(line 881)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>21</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(21);" id="toc21"><b> Markup and Escaping </a>&nbsp;<a><font class='lnum' size=-1><i>(line 937)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>22</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(22);" id="toc22"><b> Mathematical Formulae - MathML inside Mollified Literate source files </a>&nbsp;<a><font class='lnum' size=-1><i>(line 967)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>23</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(23);" id="toc23"><b> How to use ASCIIMathML.js in Molly </a>&nbsp;<a><font class='lnum' size=-1><i>(line 985)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>24</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(24);" id="toc24"><b> 6 . Some examples and LaTexMathML.js library versions </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1037)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>25</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(25);" id="toc25"><b> 7 .  ASCIIMathML Markup - reference </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1124)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>26</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(26);" id="toc26"><b> How to distribute your final folding HTML-formatted work </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1153)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>27</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(27);" id="toc27"><b> READ and SEARCH inside a Folding Literate Source file </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1193)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>28</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(28);" id="toc28"><b> Opening many relevant subsections together, TOC highlighting </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1199)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>29</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(29);" id="toc29"><b> Keeping some sections of the LSFile permanently open </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1215)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>30</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(30);" id="toc30"><b> TOC and Code Chunks Index </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1272)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>31</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(31);" id="toc31"><b> Searching for symbols, chunks, phrases </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1296)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>32</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(32);" id="toc32"><b> TOC/Index unfolding and collapsing </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1312)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>33</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(33);" id="toc33"><b> Use for printing </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1321)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>34</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(34);" id="toc34"><b> Text browsers and JavaScript </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1336)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>35</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(35);" id="toc35"><b> SUGGESTED USES: Work with Folding LSFiles</a>&nbsp;<a><font class='lnum' size=-1><i>(line 1354)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>36</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(36);" id="toc36"><b> scrap </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1447)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>37</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(37);" id="toc37"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1480)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>38</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(38);" id="toc38"><b> PART III ------------ LITERATE SOURCE OF THE SCRIPT ------------ </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1483)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>39</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(39);" id="toc39"><b> Local Reference </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1488)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>40</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(40);" id="toc40"><b> Bugs, status, changes </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1507)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>41</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(41);" id="toc41"><b> Ideas - versions - changes</a>&nbsp;<a><font class='lnum' size=-1><i>(line 1511)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>42</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(42);" id="toc42"><b> first ideas </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1528)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>43</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(43);" id="toc43"><b> more ideas </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1629)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>44</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(44);" id="toc44"><b>  CONTRACT PROGRAMMING and Molly?? </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1675)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>45</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(45);" id="toc45"><b> Editor highlighting, Perl POD and Literate Markup </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1721)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>46</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(46);" id="toc46"><b>Done </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1749)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>47</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(47);" id="toc47"><b>Todo -  current</a>&nbsp;<a><font class='lnum' size=-1><i>(line 1815)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>48</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(48);" id="toc48"><b> PRELIMINARIES: The script layout and idea </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1880)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>49</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(49);" id="toc49"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1956)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>50</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(50);" id="toc50"><b> MOLLY.pl - top of the script </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1959)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>51</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(51);" id="toc51"><b> general settings </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1982)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>52</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(52);" id="toc52"><b> main despatcher </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2103)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>53</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(53);" id="toc53"><b> With tanglediffs as an option </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2120)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>54</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(54);" id="toc54"><b> a skeleton script to test this snippet </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2153)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>55</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(55);" id="toc55"><b> With wavediff and tanglediff?? </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2218)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>56</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(56);" id="toc56"><b> "Main despatcher kludgy" - first version - no tanglediffs </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2321)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>57</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(57);" id="toc57"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2357)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>58</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(58);" id="toc58"><b> TANGLER </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2360)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>59</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(59);" id="toc59"><b> pass-through tangler (for "noweb" by Ramsey), default now </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2389)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>60</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(60);" id="toc60"><b> seek-peek tangler (working) </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2482)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>61</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(61);" id="toc61"><b> seek-peek tangler (preliminaries, about) </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2487)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>62</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(62);" id="toc62"><b> Geany carpings NOTES</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2519)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>63</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(63);" id="toc63"><b>Makefile</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2536)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>64</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(64);" id="toc64"><b>todo</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2575)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>65</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(65);" id="toc65"><b>The code</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2589)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>66</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(66);" id="toc66"><b> PAss 1 </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2627)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>67</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(67);" id="toc67"><b> Ref: perl operators </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2676)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>68</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(68);" id="toc68"><b> PAss 1: main while-loop and foffs</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2709)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>69</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(69);" id="toc69"><b> multiple refs on the same line</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2871)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>70</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(70);" id="toc70"><b> pass 2 and print </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2960)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>71</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(71);" id="toc71"><b> two debug chunks</a>&nbsp;<a><font class='lnum' size=-1><i>(line 3032)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>72</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(72);" id="toc72"><b> Tsort tangler - bad idea - useful leftover bits and pieces </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3068)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>73</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(73);" id="toc73"><b> Topological Sort </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3074)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>74</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(74);" id="toc74"><b> Strange var and hash key names plus string interpolation </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3158)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>75</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(75);" id="toc75"><b> Scrap pieces for tangler </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3239)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>76</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(76);" id="toc76"><b> 1. Use MD5 for chunk titles? </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3244)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>77</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(77);" id="toc77"><b> 2. ver 1 -- skeleton for tangling </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3288)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>78</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(78);" id="toc78"><b> 4. Another idea for tangling </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3412)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>79</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(79);" id="toc79"><b> 6. Lazy iteration over strings in a memory buf </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3438)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>80</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(80);" id="toc80"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3509)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>81</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(81);" id="toc81"><b> WEAVER </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3512)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>82</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(82);" id="toc82"><b> How formatting is done in the weaver </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3535)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>83</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(83);" id="toc83"><b> actual working test.html </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3571)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>84</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(84);" id="toc84"><b> changing text style - the basic JS recipy </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3703)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>85</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(85);" id="toc85"><b> Reference - Javascript and DOM </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3754)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>86</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(86);" id="toc86"><b> set formatting strings for weaver </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3770)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>87</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(87);" id="toc87"><b> JS functions </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3847)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>88</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(88);" id="toc88"><b> Stylesheet </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3901)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>89</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(89);" id="toc89"><b> Accumulate the result </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4052)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>90</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(90);" id="toc90"><b> process code chunks </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4133)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>91</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(91);" id="toc91"><b> process section headings </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4188)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>92</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(92);" id="toc92"><b> dotHTML formatter and rawHTML </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4323)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>93</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(93);" id="toc93"><b> test of &nbsp;&nbsp; s p a c i n g &nbsp;&nbsp; regexp </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4501)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>94</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(94);" id="toc94"><b> Print out the resulting page </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4552)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>95</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(95);" id="toc95"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4762)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>96</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(96);" id="toc96"><b> ADD-ON: example of additional markup - dotHTML - change unfinished</a>&nbsp;<a><font class='lnum' size=-1><i>(line 4765)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>97</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(97);" id="toc97"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4794)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>98</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(98);" id="toc98"><b> ADD-ON: ASCIIMathML and LaTeXMathML inside Molly  </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4797)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>99</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(99);" id="toc99"><b> Extending the lib with missing LaTeX or HTML symbols </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4821)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>100</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(100);" id="toc100"><b> MathML and Molly -- inclusion of ASCIIMathML.js -- testing - OK partially </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4894)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>101</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(101);" id="toc101"><b> test one - simple </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4898)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>102</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(102);" id="toc102"><b> test two - from realistic paper, partially failing  </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4958)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>103</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(103);" id="toc103"><b> Two problems - solved </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5035)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>104</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(104);" id="toc104"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5114)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>105</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(105);" id="toc105"><b> ADD-ON: Context diffs and sections editing -- not implemented </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5117)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>106</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(106);" id="toc106"><b> Outline of the idea </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5121)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>107</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(107);" id="toc107"><b> Editing - javascript versus external editor </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5153)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>108</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(108);" id="toc108"><b> Patch details and probs </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5174)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>109</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(109);" id="toc109"><b> Implementation steps </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5210)</i></font></b></a><br>
</div>
<p>
<br>
<p>
<!--fieldset><legend-->
<div class='hl' align=center>
<a href="javascript:;" onmousedown="toggleDiv('indbuf');">
<b>INDEX of Code Chunks [expand/collapse]</b></a>
</div>
<!--/legend></fieldset-->
<p>
<div id='indbuf' style='display:none' style='background:#ffffff'> 
<ul>
<p>
<b>"Def" subscript</b> means the chunk is defined, while a bare number means 
<br>the chunk is being used in the given section.
<p>
<br>
<b>&lt;&lt;</b><font class='chunkref'>*</font><b>&gt;&gt;</b> -- <b> 2<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>*-dis</font><b>&gt;&gt;</b> -- <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>Article</font><b>&gt;&gt;</b> -- <b> 7<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>DEBUG check hash keys</font><b>&gt;&gt;</b> -- <b> 71<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>DEBUG print out full hash</font><b>&gt;&gt;</b> -- <b> 71<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>HTML head section javascript add-ons</font><b>&gt;&gt;</b> -- <b> 99<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>Intro</font><b>&gt;&gt;</b> -- <b> 7</b>  <b> 7<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>JS script functions</font><b>&gt;&gt;</b> -- <b> 86</b>  <b> 87<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>MOLLY.pl module</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 50<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>Makefile</font><b>&gt;&gt;</b> -- <b> 63<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>a thousand-line-long piece of code</font><b>&gt;&gt;</b> -- <b> 8</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>accumulate result in a buffer</font><b>&gt;&gt;</b> -- <b> 81</b>  <b> 89<sub>def</sub></b>  <b> 89<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>another thousand-line-long piece of code</font><b>&gt;&gt;</b> -- <b> 8</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>body HTML formatters</font><b>&gt;&gt;</b> -- <b> 89</b>  <b> 92<sub>def</sub></b>  <b> 92<sub>def</sub></b>  <b> 92<sub>def</sub></b>  <b> 92<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>built-in tangler skeleton</font><b>&gt;&gt;</b> -- <b> 77<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>ch*nk n@me wh&amp;ch q(i$$ a p#r@se)</font><b>&gt;&gt;</b> -- <b> 74<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>check strings expansion</font><b>&gt;&gt;</b> -- <b> 2</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>check topo sort</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 73<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk beginning</font><b>&gt;&gt;</b> -- <b> 68</b>  <b> 68<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk body</font><b>&gt;&gt;</b> -- <b> 68</b>  <b> 68<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk ending</font><b>&gt;&gt;</b> -- <b> 68</b>  <b> 68<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk reference - single ref inside other text</font><b>&gt;&gt;</b> -- <b> 69<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk reference - single ref on its own line</font><b>&gt;&gt;</b> -- <b> 68</b>  <b> 68<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk reference</font><b>&gt;&gt;</b> -- <b> 68</b>  <b> 68<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>condition A</font><b>&gt;&gt;</b> -- <b> 8</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>declarations and initializations</font><b>&gt;&gt;</b> -- <b> 66</b>  <b> 66<sub>def</sub></b>  <b> 69<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>first pass of tangling - accumulate in RAM</font><b>&gt;&gt;</b> -- <b> 77</b>  <b> 77<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>full MOLLY template</font><b>&gt;&gt;</b> -- <b> 15<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>general settings</font><b>&gt;&gt;</b> -- <b> 50</b>  <b> 51<sub>def</sub></b>  <b> 51<sub>def</sub></b>  <b> 51<sub>def</sub></b>  <b> 51<sub>def</sub></b>  <b> 51<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>logical switch</font><b>&gt;&gt;</b> -- <b> 8<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher kludgy</font><b>&gt;&gt;</b> -- <b> 52</b>  <b> 56<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher with tanglediffs</font><b>&gt;&gt;</b> -- <b> 53<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher</font><b>&gt;&gt;</b> -- <b> 50</b>  <b> 52<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main: call the sub</font><b>&gt;&gt;</b> -- <b> 65</b>  <b> 65<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>matchstring2.pl</font><b>&gt;&gt;</b> -- <b> 79<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>md5 hashing from perl</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 76<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>minimal MOLLY template</font><b>&gt;&gt;</b> -- <b> 14<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>minimal thttpd configuration</font><b>&gt;&gt;</b> -- <b> 18<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>opinions: public and officials' reactions</font><b>&gt;&gt;</b> -- <b> 7</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>pass 1</font><b>&gt;&gt;</b> -- <b> 65</b>  <b> 66<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>pass 2 and print</font><b>&gt;&gt;</b> -- <b> 65</b>  <b> 70<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>print out</font><b>&gt;&gt;</b> -- <b> 81</b>  <b> 94<sub>def</sub></b>  <b> 94<sub>def</sub></b>  <b> 94<sub>def</sub></b>  <b> 94<sub>def</sub></b>  <b> 94<sub>def</sub></b>  <b> 94<sub>def</sub></b>  <b> 94<sub>def</sub></b>  <b> 94<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process code chunks</font><b>&gt;&gt;</b> -- <b> 89</b>  <b> 90<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process section headings</font><b>&gt;&gt;</b> -- <b> 89</b>  <b> 91<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>run.thttpd.sh</font><b>&gt;&gt;</b> -- <b> 18<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>second pass of tangling - print out</font><b>&gt;&gt;</b> -- <b> 77</b>  <b> 77<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>seek-peek tangler</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 65<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>set formatting strings for weaver</font><b>&gt;&gt;</b> -- <b> 81</b>  <b> 86<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>spacing.pl</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 93<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>stylesheet</font><b>&gt;&gt;</b> -- <b> 86</b>  <b> 88<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>sub: tangle recursively</font><b>&gt;&gt;</b> -- <b> 70</b>  <b> 70<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tangle me straight</font><b>&gt;&gt;</b> -- <b> 59<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tangle me with filtering</font><b>&gt;&gt;</b> -- <b> 59</b>  <b> 59<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tangle me</font><b>&gt;&gt;</b> -- <b> 50</b>  <b> 59<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tanglediff test 1</font><b>&gt;&gt;</b> -- <b> 54<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tanglediff.test2.pl</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 55<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>test names and deref</font><b>&gt;&gt;</b> -- <b> 74<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>test.html</font><b>&gt;&gt;</b> -- <b> 83<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>the meat</font><b>&gt;&gt;</b> -- <b> 70</b>  <b> 70<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>throw in some stats and end on a grand note</font><b>&gt;&gt;</b> -- <b> 7</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tsort sub in perl</font><b>&gt;&gt;</b> -- <b> 73</b>  <b> 73<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>weave me</font><b>&gt;&gt;</b> -- <b> 50</b>  <b> 81<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>while-loop and peek file ofsets</font><b>&gt;&gt;</b> -- <b> 66</b>  <b> 68<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>witness:  a personal side -- gist of story, splinter 2</font><b>&gt;&gt;</b> -- <b> 7</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>witness: a personal side, splinter 1</font><b>&gt;&gt;</b> -- <b> 7</b> <br>
</div>
<p>
<br>
<p><div class='hl' align=center><i>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</i></div><p>
</ul></fieldset><p>
<br><p>



<p>
<p>
<p>
<p>
<center> <b> Licensing </b><br>
MOLLY is licensed under GNU Public License version 3. </center><br>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('1');">
<font class='lnum'><i>(1)</i></font>&nbsp; MOLLY MODULE </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 70)</i></sub></font></a></legend></fieldset>
<p>
<div id="1" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 1).className='hilited';
		    </script>   
<ul>


<p>
<b> What is it? </b><br>
<p>
<i> Answer A: </i> this is an attempt to combine Literate Programming (as practiced with<br>
    "noweb" tools by Norman Ramsey) and autogenerated document folding/outlining with<br>
    Javascript and HTML -- to escape scalability limitation of pure L.P. and enable a number<br>
    of new source file management techniques.<br>
<p>
<i> Answer B: </i> Technically, this is "MOLLY.pl", a MO-dule for LI-terate programming, a<br>
    small perl script that implements a new type of "weaver" for Literate Programming, which:<br>
    <ul> <li> is HTML-based,<br>
    </li><li> can produce formatted documents automatically, as a CGI script, as well as in <br>
    a separate step, as a classical weaver and<br>
    </li> <li> creates <i>folding</i> documents</li> </ul><br>
<b>Why?</b><br>
    <ul><li> This greatly simplifies markup, ridding it of TeX entanglement and reducing it <br>
    to basic HTML tagging. Inputting mathematical formulae is still possible with MathML.<br>
    No more one needs to be "writing and debugging two programs in place of one", a<br>
    common complaint about the use of WEB-like lit.prog. tools based strictly on (La)TeX.<br>
    </li><li> ...while folding, as already stated, allows the programmer to apply a number of code<br>
    management techiniques not possible before with flat Literate Programming source <br>
    files. </li></ul><br>
<p>
<p>
<b>Below</b> you will find <br>
(a) an explanation of the concepts involved <br>
(b) usage information and <br>
(c) the annotated literate source of the script<br>
<p>
<p>
<br><br>
If you are not familiar with concepts behind LIterate Programming, please read an introductory<br>
article, such as the one below or <a href= http://en.wikipedia.org/wiki/Literate_Programming > http://en.wikipedia.org/wiki/Literate_Programming </a><br>
<p>
<p>
<br><br>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('2');">
<font class='lnum'><i>(2)</i></font>&nbsp; THE CHUNK TO TANGLE BY  DEFAULT </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 109)</i></sub></font></a></legend></fieldset>
<p>
<div id="2" style="display:none">   
<ul>


<p>
<font class='lnum'>112</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*&gt;&gt;=</legend>
<font class='lnum'>113</font>   <font class='chunkref'>&lt;&lt;seek-peek tangler&gt;&gt</font>;
<font class='lnum'>114</font>   </fieldset></pre>
<p>
<font class='lnum'>116</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>117</font>   <font class='chunkref'>&lt;&lt;MOLLY.pl module&gt;&gt</font>;
<font class='lnum'>118</font>   </fieldset></pre>
<p>
<font class='lnum'>120</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>121</font>   <font class='chunkref'>&lt;&lt;spacing.pl&gt;&gt</font>;
<font class='lnum'>122</font>   </fieldset></pre>
<font class='lnum'>123</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>124</font>   <font class='chunkref'>&lt;&lt;tanglediff.test2.pl&gt;&gt</font>;
<font class='lnum'>125</font>   </fieldset></pre>
<p>
<font class='lnum'>127</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>128</font>   <font class='chunkref'>&lt;&lt;md5 hashing from perl&gt;&gt</font>;
<font class='lnum'>129</font>   </fieldset></pre>
<p>
<font class='lnum'>131</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>132</font>   <font class='chunkref'>&lt;&lt;check topo sort&gt;&gt</font>;
<font class='lnum'>133</font>   </fieldset></pre>
<p>
<p>
<font class='lnum'>136</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>137</font>   <font class='chunkref'>&lt;&lt;check strings expansion&gt;&gt</font>;
<font class='lnum'>138</font>   </fieldset></pre>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('2');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('3');">
<font class='lnum'><i>(3)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 142)</i></sub></font></a></legend></fieldset>
<p>
<div id="3" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('3');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('4');">
<font class='lnum'><i>(4)</i></font>&nbsp; PART I ----------- History and concepts. "Management of thinking" ------------ </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 145)</i></sub></font></a></legend></fieldset>
<p>
<div id="4" style="display:none">   
<ul>


<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('5');">
<font class='lnum'><i>(5)</i></font>&nbsp; What is Literate Programming? </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 148)</i></sub></font></a></legend></fieldset>
<p>
<div id="5" style="display:none">   
<ul>

<p>
<b> <i> This is a techinique for "management of thinking", which has nothing to do with programming. </i> </b><br>
<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('6');">
<font class='lnum'><i>(6)</i></font>&nbsp; My example from ru_perl (in Russian) </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 155)</i></sub></font></a></legend></fieldset>
<p>
<div id="6" style="display:none">   
<ul>


<p>
И, наконец, третье объяснение что значит писать 'на ЛП'.<br>
Если бы целью вашей была не программа, а роман или статья-эссе, то "писать на ЛП"<br>
означало бы писать примерно так:<br>
<p>
<p>
<ul><br>
    &lt; &lt;quote&gt; &gt;=<br>
    A HISTORICAL CURIOSITY<br>
    this is a &lt; &lt;story&gt; &gt; that was used<br>
    by Emperor Friedrich II when he replied<br>
    to &lt; &lt;ambassadors&gt; &gt; of France, famously:<br>
    "bla-bla-bla.<br>
    &lt; &lt;quote_continued&gt; &gt;"<br>
    @<br>
<p>
    &lt; &lt;story&gt; &gt;=<br>
    histoical quote that first surfaced in a lesser-known Austrian publication in 1843<br>
    @<br>
<p>
    &lt; &lt;ambassadors&gt; &gt;=<br>
    Earl Marra and Count Swiepolski<br>
    @<br>
<p>
    &lt; &lt;quote_continued&gt; &gt;=<br>
    Hrrrrrr mbrruaghhhrch<br>
    awwrraghrtps<br>
    pst pst pst.<br>
    @<br>
</ul><br>
<p>
<p>
И на самом деле так можно писать любые тексты, например журналистскую статью, в которой <br>
есть некая последовательная мысль, а отдельные куски или неизвестные сразу факты <br>
разрабатываются и добавляются позже.<br>
<p>
ЛП - метод организации мыслей и придания тексту структуры на мета-уровне, на основе неких <br>
фраз, скрывающих за собой любой "оконечный код" или любые подобые абстракции.<br>
<p>
Пре-процессор их автоматически подставит и развернет все в нужной последовательности<br>
<p>
<p>
Кстати как видите в последнем примере ВООБЩЕ НЕТ НИ ОДНОГО КОММЕНТАРИЯ, и вместе с тем это <br>
"программа на ЛП": она написана на "псевдокоде", т.е. с использованием макро, которые <br>
становятся точными операторами мета-языка.<br>
<p>
Т.е. ЛП в нормальном случае связан с текстом (который объясняет концепции и идеи кода), <br>
но сама техника введения макро вместо кропотливых кусков чтобы теми кусками заняться в <br>
их очередь и избавить мозг от нагрузки по ведению учета и контроля тысячи мыслей -- то <br>
есть для того, чтобы в конечном счете СТАТЬ УМНЕЕ за счет механизма абстрагирования -- <br>
эта техника возможна и совершенно без комментариев.<br>
<p>
Которые почему-то все настаивают есть не заметки в помощь программисту, а некая "документация" <br>
якобы для посторонних людей.<br>
<p>
Нет, запись мыслей ПОМОЖЕТ и будет служить документацией идей, да. Но создается это не для <br>
васи, а для себя в момент программирования.<br>
<p>
<p>
<b> ... continued in a next commentary: </b><br>
<p>
Цитата о "людях, которые умеют хорошо писать" очень глупа потому что ПОХЕРУ хорошо ли <br>
программист пишет или так себе: он пишет для себя в помощь мыслям.<br>
<p>
Чтобы стало понятнее, возьмем последний литературный пример. Он был без комментариев. Если <br>
теперь "восстановить" те реалистические комментарии, которые там могли бы появиться в процессе,<br>
это выглядело бы примерно так:<br>
<p>
<ul><br>
    Анекдот пойдет в эпиграф третьего раздела (? - или в основной текст?)<br>
<p>
    &lt; &lt;quote&gt; &gt;=<br>
    A HISTORICAL CURIOSITY<br>
    this is a &lt; &lt;story&gt; &gt; that was used<br>
    by Emperor Friedrich II when he replied<br>
    to &lt; &lt;ambassadors&gt; &gt; of France, famously:<br>
    "bla-bla-bla.<br>
    &lt; &lt;quote_continued&gt; &gt;"<br>
    @<br>
<p>
<p>
    Уточнить дату и обстоятельства:<br>
    &lt; &lt;story&gt; &gt;=<br>
    histoical quote that first surfaced in a lesser-known Austrian publication in 1843<br>
    @<br>
<p>
    Нужны имена; если нет, выдумать: публика дура и любит "точность"<br>
    &lt; &lt;ambassadors&gt; &gt;=<br>
    Earl Marra and Count Swiepolski<br>
    @<br>
<p>
    Кажется цитата была в моих архивах: сделать поиск на хррр? пст?<br>
    Брал её из гугла; вспомнить еще какие-то слова<br>
    &lt; &lt;quote_continued&gt; &gt;=<br>
    Hrrrrrr mbrruaghhhrch<br>
    awwrraghrtps<br>
    pst pst pst.<br>
    @<br>
</ul><br>
<p>
.. ну а заполненные позже куски составят уже полный чистый текст, который НЕ НАДО лазить править <br>
руками.<br>
<p>
То есть в момент написания мы отодвинули массу соображений, которые занимают весьма <br>
ограниченные ресурсы мозга (всего-то до 7, говорят, элементов в краткосрочной памяти) и <br>
необходимости решать и увязывать детали.<br>
<p>
Мы стали "умнее" за счет того, что убрали, отодвинули куски деятельнопсти, заменив их на <br>
время фразами-абстракциями.<br>
<p>
Вот в чем суть.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('6');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('7');">
<font class='lnum'><i>(7)</i></font>&nbsp; Invented example (an urban legend) - unfinished </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 273)</i></sub></font></a></legend></fieldset>
<p>
<div id="7" style="display:none">   
<ul>


<p>
Let's suppose you are an editor of some local newspaper which wants to kick up sales.<br>
So one day you get an email that says:<br>
<ul> 'Don't know if this is true or not, but I received it from a good friend, so... <br>
    you never know... <br>
    Just a small warning of the latest way criminals operate - very inventive!! <br>
    They dress in black &amp; cover themselves in black refuse bags and wait on the<br>
    pavement. When <s> SAPS </s> police or the neighbourhood watch drive pass they<br>
    crouch down on the ground to make it look like a full black rubbish bag. <s> SAPS </s><br>
    police etc ignore the "black bags" &amp; drive past. The criminals then either wait<br>
    for the home owner to come home ---to hijack them or proceed to break into the<br>
    house.<br>
    Please be aware &amp; beware of "moving" black bags!!! --particularly on rubbish<br>
    removal days.<br>
    PS: The neighbourhood watch member who noticed this wouldn't have known any<br>
    different if one of the bags hadn't moved &amp; if he wasn't vigilant.'<br>
    <i> /* this example of a real urban legend obtained via http://thoselegends.blogspot.com/<br>
    Entry of Thursday 30 October 2008 */ </i><br>
</ul><br>
You call a meeting and say to your stuff:<br>
"Guys,  &nbsp;   &nbsp;  t h i s  &nbsp;  e e e z  &nbsp;  a  &nbsp;  b o m b ! !  &nbsp; " - (and read them the e-mail) -  "Get down to it! <br>
You write your parts, I will edit the whole thing.  Let's see..."<br>
<p>
<font class='lnum'>298</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;Intro&gt;&gt;=</legend>
<font class='lnum'>299</font>   
<font class='lnum'>300</font>   
<font class='lnum'>301</font>   </fieldset></pre>
<p>
Then after collecting the materials  the editor produces a skeleton for the article.<br>
<p>
<font class='lnum'>305</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;Article&gt;&gt;=</legend>
<font class='lnum'>306</font>   <font class='chunkref'>&lt;&lt;Intro&gt;&gt</font>;
<font class='lnum'>307</font>   <font class='chunkref'>&lt;&lt;witness: a personal side, splinter 1&gt;&gt</font>;
<font class='lnum'>308</font>   <font class='chunkref'>&lt;&lt;opinions: public and officials' reactions&gt;&gt</font>;
<font class='lnum'>309</font>   <font class='chunkref'>&lt;&lt;witness:  a personal side -- gist of story, splinter 2&gt;&gt</font>;
<font class='lnum'>310</font>   <font class='chunkref'>&lt;&lt;throw in some stats and end on a grand note&gt;&gt</font>;
<font class='lnum'>311</font>   </fieldset></pre>
<p>
<p>
<b> <i> ... unfinished ... </i> </b><br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('7');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('5');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('8');">
<font class='lnum'><i>(8)</i></font>&nbsp; Controlling human attention </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 322)</i></sub></font></a></legend></fieldset>
<p>
<div id="8" style="display:none">   
<ul>

<p>
<p>
<br><br>
<b> LP as "management of thinking" </b> <br>
<p>
    <b> <i> L.P. is a technique for "management of thinking" that help to unload short-term memory<br>
    and "splits levels" for 'global thinking" and "local changing" </i> </b><br>
<p>
    The biggest problem in managing complex texts of any kind - programming simply being the most<br>
    complicated one, where the text is not supposed contain errors at all - is in holding it all<br>
    together in one's mind.<br>
<p>
    Human short-term memory is surprisingly tiny, up to 7 to 9 objects simultaneously at any one<br>
    time, psychologists tell us. Therefore, when faced with larger tasks, humans need to use a number<br>
    of "aoivdance techniques" to dance around the limitation.<br>
<p>
    First, we constantly switch. E.g. I need to change my program. I remember the general outline of<br>
    it (as no more than several largish chunks), so I use that to figure out where to go. On each<br>
    level I would probably remember details "inside" each of those largish blocks etc.<br>
<p>
    In my experience a script or a program longer than, say 1000 to 1200 lines long becomes a major<br>
    problem unless special techniques are used to help one's mind.<br>
<p>
    In programming, probably 90% of "chunking", i.e. division into procedures, or "object" or<br>
    "functions" are not needed for the machine. They are done <b> simply for the humans not<br>
    to lose thread. </b> Things would simply become totally unmanageable otherwise.<br>
<p>
    Here comes also the idea of "writing domain-specific languages": humans chunk lower-level<br>
    operations into a new 'unit' or 'abstraction', then manipulate with higher-level abstractions<br>
    over abstractions over abstractions over abstractions..<br>
<p>
    "Literate Programming" is not a programming-specific technique that allows us to create arbitrary<br>
    systems of abstractions <i> with phrases in a human language </i> - "in pseudocode" - while staying<br>
    precise in our specification opf the final product.<br>
    In this L.P. <b> is an alternative to procedures and subroutines in the machine language </b><br>
<p>
    For example, I can easily write and maintain na LPSource file with<br>
<p>
<font class='lnum'>361</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;logical switch&gt;&gt;=</legend>
<font class='lnum'>362</font>   if (<font class='chunkref'>&lt;&lt;condition A&gt;&gt</font>;) {
<font class='lnum'>363</font>       <font class='chunkref'>&lt;&lt;a thousand-line-long piece of code&gt;&gt</font>;}
<font class='lnum'>364</font>   else { 
<font class='lnum'>365</font>       <font class='chunkref'>&lt;&lt;another thousand-line-long piece of code&gt;&gt</font>;}
<font class='lnum'>366</font>   </fieldset></pre>
<p>
    (and specify all those references elsewhere), while such code written directly would be<br>
    unmaintainable and almost impossible to understand to a human. As a result, a human would<br>
    <i> have to </i> wrap his code into some subs, with inherent limitations and complications<br>
    on their parameters and return result, built into his programming language.<br>
    The machine would slow down its execution because internally it will maintain environment<br>
    to switch to when returning etc.<br>
    Isnt't it ironic that "hand-made optimisations" include "unrolling" programming constructs<br>
    programmers introduced on the first place? The reason most probably was that otherwise<br>
    a human mind would not be able to keep the thread, they would have lost it without that<br>
    unnecessary for the machine mental chunking.<br>
<p>
<p>
    So, <ul> <i> <b> Literate Programming is a system of free-form macros in a natural human language<br>
    used as an alternative to programming language procedures used as props to limit load on<br>
    human attention span, and totally unnecessary for machine language in themselves </b> </i> </ul><br>
<p>
<p>
<br><br>
<b> Three problems with L.P. -- unification of L.P. and folding </b><br>
<p>
    Donald Knuth first was thinking of how to document his code when he created a mish-mash of<br>
    previous attempts at similar management techniques with macros, which he called "WEB" (at<br>
    the time when no "www-web" existed yet).<br>
    Then he proclaimed this is the best way to write programs he knows, and repositioned it<br>
    as "a programming paradigm", in direct competition to the "structural programming",<br>
    introduced in the previous decade.<br>
<p>
    Acceptance of this new method of program writing however was disappointing. I believe, there<br>
    were and still are three factors at play, which hurt it, even though the name of L.P. creator<br>
    ensured L.P. never fell into complete obscurity.<br>
<p>
    <ul><br>
	<li> First, L.P. used TeX as a formatting tool, which is a sort of programming language in<br>
	itself. Therefore, the first thing to blame L.P. for became "but I'd need to write - <i> and <br>
	debug! </i> - two programs at the same time, in TeX and in my own machine language.<br>
<p>
	Today when much, much simpler markup languages abound - "html" or even "markdown html"<br>
	or even "wiki" for the majority of uses that do not require typesetting complicated<br>
	equations or graphs - this problem has long been solved.<br>
	You do not need to "debug" basic HTML markup - any error is displayed in your browser as a<br>
	distortion of the web page, I do not need to "debug" html when writing with my Molly script<br>
	which uses html markup.<br>
<p>
	</li> <li> Secondly, the first generation of L.P. tools was language-specific. You could <br>
	do Pascal, but not Fortran. Later "C" and "Fortran" literate tools were added, but you could<br>
	not do Lisp or Ada etc.<br>
<p>
	Today with tools like "noweb" by Norman Ramsey this problem has long been solved. Simplified<br>
	to its core idea Literate Programming is now totally language-independent to the degree that<br>
	you can write books or essays with L.P. tools not even knowing how to program for the computer.<br>
<p>
	</li> <li> And the third problem is the flat file structure of Literate Source files and<br>
	(probably that could be listed as the fourth, psychological stumbling block) the insistence<br>
	on "producing clean documentation" or "polished essays" of one's programs other could read<br>
	and enjoy.<br>
<p>
	Flat files continue to limit the size of the literate source files: your mind still <i> has to<br>
	keep internally the overall structure of your program </i> and switch from it to doing concrete<br>
	tasks.<br>
	Technically a Literate Source file can include <i> many </i> program files ( e.g. project.h,<br>
	project.c, a makefile and a README). In reality the size is limited by your "attention horizon"<br>
    </li> </ul><br>
<p>
    <b> I propose to solve </b> this last problem by combining L.P. with folding or outlining, using html and<br>
    javascript as the simplest and ubiquitous tools.<br>
<p>
    The Literate Source file is written in basic HTML, or even in "markdown" or "wiki"-style markup<br>
    notation. The script then automatically creates a document with folds at each heading line<br>
    (i.e. "h1", "h2", ...). The file can be "weaved" from command line or dynamically under a web <br>
    server as a CGI document.<br>
<p>
    Folding must allow opening an arbitrary number of sections from any place in the file to create<br>
    a sub-view of the document, a small document which is relevant to some particular sub-task.<br>
    These sub-views must persist for the time of this particular work, i.e. the user should not<br>
    be forced to reopen his subview over and over again.<br>
<p>
    Common practice in IDEs and outlining editors, when a programmer is allowed to see only one<br>
    section at a time is the death of the idea of folding.<br>
<p>
    <i> As an example of totally wrong presentation, </i> which  fragments perception into poorly<br>
    connected pieces and does not allow a reader to see the forest for the trees and see <br>
    documentation of GNU libavl <a href= http://adtinfo.org/libavl.html/ > http://adtinfo.org/libavl.html/ </a> <br>
    It is not humanly possible to follow the train of logic from such a presentation: one has to<br>
    keep an internal mental map of the document BEFORE reading it and inability to see more than<br>
    one snippet puts a stop to perception: once the snippet is left, one has to rely on memory of<br>
    previously read pieces to relate things to each other.<br>
    Nor the split HTML, not the flat file format provide for human-friendly perception of the code<br>
    if it is not a small self-contained piece.<br>
<p>
<p>
    <i> A document that is based on a structure of folding subsections </i> drastically increases one's<br>
    attention span, allows to manage easily thousands and thousands of lines of text, and makes<br>
    inclusion of many different types of files into what becomes one Literate Source Project file<br>
    "a cinch".<br>
<p>
    A number of techniques becomes possible which have not been possible before in a flat file. <br>
    Snippets testing language constructs, doubling certain "chunks" while keeping a pointer in a<br>
    "dummy chunk" to preserve the previous working version of your program while experimenting<br>
    with a new one (previously one would have to use version control or rename files for that), <br>
    making collections of loosely related documents and script, each still obtainable, such as<br>
    a collection of system administration policies, readmes, config files and many scripts -- all<br>
    become easy with a folding literate source file.<br>
<p>
    And consequently emphasis moves from the creation of usually comparatively compact programs<br>
    exposed as a sort of polished essays (or documented for their logic in the order of thinking)<br>
    -- and to using Literate Source folding files as your "work log" or "a log of thinking" when<br>
    developing a program, like a scientist might keep a log of his experiments.<br>
<p>
    Clean version of documentation or program presentation might emerge from it, later, but at the<br>
    moment of conception the most urgent task is to preserve your thinking, however "clever" or<br>
    "stupid" that might be.<br>
    It does become good documentation, it seems, even without further polishing, however.<br>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('8');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('4');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('9');">
<font class='lnum'><i>(9)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 486)</i></sub></font></a></legend></fieldset>
<p>
<div id="9" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('9');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('10');">
<font class='lnum'><i>(10)</i></font>&nbsp; PART II ------------ HOW TO USE MOLLY.pl ------------ </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 489)</i></sub></font></a></legend></fieldset>
<p>
<div id="10" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 10).className='hilited';
		    </script>   
<ul>


<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('11');">
<font class='lnum'><i>(11)</i></font>&nbsp; My workflow - literate programming with Molly </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 494)</i></sub></font></a></legend></fieldset>
<p>
<div id="11" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 11).className='hilited';
		    </script>   
<ul>


<p>
 <img src=eeerotate.jpg align=right hspace=5 width=200 border=2><br>
<i> <b> A prerequisite of sorts </b><br>
Use a vertically rotated screen (with an external keyboard and mouse on<br>
a notebook) or a large  enough screen to see a vertically positioned A4<br>
sheet of paper to obtain full advantages of outlining and folding <br>
Psychologically, the more we see, the more "clever" we are. Stop reading<br>
compicated documents through a slit: with mental perception crippled, <br>
you'll just jump between fragments, and never truly "get" them in whole. </i> <b> &gt;&gt;&gt; </b><br>
<p>
Rotation on Linux is done by running <pre> xrandr -o right|left|normal </pre><br>
from an X terminal window. Most modern video cards support this.<br>
<p>
<b> The Workflow </b> :<br>
<ol><br>
    <li> I run a web server on localhost:8000, for myself only. My<br>
    development directory is under the web server - or is linked to<br>
    the web server document tree.<br>
<p>
    </li> <li> I write my Literate Source file in a vim editor. I mark up<br>
    the documentation section (i.e. not code) with most basic HTML tags<br>
    (e.g. &lt;h2&gt;, &lt;b&gt;, &lt;ul&gt; ...). <br>
    The code sections live between "&lt; &lt; section name &gt; &gt; =" and "@" <br>
    (in the first position in the line), as is required by "noweb"<br>
    literate programming tools.<br>
<p>
    </li> <li> I view my file in a web browser, and reload the page after editing updates.<br>
    Because I write my Literate Source with help from the MOLLY.pl script (see below how to <br>
    include it in the file and set it up), every "heading" in HTML (i.e.  h1,  h2  etc. )<br>
    automatically becomes a <b> folding subsection </b> of the document I see in the browser,<br>
    and every code section is automatically formatted with line numbers and a frame.<br>
<p>
    </li> <li> When I think ("globally"), I look at the formatted, immediately updating document<br>
    in the browser, keeping open only the sections relevant to my thinking.<br>
    When I edit, I refer to the line numbers, and avoid navigating "blindly" in the programming<br>
    editor, stressing my memory. I edit "locally".<br>
<p>
    </li> <li> Automatically created folding documents allow me a number of techniques and<br>
    uses impossible previously with flat "literate programming" files.<br>
<p>
    </li> <li> I tangle the created code either directly with "notangle" tools from "noweb", or<br>
    by running "MyProject.tangle", which is a link to "MyProject.weave", the Literate Source file<br>
    turned into a perl script by inclusion of the MOLLY.pl into it in the first lines of the file.<br>
</ol><br>
<p>
See details about this setup and possible uses of it below.<br>
<p>
<p>
<br><br>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('11');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('12');">
<font class='lnum'><i>(12)</i></font>&nbsp; SET UP a Literate Source file and project </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 546)</i></sub></font></a></legend></fieldset>
<p>
<div id="12" style="display:none">   
<ul>


<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('13');">
<font class='lnum'><i>(13)</i></font>&nbsp; Prerequisites: "noweb" tools By Norman Ramsey </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 552)</i></sub></font></a></legend></fieldset>
<p>
<div id="13" style="display:none">   
<ul>


<p>
    The first version of the script uses a "pass-through" tangler, i.e. delegates actual tangling to <br>
    the "notangle" utility from the "noweb" suite.<br>
<p>
    Please obtain and install it. <b> <i> Make sure the tangler is in your path </i> </b><br>
     <a href= http://www.cs.tufts.edu/~nr/noweb > http://www.cs.tufts.edu/~nr/noweb </a><br>
<p>
    Any version will do, e.g. the one based on shell and awk. I created the MOLLY script to work with<br>
    the overall markup of the "noweb" tools. It means your project file(s) can be directly processed<br>
    with "noweb" tools. MOLLY is just an alternative weaver which creates folding HTML documents <br>
    on the fly.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('13');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('14');">
<font class='lnum'><i>(14)</i></font>&nbsp; Setting up the file </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 568)</i></sub></font></a></legend></fieldset>
<p>
<div id="14" style="display:none">   
<ul>


<p>
<p>
    I aimed at simplifying and eliminating unnecessary steps, and wanted to automate some others.<br>
    Therefore practical work with MOLLY.pl looks like this:<br>
<p>
    <ol> <li> <b> <i> Your Literate Source file must be "mollified" </i> </b>, i.e. you have to add an invocation<br>
    of MOLLY.pl in the first lines of it. Think of it as a template. You will write your Literate Source text<br>
    right after these initial lines.  The minimal template is this:<br>
<p>
<font class='lnum'>579</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;minimal MOLLY template&gt;&gt;=</legend>
<font class='lnum'>580</font>       #!/full/path/to/perl
<font class='lnum'>581</font>       do "/full/path/to/script/MOLLY.pl";
<font class='lnum'>582</font>       exit;
<font class='lnum'>583</font>       # delete first space(s) in the next line
<font class='lnum'>584</font>       __DATA__
<font class='lnum'>585</font>   
<font class='lnum'>586</font>   
<font class='lnum'>587</font>       &lt;h1&gt; And here I start My Project &lt;/h1&gt;
<font class='lnum'>588</font>       Your Literate Source file can be typed here
<font class='lnum'>589</font>   
<font class='lnum'>590</font>       &lt;h2&gt; Subsection &lt;/h2&gt;
<font class='lnum'>591</font>       level 0-9 of subsections are allowed now.
<font class='lnum'>592</font>   
<font class='lnum'>593</font>       Each subsection will be automatically created as "folding". Javascript must be
<font class='lnum'>594</font>       enabled in your browser to use this functionality
<font class='lnum'>595</font>   </fieldset></pre>
<p>
    The perl invocaton and the "__DATA__"  line must start  &nbsp;   &nbsp;  a t  &nbsp;  t h e  &nbsp;  f i r s t  &nbsp;  p o s i t i o n  &nbsp; <br>
<p>
    You do not need any extra perl modules  as pre-requsites, the script uses core perl.  <br>
<p>
    Full template will also set configuration variables between calling the perl interpreter and<br>
    the inclusion of the MOLLY.pl script, which adjust its behaviour.<br>
<p>
    Save this under some name, e.g. MyProject.txt. This turns your Literate Source file into<br>
    a perl script<br>
<p>
    </li> <li> <b> <i> Make it executable. </i> </b> <br>
	<pre> chmod 755 MyProject.txt </pre><br>
<p>
    </li> <li>  <b> <i> The script behaves according to its name extension </i> </b><br>
    The script will produce HTML-formatted documentation, if its name ends with "weave" <br>
    (default - or whatever you selected when setting configuration variables in the "mollification"<br>
    template). Invoked under any different name (default) it will "tangle", i.e. create machine code.<br>
    So,  name or rename your LSFile "MyProject.weave" and link it to "MyProject.tangle" (or whatever):<br>
    <pre>
	mv MyProject.txt MyProject.weave
	ln -s MyProject.weave MyProject.tangle </pre><br>
<p>
    Now if you run MyProject.weave, it will dump HTML-formatted documentation of your work to STDOUT<br>
	<pre> ./MyProject.weave &gt; MyProject-formatted.foldingdocument.html </pre><br>
    It you run MyProject.tangle, it will dump machine code from your Literate Source file to STDOUT.<br>
	<pre> ./MyProject.tangle &gt; MyProject-runnable.script.pl </pre><br>
    ( Of course, tangling is independent of the language you program in )<br>
<p>
    For example, if you develop in perl, you can run the resulting script like this:<br>
	<pre> ./MyProject.tangle | perl [perl options here] - </pre><br>
<p>
    Additionally, as the markup is the same as that of "noweb" tools. one can use them directly<br>
    on the My.Project.weave file, with all of their flexibility and extra options.<br>
<p>
    However the idea was even to avoid running some of these commands after each change in<br>
    the file and to avoid saving the weaved docs: STDOUT can be picked up by your local web<br>
    server as CGI, and you will have an HTML-formatted and which is more important, <i> folding </i><br>
    document in your browser by simply reloading the page (usually with Ctrt+R or a mouse click)<br>
<p>
    </li> <li> Now, <b> <i>  the only other step  is to run a local web server </i> </b> <br>
    (on localhost, any tiny very simple httpd will do), and tell it to treat "*.weave" as valid cgi <br>
    file extension. (Alternatively, I can set "weaving" to files that end in '*.cgi" or "*.pl" etc. <br>
    in the configuration part of my MOLLY template)<br>
<p>
    One of the simplest WWW servers for such use could be "thttpd", and I will provide you with its<br>
    minimal configuration file below.<br>
    </li> </ol><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('14');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('15');">
<font class='lnum'><i>(15)</i></font>&nbsp; "Mollification" - full configuration template </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 648)</i></sub></font></a></legend></fieldset>
<p>
<div id="15" style="display:none">   
<ul>


Should be self-explanatory. May add to this section later.<br>
Uncomment to set, otherwise defaults apply.<br>
<p>
<p>
<font class='lnum'>654</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;full MOLLY template&gt;&gt;=</legend>
<font class='lnum'>655</font>   #!/usr/bin/perl
<font class='lnum'>656</font>   
<font class='lnum'>657</font>   #-------------------------------------
<font class='lnum'>658</font>   # -------TOC and INDEX behaviour------
<font class='lnum'>659</font>   
<font class='lnum'>660</font>   # print TOC? 1:0
<font class='lnum'>661</font>   #$print_toc=1;	# default is to print
<font class='lnum'>662</font>   
<font class='lnum'>663</font>   # should we keep TOC expanded? "block":"none"
<font class='lnum'>664</font>   #$toc_expanded="block";	# default is to unfold
<font class='lnum'>665</font>   
<font class='lnum'>666</font>   # should we keep Chunks Index expanded? "block":"none"
<font class='lnum'>667</font>   #$ind_expanded="none";	# default is to keep folded
<font class='lnum'>668</font>   
<font class='lnum'>669</font>   
<font class='lnum'>670</font>   # should we number lines in code sections? 1 : else
<font class='lnum'>671</font>   #$line_numbering = 1;	# default is to number
<font class='lnum'>672</font>   
<font class='lnum'>673</font>   
<font class='lnum'>674</font>   #-------------------------------------
<font class='lnum'>675</font>   #---------MathML options--------------
<font class='lnum'>676</font>   
<font class='lnum'>677</font>   # should we enable MathML via ASCIIMathML.js or LaTeXMathML.js library? 1:0
<font class='lnum'>678</font>   #$enable_ASCIIMathML = 0; #default is to disable as it slows Molly down a lot
<font class='lnum'>679</font>   #$enable_ASCIIMathML = 1;
<font class='lnum'>680</font>   
<font class='lnum'>681</font>   # If yes, what is the full path to the lib? Remember to get the one with proper
<font class='lnum'>682</font>   # escapes for your work, default or modified (see documenation)
<font class='lnum'>683</font>   # CAN BE: (a) local "/full/path/from/root/to/ASCIIMathML_with_modified_escapes.js" or 
<font class='lnum'>684</font>   # (b) in current dir "ASCIIMathML_with_modified_escapes.js" or
<font class='lnum'>685</font>   # (c) on the web, e.g. the original site of the library (unmodified) is:
<font class='lnum'>686</font>   #$path_to_ASCIIMathML = "http://www1.chapman.edu/~jipsen/mathml/ASCIIMathML.js";
<font class='lnum'>687</font>   #$path_to_ASCIIMathML = "ASCIIMathML_with_modified_escapes.js"; # default is current dir
<font class='lnum'>688</font>   
<font class='lnum'>689</font>   
<font class='lnum'>690</font>   #-------------------------------------
<font class='lnum'>691</font>   #--------Document Markup lang---------
<font class='lnum'>692</font>   
<font class='lnum'>693</font>   # how are doc sections marked? "dotHTML":"rawHTML"
<font class='lnum'>694</font>   #$weave_markup = "rawHTML"; # default is "rawHTML"
<font class='lnum'>695</font>   
<font class='lnum'>696</font>   
<font class='lnum'>697</font>   #--------------------------------------
<font class='lnum'>698</font>   #---------File extensions setting------
<font class='lnum'>699</font>    
<font class='lnum'>700</font>   # what is the file extention to weave it? (perms must allow execution!)
<font class='lnum'>701</font>   # e.g. "scriptname.weave" or "scriptname.cgi" etc.
<font class='lnum'>702</font>   #$weave_extension = "weave";	# default is "weave"
<font class='lnum'>703</font>   
<font class='lnum'>704</font>   # what is the file extention to tangle it? (perms must allow execution!)
<font class='lnum'>705</font>   # e.g. "scriptname.tangle",  "scriptname.pl" etc.
<font class='lnum'>706</font>   #$tangle_extension = "tangle";	# default is "tangle"
<font class='lnum'>707</font>   
<font class='lnum'>708</font>   #--------------------------------------
<font class='lnum'>709</font>   #---------invocation of MOLLY.pl-------
<font class='lnum'>710</font>   
<font class='lnum'>711</font>   # make sure to provide correct and full path to the script here
<font class='lnum'>712</font>   # (default is "current directory"):
<font class='lnum'>713</font>   do "MOLLY.pl";
<font class='lnum'>714</font>   exit;
<font class='lnum'>715</font>   
<font class='lnum'>716</font>   # delete the space before the __DATA__ marker
<font class='lnum'>717</font>    __DATA__
<font class='lnum'>718</font>   #---------------start of script-------------
<font class='lnum'>719</font>   
<font class='lnum'>720</font>   &lt;h1&gt; MY PROJECT &lt;/h1&gt;
<font class='lnum'>721</font>   
<font class='lnum'>722</font>   The main idea for my new project is ..
<font class='lnum'>723</font>   
<font class='lnum'>724</font>   &lt;h2&gt; Subsection 1 &lt;/h2&gt;
<font class='lnum'>725</font>   
<font class='lnum'>726</font>   Here I explain things that come first
<font class='lnum'>727</font>   ................................
<font class='lnum'>728</font>   
<font class='lnum'>729</font>   </fieldset></pre>
<p>
<b> "__DATA__" must start at the first position in its line </b><br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('15');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('16');">
<font class='lnum'><i>(16)</i></font>&nbsp; Markup of code and documentation sections </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 737)</i></sub></font></a></legend></fieldset>
<p>
<div id="16" style="display:none">   
<ul>


<p>
First, <br>
    <ul> <li>  code sections begin with "&lt; &lt;name of the section&gt; &gt;="<br>
    in the first position in the line and end with "@"  in the first position<br>
    <i> no spaces between the double angle brackets - I used spaces as escapes here </i><br>
<p>
    </li> <li> References to other code sections are done with "&lt; &lt;name of the ref sect&gt; &gt;"<br>
    inside the code sections<br>
<p>
    </li> <li> The rest is "documentation chunks" which must be marked up with some formatting<br>
    tags.<br>
<p>
     I do not insert examples here, as the file you are reading provides them ad nauseam.<br>
<p>
<p>
    THIS IS THE BASIC MARKUP OF THE LITERATE SOURCE FILE, as used by the <br>
    "noweb" tools.<br>
    </ul><br>
<p>
<p>
    Secondly, how do we format the documentation sections?<br>
<p>
    <ul> <li> In the simplest case, with straight HTML markup (default)<br>
<p>
    </li> <li> If a simple subsection is added to the MOLLY.pl script to process it, in any<br>
    markup lingo of your choice (e.g. "wiki") <br>
<p>
    Currently I provide a "dotHTML" formatting subsection as an example. It implements<br>
    a few of the most common HTML tags but with "dots" around them, in place of angle brackets <br>
    "&lt;" and "&gt;" (which is faster, as one does not need to switch register, so is less prone <br>
    to typos). See below for more detailed explanations<br>
    </li> </ul><br>
<p>
    <b> <i> The only difference </i> </b> from the truly "raw" HTML is that except in "pre" sections the MOLLY.pl script will <br>
    add automatic &lt;br&gt; tags at the end of each line of your Literate Source file.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('16');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('17');">
<font class='lnum'><i>(17)</i></font>&nbsp; Tangling from LSFile </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 778)</i></sub></font></a></legend></fieldset>
<p>
<div id="17" style="display:none">   
<ul>


<p>
    <ol> <li> Usually only one file needs to be tangled constantly, the file the developer<br>
    is working on.  It's easiest to do by using the "default root", which is a code chunk<br>
    called "*". When you run <br>
    <pre> MyProject.tangle &gt; source.pl </pre> <br>
    MOLLY will pass the command to "notangle" from Ramsey's "noweb" tools, and print code<br>
    chunks starting from the one named "*". Therefore, I drag along the default root to<br>
    wherever I am editing now and reassigning to it the chunk I need to tangle currently.<br>
    I usually keep the pointer subsection at the top of the Literate Source file. See <br>
    "THE CHUNK TO TANGLE BY DEFAULT" in the file you are reading as an example of this<br>
    technique.<br>
<p>
    This is the task for which MOLLY quick "pass-through tangling" is designed.<br>
<p>
    </li> <li> If, however, you need to tangle out non-"*" root, you might need to run<br>
    "notangle" directly on your MyProject.weave. This is the most flexible way.<br>
<p>
    </li> <li> If you need to tangle out many source files, then probably the easiest way<br>
    to arrange it is through many invocations of "notangle" in a makefile.<br>
    Include "Makefile" subsection into your Literate Source file and create a target that<br>
    combines several "notangle -R ... " commands in it.<br>
    Assing default root "*" to the Makefile, then run "MyProject.tangle &gt; Makefile" to create<br>
    it and next run "make targetname" to tangle (and compile, run etc) many files included<br>
    into your Literate Source project file.<br>
    </li> </ol><br>
<p>
<br><br>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('17');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('18');">
<font class='lnum'><i>(18)</i></font>&nbsp; Sample minimal configuration of thttpd </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 809)</i></sub></font></a></legend></fieldset>
<p>
<div id="18" style="display:none">   
<ul>


<p>
"THTTPD" home is <a href= http://www.acme.com/software/thttpd/ > http://www.acme.com/software/thttpd/ </a> <br>
<p>
From the distro README:<br>
<ul> thttpd is a simple, small, portable, fast, and secure HTTP server. <br>
<b> Simple: </b> It handles only the minimum necessary to implement HTTP/1.1. Well, maybe a <br>
little more than the minimum. <br>
<b> Small: </b>  See the comparison chart. It also has a very small run-time size, since it <br>
does not fork and is very careful about memory allocation. <br>
<b> Portable: </b>  It compiles cleanly on most any Unix-like OS, specifically including FreeBSD, <br>
SunOS 4, Solaris 2, BSD/OS, Linux, OSF. <br>
<b> Fast:  </b>  In typical use it's about as fast as the best full-featured servers (Apache, <br>
NCSA, Netscape). Under extreme load it's much faster. <br>
<b> Secure: </b>  It goes to great lengths to protect the web server machine against attacks and <br>
breakins from other sites. <br>
<p>
It also has one extremely useful feature (URL-traffic-based throttling) that no other server <br>
currently has. Plus, it supports IPv6 out of the box, no patching required.<br>
</ul><br>
<p>
Its compilation is very quick. Its configuration is simpler than that of Apache. <br>
<p>
Supposing I'd like to point my browser at "http://localhost:8000/path/to/MyProject.weave"<br>
Then the minimal configuration will look something like this:<br>
<p>
<p>
<font class='lnum'>837</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;minimal thttpd configuration&gt;&gt;=</legend>
<font class='lnum'>838</font>   #
<font class='lnum'>839</font>   host=localhost
<font class='lnum'>840</font>   port=8000
<font class='lnum'>841</font>   dir=/my/home/00trash/tmp/literate.perl/WORKDIR
<font class='lnum'>842</font>   data_dir=/my/home/00trash/tmp/literate.perl/WORKDIR
<font class='lnum'>843</font>   #chroot
<font class='lnum'>844</font>   
<font class='lnum'>845</font>   # extensions understood as valid "cgi" scripts:
<font class='lnum'>846</font>   #cgipat=/**.cgi|/**.weave|/**.pl
<font class='lnum'>847</font>   #cgipat=/**.tangle
<font class='lnum'>848</font>   cgipat=/**.weave
<font class='lnum'>849</font>   
<font class='lnum'>850</font>   #logfile=/my/home/00trash/tmp/literate.perl/WWW.server/thttpd.log
<font class='lnum'>851</font>   logfile=/dev/null
<font class='lnum'>852</font>   
<font class='lnum'>853</font>   #pidfile=./thttpd.pid
<font class='lnum'>854</font>   pidfile=/home/vedmed/00trash/tmp/literate.perl/WWW.server/thttpd.pid
<font class='lnum'>855</font>   
<font class='lnum'>856</font>   # uncomment this to be able to link from anywhere to your web server document dir 
<font class='lnum'>857</font>   # (unsecure, for local development only)
<font class='lnum'>858</font>   nosymlink
<font class='lnum'>859</font>   #
<font class='lnum'>860</font>   </fieldset></pre>
<b> NOTE </b> that "nosymlink" schizophrenically <i> allows </i> symbolic links in spite of what<br>
thttpd documentation tells you<br>
<p>
The script to start thttpd (it will detach and run as a daemon) is something like this:<br>
<p>
<font class='lnum'>866</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;run.thttpd.sh&gt;&gt;=</legend>
<font class='lnum'>867</font>   #!/bin/sh
<font class='lnum'>868</font>   PROJECT_ADMIN_DIR="/my/home/00trash/tmp/literate.perl/WWW.server";
<font class='lnum'>869</font>   #./thttpd -p 8000 -h localhost -C ./thttpd.config
<font class='lnum'>870</font>   #$PROJECT_ADMIN_DIR/thttpd -nos -C $PROJECT_ADMIN_DIR/thttpd.config
<font class='lnum'>871</font>   $PROJECT_ADMIN_DIR/thttpd -C $PROJECT_ADMIN_DIR/thttpd.config
<font class='lnum'>872</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('18');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('12');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('19');">
<font class='lnum'><i>(19)</i></font>&nbsp; CREATE a Literate Source file -- markup of documentation chunks </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 877)</i></sub></font></a></legend></fieldset>
<p>
<div id="19" style="display:none">   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('20');">
<font class='lnum'><i>(20)</i></font>&nbsp; Markup </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 881)</i></sub></font></a></legend></fieldset>
<p>
<div id="20" style="display:none">   
<ul>


<p>
<ol> <li> The default is to use <b> ordinary 'html' markup </b> in the document sections<br>
The only difference from "true raw" HTML is that MOLLY adds automatic <br>
&lt;br&gt; linebreaks unless lines are inside the &lt;pre&gt;..&lt;/pre&gt; sections<br>
The script also cuts out vim folding marks -- { { { number ... } } } number<br>
-- without spaces  and "#------------" lines.<br>
<p>
<p>
</li> <li> <b> Any "markdown" or "wiki"-style markup can be added </b> to MOLLY. Another <br>
reasonable suggestion could be a simple translator from basic TeX markup etc.<br>
Some of this functionality is unnecessary to reimplement, as "noweb" or third-party <br>
filters can be run on the document after MOLLY weaving or from inside MOLLY.<br>
<p>
</li> <li> As an <b> example of a simple markup </b> which can be done with regular expressions<br>
I added  "dotHTML", which is several most basic HTML tags inside "dots" instead<br>
of angle brackets.<br>
<p>
Dots do not require switcing the keyboard register, and therefore I can speed up<br>
typing and avoid annoying repeating typos.<br>
<p>
Please see the "dotHTML" subsection below where the source of MOLLY is listed.<br>
<p>
Currently implemented tags are (write them inside "dots", not "&lt;..&gt;"):<br>
<ul> &lt;br&gt; &lt;p&gt;  &lt;s&gt; - &lt;/s&gt; &lt;pre&gt; - .. &lt;b&gt; - &lt;/b&gt; &lt;i&gt; - .. &lt;ul&gt; - .. &lt;ol&gt; - ..<br>
&lt;li&gt; - ..<br>
<p>
Special marks are dot-&lt;-dot and dot-&gt;-dot (no dashes, like ". &lt; ." <br>
without spaces) which are needed if the tag includes some options or<br>
is not among the tags "dotHTML" understands already.<br>
These will be converted to single &lt; and &gt; respectively.<br>
This is clumsy, but for quick sample and to speed up typing I found<br>
it sufficient. So far.<br>
<p>
<p>
And there are three special, non-HTML marks I introduced for convenience.<br>
(a) dot-x-dot ... dot-/x-dot <i>on one line only </i> will  &nbsp;   &nbsp;  f o r m a t  &nbsp;  t h e  &nbsp;  p h r a s e  &nbsp;  as spaced<br>
(b) dot-a-dot http://some/URL dot-/a-dot will create a hyperlink <a href= http://some/URL > http://some/URL </a> <br>
(c) dot-sp-dot - creates a space<br>
</ul><br>
<p>
etc. I add them as I go, whenever I need them for my current document.<br>
<p>
This formatting also adds &lt;br&gt; linebreaks unless lines are inside the <br>
&lt;pre&gt;..&lt;/pre&gt; sections.<br>
"dotHTML" also cuts out vim folding marks <br>
<pre> { { { number ... } } } number </pre><br>
without spaces, and  comment lines with dashes<br>
<pre> "#------------" </pre><br>
<p>
<p>
</li> </ol><br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('20');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('21');">
<font class='lnum'><i>(21)</i></font>&nbsp; Markup and Escaping </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 937)</i></sub></font></a></legend></fieldset>
<p>
<div id="21" style="display:none">   
<ul>


<p>
Escaping in files marked in multiple ways is a big source of all kinds of errors.<br>
Currently Molly should be able to take care of most cases.<br>
<p>
Exceptions include:<br>
<p>
1.  double angle brackets ("&lt; &lt;" and "&gt; &gt;" without spaces in between) and the "at" sign.<br>
Those confuse the "notangle" tool from Ramsey's "noweb". While Molly treats<br>
double angle brackets and "at" as a switch between documentation and a code chunk <i> only<br>
if those are in the first position in the line </i>, "noweb" stumbles.<br>
<p>
If you tangle through Molly (by running "my_project.tangle &gt; source.code"), Molly will<br>
filter these out. If you run "notangle" directly on the project file ("notangle -R'some <br>
root chunk' my_project.weave &gt; source.code"), it will fail.<br>
<p>
Therefore in this file I always <b> use extra white space btw angle brackets as an escape </b><br>
<p>
2. If you enabled the use of ASCIIMathML.js library to display mathematical exressions in<br>
you document, then <b> double backticks </b> on both sides of any expression will be <br>
processed by the library. (It also processes everything between "a m a t h" and<br>
"e n d a m a t h" tags - no spaces btw letters - in you file).<br>
Make sure that your target programming language or any future "markdown" you are going to <br>
add to Molly does not use these signs at all -- or re-edit the javascript library to<br>
substitute all inclusions of double backticks to sth else.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('21');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('19');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('22');">
<font class='lnum'><i>(22)</i></font>&nbsp; Mathematical Formulae - MathML inside Mollified Literate source files </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 967)</i></sub></font></a></legend></fieldset>
<p>
<div id="22" style="display:none">   
<ul>


<p>
<i> The most common reason users put forward for the continued use of (La)TeX in this day <br>
is its facility in dealing with mathematical notation. However today much <b> simpler HTML </b> <br>
(which is often further reduced to "markdown" level) if <b> used with MathML </b> can cover <br>
most of such needs</i><br>
<p>
There are two libraries in JavaScript, ASCIIMathML.js and LaTeXMathML.js (derived from the former)<br>
which do translation "on the fly" in the reader's browser. Those provide almost a drop-in <br>
functionality and can be used with Molly.<br>
<p>
The latest version of the library (2.0.1) includes <b> <i> both </i> </b> ASCII and LaTex processing<br>
into its code. <br>
<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('23');">
<font class='lnum'><i>(23)</i></font>&nbsp; How to use ASCIIMathML.js in Molly </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 985)</i></sub></font></a></legend></fieldset>
<p>
<div id="23" style="display:none">   
<ul>


<p>
<b> 1 </b>. To enable MathML one needs to use a compliant browser. Currently MathML is built in<br>
Firefox, or it can be enabled in Internet Explorer with a (free) plugin.<br>
<p>
For Opera the support is also built-in, however the library actually checks for the browser type<br>
and then it seems disallows Opera. The Opera browser, however, has another feature to bypass<br>
exactly that and lie about its identity. If "identify as Firefox" is set in your Opera browser,<br>
the MathML output is caught and rendered.<br>
I did not see any difference between Firefox and Opera_pretending_to_be_Firefox in rendering<br>
output of the library.<br>
<p>
<b> 2 </b>. To enable MathML while dynamically creating the folding-html file, I use an LGPLed<br>
Javascript library called "ASCIIMathML.js" from <br>
<a href= http://www1.chapman.edu/~jipsen/mathml/asciimath.html > http://www1.chapman.edu/~jipsen/mathml/asciimath.html </a><br>
(the home page), while only the library itself can be copied from<br>
<a href= http://www1.chapman.edu/~jipsen/mathml/ASCIIMathML.js > http://www1.chapman.edu/~jipsen/mathml/ASCIIMathML.js </a><br>
<p>
<b> 3 </b>. The use of MathML must be <b> enabled in the "mollifying" template </b> at the top of your<br>
Literate Project file, and the path to the ASCIIMathML.js added. See the config. <br>
template subsection above<br>
<p>
<b> 4 </b>. I had to <b> change escape symbols </b> in the library not to conflict with <br>
<i> programming symbols </i> - now it's double backticks instead of single ones -- and <br>
change config option enabling "preservation of $ and $$"<br>
<p>
Therefore a copy of modified library is distributed with the Molly script.<br>
The default location for Molly to work with is in the same directory as the Molly.pl.<br>
Adjust configuration as needed at the top of your script.<br>
<p>
If the rest of your file does not conflict with default ASCIIMathML.js escapes, i.e. does not use<br>
$ signs and single backtics, you can point to the original unmodified library and distribute that<br>
one with your work (see detailed explanations below).<br>
<p>
<b> 5 </b>. This javascript library allows a user <b> to type math formulas in simple calculator-<br>
like ASCII notation with LaTeX constants </b> if needed.<br>
<p>
The interpreted parts of the text must be either:<br>
<p>
(a) <b> <i> between "a m a t h" ...... "e n d a m a t h" tags (no brackets). </i> </b> The script<br>
then tries to differentiate between ordinary text and math expressions and renders the latter<br>
dynamically as MathML - which is then displayed by your browser.<br>
<p>
It might get confused etc. (e.g. because you used underscores somewhere); then your math<br>
could be<br>
<p>
(b) <i> <b> escaped (the math expressions only) with DOUBLE BACKTICKS around them. </b> </i><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('23');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('24');">
<font class='lnum'><i>(24)</i></font>&nbsp; 6 . Some examples and LaTexMathML.js library versions </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1037)</i></sub></font></a></legend></fieldset>
<p>
<div id="24" style="display:none">   
<ul>


<p>
<p>
..are quite intuitive:<br>
<p>
Let's try some interesting formulas: <br>
E=m c^2 ---&gt; ``E=m c^2`` and e^(i pi)=-1 ---&gt; ``e^(i pi)=-1``<br>
<p>
and AA x in CC (sin^2x+cos^2x=1) ---&gt; ``AA x in CC (sin^2x+cos^2x=1)``<br>
and one more: sum_(i=1)^n i^3=((n(n+1))/2)^2 ---&gt; ``sum_(i=1)^n i^3=((n(n+1))/2)^2``<br>
<p>
<p>
<p>
<p>
..and here are <b> more realistic math expressions </b> taken from a depository of some math <br>
    student and written in TeX notation. I drop $$ .. $$ wrapping the in-lined expressions <br>
    though and delimit it with double backticks instead. Here's the test:<br>
<p>
    Hover your mouse over the expression to see the ASCII/TeX coding:<br>
<p>
Freudental Formula<br>
``mult(\xi)=\frac{2}{(\mu+\rho|\mu+\rho)-(\xi+\rho|\xi+\rho)}\sum_{\alpha\in\Delta^{+}} mult(\alpha) \sum_{k=1}^{\infty}mult(\xi+k\alpha)(\xi+k\alpha|\alpha)``<br>
It includes roots ``\Delta=\left\{k\delta+\alpha|k\in Z,\; \alpha\in \Delta_0\right\}``<br>
positive roots ``\Delta^{+}=\{k\delta+\alpha|k\geq 0,\; \alpha\in \Delta_0^{+}\}\cup \{k\delta+\alpha|k\geq 1,\; \alpha\in \Delta_0\setminus \Delta_0^{+}\}``<br>
<p>
<i> NOTE </i> If you hover with your mouse over some interpreted expression, a baloon<br>
will appear showing the original ASCII markup for the expression. Very nice.<br>
<p>
<i> NOTE 2 </i> the "pre" (preformat) "/pre" HTML tags prevent the library from<br>
rendering the expressions and might even be used as a quick escape tool when you are writing<br>
your page.<br>
<p>
<p>
<p>
<b> Some TeX operators are not understood by ASCIIMathML.js nor by LaTeXMathML.js libs </b><br>
(the failing test is in the ADD-ON MAthML subsection of the Source Code section in this document)<br>
<p>
The reason is most likely that the lib was never told about those 1 or 2 constants and<br>
operators on which it fails<br>
<p>
<b> First </b> one can explore another version of the library, "LaTexMathML.js" changed to <br>
interpret  the actual LaTex code:<br>
<a href= http://www.maths.nottingham.ac.uk/personal/drw/lm.html > http://www.maths.nottingham.ac.uk/personal/drw/lm.html </a><br>
<p>
One more version is here:<br>
<a href= http://math.etsu.edu/LaTeXMathML/ > http://math.etsu.edu/LaTeXMathML/ </a><br>
<p>
One more version (related) of LaTexMathML.js is here:<br>
<a href= http://pillars.che.pitt.edu/LaTeXMathML/ > http://pillars.che.pitt.edu/LaTeXMathML/ </a><br>
<a href= http://pillars.che.pitt.edu/LaTeXMathML/latexmathmlguide.xhtml > http://pillars.che.pitt.edu/LaTeXMathML/latexmathmlguide.xhtml </a><br>
<p>
.. and there is even a perl port for that<br>
<a href= http://pillars.che.pitt.edu/LaTeXMathML/ > http://pillars.che.pitt.edu/LaTeXMathML/ </a><br>
(which also can potentially be used from MOLLY)<br>
<p>
<p>
I have not tested those in full, but the use of JavaScript libraries from MOLLY should be<br>
identical (and so it says in the documentation inside the libraries) to that of ASCIIMathML.js<br>
They are directly interchangeable in a standalone HTML-based editor. Just point to a copy of the <br>
needed lib in the configuration section of your Literate Source file.<br>
<p>
<b> Secondly </b> the home page for the library mentions (at the very bottom) that the library<br>
encoding in its JavaScript source file is straightforward and more translations can be added<br>
as needed.<br>
Here is the URL: <a href= http://www1.chapman.edu/~jipsen/mathml/asciimathextend.html > http://www1.chapman.edu/~jipsen/mathml/asciimathextend.html </a><br>
I will provide a section in the Literater Source of Molly (in the ADD-ON section for MathML) <br>
to add all necessary definitions. It <b> <i> is </i> </b> very easy ;))<br>
<p>
<b> Thirdly </b> the general lesson/answer to the question of using math in your Mollified Literate<br>
Source files is this: <br>
<ul> <li> I had to adjust the lib (double backticks and preservation of $) because I was concerned<br>
with programming languages. The source code must stay untouched by the math library <br>
(mis)translations. That is why I provide a copy of the lib with MOLLY.<br>
<p>
</li> <li> If one wishes to use MOLLY for writing mathematical notation without conflicting computer\<br>
language code sections, one can always <b> link to an unmodified copy of the same lib </b><br>
and distribute that one with your work ( in *.mht files, see below) or even link to an <br>
address on the web.<br>
<p>
</li> <li>The same applies to a version of the lib to interpret TeX rather than ASCII math notation: <br>
MOLLY inclusion of the library is generic, just point to the correct javascript library.<br>
</li> </ul><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('24');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('25');">
<font class='lnum'><i>(25)</i></font>&nbsp; 7 .  ASCIIMathML Markup - reference </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1124)</i></sub></font></a></legend></fieldset>
<p>
<div id="25" style="display:none">   
<ul>


<p>
The full set of ASCII notation conventions for the library can be found on its<br>
home page.<br>
<a href= http://www1.chapman.edu/~jipsen/mathml/asciimathsyntax.html > http://www1.chapman.edu/~jipsen/mathml/asciimathsyntax.html </a><br>
<p>
There are 2 pages there, the first describes the syntax, and the second one shows allowed <br>
LaTex escapes.<br>
<p>
The easiest way to see the ascii code and to use any interpreted page as a reference is to<br>
hover your mouse over an interpreted math symbol or expression. In about a second a baloon <br>
appears  with the ascii source in it.<br>
<p>
There is an on-line tutorial in the use of ASCII math notation  for the library at<br>
<a href= http://www.wjagray.co.uk/maths/ASCIIMathTutorial.html > http://www.wjagray.co.uk/maths/ASCIIMathTutorial.html </a><br>
and <a href= http://www.wjagray.co.uk/maths/ASCIIMathMLinfo.html > http://www.wjagray.co.uk/maths/ASCIIMathMLinfo.html </a><br>
<p>
<b> One more URL </b><br>
"an on-line ASCIIMathEditor" is here<br>
<a href= http://www1.chapman.edu/~jipsen/mathml/asciimatheditor/ > http://www1.chapman.edu/~jipsen/mathml/asciimatheditor/ </a><br>
Works in my case (firefox on Linux) if I save the page ("full page") and use it from<br>
local files. Could immediately see what I am typing, next copy and paste expressions<br>
into my target file.<br>
Useful. Just delete the spy from google, "the urchin tracker" from the page ;)) .<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('25');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('26');">
<font class='lnum'><i>(26)</i></font>&nbsp; How to distribute your final folding HTML-formatted work </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1153)</i></sub></font></a></legend></fieldset>
<p>
<div id="26" style="display:none">   
<ul>


<p>
<b> 8 . To distribute your HTML-weaved folding files with MathML notation </b><br>
afterwards you'll have to provide a copy of the JavaScript library with the weaved html <br>
file, as well as any images you might have used there.<br>
This can be done by creating <b> *.mht archives </b> from them.<br>
<p>
(to explain: MHT is a base64-encoded concatenation of elements of a page<br>
    and its images, scripts etc.;<br>
    MAF is a Mozilla zip-comression of page or several with all images etc into one<br>
    archive file).<br>
<p>
Note that because I had to modify escapes in the library for it not to clobber single <br>
backticks and $ symbols, so common in programming, one has to provide a copy of the <br>
modified lib with your HTML work.  You cannot simply link to any copy ot ASCIIMathML.js <br>
found on the Net. (You could if you use an unmodified copy though).<br>
<p>
Internet Explorer has built-in support for *.mht (as it is a MSoft standard).<br>
For Firefox the problem is solved easily by installing either<br>
"UnMHT" add-on: <a href= http://www.unmht.org/unmht/en_index.html > http://www.unmht.org/unmht/en_index.html </a><br>
or "MAF" add-on: <a href= http://maf.mozdev.org/ > http://maf.mozdev.org/ </a><br>
<p>
Then just open the weaved html file in your browser, and "Save As" *.MHT, it will <br>
include all images and the library with it.<br>
<p>
So: (a) weave an HTML file from Molly<br>
    (b) open it in IE or Firefox with MHT add-on, and <br>
    (c) save it as one file.<br>
<p>
This will allow you to distribute your MathML marked files with included images, plots<br>
etc. in a convenient manner.<br>
If you are strictly Firefox-based, you can also use the open zip-based MAF format.<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('26');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('22');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('27');">
<font class='lnum'><i>(27)</i></font>&nbsp; READ and SEARCH inside a Folding Literate Source file </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1193)</i></sub></font></a></legend></fieldset>
<p>
<div id="27" style="display:none">   
<ul>


<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('28');">
<font class='lnum'><i>(28)</i></font>&nbsp; Opening many relevant subsections together, TOC highlighting </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1199)</i></sub></font></a></legend></fieldset>
<p>
<div id="28" style="display:none">   
<ul>


<p>
One advantage of the folding format is that - in contrast to most other tools - it allows<br>
    the programmer to open <i> many </i> relevant sections from any parts of the file <i> at the <br>
    same time </i><br>
<p>
    This can be done by "walking" the Literate Source file, as its sections and subsections are a <br>
    kind of TOC of themselves.<br>
    This can be done from the TOC section as well. The open sections get a highlighted background,<br>
    and highlighting appears irrespective of whether the section was opened from the TOC or in the<br>
    body of the text.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('28');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('29');">
<font class='lnum'><i>(29)</i></font>&nbsp; Keeping some sections of the LSFile permanently open </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1215)</i></sub></font></a></legend></fieldset>
<p>
<div id="29" style="display:none">   
<ul>


<p>
The behaviour of folding sections in the mollified LSFile is as follows:<br>
    <ul> <li> If you click on the <b> "expand all" </b> link anywhere in the document, all folding <br>
    sections in the body (not TOC/Index) will open. The limitation is 10000 objects per document,<br>
    hardcoded.<br>
    </li> <li> If you click on <b> "collapse all" </b>, all folding sections in the body will fold. <br>
    The limit is 10k objects per document<br>
    </li> <li> If you <b> reload the document </b> in your browser ("Ctrl-R" or an icon click), the<br>
    document will be shown with sections open or closed <b> as marked </b> in the document itself.<br>
    </li> </ul><br>
<p>
    The markup is simple: if you'd like a section to stay open upon load/reload,  add a "+" before<br>
    "h" in the opening  heading tag:<br>
    <pre> &lt;+h1&gt;, or &lt;+h2&gt;, ... </pre><br>
<p>
    This is important when you work on a section or many sections of your LIterate Source file for<br>
    a longer period and could not click them open in teh browser time and time again, after each <br>
    minor code change when you reload the "project.weave" in your browser to see the updates.<br>
<p>
    Such changes - adding or deleting a "+" - can often be done with one command in a programming editor.<br>
    For example, to open the whole subthread in vim, issue a range command, sth like<br>
    <pre> 1024,1150s/&lt;h/&lt;+h/ </pre> (i.e. substitute between lines 1024 and 1150 of your Literate Source file)<br>
<p>
    Another suggestion is, when you, for example, work with several program files inside your LIterate<br>
    Source (project) file, you might keep subthreads marked open, while changing only the topmost <br>
    heading to show/hide the whole of that file/subthread code and notes.<br>
<p>
    Even when you handpick the sections to keep open, I found, this arrangement suits me well, at least<br>
    for medium-sized LSFiles up to several thousand lines long.<br>
    I also use folding inside "vim", and so line ranges are visible at one glance: "z-a" to collapse the<br>
    vim fold, and then see the range and issue the range command.<br>
<p>
    <i> Note </i> <br>
	<ul> Use of folding inside your programming editor  &nbsp;   &nbsp;  i s  &nbsp;  n o t  &nbsp;  a  &nbsp;  s u b s t i t u t e  &nbsp;  for reading <br>
	a well-laid out formatted document in the browser. Vim folding is still "blind" and  navigation<br>
	inside such a file still has to rely on your memory of the full layout. This is a burden one <br>
	wishes to escape when programming, to be able to dedicate attention to thinking and<br>
	programming while avoiding unnecessary "housekeeping" tasks. Short-term memory of humans<br>
	is very small, and switching between remembering where things are and doing programming<br>
	becomes exhausting when your program exceeds a thousand lines or so.<br>
<p>
	MOLLY numbers lines in the code sections by default, making jumps from reading in your browser<br>
	to editing a particular line in your editor painless. I could also put it like this: I view<br>
	the file globally in my browser as a folding document when I am thinking, while editing <br>
	"locally" in a programming editor, without thinking about the overall layout of the file.<br>
<p>
	</ul><br>
<p>
    MOLLY.pl is written to filter out vim folding markups ( {{{number ... }}}number ) and those <br>
    will not show on your web page.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('29');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('30');">
<font class='lnum'><i>(30)</i></font>&nbsp; TOC and Code Chunks Index </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1272)</i></sub></font></a></legend></fieldset>
<p>
<div id="30" style="display:none">   
<ul>


<p>
Traditional literate programming tools create extensive indeces of variables and code chunks.<br>
<p>
    The approach in this script is as follows:<br>
<p>
    Index of all code chunks in your LSFile exists (unless a configuration opton in the <br>
    template tells MOLLY to skip it) right under TOC. Click on teh line to expand it, and then use<br>
    TOC section numbers to click open the sections which contain or define the chunks you need.<br>
<p>
    Remember that <i> all parent sections </i> above the needed one must be open for you to see <br>
    the innermost subsection in your browser. This is easy to control through TOC highlighting, and<br>
    as an additional indicator, the slider on your web browser will visibly jerk and shorten when <br>
    new sections will become visible in the browser window.<br>
<p>
    It's also convenient to keep some inner subsections open, but click closed the topmost section to<br>
    quickly hide and unhide larger pieces of code (e.g.complete files which live inside the Literate<br>
    Source File when it is used as a common Project file for many source files, test files, makefile(s)<br>
    etc.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('30');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('31');">
<font class='lnum'><i>(31)</i></font>&nbsp; Searching for symbols, chunks, phrases </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1296)</i></sub></font></a></legend></fieldset>
<p>
<div id="31" style="display:none">   
<ul>


<p>
Web browsers "search" functions  will work on open sections only, at least that's the behaviour of<br>
    Opera and Mozilla browsers.<br>
    This means that instead of creating exhaustive indeces of symbols, which clutter program text, <br>
    especially when they display as HTML links in the output of Weaver tools, one can ensure only the<br>
    interesting subsections are open and then search using the built-in browser function. It usually<br>
    highlights the results and iterates over the found items, which is a nice behaviour.<br>
<p>
    To search in the whole of the LSFile, simply click on the "expand all" under any of the subsections,<br>
    and then again use the browser search function.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('31');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('32');">
<font class='lnum'><i>(32)</i></font>&nbsp; TOC/Index unfolding and collapsing </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1312)</i></sub></font></a></legend></fieldset>
<p>
<div id="32" style="display:none">   
<ul>


<p>
    The TOC and Index at the top of the document can be kept folded or expanded upon initial load<br>
    depending on the configuration variables in the "mollifying" template you add at the top of <br>
    your Literate Project file. Please see the subsection titled '"Mollification" - full template' above<br>
    Of course, those subsections can always be opened/closed manually at any time<br>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('32');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('33');">
<font class='lnum'><i>(33)</i></font>&nbsp; Use for printing </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1321)</i></sub></font></a></legend></fieldset>
<p>
<div id="33" style="display:none">   
<ul>


<p>
Unfolding only the needed sections also seems to work well with printing from the browser window.<br>
    You can therefore avoid picking certain pages manually from "print preview". You'll print only<br>
    the visible part(s) - i.e. the open sections and the topmost folded section names, which do not<br>
    take place if your document is marked in a sane way, and rather help the reader to orient himself<br>
    while looking at the printout.<br>
<p>
    Just remember to check the font size in the "print preview" when preparing to print for the first <br>
    time.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('33');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('34');">
<font class='lnum'><i>(34)</i></font>&nbsp; Text browsers and JavaScript </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1336)</i></sub></font></a></legend></fieldset>
<p>
<div id="34" style="display:none">   
<ul>


<p>
Web page folding seems to work well with text-only www browsers, such as  "lynx" or 'w3m': they do not <br>
understand javascript folding, and so display the whole document.<br>
<p>
Here's an example invocation with w3m:<br>
<pre>  ./MOLLY.weave | w3m -T text/html  </pre><br>
<i> Note </i>MOLLY does not issue HTTP headers, and this may affect browser behaviour. The web server<br>
 and/or browser may add them or not, or ignore them or not. I might need to correct that.<br>
<p>
If JavaScript in your GUI browser is turned off, you'll see only the sections marked in the body<br>
of the Literate Source file as open.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('34');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('27');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('35');">
<font class='lnum'><i>(35)</i></font>&nbsp; SUGGESTED USES: Work with Folding LSFiles</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1354)</i></sub></font></a></legend></fieldset>
<p>
<div id="35" style="display:none">   
<ul>


<i> <b>  section unfinished; an outline of major points for now </b> </i><br>
<p>
I do not show examples below, as the document you are reading itself is an example of the<br>
techniques (and that may be the reason it is too bloated and somewhat unorderly ;)) ).<br>
<p>
<ol> <li> Literate Programming proper.<br>
<p>
    Emphasis on note-taking rather than producing a polished "essay" or "documentation"<br>
<p>
    Traditional Literate Programming texts place much emphasis on the fact that it is a means of <br>
    providing <i> documentation </i> (albeit with source code, and reflecting the thinking rather<br>
    than machine-imposed order).<br>
    Knuth first thought of LP as a documentation tool, then upgraded it to a "programming paradigm",<br>
    but insisted on writing programs "like literary essays".<br>
<p>
    However I would like to suggest placing emphasis on NOT documenting and NOT producing <br>
    polished code or an essay in thinking. The first use of this programming technique is <br>
    to  <i> keep a full log of your thinking </i> irrespective of how polished or stupid it is.<br>
<p>
    This is most precious. When you first attack a problem, several directions might come to mind,<br>
    but once you began to work out one of then in detail, everything else is lost. This is the<br>
    way human mind works. Keeping even briefest notes is more valuable than attempting to produce<br>
    polished exposition.<br>
<p>
    Psychological restrain people feel when they are compelled to prepare something for other people<br>
    is probably the third major hurdle to wide spreading of L.P. (the first two were flat file <br>
    structure and formatting languages which doubled the effort of programming and debugging).<br>
<p>
    My MOLLY Literate Source file is a log of my thinking, trials and experiments. I might later offer<br>
    a cleaned version to other people, but I do not give a damn about them in the beginning.<br>
<p>
    Non-folding L.P. source files could not accomodate inclusion of old versions, test files, bad<br>
    versions and skeletons without polutting the file to the degree of becoming unusable.<br>
<p>
    Folding version of L.P. source allows one to relegate bad trials into subsections  nicely folded<br>
    out of the way by merely adding a single header line.<br>
<p>
    When creating documentation, I could double the content of some sections, by copy-pasting the<br>
    "cleaned" versions, and then save a version with the original snippets bypassed, which is<br>
    easy and mechanical with tools like "gema", "awk" or "perl", just put a code word like<br>
    "scrap" in the beginning and end of those sections you'd like to avoid.<br>
<p>
    This ability to bypass marked sections when weaving, by the way, might be incorporated as an<br>
    option into a future version of MOLLY, to produce both 'clean' and 'dirty' versions of the<br>
   formatted Literate Source doc from one file.<br>
<p>
</li> <li> Use as a combined Project file<br>
    <ul> <li> to include tests and snippets that implement skeleton functionality to<br>
    be embedded into the main program<br>
    </li> <li> to include versioning and changes in the way  that does not break what<br>
    has been working so far (there was even a special term for that as a programming <br>
    principle). Keep the old version, put it into a subsection, and rename the chunk<br>
    to bypass it. The newer version of the piece of code that is being reworked will<br>
    get the old chunk name to be included into the chain to tangle out.<br>
    </li> <li> To keep a makefile (split, to which I can add lines from many places in<br>
    my Literate Source as I grow it) together with source file(s)<br>
    </li> <li> To keep several source files related logically in teh same Literate Source file.<br>
    </li> </ul><br>
<p>
    <i> Folding meta-files </i> could be used for larger projects, in which <br>
    the meta-file, a folding document, would describe teh topmost level layout of the <br>
    project, and contain ordinary HTML links to partial Folding Literate Sourcefiles, which<br>
    will keep all the junk as described above.<br>
<p>
    In any case, the use of Folding Literate Source files would considerably simplify tracking<br>
    of the project files in a version control system.<br>
<p>
</li> <li> Use for system administration etc. - as a single file to keep many sysadmin scripts, <br>
    descriptions of conventions and procedures, bugs and changes in the system <b> <i> in one place </i> </b><br>
    from which any of the included source (or texts, if they are kept in the "source chunks") <br>
    can be obtained easily with a single command.<br>
    ALSO: combine LIterate Source project file with a makefile as a simple means to keep <br>
    one-command tangling of multiple targets.<br>
<p>
    This Literate Source can live in a central place (e.g. root home) and be under version control.<br>
    The tangled pieces, config files or scripts could be copied to files on one or many machines.<br>
<p>
</li> <li> Use for non-programming tasks:<br>
    <ul> <li> as a note-keeper. E.g. I kept job listings and followi-up info in a folding<br>
   MOLLY file and found it quite convenient. <br>
    </li> <li> as an outliner for general purpose texts.<br>
    </li> <li> for keeping documentation, books etc. I keep documentation for a number of<br>
    software tools (e.g. "awk", "newlisp", "monotone") in folding format. It <i> is </i> helpful.<br>
    </li> <li> for editorial work on larger texts. The text itself will become "code chunks", <br>
    and editorial remarks and meta-thinking will remain as "documentation" in a Literate <br>
    Source file.<br>
    </li> </ul><br>
<p>
</li> </ol><br>
<p>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('36');">
<font class='lnum'><i>(36)</i></font>&nbsp; scrap </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1447)</i></sub></font></a></legend></fieldset>
<p>
<div id="36" style="display:none">   
<ul>

(a) //CGI and CL invocations - compared to "noweb"<br>
    // dotHTML tagging; alternative tagging, translations<br>
    // alternative tanglers and pass-through tangler; makefile problem<br>
<p>
(b) ideas - how to incorporate tests; how to keep a single project file;<br>
how to set up dummy plugs and alternatives (i.e. to develop without destroying<br>
the old working version)<br>
Maybe: for distribution of a lot of small scripts (admin etc), the  way I used<br>
Makefiles?<br>
<p>
(c) It's possible even to do development in smallest chunks -- and later (e.g. for<br>
outside clients or for higher-level documentation, etc.) to consolidate the tiny fractured <br>
bits and pieces, with plenty of alternatives, dummies, plugs and trials etc. etc.<br>
How? - by tangling those from some certain level and copy-pasting the result into the<br>
Literate Project File.<br>
One could even keep the actual development fractions in a subsection, while retaining<br>
higher-level and cleaner view in higher level sections. I do not care about doubling the<br>
text at all.<br>
<p>
<b>suggestion from a Slashdot 2002 discussion </b>(see ref above) about style or approach:<br>
do not document what the code does (which is redundant, as can be seen from the code itself),<br>
document rather WHY it does it (what's the purpose or the idea).<br>
<p>
<b> Also </b> use this file itself as an example of all illustrated techniques.<br>
<p>
Use <b>"mollify"</b> as  a technical term (insert MOLLY.pl invocation into the LitProject file)<br>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('36');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('35');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('10');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('37');">
<font class='lnum'><i>(37)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1480)</i></sub></font></a></legend></fieldset>
<p>
<div id="37" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('37');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('38');">
<font class='lnum'><i>(38)</i></font>&nbsp; PART III ------------ LITERATE SOURCE OF THE SCRIPT ------------ </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1483)</i></sub></font></a></legend></fieldset>
<p>
<div id="38" style="display:none">   
<ul>


<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('39');">
<font class='lnum'><i>(39)</i></font>&nbsp; Local Reference </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1488)</i></sub></font></a></legend></fieldset>
<p>
<div id="39" style="display:none">   
<ul>


<p>
<b> VIM regexp to highlight literate code sections only: </b><br>
<i> HAD TO spoil it because "notangle" complained about double diamonds <br>
"in documentation chunk", bastard </i><br>
<pre> ^&lt; &lt;.*&gt; &gt;=\_.\{-1,}\n^@/e </pre><br>
.. and vice versa, highlight text, leave only code unhighlighted:<br>
<pre> ^@\_.\{-1,}\n^&lt; &lt;.*&gt; &gt;=/e </pre><br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('39');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('40');">
<font class='lnum'><i>(40)</i></font>&nbsp; Bugs, status, changes </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1507)</i></sub></font></a></legend></fieldset>
<p>
<div id="40" style="display:none">   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('41');">
<font class='lnum'><i>(41)</i></font>&nbsp; Ideas - versions - changes</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1511)</i></sub></font></a></legend></fieldset>
<p>
<div id="41" style="display:none">   
<ul>


<p>
Current version:<br>
<ul><br>
    <li> creates folding documents on the fly..<br>
    </li><li> ..based on dotHTML or rawHTML markup <br>
    (i.e. either to create new docs or convert existing HTML into folding format);<br>
    </li><li> and generates dynamically TOC and code chunks index;<br>
    </li><li> ties collapsing/expandind of sections with TOC highlighting;<br>
    </li><li> .. and provides pass-through tangling with "noweb".<br>
    </li></ul><br>
<p>
    This script is a test of the concept (LitProg+folding+dynamic web formatting)<br>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('42');">
<font class='lnum'><i>(42)</i></font>&nbsp; first ideas </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1528)</i></sub></font></a></legend></fieldset>
<p>
<div id="42" style="display:none">   
<ul>


<p>
<p>
    Options for future versions --  3 ideas for now:<br>
    <ul><br>
    <li> add a built-in tangler (while retaining the possibility to tangle<br>
    through an external tool, such as "notangle" with all its options and filters).<br>
<p>
    </li><li>  &nbsp;  c r e a t e  &nbsp;  a  &nbsp;  f u l l y  &nbsp;  s e l f - c o n t a i n e d  &nbsp;  folding web-based  &nbsp;  w e a v e r  &nbsp; <br>
    ("Lilit") (plus possibly a built-in tangler).<br>
    This can be done in newlisp (www.newlisp.org), which has a built-in httpd<br>
    and allows creation of 250k+(size of script) standalone executables on all<br>
    major platforms (unix/linux, windows mac).<br>
<p>
    </li><li> maybe -  &nbsp;  a d d  &nbsp;  " v i e w s "  &nbsp;  ( a  &nbsp;  l a  &nbsp;  L e o  &nbsp;  v i e w s )  &nbsp;  and maybe editing of single<br>
    subsections (in a pop-up term window with a running editor).<br>
    This - as I see it now - may/will involve storing each subsection in its <br>
    own little file and dynamically concatenating them both for dynamic weaving<br>
    and for tangling ( keep a third name, some "scriptname.src" for dumping the<br>
    full file to STDOUT?? )<br>
    This can be done dynamically: a huge project file will be displayed fully<br>
    collapsed, and then only the sections marked open will be dumped to the web<br>
    browser dynamically.<br>
    The whole thingy can be kept either as a bunch of section-files in a subdir,<br>
    or (and/or) in a tar file (gzipped or not, indexed or not).<br>
<p>
    <b> One possible implementation </b> is with <a href= http://www.wikiwyg.net > http://www.wikiwyg.net </a><br>
    - the "wikiwyg" library, which can turn any "div" into an editable section.<br>
<p>
    The lib as it is distribted does not save (no sub that saves, actually), but<br>
    one can "save in the browser" and next save the page from the browser to a <br>
    local file<br>
<p>
    For a local programming setup ( thttpd on localhost:8000 for example) this<br>
    will do. However one still needs to figure out if there is a possible post-<br>
    processing of the dynamically created (and then saved from the browser) page<br>
    with some script that would strip back the "frameset" decorations and the <br>
    invocations of folding plus the html head and TOC/chunks index sections.<br>
<p>
    I might say, I need the "reverse weaver" (although not as thorough ?)<br>
<p>
    .. and, secondly, after post-processing, if there is an invocation op "patch"<br>
    which would apply the diffs back to the Literate SOurce file.<br>
<p>
    <ul> <li> Will a "context patch" do? Can I postprocess<br>
    </li> <li> Can I postprocess the dynamically generated HTML to mimic some<br>
    sort of diff markup (unified? Context? ...)<br>
    </li> <li> Third, the exact invocation to apply it to an LSF.<br>
    Is manual restoration of this kind possible? Is it poss to run through a GUI<br>
    merge tool? An "apply all left to the right one" automatic tool?<br>
    </li> <li> This can be presented as buttons on the page (when the wikiwyg<br>
    option is enabled) etc.<br>
    The script then would take another option (your_filename?apply_changes) to<br>
    run this, and fail with a request to do a manual merge if not possible.<br>
    </li> </ul><br>
<p>
    Then the question   remains, how practically useful/convenient that is.<br>
<p>
<p>
    <i>How to do it</i><br>
    /* Basically, to manage sectionfiles I'd have to code as if those are comments<br>
    to a blog entry (and dynamic gathering of them is the same, too. Should be<br>
    rather obvious and possibly quite easy*/<br>
    This 'views_enabled' mode will switch to sect-files in a ./.molly/ and will<br>
    add dynamic links to each section: "edit section" (in an external editor);<br>
    "update Literate Source Project file". And the script will start to check the<br>
    subdir and dynamically reconstruct its HTML output in this mode.<br>
    Same must be true for the "tangler" pre-filter, too - it will reconstruct<br>
    the whole before passing it to the "notangle" utility.<br>
<p>
    </li><li> Is it possible to do  &nbsp;  " p r o m o t i n g / d e m o t i n g "  &nbsp;   &nbsp;  o f  &nbsp;  b r a n c h e s ? ?  &nbsp; <br>
    Is it possible in the view-enabled weaver?<br>
<p>
    </li><li>  &nbsp;  a d d  &nbsp;  " w e b  &nbsp;  t a n g l e  &nbsp;  m o d e "  &nbsp; , in which MOLLY will dump coloured diff<br>
    of the subsections (or the whole file if not too large), of the current version,<br>
    tangled via the browser form versus a file on disk.<br>
    (I do it all the time firing fldiff after each tangle - would be convenient to<br>
    have the functionality before tangling to disk (with file renaming etc), just<br>
    by reloading a page in a browser.<br>
    Will need to allow saving files (or some branch of chunks) from the browser, then.<br>
<p>
    Do I underuse  &nbsp;   &nbsp;  V i m  &nbsp;  ? - it does have <b> some "diff" mode </b> for side-to-side<br>
    display. Just open 2 files, current and prev. vers. and toggle btw one-file<br>
    view and edit or side-by-side coloured diff ???<br>
<p>
    <i>How to do it</i><br>
    .. by first (poss) checking that the files are not identical, and then by<br>
    filtering into "diff":<br>
    <pre> MOLLY.tangle|diff -y -w --left-column xxz - |less </pre><br>
    Just wrap it into html-body-pre tags and colour if there's something in the <br>
    right half (not necessary, really)<br>
<p>
</li> <li> <b> context diffs and sections editing </b>   <br>
</li> </ul><br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('42');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('43');">
<font class='lnum'><i>(43)</i></font>&nbsp; more ideas </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1629)</i></sub></font></a></legend></fieldset>
<p>
<div id="43" style="display:none">   
<ul>


<p>
<b> More ideas: </b><br>
<p>
<b> 1. Maybe </b>  have the  &nbsp;   &nbsp;  " c o m p o s i t e  &nbsp;  d o c u m e n t "  &nbsp;  (or "fragmented document") <br>
    option for  &nbsp;   &nbsp;  t h e  &nbsp;  s e c o n d - l e v e l  &nbsp;  meta-management  &nbsp;   &nbsp;  o f  &nbsp;  p r o j e c t  &nbsp;  f i l e s  &nbsp; <br>
    I.e. one project could be split into many file-sections, and MOLLY weaver will <br>
    assemble them into the doc.<br>
    OR: I maintain logically consistent pieces in medium-size project files, and<br>
    keep a meta-project file with the split option enabled.<br>
    The "edit" links from it will pop up gvim or another editor of choice with<br>
    the full piece in it.<br>
    While viewing will present it all as if one LIterate Source project file.<br>
    I'll need only to mark the pieces in the TOC, possibly, as a separate doc,<br>
    and -- <b> how will I treat TOC compilation then ? </b><br>
<p>
<b> 2. Maybe </b> - if I find an ASCII script (ascii art from commands and <br>
    descriptions), I could automatically generate  &nbsp;   &nbsp;  a s c i i - a r t  &nbsp;  " m a p s "  &nbsp;  <br>
    of the chunks ??<br>
<p>
<p>
<b> 3. introduce horizontal/vertical layouts? </b> <br>
    I.e. TOC and Chunks Index either on top of the file or on the left of it for<br>
    "wide screens", like those on notebooks ??<br>
    Changes are in  "Print out the resulting page" (currently line 3359)<br>
     - plus options, of course<br>
<p>
    Note: will require gluing TOC or the body to stick at the top, not simple table<br>
    cells, which will center and resize depending on relative cell content sizes.<br>
    May require separate scrolling for the two panes?<br>
<p>
OR: <b> TOC/Index in a floating window? </b> -- should be easy, just  name the<br>
    output windows.<br>
<p>
<b> 4. Maybe </b> add ancors to folding section names to be able to 'hyperlink' <br>
    and refer to them from other parts of the document??<br>
    // no jumps from the TOC? or with a separate 'jump' icon? //<br>
    // no jumps to closed sections will work anyway, then what to do? //<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('43');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('44');">
<font class='lnum'><i>(44)</i></font>&nbsp;  CONTRACT PROGRAMMING and Molly?? </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1675)</i></sub></font></a></legend></fieldset>
<p>
<div id="44" style="display:none">   
<ul>


<p>
possibly add conditional tangling to produce a contract-assertion-littereted prog during<br>
development and debugging --<br>
versus a "clean" copy -- ???<br>
<p>
<b> OR </b> just keep an "assertion-full" skeleton  by using a simple "rename" or a <br>
meta-chunk which is a dispatcher??<br>
<pre> [chunk_to_do_sth]=
 code code code code
 [another_chunk_ref]
 more code more code
 @
</pre><br>
...NO, I cannot do that without conditional tangling<br>
...or - do it in the target language using a "lazy and" for conditionals:<br>
(and (debug_assert_flag) (block .....with some code.....))<br>
<p>
<b> Well, this is what I can do: </b><br>
<pre>
&lt; &lt; main code chunk &gt; &gt; =
if ($DEBUG) {
&lt; &lt; pre-chunk assertions and if-checks &gt; &gt;
} # fi DEBUG

# main chunk code goes here

if ($DEBUG) {
&lt; &lt; post-chunk assertions and if-checks &gt;&gt;
} # fi DEBUG
#end of chunk here @
</pre><br>
<p>
Then I'll be able to produce debug code by tangling:<br>
<pre> notangle -R"some root" project.weave </pre><br>
and the "clean code" without assertion checks I'll get from it<br>
by simply filtering with<br>
<pre> perl -ne 'print unless m!^if ($DEBUG) {! .. m!^\} # fi DEBUG!' tangled.code \
&gt; clean.distribution.code </pre><br>
<p>
Should be easy enough ;))<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('44');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('45');">
<font class='lnum'><i>(45)</i></font>&nbsp; Editor highlighting, Perl POD and Literate Markup </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1721)</i></sub></font></a></legend></fieldset>
<p>
<div id="45" style="display:none">   
<ul>


<p>
The editor highlighting and literate marks  - is <i> bullshit </i><br>
The way I danced around it in Molly is half-insane.<br>
<p>
<b> SO: the solution might be </b> to configure POD marks as <br>
alternative literate markup boundaries, and/or filter the shit<br>
substituting for the real ones in the "pass-through tangler".<br>
Will be Ok at least for quick development, won't it?<br>
<p>
The namess of the POD sections are the names of literate chunks, then.<br>
<p>
I coould try "=pod Name of the Chunk"<br>
as simple PODs stand for nothing<br>
<p>
	(a) need empty lines around all POD markers<br>
	(b) =pod is ignored unless there is a =meaningful_mark<br>
	before<br>
	(c) =pod SOME TEXT -- text is ignored<br>
<p>
So, I could use it, it seems? OR: is there any sense in that??<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('45');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('41');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('46');">
<font class='lnum'><i>(46)</i></font>&nbsp;Done </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1749)</i></sub></font></a></legend></fieldset>
<p>
<div id="46" style="display:none">   
<ul>


<p>
<b> 1. Adding TOC open/collapsed section indication </b><br>
Changes must be made in:<br>
"weave me" ==&gt; "JS script functions" &amp;&amp; "stylesheet"<br>
// as expl in the ref section below <br>
<p>
AND in<br>
"Accumulate the result" ==&gt; "process section headings"<br>
// the actual invocation "onmousedown"<br>
<p>
<p>
<b> 2. Synchronize TOC and sections </b><br>
I have done highlighting; now two more steps:<br>
    <ul> (a) make body sections run "toggleCombined" rather that directly<br>
    open/close the "div"s/sections - to highlight the TOC at the moment<br>
    of change<br>
    (b) make TOC bg. highlighting recognize the "+" signs in the html headings<br>
    markup.<br>
    </ul><br>
This is not difficult, just needs a little attention.<br>
<p>
To do (b) NEED to rewrite <br>
<pre> &lt;div id="$section_num" style="display:$fold_state"&gt;  </pre><br>
in line appr. 370 to add inline javascript invocation of expandDiv<br>
<p>
3. see 8.<br>
Add "pass-through" direct HTML dummy encoder (plus a switch btw rawHTML and dotHTML)<br>
Explain  the user can expand the script in any way he wishes (e.g. with a "wiki" syntax)<br>
<p>
(++-)4. I still need to do at least a <b> stub in tangler </b> to do some pre-filtering before<br>
calling "notangle".<br>
E.g. I might want to reassign the double-&lt; and double-&gt; or other symbols for some esoteric<br>
languages, or filter out escapes from documentation chunks for the notangle not to choke.<br>
<p>
NO SWITCH yet to select from pre-tangle filters or built-in tangler.<br>
<p>
(++) 8. Weaving -- "dotHTML" versus "rawHTML".<br>
Version MOLLY-0.62-BAD.pl is incorrect. It's "dot" markup is OK, but for "raw" to work <br>
<i> regexps must be changed </i> in the main filtering "if - elsif - else", as headers<br>
will too be in angle brackets, not in dots.<br>
<p>
<b> May be a good idea to extract those regexps </b> and assign them to vars, as now<br>
they are coded in, bad.<br>
<p>
9. See "accumulate result in a buffer"<br>
Should I make the "----start of script--" line unnecessary (relying on __DAT A__ ) ??<br>
Or =- both? or no "data" (as it throws off editors highlighting) ???<br>
<b> set to react to DATA not "start of script"</b><br>
<p>
<p>
<b> Bug with setting default for $print_toc fixed</b> --  must check for "defined", the perl operator<br>
xx?aa:bb checks for 0 or non-0, and so if the var equals 0 it will never set it to 0.<br>
Changed and tested.<br>
Maybe should use "yes" and "no" instead of "1" and "0"?<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('46');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('47');">
<font class='lnum'><i>(47)</i></font>&nbsp;Todo -  current</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1815)</i></sub></font></a></legend></fieldset>
<p>
<div id="47" style="display:none">   
<ul>


<p>
<b>1. Problem of double diamonds in doc chunks </b><br>
<ul><br>
    change the pass-through tangler to isolate the "notangle" from docs sections???<br>
    (will squash the prob of double angle brackets in documentation chunks)<br>
<p>
    OR - introduce a sort of escape?? Because sol 1 would clobber correct line numbering??<br>
    But I do not number lines in the default pass-through invocation..<br>
    The standalone will be affected, anyway.<br>
<p>
    I could add regex conversion to hexadecimals in the pass-through tangler.<br>
    However it would still break the "notangle" when run standalone.<br>
<p>
    I could collect command-line options in case of "scriptname.tangle" invocation<br>
    and pass them to "notangle" - that could be a sort of solution.<br>
</ul><br>
<p>
2. Change logic of "weave-tangle" ("main despatcher"), as it is stupidly convoluted <br>
and ugly now<br>
<p>
3 and 8. (++) rawHTML mode, done<br>
<p>
4. (++-) see below in "done"<br>
<p>
5. <b> BUG of sorts </b><br>
the "lt" and "gt" escapes in the code chunks right above ("tangle me with filtering") are not <br>
displayed correctly  by the web weaver: the browser displays them as real angle brackets.<br>
<p>
6. <s>TMLize the error message in the main despatcher (if "I am a module", print it as<br>
an html file). Otherwise it won't look good in the browser. </s> <br>
<b> NOT NEEDED </b> as "tangling" is done from CL only<br>
<p>
7. Add another mode - if file ext is "src" - "scriptname.src" - do not pass to "notangle", but<br>
dump the pre-filtered source to STDOUT.<br>
May be needed in some cases, who knows?? - i.e. to escape special symbols, such as double-&lt;'s <br>
etc in documentation chunks.<br>
Ordinarily, this is not needed and the file can be processed by "notangle" directly.<br>
This step is needed to tangle some non-default pieces or to use some extra tangling options.<br>
<p>
9 (++). DATA or ---start of script-- to filter?? - done<br>
<p>
10. Add "expand subthread" ?? - to open only the current branch of the L.T.File?<br>
<p>
11. Add auto-href creation (i.e. posting a URL with minimal markup must create a valid<br>
    HTML link with URL as the name of it.<br>
<p>
12 (+--). and checking <br>
qwer qwer  &nbsp;  s p a c i n g  &nbsp;  of one word and <i> &nbsp;  o f  &nbsp;   &nbsp;  m a n y  &nbsp;   &nbsp;  o n  &nbsp;   &nbsp;  t h e  &nbsp;   &nbsp;  s a m e  &nbsp;  l i n e  &nbsp; </i> asdf asd  <br>
SO: to do word boundaries properly.<br>
DONE although not very cleanly. The tag will break across several lines<br>
<p>
13. Add a full set of HTML escapes to "dotHTML" and "rawHTML" ?<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('47');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('40');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('48');">
<font class='lnum'><i>(48)</i></font>&nbsp; PRELIMINARIES: The script layout and idea </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1880)</i></sub></font></a></legend></fieldset>
<p>
<div id="48" style="display:none">   
<ul>


<p>
.. are very simple.<br>
<p>
<b>1. </b> It is possible to include an invocation of a  perl script with <br>
<pre> "do script.pl" or "use script.pl"  </pre><br>
as the first lines in a Literate Source file.  This turns the source into a standalone perl script. <br>
If we write the script to process the L.Source file itself ($0 in perl parlance) then the script can do <br>
weaving and tangling of it. The output, which is formatted documentation (which was "weaved" from L.P.) <br>
or the sources usable by a computer ("tangled") can be  saved in a file, as with traditional "literate <br>
programming" tools. But which is more convenient, the formatted documentation can be  picked up by a web  <br>
server, and thus allow us to see work in progress immediately and automatically. <br>
<p>
When I think, I prefer to look at the formatted document, and when I change, I do it "locally" in a good<br>
programming editor (such as "vim"). Even with vim folding the difference in perception is enormous.<br>
<p>
<b> 2. </b>I see three advantages to such an arrangement:  <br>
<ul><li>first, web markup is ubiquitous today, and it is quite sufficient for most publishing needs. <br>
So Literate Programming with HTML will free us from a tie to TeX which so negatively affected <br>
perception of L.P. by the masses of programmers. The markup becomes very, very simple. <br>
<p>
This eliminates a source of one major complaint about the traditional L.P. - that the programmer has <br>
to maintain not one, but two "programming languages" while working with LP, the target one<br>
and the formatting one. This - the complaint goes - becomes a source of errors from an additional layer <br>
of programming in addition to writing the code itself. It taxes the programmer's mind rather than relieving<br>
it.<br>
<p>
In fact, simple HTML is almost self-correcting, as wrong markup becomes immediately obvious in the <br>
browser. <br>
<p>
</li> <li> secondly, this eliminates "weaving" as a separate step during development, but more<br>
importantly, such an arrangement allows a programmer to think about his program while looking<br>
at a <i>folding</i> document, in which only relevant sections are open.<br>
<p>
I perceive <i> folding </i> as a major advantage<br>
<p>
With <i>folding</i> the Literate Source file becomes manageable even for really large texts. This in turn<br>
allows the programmer to keep <i> many files </i> inside the LPSource, including test snippets, the makefile,<br>
preserve old versions of parts of the source etc. etc.<br>
Literate Source file is painlessely turned into a Project File, one file, from which anything can be<br>
easily generated.<br>
It is this one file that my version control system must track now. For really large projects, we can keep<br>
a meta-file (also in the folding format) with largish partial files as links, corresponding to logical <br>
pieces of the project, which will open in the browser as automatically weaved Literate Source Files.<br>
<p>
I attempted to explain this at length in introductory sections above.<br>
</li></ul><br>
<p>
<b>3. </b> The script that programs this functionality can assemble all pieces as buffered strings in RAM: today's <br>
machines routinely contain RAM in Gigabytes, therefore processing in memory a very large source or <br>
project file  in Megabytes, even in tens of Megabytes is not a problem. <br>
<p>
<b>4. </b> How the script works overall<br>
<p>
After figuring out how it was invoked, the script:<br>
<ul><li> <b>when it is supposed to weave</b>, scans into memory the Literate Source file, marked up in "noweb" <br>
notation (and its document sections marked with raw HTML or in "dotHTML") doing necessary substitutions <br>
and conversions along the way.<br>
Then the buffered string thus formed and several auxilliary buffers (for document TOC and Index <br>
sections) are printed out to STDOUT. They can be redirected into files, if LPSource, now also an executable<br>
script itself, is run from command line, or they can be picked up by a local personal web server that is<br>
used by the developer, which  should recognize the LPSource as a valid CGI script<br>
<p>
After any changes in the script, the user can reload the page in his web browser and immediately see the<br>
changes.<br>
<p>
</li><li> <b>If invoked to tangle</b> the source of the program, this version of the script will refer the <br>
actual  tangling to the "notangle" utility from "noweb" suite of tools by Ramsey.<br>
</li></ul><br>
<b>5. </b>  &nbsp;   &nbsp;  A  &nbsp;  f u t u r e  &nbsp;  v e r s i o n  &nbsp;  of the script may be made completely self-contained, i.e. include a mini-web <br>
server as well as a folding weaver and a tangler.<br>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('48');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('49');">
<font class='lnum'><i>(49)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1956)</i></sub></font></a></legend></fieldset>
<p>
<div id="49" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('49');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('50');">
<font class='lnum'><i>(50)</i></font>&nbsp; MOLLY.pl - top of the script </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1959)</i></sub></font></a></legend></fieldset>
<p>
<div id="50" style="display:none">   
<ul>


<p>
<font class='lnum'>1962</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;MOLLY.pl module&gt;&gt;=</legend>
<font class='lnum'>1963</font>   #!/usr/bin/perl
<font class='lnum'>1964</font>   
<font class='lnum'>1965</font>   #---------------------------------------------------------------------------------    
<font class='lnum'>1966</font>   #
<font class='lnum'>1967</font>   #	This script is licensed under GPL version 3
<font class='lnum'>1968</font>   #
<font class='lnum'>1969</font>   #----------------------Script proper----------------------------------------------
<font class='lnum'>1970</font>   
<font class='lnum'>1971</font>   
<font class='lnum'>1972</font>   <font class='chunkref'>&lt;&lt;general settings&gt;&gt</font>;
<font class='lnum'>1973</font>   <font class='chunkref'>&lt;&lt;main despatcher&gt;&gt</font>;
<font class='lnum'>1974</font>   <font class='chunkref'>&lt;&lt;tangle me&gt;&gt</font>;
<font class='lnum'>1975</font>   <font class='chunkref'>&lt;&lt;weave me&gt;&gt</font>;
<font class='lnum'>1976</font>   
<font class='lnum'>1977</font>   # END OF SCRIPT
<font class='lnum'>1978</font>   </fieldset></pre>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('51');">
<font class='lnum'><i>(51)</i></font>&nbsp; general settings </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1982)</i></sub></font></a></legend></fieldset>
<p>
<div id="51" style="display:none">   
<ul>


<p>
<p>
Some internal script parameters are set here.<br>
E.g. "noweb" tangler gets confused if it finds double angle brackets<br>
anywhere, so sometimes it's possible to fool it by setting a var in the<br>
perl script like this:<br>
<p>
<font class='lnum'>1991</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1992</font>     # need to fool the noweb "notangle" utility, switch markup modes etc.
<font class='lnum'>1993</font>     $lt = "&lt;";
<font class='lnum'>1994</font>     $gt = "&gt;";
<font class='lnum'>1995</font>     $lt_esc = "&amp;lt;";
<font class='lnum'>1996</font>     $gt_esc = "&amp;gt;";
<font class='lnum'>1997</font>     $dash = "-";
<font class='lnum'>1998</font>     $dot = "\.";
<font class='lnum'>1999</font>   </fieldset></pre>
<p>
But more importantly:<br>
There are a number of parameters that can be set from the literate source file<br>
at the very top before loading the module with "do MOLLY.pl" (or "use MOLLY.pl").<br>
These are assigned defaults here. You can refer to this portion of the script<br>
to find out what parameters are settable in your document template and expand the<br>
tunings if you modify MOLLY.pl<br>
<p>
<font class='lnum'>2008</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>2009</font>   
<font class='lnum'>2010</font>     # ----- GENERAL settings -----
<font class='lnum'>2011</font>     
<font class='lnum'>2012</font>     # am I a module? 1:0
<font class='lnum'>2013</font>     $i_am_module = 1;
<font class='lnum'>2014</font>   
<font class='lnum'>2015</font>     # print toc? 1:0
<font class='lnum'>2016</font>     $print_toc = 1 unless defined $print_toc;
<font class='lnum'>2017</font>       
<font class='lnum'>2018</font>     # keep TOC expanded on initial load? "block":"none"
<font class='lnum'>2019</font>     $toc_expanded = $toc_expanded || "block";
<font class='lnum'>2020</font>   
<font class='lnum'>2021</font>     # keep TOC expanded in initial load? "block":"none"
<font class='lnum'>2022</font>     $ind_expanded = $ind_expanded || "none";
<font class='lnum'>2023</font>   </fieldset></pre>
<p>
The script will behave differently depending on its own name. One "major" name<br>
can be used with others existing as soft links (although an "thttpd" lightweight<br>
web server insisted on a hard link in one case).<br>
The modes are detected by file extensions, which are set here.<br>
'Weaving' = creating a formatted HTML documentation file on STDOUT<br>
'Tangling' = creating the program/script source on STDOUT<br>
<p>
<font class='lnum'>2032</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>2033</font>     # what is the file extention to weave it? (perms must allow execution!)
<font class='lnum'>2034</font>     # e.g. "scriptname.weave" or "scriptname.cgi" etc.
<font class='lnum'>2035</font>     $weave_extension = $weave_extension || "weave";	# default is "weave"
<font class='lnum'>2036</font>   
<font class='lnum'>2037</font>       # what is the file extention to tangle it? (perms must allow execution!)
<font class='lnum'>2038</font>       # e.g. "scriptname.tangle",  "scriptname.pl" etc.
<font class='lnum'>2039</font>       $tangle_extension = $tangle_extension || "tangle";	# default is "tangle"
<font class='lnum'>2040</font>   
<font class='lnum'>2041</font>   
<font class='lnum'>2042</font>   
<font class='lnum'>2043</font>     # tangle? Or run? (perms must allow execution)
<font class='lnum'>2044</font>     $tangle_me = 1;
<font class='lnum'>2045</font>   
<font class='lnum'>2046</font>         # -- not implemented yet --
<font class='lnum'>2047</font>         #
<font class='lnum'>2048</font>         #$run_me = 0;
<font class='lnum'>2049</font>         # what interpreter to run the tangle output with?
<font class='lnum'>2050</font>         #$run_me_with="/usr/bin/perl";
<font class='lnum'>2051</font>   
<font class='lnum'>2052</font>   
<font class='lnum'>2053</font>   # number lines ? 1 : else
<font class='lnum'>2054</font>   $line_numbering = 1;
<font class='lnum'>2055</font>   </fieldset></pre>
<p>
The document sections ("chunks") can be marked with actual HTML tags ("rawHTML") or<br>
with a smaller number of the same tags in "dots" in place of "angle brackets", i.e.<br>
dot-br-dot, not open.angle-br-closing.angle<br>
This is selected here:<br>
<p>
<font class='lnum'>2062</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>2063</font>   # how are doc sections marked? "dotHTML":"rawHTML"
<font class='lnum'>2064</font>   $weave_markup = $weave_markup || "rawHTML"; # default is "rawHTML"
<font class='lnum'>2065</font>   
<font class='lnum'>2066</font>       if ($weave_markup eq "dotHTML") {
<font class='lnum'>2067</font>   	$tag_open_symbol = $dot;	# this will take care of default
<font class='lnum'>2068</font>   	$tag_close_symbol = $dot;	# when no var is set in the Lit Src file
<font class='lnum'>2069</font>       }
<font class='lnum'>2070</font>       elsif ($weave_markup eq "rawHTML") { 
<font class='lnum'>2071</font>   	$tag_open_symbol = $lt;
<font class='lnum'>2072</font>   	$tag_close_symbol = $gt;
<font class='lnum'>2073</font>       } #fi
<font class='lnum'>2074</font>   
<font class='lnum'>2075</font>   </fieldset></pre>
<p>
<p>
Do we need to enable MathML functionality? If "yes", set the path to the js library<br>
"ASCIIMathML.js" and enable the switch.<br>
This slows down interpretation of the file on reload drastically (from nothing to<br>
3 seconds with 4-5 example formulas), so for sfw development usually this should be off.<br>
<p>
<font class='lnum'>2083</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>2084</font>   
<font class='lnum'>2085</font>   # enable MathML interpretation? 1 : 0
<font class='lnum'>2086</font>   $enable_ASCIIMathML = $enable_ASCIIMathML || 0;
<font class='lnum'>2087</font>   # If enabled, set the path; default is local in current dir
<font class='lnum'>2088</font>   $path_to_ASCIIMathML = $path_to_ASCIIMathML || "ASCIIMathML_with_modified_escapes.js";
<font class='lnum'>2089</font>   
<font class='lnum'>2090</font>   </fieldset></pre>
<p>
<p>
It would make sense to add a few more markups to the program, i.e. some "wiki" many use,<br>
and some TeX basic tags for automatic translation, if the doc is tagged as a TeX file.<br>
<p>
In more detail dotHTML is explained in its own section<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('51');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('52');">
<font class='lnum'><i>(52)</i></font>&nbsp; main despatcher </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2103)</i></sub></font></a></legend></fieldset>
<p>
<div id="52" style="display:none">   
<ul>


<p>
The script figures out how it was invoked and then starts either a tangler<br>
or a weaver, or fails with a usage line.<br>
<p>
If the script name ends in "weave" (e.g. script.weave), it will be weaved to STDOUT.<br>
If the name ends in "tangle", the source starting from the default chunk &lt; &lt;*&gt; &gt;<br>
(without spaces) will be dumped to STDOUT:<br>
<p>
<font class='lnum'>2113</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher&gt;&gt;=</legend>
<font class='lnum'>2114</font>   <font class='chunkref'>&lt;&lt;main despatcher kludgy&gt;&gt</font>;
<font class='lnum'>2115</font>   </fieldset></pre>
<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('53');">
<font class='lnum'><i>(53)</i></font>&nbsp; With tanglediffs as an option </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2120)</i></sub></font></a></legend></fieldset>
<p>
<div id="53" style="display:none">   
<ul>


<p>
<b>To add "tangled diffs"</b>  through a broser - i.e. output of <br>
<pre>  MOLLY.tangle | diff -y -w --left-column xxz - |less </pre><br>
<p>
1. To colour the script must hard-set "width":<br>
<pre> diff -W130 ......... # 130 is the default </pre><br>
The separation line runs at &lt; width/2 (e.g. at pos 63 if W=130, at 87 if W=190 etc<br>
So I can recognize "changed" lines to colour if length($line) &gt;= Width/2 ?? (or strictly more)<br>
But figuring out at which pos the separation line runs without hardcoding W is not obvious to me.<br>
<p>
Another alternative might be to use an external code colourizer, such as vim ??<br>
<p>
<p>
<p>
2. I'll have to redo the despatcher's logic:<br>
    <ul> check REQUEST_METHOD if it si GET, then weave for "xx.weave" extensions, <br>
    do tanglediffs for the "scriptname.tangle" extension, and do real tangle if <br>
    REQUEST_METHOD is not set.<br>
    The tanglediffs will be controlled by cgi query string (i.e. disassemble and<br>
    match QUERY_STRING).<br>
    The tanglediffs will present a form to select a disk file to tanglediff against;<br>
    subsequent views of output can be done by reloading the page in a browser.<br>
    </ul><br>
<p>
<font class='lnum'>2146</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher with tanglediffs&gt;&gt;=</legend>
<font class='lnum'>2147</font>   ;
<font class='lnum'>2148</font>   
<font class='lnum'>2149</font>   </fieldset></pre>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('54');">
<font class='lnum'><i>(54)</i></font>&nbsp; a skeleton script to test this snippet </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2153)</i></sub></font></a></legend></fieldset>
<p>
<div id="54" style="display:none">   
<ul>


<p>
To test: <br>
    <ol><li>save as test.weave, hard link to test.tangle and test.pl<br>
    </li><li> and set thttpd.conf to treat x.tangle as cgi<br>
    </li></ol><br>
<p>
<font class='lnum'>2161</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tanglediff test 1&gt;&gt;=</legend>
<font class='lnum'>2162</font>   #!/usr/bin/perl
<font class='lnum'>2163</font>   
<font class='lnum'>2164</font>   if ( $0 =~ m!\.tangle$! ) { 
<font class='lnum'>2165</font>       if ($ENV{'REQUEST_METHOD'}){ goto TANGLEDIFF_ME }
<font class='lnum'>2166</font>       else { goto TANGLE_ME; }
<font class='lnum'>2167</font>   }
<font class='lnum'>2168</font>   elsif ( $0 =~ m!\.weave$! ) {
<font class='lnum'>2169</font>       goto WEAVE_ME
<font class='lnum'>2170</font>   }
<font class='lnum'>2171</font>   else {
<font class='lnum'>2172</font>       #output error message and usage 
<font class='lnum'>2173</font>       exit;
<font class='lnum'>2174</font>   }
<font class='lnum'>2175</font>   
<font class='lnum'>2176</font>   TANGLE_ME:
<font class='lnum'>2177</font>       print "I am being tangled\n";
<font class='lnum'>2178</font>       exit;
<font class='lnum'>2179</font>   
<font class='lnum'>2180</font>   TANGLEDIFF_ME:
<font class='lnum'>2181</font>       #disassemble and check the query string here
<font class='lnum'>2182</font>       #and accordingly do a primitive protocol:
<font class='lnum'>2183</font>   	# output file selection form of none
<font class='lnum'>2184</font>   	# show the diff if selected, e.g. 
<font class='lnum'>2185</font>   	#   "script.tangle?filename_on_disk_to_tanglediff_against"
<font class='lnum'>2186</font>       
<font class='lnum'>2187</font>       #debug:
<font class='lnum'>2188</font>       print "I am in a tanglediffer\n";
<font class='lnum'>2189</font>       exit;
<font class='lnum'>2190</font>   
<font class='lnum'>2191</font>   WEAVE_ME:
<font class='lnum'>2192</font>       print "I am in a weaver\n";
<font class='lnum'>2193</font>       exit;
<font class='lnum'>2194</font>   
<font class='lnum'>2195</font>   </fieldset></pre>
<p>
<b>also</b> where there were "weaver" and "tangler" before, I'll have one more "tanglediff"<br>
subsection below to set the "diff" invocation and dumping its output.<br>
<p>
<i>Question for the tanglediffe</i>r - should I have an option to directly dump the result <br>
of tangling into a browser, or is it unnecessary?<br>
<p>
<i> NOTE </i> the tanglediffer and tangler may share some pre-processing part needed for<br>
clean tangling. Then the separation will be different:<br>
the tangle-tanglediff switch will live inside TANGLE_ME<br>
<p>
<b><i>NOTE 2</i></b> Should I simplify it even more? -- rather than making distinction by the name<br>
extension and forcing the user to create hard links and reconfigure the web server (imposs.<br>
if it is not a local server, but say an html-served subdir in his home dir) -- why don't I<br>
<i>start the mode from a hyperlink</i> ??<br>
The mode will be identified from the QUERY_STRING (or CL options), and the code providing<br>
it is of course still inside MOLLY.pl.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('54');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('55');">
<font class='lnum'><i>(55)</i></font>&nbsp; With wavediff and tanglediff?? </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2218)</i></sub></font></a></legend></fieldset>
<p>
<div id="55" style="display:none">   
<ul>


<p>
I could also do "weavediff" and "tanglediff" for ease of checking in the browser.<br>
<p>
<ul>     &nbsp;  w e a v e d i f f  &nbsp;  - checked, looks bad: huge and not well-readable after a few changes.<br>
    Main prob: executing "weave" produces HTML, so I'll need to execute the other file on<br>
    disk too, or save HTMLs, both are cumbersome options<br>
    SO: no "weavediff"<br>
</ul><br>
<p>
In that case the despatcher will be different:<br>
<p>
<font class='lnum'>2231</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tanglediff.test2.pl&gt;&gt;=</legend>
<font class='lnum'>2232</font>   #!/usr/bin/perl
<font class='lnum'>2233</font>   
<font class='lnum'>2234</font>   $weave_extension = "weave";
<font class='lnum'>2235</font>   $tangle_extension = "tangle";
<font class='lnum'>2236</font>   
<font class='lnum'>2237</font>   
<font class='lnum'>2238</font>   # -- a call for the weaver --
<font class='lnum'>2239</font>   if ( $0 =~ m!\.$weave_extension$! ) {
<font class='lnum'>2240</font>   
<font class='lnum'>2241</font>       # --- a call from CGI ---
<font class='lnum'>2242</font>       if ($ENV{'REQUEST_METHOD'}){
<font class='lnum'>2243</font>   
<font class='lnum'>2244</font>   	print "\nFIRST OF ALL, THIS IS A CALL TO WEAVER\n";
<font class='lnum'>2245</font>   
<font class='lnum'>2246</font>   	#pull and process QUERY_STRING to weave or tanglediff
<font class='lnum'>2247</font>   	
<font class='lnum'>2248</font>   	if ( $ENV{'QUERY_STRING'} eq "" ) {
<font class='lnum'>2249</font>   
<font class='lnum'>2250</font>   	    print "&lt;html&gt;&lt;body&gt;\n";
<font class='lnum'>2251</font>   	    print "a CGI call for weaving&lt;br&gt;\n";
<font class='lnum'>2252</font>   	    print "&lt;/body&gt;&lt;/html&gt;";
<font class='lnum'>2253</font>   	}
<font class='lnum'>2254</font>   
<font class='lnum'>2255</font>   
<font class='lnum'>2256</font>   	elsif ( $ENV{'QUERY_STRING'} eq "diff") {
<font class='lnum'>2257</font>   	    print "here I should output the file selection form for tangle-diff\n"
<font class='lnum'>2258</font>   	}
<font class='lnum'>2259</font>   	elsif ($ENV{'QUERY_STRING'} =~ m!^diff&amp;(.*)$! ) {
<font class='lnum'>2260</font>   
<font class='lnum'>2261</font>   	    # check the supposed filename is an allowed alphanumeric:
<font class='lnum'>2262</font>   	    # convert spaces into underscores and check for match to "\w+"
<font class='lnum'>2263</font>   	    print "a call from CGI for a diff with some file.. going to check if it exists..\n";
<font class='lnum'>2264</font>   
<font class='lnum'>2265</font>   	    # for the test - just get the file
<font class='lnum'>2266</font>   	    # /if the file with such a name exists, of course/
<font class='lnum'>2267</font>   	    if (-f $1) {
<font class='lnum'>2268</font>   
<font class='lnum'>2269</font>   		# then run the piped command like
<font class='lnum'>2270</font>   		# scriptname.tangle | diff -y -w --left-column xxz -
<font class='lnum'>2271</font>   		print "here tanglediff pipe will be with the given file\n"
<font class='lnum'>2272</font>   
<font class='lnum'>2273</font>   	    } # fi rung the tanglediff pipe
<font class='lnum'>2274</font>   	} # fi this is CGI GET args for tanglediffing
<font class='lnum'>2275</font>   	else {
<font class='lnum'>2276</font>   	    print "a call from CGI to the weaver -- with unknown arguments&lt;br&gt;\n";
<font class='lnum'>2277</font>   	}
<font class='lnum'>2278</font>   
<font class='lnum'>2279</font>       } # this was a call from CGI
<font class='lnum'>2280</font>   
<font class='lnum'>2281</font>       # --- a call from CL ---
<font class='lnum'>2282</font>       else {
<font class='lnum'>2283</font>   	#process command-line args
<font class='lnum'>2284</font>   	# to weave or weavediff or tanglediff
<font class='lnum'>2285</font>   	print "this is a call from CL\n";
<font class='lnum'>2286</font>   	print " arg1 is $ARGV[0] -- arg2 is $ARGV[1]\n";
<font class='lnum'>2287</font>   	print "The same 3 options will apply: weave, ask for selection and tanglediff\n";
<font class='lnum'>2288</font>       } # esle, fi -- this was a call from command line
<font class='lnum'>2289</font>   }
<font class='lnum'>2290</font>   
<font class='lnum'>2291</font>   # -- a call for the tangler -- 
<font class='lnum'>2292</font>   elsif ( $0 =~ m!\.$tangle_extension$! ) {
<font class='lnum'>2293</font>   
<font class='lnum'>2294</font>       # do direct tangling
<font class='lnum'>2295</font>       # will not execute in the browser, as the web server
<font class='lnum'>2296</font>       # does not allow it?? -- or filter on REQUEST_METHOD, too?
<font class='lnum'>2297</font>       print "a CL call for tangling\n";
<font class='lnum'>2298</font>   
<font class='lnum'>2299</font>   }
<font class='lnum'>2300</font>   
<font class='lnum'>2301</font>   # -- a call for other extensions --
<font class='lnum'>2302</font>   else {
<font class='lnum'>2303</font>       #print usage
<font class='lnum'>2304</font>       print "a call with an unknown extension or a call to 'tangle' from under CGI\n";
<font class='lnum'>2305</font>       print "Not allowed, printing usage..\n";
<font class='lnum'>2306</font>   }
<font class='lnum'>2307</font>   
<font class='lnum'>2308</font>   </fieldset></pre>
<p>
<p>
<b> So </b> this one seems to be Ok, although I still dislike its cludginess. I'd like a<br>
better options processing skeleton script.<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('55');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('53');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('56');">
<font class='lnum'><i>(56)</i></font>&nbsp; "Main despatcher kludgy" - first version - no tanglediffs </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2321)</i></sub></font></a></legend></fieldset>
<p>
<div id="56" style="display:none">   
<ul>


<p>
<p>
<i> To add here: </i><br>
command line options parsing??<br>
Error/usage message should be html-ized too??<br>
<p>
<font class='lnum'>2329</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher kludgy&gt;&gt;=</legend>
<font class='lnum'>2330</font>     # -- MAIN DESPATCHER ----
<font class='lnum'>2331</font>   
<font class='lnum'>2332</font>     # check if $i_am_module and set filenames to $0 - or 
<font class='lnum'>2333</font>     # process CL options otherwise
<font class='lnum'>2334</font>   
<font class='lnum'>2335</font>     # (temp) - 2 options, to weave and to tangle in module mode:
<font class='lnum'>2336</font>     #
<font class='lnum'>2337</font>     if ( $0 =~ m!\w+\.$weave_extension$! ) { goto WEAVE_ME }
<font class='lnum'>2338</font>     elsif ( $tangle_me) {goto TANGLE_ME}
<font class='lnum'>2339</font>     else {
<font class='lnum'>2340</font>     print &lt;&lt;end_of_print;
<font class='lnum'>2341</font>   
<font class='lnum'>2342</font>   	USAGE:
<font class='lnum'>2343</font>   	Not set to tangle.
<font class='lnum'>2344</font>   	Set variables at the beginning of the script properly.  
<font class='lnum'>2345</font>   
<font class='lnum'>2346</font>   end_of_print
<font class='lnum'>2347</font>     }
<font class='lnum'>2348</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('56');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('52');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('50');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('57');">
<font class='lnum'><i>(57)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2357)</i></sub></font></a></legend></fieldset>
<p>
<div id="57" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('57');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('58');">
<font class='lnum'><i>(58)</i></font>&nbsp; TANGLER </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2360)</i></sub></font></a></legend></fieldset>
<p>
<div id="58" style="display:none">   
<ul>


<p>
    This version of the script does not include a built-in tangler, and therefore<br>
    if you set "$tangle_me" to 1 in the settings, the script will pass ithe request through<br>
    the "notangle" utility of the "noweb" Literate Programming tool to tangle starting with <br>
    <i>the default chunk &lt; &lt;*&gt; &gt;</i>   and without other options passed. I only set "notangle" <br>
    below to preserve the tabs in case you are tangling Makefiles.<br>
<p>
    So, when the script is invoked as "script.tangle" (which can be a link or a soft<br>
    link to something like "script.weave", it's "real" name), it will dump the source<br>
    to STDOUT, very convenient for development.<br>
<p>
    I usually move the root chunk &lt; &lt;*&gt; &gt; along inside the LIterate Source project<br>
    file and assign it to the test script or the part I am working on. The Literate Source<br>
    project file includes several actual source files usually. By the way, it's quite<br>
    nice to be able to keep all partial tests that you do before including those into<br>
    the target program all in one place, your common project file.<br>
<p>
    To tangle with more specific options, run "notangle" directly on your "mollified"<br>
    literate source file, e.g.<br>
    <pre>notangle -R my_root_chunk -L script.weave </pre><br>
<p>
    Later other modes of operation may be incorporated here.<br>
<p>
<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('59');">
<font class='lnum'><i>(59)</i></font>&nbsp; pass-through tangler (for "noweb" by Ramsey), default now </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2389)</i></sub></font></a></legend></fieldset>
<p>
<div id="59" style="display:none">   
<ul>


<p>
    Passes the request to "notangle" from the "noweb" literate tools suite.<br>
<p>
<font class='lnum'>2394</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tangle me&gt;&gt;=</legend>
<font class='lnum'>2395</font>   <font class='chunkref'>&lt;&lt;tangle me with filtering&gt;&gt</font>;
<font class='lnum'>2396</font>   </fieldset></pre>
<p>
<p>
<font class='lnum'>2399</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tangle me straight&gt;&gt;=</legend>
<font class='lnum'>2400</font>   
<font class='lnum'>2401</font>   
<font class='lnum'>2402</font>   TANGLE_ME:
<font class='lnum'>2403</font>   
<font class='lnum'>2404</font>   	open TANGLE_PIPE, "| notangle -t4 -";
<font class='lnum'>2405</font>   
<font class='lnum'>2406</font>   	open MYSELF, "&lt;$0";
<font class='lnum'>2407</font>   	while  (&lt;MYSELF&gt;) {
<font class='lnum'>2408</font>   	    # filter here
<font class='lnum'>2409</font>   	    # filter here and
<font class='lnum'>2410</font>   	print TANGLE_PIPE $_;
<font class='lnum'>2411</font>   	}
<font class='lnum'>2412</font>   
<font class='lnum'>2413</font>   	close TANGLE_PIPE;
<font class='lnum'>2414</font>   	close MYSELF;
<font class='lnum'>2415</font>   exit;
<font class='lnum'>2416</font>   
<font class='lnum'>2417</font>   </fieldset></pre>
<p>
<p>
    Pre-filtering might need to bo done. E.g. "notangle" gets confused by double angle brackets<br>
    even when those are inside the document chunks.<br>
    Therefore I could escape those before passing them to the tangler.<br>
<p>
    This of course is kind of stupid, as running 'notangle' without this pre-filter will still<br>
    break it, e.g.<br>
    if I want to do it from command-line with some special options or for a non-root chunk,<br>
<p>
    This is not a full solution in itself. Consider it as a template for pre-filtering, sort of.<br>
<p>
<p>
<font class='lnum'>2431</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tangle me with filtering&gt;&gt;=</legend>
<font class='lnum'>2432</font>   
<font class='lnum'>2433</font>   
<font class='lnum'>2434</font>   TANGLE_ME:
<font class='lnum'>2435</font>   
<font class='lnum'>2436</font>   	open TANGLE_PIPE, "| notangle -t4 -";
<font class='lnum'>2437</font>   
<font class='lnum'>2438</font>   	open MYSELF, "&lt;$0";
<font class='lnum'>2439</font>   	while  (&lt;MYSELF&gt;) {
<font class='lnum'>2440</font>   
<font class='lnum'>2441</font>   	    if ( m!^(goto)?&lt;\&lt;(.*)&gt;\&gt;=! ... m!^@\s*$! ) { # -- CODE CHUNKS -- 
<font class='lnum'>2442</font>   		print TANGLE_PIPE $_;
<font class='lnum'>2443</font>   	    }
<font class='lnum'>2444</font>   	    else {  # -- DOC CHUNKS /and beginning of file, irrelevant / --
<font class='lnum'>2445</font>   
<font class='lnum'>2446</font>   		# filter double angle brackets that confuse "notangle"
<font class='lnum'>2447</font>   		s/&lt;&lt;/$lt_esc$lt_esc/g;
<font class='lnum'>2448</font>   		s/&gt;&gt;/$gt_esc$gt_esc/g;
<font class='lnum'>2449</font>   		print TANGLE_PIPE $_;
<font class='lnum'>2450</font>   	    }
<font class='lnum'>2451</font>   
<font class='lnum'>2452</font>   	} # elihw
<font class='lnum'>2453</font>   
<font class='lnum'>2454</font>   	close TANGLE_PIPE;
<font class='lnum'>2455</font>   	close MYSELF;
<font class='lnum'>2456</font>   exit;
<font class='lnum'>2457</font>   
<font class='lnum'>2458</font>   </fieldset></pre>
<p>
<p>
    <b> BUG of sorts </b><br>
    the "lt" and "gt" escapes in the code chunks right above ("tangle me with filtering") are not <br>
    displayed correctly  by the web weaver: the browser displays them as real angle brackets.<br>
    <s>I could avoid this  by using $lt and $gt perl vars defined in "general settings" for exactly<br>
    cases like this.</s><br>
    I <i>cannot</i> avoid this without setting another couple of perl vars: $gt_esc = "&amp; gt;" etc. ...<br>
<p>
    I do have lines with the same problem in the "dotHTML formatter" chunk as well.<br>
<p>
<p>
<p>
    <b> Immediate execution of the script </b><br>
    It did not work exactly, but then I did not try it for real -- if it is needed and if your<br>
    language supports taking input from STDIN, it may be possible also to immediately run your<br>
    script skipping the stage of "tangling-into-a-file" before running.<br>
    To be added (possibly).<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('59');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('60');">
<font class='lnum'><i>(60)</i></font>&nbsp; seek-peek tangler (working) </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2482)</i></sub></font></a></legend></fieldset>
<p>
<div id="60" style="display:none">   
<ul>


<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('61');">
<font class='lnum'><i>(61)</i></font>&nbsp; seek-peek tangler (preliminaries, about) </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2487)</i></sub></font></a></legend></fieldset>
<p>
<div id="61" style="display:none">   
<ul>


<p>
<p>
&lt;b&gt;The idea is to:&lt;/b&gt;<br>
<p>
(a) run first pass over the file collecting a list of <br>
	chunk addresses<br>
<p>
(b) run second pass recursively, already knowing where to read the<br>
	bits and pieces from <br>
<p>
(c) Filters could apply to some chunks for:<br>
	/weaving/<br>
	* feeding the text to a markdown lang<br>
	* cutting sth out for a math processor <br>
		(e.g. mimeTeX, or to ASCIIMathML.js)<br>
		/tangling/<br>
	* for conditional tangling of certain chunks<br>
	(e.g. those whose names start with DEBUG, negative<br>
	or the opposint, CLEAN, for a positive filtering)<br>
<p>
This type of tangler should be fine working across &lt;b&gt;several literate source<br>
files&lt;/b&gt;, the only requirement is that their chunk namespace should be<br>
flat (unique names across your whole project). <br>
It can be managed by prepending the chunk names by their file IDs, for<br>
example.<br>
/* command line option to get several files and their processing is<br>
not implemented yet */<br>
<p>
<p>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('62');">
<font class='lnum'><i>(62)</i></font>&nbsp; Geany carpings NOTES</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2519)</i></sub></font></a></legend></fieldset>
<p>
<div id="62" style="display:none">   
<ul>

&lt;b&gt;NOTES on Geany -- offtopic&lt;/b&gt;<br>
	* Geany loses bookmarks	when the proj is closed/reopened<br>
	* has no "folding at my marks"<br>
		This can be worked around, sorts of (perl POD dummy marks<br>
		will work), BUT then there is no way to "fold all", so<br>
		for largish files the feature is useless<br>
	  Geany loses the state of folding when closed/reopened.<br>
	* and has no "address range" operators (only by manual selection)<br>
	* If my mark is under a folded section, jumping consequentially<br>
		(the only way Molly knows how) will reopen all of them,<br>
		bringing utility of folding to nil<br>
	  Solution could be "named marks" ?? And a command to list them all.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('62');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('63');">
<font class='lnum'><i>(63)</i></font>&nbsp;Makefile</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2536)</i></sub></font></a></legend></fieldset>
<p>
<div id="63" style="display:none">   
<ul>


<p>
a small informal test for now; to be expanded to:<br>
    - "make" --&gt; "help"<br>
    - "make target" -&gt; for tests, tangling out parts of the project etc<br>
<p>
<p>
<p>
<font class='lnum'>2545</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;Makefile&gt;&gt;=</legend>
<font class='lnum'>2546</font>   
<font class='lnum'>2547</font>   all: tangle  perl-check run compare
<font class='lnum'>2548</font>   #-
<font class='lnum'>2549</font>   
<font class='lnum'>2550</font>   tangle:
<font class='lnum'>2551</font>   	./zz-seek-peek.tangle &gt; zz.pl;
<font class='lnum'>2552</font>   #-
<font class='lnum'>2553</font>   
<font class='lnum'>2554</font>   perl-check:
<font class='lnum'>2555</font>   	perl -c zz.pl;
<font class='lnum'>2556</font>   #-
<font class='lnum'>2557</font>   
<font class='lnum'>2558</font>   
<font class='lnum'>2559</font>   run:
<font class='lnum'>2560</font>   	perl zz.pl zyy-test.litsource.txt &gt;test.out;
<font class='lnum'>2561</font>   #-	
<font class='lnum'>2562</font>   
<font class='lnum'>2563</font>   compare:
<font class='lnum'>2564</font>   		fldiff zyy-test.litsource.txt test.out;
<font class='lnum'>2565</font>   #-
<font class='lnum'>2566</font>   
<font class='lnum'>2567</font>    
<font class='lnum'>2568</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('63');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('64');">
<font class='lnum'><i>(64)</i></font>&nbsp;todo</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2575)</i></sub></font></a></legend></fieldset>
<p>
<div id="64" style="display:none">   
<ul>


Now, the next step is to fix the trailing line with @<br>
<p>
&lt;b&gt; HOW: &lt;/b&gt;<br>
I'll "tell" on each line and use as my end-of-splinter address<br>
the one from the previous line (i.e. just before the last line, <br>
which contains the trailing rubbish).<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('64');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('61');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('65');">
<font class='lnum'><i>(65)</i></font>&nbsp;The code</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2589)</i></sub></font></a></legend></fieldset>
<p>
<div id="65" style="display:none">   
<ul>


<p>
<font class='lnum'>2592</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;seek-peek tangler&gt;&gt;=</legend>
<font class='lnum'>2593</font>   #!/usr/bin/perl 
<font class='lnum'>2594</font>   #use strict;
<font class='lnum'>2595</font>       
<font class='lnum'>2596</font>       open LITSOURCE, "&lt; $ARGV[0]" || die "could not open the file to tangle\n";
<font class='lnum'>2597</font>   
<font class='lnum'>2598</font>   	<font class='chunkref'>&lt;&lt;pass 1&gt;&gt</font>;
<font class='lnum'>2599</font>   	<font class='chunkref'>&lt;&lt;pass 2 and print&gt;&gt</font>;
<font class='lnum'>2600</font>   	<font class='chunkref'>&lt;&lt;main: call the sub&gt;&gt</font>;
<font class='lnum'>2601</font>   
<font class='lnum'>2602</font>       close LITSOURCE;
<font class='lnum'>2603</font>   
<font class='lnum'>2604</font>   </fieldset></pre>
<p>
"pass 1" goes through the file collecting addresses.<br>
<p>
Then "pass 2" sets a recursive sub to "untangle" the chunks with<br>
their included references.<br>
<p>
The "main" sets the root chunk and calls the sub<br>
<p>
I'll add command-line and CGI arguments processing later.<br>
<p>
<font class='lnum'>2615</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main: call the sub&gt;&gt;=</legend>
<font class='lnum'>2616</font>   
<font class='lnum'>2617</font>   	#~ $root_chunk = "chunk 1";
<font class='lnum'>2618</font>   	#~ $root_chunk = "DEBUG print one reference";
<font class='lnum'>2619</font>   	$root_chunk = "*";
<font class='lnum'>2620</font>   
<font class='lnum'>2621</font>   	print_chunk($root_chunk); 
<font class='lnum'>2622</font>   
<font class='lnum'>2623</font>   </fieldset></pre>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('66');">
<font class='lnum'><i>(66)</i></font>&nbsp; PAss 1 </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2627)</i></sub></font></a></legend></fieldset>
<p>
<div id="66" style="display:none">   
<ul>


<p>
declare and initialize some vars<br>
<p>
<font class='lnum'>2632</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;pass 1&gt;&gt;=</legend>
<font class='lnum'>2633</font>   
<font class='lnum'>2634</font>   	<font class='chunkref'>&lt;&lt;declarations and initializations&gt;&gt</font>;
<font class='lnum'>2635</font>   	<font class='chunkref'>&lt;&lt;while-loop and peek file ofsets&gt;&gt</font>;
<font class='lnum'>2636</font>   
<font class='lnum'>2637</font>   </fieldset></pre>
<p>
<font class='lnum'>2639</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;declarations and initializations&gt;&gt;=</legend>
<font class='lnum'>2640</font>   
<font class='lnum'>2641</font>       my $chunk_beg_pattern = q(^&lt;\&lt;(.*)&gt;\&gt;=);
<font class='lnum'>2642</font>       my $chunk_end_pattern = q(^@\s.*$);
<font class='lnum'>2643</font>       my $chunk_ref_pattern = q(&lt;\&lt;(.*?)&gt;\&gt;[^=]); # can be used several times in a line
<font class='lnum'>2644</font>   
<font class='lnum'>2645</font>       my $current_chunk_name = "";
<font class='lnum'>2646</font>   	my $current_chunk_start_foff = ""; # "foff" is a "file offset"
<font class='lnum'>2647</font>   	my %file_offsets_hash = ();
<font class='lnum'>2648</font>       
<font class='lnum'>2649</font>       my $line_num = 0;
<font class='lnum'>2650</font>   	my $previous_line_foff = 0; # "foff" is a "file offset"
<font class='lnum'>2651</font>   
<font class='lnum'>2652</font>   </fieldset></pre>
<p>
<p>
&lt;b&gt;Main loop&lt;/b&gt;<br>
Need to collect chunk addresses (with "tell"), and keep a hash of lists<br>
with addresses of all chunk continuations (if any)<br>
<p>
I'll need to push them in, and in pass 2 I'll pop them (i.e. destroy on reading), <br>
and so ensure all of a split chunk is read.<br>
<p>
I see no way to keep a "list of lists", such as <br>
	((chunk_1_start, chunk__1_end), (chunk_2_start, chunk_2_end))<br>
So, it'll be an ugly hash of references to lists (of differing lengths).<br>
<p>
&lt;b&gt;Anyway,&lt;/b&gt; to deal with references to chunks from inside chunks I <br>
should probably insert ("ref" "referred_chunk_name") into my <br>
%file_offsets_hash during the first pass -  this pair is different from<br>
numeric beg-end offset pairs, and I'll start recursively teh printout of<br>
the chunk referred to when I detect it, in the second printing half of<br>
processing.<br>
<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('67');">
<font class='lnum'><i>(67)</i></font>&nbsp; Ref: perl operators </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2676)</i></sub></font></a></legend></fieldset>
<p>
<div id="67" style="display:none">   
<ul>


<p>
&lt;b&gt;---Perl operators----&lt;/b&gt;<br>
<p>
&lt;b&gt;pos&lt;/b&gt;<br>
<p>
&lt;ul&gt;<br>
3253   while ( $string =~ m!\G(.*?)&lt;\&lt;(.*?)&gt;\&gt;!gs) {<br>
3254     <br>
3255     $off = length($2);<br>
3256     $position = pos($string);<br>
3257     #pos($string) = $position + $off;<br>
3258     print "\n\t---title---\n$2 of length $off at $position \n\t----after----\n$1\n========\n";<br>
3259   <br>
3260   }<br>
&lt;/ul&gt;<br>
<p>
&lt;b&gt;tell filehandle&lt;/b&gt; (if omitted, the last file read)<br>
<p>
&lt;b&gt;seek FILEHANDLE,POSITION,WHENCE &lt;/b&gt;<br>
Sets FILEHANDLE's position, just like the fseek call of stdio . <br>
FILEHANDLE may be an expression whose value gives the name of the filehandle. <br>
The values for WHENCE are 0 to set the new position in bytes to POSITION,<br>
<p>
&lt;b&gt;read FROM_FILEHANDLE, IN_SCALAR_BUFER_VAR_OR_STREM, LENGTH_IN_BYTES_OR_CHARS&lt;/b&gt;<br>
There &lt;b&gt;may be problems&lt;/b&gt; if FH is opened in non-bytes mode, or if some pragma is used<br>
<p>
-------------------<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('67');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('68');">
<font class='lnum'><i>(68)</i></font>&nbsp; PAss 1: main while-loop and foffs</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2709)</i></sub></font></a></legend></fieldset>
<p>
<div id="68" style="display:none">   
<ul>


<p>
<p>
&lt;i&gt; A loop over the doc starts here &lt;/i&gt;<br>
Process inside doc sections:<br>
<p>
<font class='lnum'>2716</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;while-loop and peek file ofsets&gt;&gt;=</legend>
<font class='lnum'>2717</font>   
<font class='lnum'>2718</font>    while (&lt;LITSOURCE&gt;) {
<font class='lnum'>2719</font>       $line_num++;
<font class='lnum'>2720</font>   
<font class='lnum'>2721</font>   	# --- CODE CHUNKS -- not inside documentation section
<font class='lnum'>2722</font>       if ( m!$chunk_beg_pattern! .. m!$chunk_end_pattern! ) {
<font class='lnum'>2723</font>   
<font class='lnum'>2724</font>   	<font class='chunkref'>&lt;&lt;chunk beginning&gt;&gt</font>;
<font class='lnum'>2725</font>   	<font class='chunkref'>&lt;&lt;chunk ending&gt;&gt</font>;
<font class='lnum'>2726</font>   	<font class='chunkref'>&lt;&lt;chunk reference&gt;&gt</font>;
<font class='lnum'>2727</font>   	<font class='chunkref'>&lt;&lt;chunk body&gt;&gt</font>;
<font class='lnum'>2728</font>   
<font class='lnum'>2729</font>   
<font class='lnum'>2730</font>       } #fi
<font class='lnum'>2731</font>   
<font class='lnum'>2732</font>   	$previous_line_foff = tell LITSOURCE;
<font class='lnum'>2733</font>   
<font class='lnum'>2734</font>     } #eliwh
<font class='lnum'>2735</font>   
<font class='lnum'>2736</font>   </fieldset></pre>
<p>
&lt;b&gt;A later adjustement, actually to rid of the last line trash&lt;/b&gt;<br>
	I'll do "tell" on each line and use as my end-of-splinter address<br>
	the one from the previous line (i.e. just before the last line, <br>
	which contains the trailing rubbish). See the last var in the loop.<br>
<p>
<p>
&lt;b&gt;First, the chunk body&lt;/b&gt; <br>
It closes the "if" opened in "chunk beginning", The rest of then are<br>
"elsif" clauses. <br>
<p>
There's nothing to do here in pass 1; just here not to leave it<br>
implicit and hidden<br>
<p>
<font class='lnum'>2751</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk body&gt;&gt;=</legend>
<font class='lnum'>2752</font>   
<font class='lnum'>2753</font>           else { # chunk body
<font class='lnum'>2754</font>   
<font class='lnum'>2755</font>   	    ; # nop; here just not to hide an implicit case
<font class='lnum'>2756</font>   	    #~ print "."; # debug: show dots for lines 
<font class='lnum'>2757</font>               }
<font class='lnum'>2758</font>   
<font class='lnum'>2759</font>   </fieldset></pre>
<p>
<p>
&lt;b&gt;Next, match for a first line of a new chunk&lt;/b&gt; (which can continue<br>
some previous splinters of the same chunk in the LitSource file)<br>
<p>
If a chunk begins (or continues) here, <br>
	- set the current chunk name<br>
	-pick up its "peeked" offset in  the file <br>
	- and push it in the hash of f_offs under the current chunk name<br>
<p>
Hmm.. The perl "tell" gives the position after the read line, I understand.<br>
No adjustment is needed for the beginning chunk match, and it'll eliminate<br>
the title from the later output.<br>
<p>
<font class='lnum'>2774</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk beginning&gt;&gt;=</legend>
<font class='lnum'>2775</font>   
<font class='lnum'>2776</font>           if ( $_ =~ m!$chunk_beg_pattern! ) {
<font class='lnum'>2777</font>   	    $current_chunk_name = $1;
<font class='lnum'>2778</font>   	    $current_chunk_start_foff = tell LITSOURCE;
<font class='lnum'>2779</font>   
<font class='lnum'>2780</font>   	    push @{$file_offsets_hash{$current_chunk_name}}, $current_chunk_start_foff;
<font class='lnum'>2781</font>   	    #~ print "[***debug: I am chunk $1 -- I start at $current_chunk_start_foff***]\n";
<font class='lnum'>2782</font>   
<font class='lnum'>2783</font>           }
<font class='lnum'>2784</font>   
<font class='lnum'>2785</font>   </fieldset></pre>
<p>
<p>
&lt;b&gt;If a chunk ends,&lt;/b&gt; peek its end offset in the file ("f_off") Actually, not to pick<br>
up the closing "at" signs, get the previous line's told offset.<br>
<p>
.. and push it in the hash of lists<br>
Plus - set $current_chunk_name=""; # just in case<br>
<p>
<font class='lnum'>2794</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk ending&gt;&gt;=</legend>
<font class='lnum'>2795</font>   
<font class='lnum'>2796</font>           elsif ( $_ =~ m!$chunk_end_pattern! )  {
<font class='lnum'>2797</font>   
<font class='lnum'>2798</font>   	    $current_chunk_end_foff = $previous_line_foff;
<font class='lnum'>2799</font>   	    push @{$file_offsets_hash{$current_chunk_name}}, $current_chunk_end_foff;
<font class='lnum'>2800</font>   	    #~ print "[+++debug: $current_chunk_name ends at off $current_chunk_end_foff++++]\n\n";
<font class='lnum'>2801</font>   
<font class='lnum'>2802</font>   		$current_chunk_name = "";
<font class='lnum'>2803</font>               }
<font class='lnum'>2804</font>   
<font class='lnum'>2805</font>   </fieldset></pre>
<p>
&lt;b&gt;Ok, so we put the foffs  in the (beg, end) order&lt;/b&gt;.<br>
Now, "pop" will get them in the pop1 -&gt; (end), then pop2 -&gt; beg order<br>
While  shift_first -&gt; beg, shift_second -&gt; end. This will be the right one<br>
for later tangling.<br>
<p>
<p>
&lt;b&gt;Now, the chunk refs &lt;/b&gt;<br>
<p>
If we get a reference, regex-split the line <br>
	- set the end offset of the current chunk<br>
	- push it in the hash of lists<br>
	- figure the offset after the chunk ref<br>
	- push it into the hash of lists using the current chunkname<br>
	- IMPORTANT COMPLICATION<br>
		deal with the case when several chunk refs on the same<br>
		line are present;<br>
		do &lt;i&gt;not&lt;/i&gt; do it for the first version of the script.<br>
<p>
for many matches on a line - <br>
Here we'll have to use the \G ancor and pos and make a global regex math --<br>
    or repeat them in a loop until the line with matches is exhausted<br>
<p>
<font class='lnum'>2829</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk reference&gt;&gt;=</legend>
<font class='lnum'>2830</font>   
<font class='lnum'>2831</font>   	<font class='chunkref'>&lt;&lt;chunk reference - single ref on its own line&gt;&gt</font>;
<font class='lnum'>2832</font>   
<font class='lnum'>2833</font>   </fieldset></pre>
<p>
This one implements the basic idea (tested, works):<br>
<p>
<font class='lnum'>2837</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk reference - single ref on its own line&gt;&gt;=</legend>
<font class='lnum'>2838</font>   
<font class='lnum'>2839</font>   	elsif ( $_ =~ m!$chunk_ref_pattern!g ) {
<font class='lnum'>2840</font>   
<font class='lnum'>2841</font>   	# simplest case: one match on its own line
<font class='lnum'>2842</font>   		# DEBUG printouts:
<font class='lnum'>2843</font>   		#~ $match_position_in_line = pos($_);
<font class='lnum'>2844</font>   		#~ print "\t**chunk ref $1 at pos $match_position_in_line in line**\n";
<font class='lnum'>2845</font>   
<font class='lnum'>2846</font>   	# mark the foffs of the chunk so far
<font class='lnum'>2847</font>   	$current_chunk_ref_foff = $previous_line_foff;
<font class='lnum'>2848</font>   	push @{$file_offsets_hash{$current_chunk_name}}, $current_chunk_ref_foff;
<font class='lnum'>2849</font>   	
<font class='lnum'>2850</font>   	#~ print "\t..while in the file I am at offset $current_chunk_ref_foff..\n"; 
<font class='lnum'>2851</font>   	# push special strings "ref" and "this chunk name" into the main hash.
<font class='lnum'>2852</font>   	# That's how we'll know to call another chunk recursively.
<font class='lnum'>2853</font>   	
<font class='lnum'>2854</font>   	push @{$file_offsets_hash{$current_chunk_name}}, "ref";
<font class='lnum'>2855</font>   	push @{$file_offsets_hash{$current_chunk_name}}, $1;
<font class='lnum'>2856</font>   
<font class='lnum'>2857</font>   	#.. and push the offset again, to serve as a start of the next chunk splinter. 
<font class='lnum'>2858</font>   	push @{$file_offsets_hash{$current_chunk_name}}, (tell LITSOURCE);
<font class='lnum'>2859</font>   
<font class='lnum'>2860</font>   	} # fisle
<font class='lnum'>2861</font>   	
<font class='lnum'>2862</font>   </fieldset></pre>
<p>
&lt;i&gt; OK, so it lies there in the ("ref", "namestring") order&lt;/i&gt;<br>
<p>
&lt;b&gt;Note&lt;/b&gt; another better ref processor is in a subsection below.<br>
I'll switch when it's tested.<br>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('69');">
<font class='lnum'><i>(69)</i></font>&nbsp; multiple refs on the same line</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2871)</i></sub></font></a></legend></fieldset>
<p>
<div id="69" style="display:none">   
<ul>


<p>
&lt;b&gt;For many chunk references on a line, potentially&lt;/b&gt;<br>
<p>
This is a snippet showing how it can be treated:<br>
<p>
<b> NOTE </b> I had to stick in "\" or Ramsey's "notangle" wouldn't work <br>
<p>
&lt;pre&gt;<br>
<p>
#~ Nope, they use it inside "while" <br>
#~ OK, this is how it will work in the script:<br>
#~ /the while loop is over the line that contained at least <br>
#~ one ref; the loop body includes pushes into the hash/<br>
<p>
	$line = "asdfas asd &lt;\&lt;qewrqw&gt;&gt; opiopiopi &lt;\&lt;2345&gt;&gt; asdasdf";<br>
	$llen = length $line;<br>
	print "the original line:: [$line] -- of length $llen\n";<br>
<p>
<p>
	while ($line =~ m!(.*?)&lt;\&lt;(.*?)&gt;&gt;!g) {<br>
		print "$1 -- $2\n";<br>
		$ancor_off  = pos $line;<br>
<p>
		print "ancor position is $ancor_off\n";<br>
<p>
<p>
<p>
	}<br>
<p>
	print "THE LAST PART IS  ", (substr $line, $ancor_off), "\n";<br>
<p>
&lt;/pre&gt;<br>
<p>
And this is its output:<br>
<p>
&lt;pre&gt;<br>
the original line:: [asdfas asd &lt;\&lt;qewrqw&gt;&gt; opiopiopi &lt;\&lt;2345&gt;&gt; asdasdf] -- of length 48<br>
asdfas asd  -- qewrqw<br>
ancor position is 21<br>
 opiopiopi  -- 2345<br>
ancor position is 40<br>
THE LAST PART IS   asdasdf<br>
&lt;/pre&gt;<br>
<p>
&lt;b&gt;Now, I'll do "one ref inside text" first&lt;/b&gt;, then wrap it into a 'while'<br>
loop<br>
<p>
First, I'll need to change the regexp pattern:<br>
<font class='lnum'>2921</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;declarations and initializations&gt;&gt;=</legend>
<font class='lnum'>2922</font>   </fieldset></pre>
<p>
<font class='lnum'>2924</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk reference - single ref inside other text&gt;&gt;=</legend>
<font class='lnum'>2925</font>   
<font class='lnum'>2926</font>   	elsif ( $_ =~ m!$chunk_ref_pattern!g ) {
<font class='lnum'>2927</font>   
<font class='lnum'>2928</font>   	# simplest case: one match on its own line
<font class='lnum'>2929</font>   		# DEBUG printouts:
<font class='lnum'>2930</font>   		#~ $match_position_in_line = pos($_);
<font class='lnum'>2931</font>   		#~ print "\t**chunk ref $1 at pos $match_position_in_line in line**\n";
<font class='lnum'>2932</font>   
<font class='lnum'>2933</font>   	# mark the foffs of the chunk so far
<font class='lnum'>2934</font>   	$current_chunk_ref_foff = $previous_line_foff;
<font class='lnum'>2935</font>   	push @{$file_offsets_hash{$current_chunk_name}}, $current_chunk_ref_foff;
<font class='lnum'>2936</font>   	
<font class='lnum'>2937</font>   	#~ print "\t..while in the file I am at offset $current_chunk_ref_foff..\n"; 
<font class='lnum'>2938</font>   	# push special strings "ref" and "this chunk name" into the main hash.
<font class='lnum'>2939</font>   	# That's how we'll know to call another chunk recursively.
<font class='lnum'>2940</font>   	
<font class='lnum'>2941</font>   	push @{$file_offsets_hash{$current_chunk_name}}, "ref";
<font class='lnum'>2942</font>   	push @{$file_offsets_hash{$current_chunk_name}}, $1;
<font class='lnum'>2943</font>   
<font class='lnum'>2944</font>   	#.. and push the offset again, to serve as a start of the next chunk splinter. 
<font class='lnum'>2945</font>   	push @{$file_offsets_hash{$current_chunk_name}}, (tell LITSOURCE);
<font class='lnum'>2946</font>   
<font class='lnum'>2947</font>   	} # fisle
<font class='lnum'>2948</font>   	
<font class='lnum'>2949</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('69');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('68');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('66');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('70');">
<font class='lnum'><i>(70)</i></font>&nbsp; pass 2 and print </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2960)</i></sub></font></a></legend></fieldset>
<p>
<div id="70" style="display:none">   
<ul>


<p>
OK, now we have a hash of refs with pairs ("ref", "ref_chunkname") interspersed<br>
where there were references included.<br>
	- start from the given root<br>
	- (shift, shift) the beg_f_off, end_f_off<br>
	- print out the file verbatim<br>
	...<br>
	  IF there WAS a ref, RECURSE on the new chunk name<br>
That should be it<br>
<p>
<font class='lnum'>2972</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;pass 2 and print&gt;&gt;=</legend>
<font class='lnum'>2973</font>   
<font class='lnum'>2974</font>   	<font class='chunkref'>&lt;&lt;sub: tangle recursively&gt;&gt</font>;
<font class='lnum'>2975</font>   
<font class='lnum'>2976</font>   </fieldset></pre>
<p>
<p>
Now - the RECURSIVE PRINTOUT untangling from the default/given root.<br>
--seek, then "read" into some $buf, which then is printed--<br>
<p>
    (a) if the pair got from the hash of lists is digits, print out <br>
    (b) if the first is a specia string "ref", get the ref name from<br>
    the second item in the pair and go there recursively<br>
<p>
<font class='lnum'>2986</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;sub: tangle recursively&gt;&gt;=</legend>
<font class='lnum'>2987</font>   
<font class='lnum'>2988</font>    sub print_chunk {
<font class='lnum'>2989</font>   	    my $chunk_being_printed = pop @_;
<font class='lnum'>2990</font>   	    #~ print "\n---- printing chunk $chunk_being_printed --------\n";
<font class='lnum'>2991</font>   	
<font class='lnum'>2992</font>   	# iterate over splinters of a chunk, which are foff pairs
<font class='lnum'>2993</font>   	while (@{$file_offsets_hash{$chunk_being_printed}}) {
<font class='lnum'>2994</font>   
<font class='lnum'>2995</font>   		<font class='chunkref'>&lt;&lt;the meat&gt;&gt</font>;
<font class='lnum'>2996</font>   
<font class='lnum'>2997</font>   	 } # elihw
<font class='lnum'>2998</font>   	
<font class='lnum'>2999</font>   	 return 1;
<font class='lnum'>3000</font>   	} # bus -- ends the recursive sub
<font class='lnum'>3001</font>   
<font class='lnum'>3002</font>   </fieldset></pre>
<p>
If the pair we get from the main hash of offsets is not<br>
a real number, but string "ref" and the string-name of the referenced<br>
chunk, do a recursive call to the same function to unravel<br>
<p>
<font class='lnum'>3008</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;the meat&gt;&gt;=</legend>
<font class='lnum'>3009</font>   
<font class='lnum'>3010</font>       my $snippet_position = shift @{$file_offsets_hash{$chunk_being_printed}};
<font class='lnum'>3011</font>       my $snippet_end = shift @{$file_offsets_hash{$chunk_being_printed}};
<font class='lnum'>3012</font>   
<font class='lnum'>3013</font>   	#~ print "DEBUG GOT: beg $snippet_position -- end $snippet_end\n";
<font class='lnum'>3014</font>   
<font class='lnum'>3015</font>   	if ($snippet_position eq "ref") {
<font class='lnum'>3016</font>   	
<font class='lnum'>3017</font>   	#~ print "got a ref $snippet_position here\n";
<font class='lnum'>3018</font>   	print_chunk($snippet_end);
<font class='lnum'>3019</font>   	
<font class='lnum'>3020</font>   	}
<font class='lnum'>3021</font>   	else { # .. print it here
<font class='lnum'>3022</font>       seek LITSOURCE, $snippet_position,  0;
<font class='lnum'>3023</font>       read LITSOURCE, $buffer_out, ($snippet_end - $snippet_position);
<font class='lnum'>3024</font>       print $buffer_out;
<font class='lnum'>3025</font>   	}
<font class='lnum'>3026</font>   
<font class='lnum'>3027</font>   </fieldset></pre>
<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('71');">
<font class='lnum'><i>(71)</i></font>&nbsp; two debug chunks</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3032)</i></sub></font></a></legend></fieldset>
<p>
<div id="71" style="display:none">   
<ul>


<p>
<p>
<font class='lnum'>3036</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;DEBUG print out full hash&gt;&gt;=</legend>
<font class='lnum'>3037</font>   
<font class='lnum'>3038</font>   	for $k (keys %file_offsets_hash) {
<font class='lnum'>3039</font>   		#~ print @{$file_offsets_hash{$k}}, "\n";
<font class='lnum'>3040</font>   
<font class='lnum'>3041</font>   	 while (scalar @{$file_offsets_hash{$k}}){
<font class='lnum'>3042</font>   		print "beg $k foff - ", shift @{$file_offsets_hash{$k}};
<font class='lnum'>3043</font>   		print " -- end foff - ", shift @{$file_offsets_hash{$k}}, "\n";
<font class='lnum'>3044</font>   		}
<font class='lnum'>3045</font>   	}
<font class='lnum'>3046</font>   </fieldset></pre>
<p>
<font class='lnum'>3048</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;DEBUG check hash keys&gt;&gt;=</legend>
<font class='lnum'>3049</font>   
<font class='lnum'>3050</font>    #~ for $k (keys  %file_offsets_hash){
<font class='lnum'>3051</font>   	#~ print $k, "\n";
<font class='lnum'>3052</font>   	#~ }
<font class='lnum'>3053</font>   
<font class='lnum'>3054</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
/* end of script litsource file */<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('71');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('70');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('65');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('60');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('72');">
<font class='lnum'><i>(72)</i></font>&nbsp; Tsort tangler - bad idea - useful leftover bits and pieces </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3068)</i></sub></font></a></legend></fieldset>
<p>
<div id="72" style="display:none">   
<ul>


<p>
<i> <b> -- Code deleted - was bad idea in general -- </b> </i><br>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('73');">
<font class='lnum'><i>(73)</i></font>&nbsp; Topological Sort </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3074)</i></sub></font></a></legend></fieldset>
<p>
<div id="73" style="display:none">   
<ul>


<p>
<p>
takes a list of (flattened) pairs ( (node_1, depends_on_1), (node_1, depends_on_2), ....)<br>
-- and produces a list of ordered precursors: ( depends_on_2 , depends_on_1, node_1, .....)<br>
for the whole tree of nodes and their dependencies.<br>
<p>
If I do "strings interpolation" tanger, I will need it to define the inned simple strings<br>
<i> before </i>  the complex ones which represent chunks, so they get interpolated without<br>
perl complaining about unknown strings.<br>
<p>
<p>
I will modify in-place this sub yanked from "tcsort.txt", a perl implementation of<br>
the unix "tsort" utility (originally from a Knuth algorithm) by Jeffrey S. Haemer in<br>
his project that reimplements unix utils in pure perl.<br>
<a href= http://cpansearch.perl.org/src/CWEST/ppt-0.14/README > http://cpansearch.perl.org/src/CWEST/ppt-0.14/README </a><br>
<p>
<p>
<font class='lnum'>3093</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tsort sub in perl&gt;&gt;=</legend>
<font class='lnum'>3094</font>   
<font class='lnum'>3095</font>   #use strict;
<font class='lnum'>3096</font>   
<font class='lnum'>3097</font>   sub topological_sort {
<font class='lnum'>3098</font>   
<font class='lnum'>3099</font>       my %pairs;	# all pairs ($l, $r)
<font class='lnum'>3100</font>       my %npred;	# number of predecessors
<font class='lnum'>3101</font>       my %succ;	# list of successors
<font class='lnum'>3102</font>       my $opt_b = 0;
<font class='lnum'>3103</font>   
<font class='lnum'>3104</font>       my @topo_list_out = '';
<font class='lnum'>3105</font>   
<font class='lnum'>3106</font>       while ( @_ ) {
<font class='lnum'>3107</font>   	my $l = shift @_;
<font class='lnum'>3108</font>   	my $r = shift @_;
<font class='lnum'>3109</font>   	my @l = ($l, $r);
<font class='lnum'>3110</font>   	#my ($l, $r) = my @l = split;
<font class='lnum'>3111</font>   	next unless @l == 2;
<font class='lnum'>3112</font>   	next if defined $pairs{$l}{$r};
<font class='lnum'>3113</font>   	$pairs{$l}{$r}++;
<font class='lnum'>3114</font>   	$npred {$l} += 0;
<font class='lnum'>3115</font>   	++$npred{$r};
<font class='lnum'>3116</font>   	push @{$succ{$l}}, $r;
<font class='lnum'>3117</font>       }
<font class='lnum'>3118</font>   
<font class='lnum'>3119</font>       # create a list of nodes without predecessors
<font class='lnum'>3120</font>       my @list = grep {!$npred{$_}} keys %npred;
<font class='lnum'>3121</font>   
<font class='lnum'>3122</font>       while (@list) {
<font class='lnum'>3123</font>   	$_ = pop @list;
<font class='lnum'>3124</font>   	unshift @topo_list_out, $_;
<font class='lnum'>3125</font>   	#print "$_\n";
<font class='lnum'>3126</font>   	foreach my $child (@{$succ{$_}}) {
<font class='lnum'>3127</font>   	    if ($opt_b) {	# breadth-first
<font class='lnum'>3128</font>   		unshift @list, $child unless --$npred{$child};
<font class='lnum'>3129</font>   	    } else {	# depth-first (default)
<font class='lnum'>3130</font>   		push @list, $child unless --$npred{$child};
<font class='lnum'>3131</font>   	    }
<font class='lnum'>3132</font>   
<font class='lnum'>3133</font>   	}
<font class='lnum'>3134</font>       }
<font class='lnum'>3135</font>   
<font class='lnum'>3136</font>       warn "cycle detected\n" if grep {$npred{$_}} keys %npred;
<font class='lnum'>3137</font>   
<font class='lnum'>3138</font>       return @topo_list_out;
<font class='lnum'>3139</font>   }
<font class='lnum'>3140</font>   
<font class='lnum'>3141</font>   </fieldset></pre>
<p>
<font class='lnum'>3143</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;check topo sort&gt;&gt;=</legend>
<font class='lnum'>3144</font>   
<font class='lnum'>3145</font>   <font class='chunkref'>&lt;&lt;tsort sub in perl&gt;&gt</font>;
<font class='lnum'>3146</font>   
<font class='lnum'>3147</font>   # let's check if it works now -- this should print it
<font class='lnum'>3148</font>   
<font class='lnum'>3149</font>   my @parents_list = ( ("a",  "b"),  ("a",  "d"),  ("a",  "c"),  ("b",  "c"),  ("d",  "e") );
<font class='lnum'>3150</font>   
<font class='lnum'>3151</font>   for my $i (topological_sort( @parents_list )){ print "$i\n";};
<font class='lnum'>3152</font>   
<font class='lnum'>3153</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('73');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('74');">
<font class='lnum'><i>(74)</i></font>&nbsp; Strange var and hash key names plus string interpolation </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3158)</i></sub></font></a></legend></fieldset>
<p>
<div id="74" style="display:none">   
<ul>


<p>
    For reference for the main tangler script below. This script has been tested and<br>
    it works as intended.<br>
<p>
<font class='lnum'>3164</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;test names and deref&gt;&gt;=</legend>
<font class='lnum'>3165</font>   # 1. Dereferencing and using long bad strings as varnames and keys in hashes
<font class='lnum'>3166</font>   
<font class='lnum'>3167</font>   $hash{q(a long $strange #tring wi# symbols)} = q(another long string @$%^ with strange symbols);
<font class='lnum'>3168</font>   
<font class='lnum'>3169</font>   while (($a, $b) = each %hash) {
<font class='lnum'>3170</font>   	print qq(key is -- $a -- and value is -- $b --\n);
<font class='lnum'>3171</font>   	}
<font class='lnum'>3172</font>   
<font class='lnum'>3173</font>   ${q(a long $strange #tring wi# symbols)} = "hehehe";
<font class='lnum'>3174</font>   print "AND NEXT IS ${q(a long $strange #tring wi# symbols)} \n";
<font class='lnum'>3175</font>   
<font class='lnum'>3176</font>   $$c = "a am a string whose name is a bad string";
<font class='lnum'>3177</font>   print "dereffing: $$c\n";
<font class='lnum'>3178</font>   
<font class='lnum'>3179</font>   
<font class='lnum'>3180</font>   
<font class='lnum'>3181</font>   # 2.  Interpolation.
<font class='lnum'>3182</font>   ${q(A chunk with a long name?!)} = q('some string @#$%^ with noise');
<font class='lnum'>3183</font>   ${q(A chunk with a long name?!)} .= q( . " ||| " . $hash{q(a long $strange #tring wi# symbols)} );
<font class='lnum'>3184</font>   
<font class='lnum'>3185</font>   print "\nFIRST, the string as I keep it in my buffer:\n\t${q(A chunk with a long name?!)}\n";
<font class='lnum'>3186</font>   print "NOW THE TRICK::\n\t", eval(${q(A chunk with a long name?!)}), "\n";
<font class='lnum'>3187</font>   
<font class='lnum'>3188</font>   
<font class='lnum'>3189</font>   # 3. Picking up chunk name from a regexp
<font class='lnum'>3190</font>   #   .. no refs are needed at all, actually, the vars do it anyway, it seems.
<font class='lnum'>3191</font>   
<font class='lnum'>3192</font>   $line1_test3 = q(&lt;&lt;ch*nk n@me wh&amp;ch q(i$$ a p#r@se)&gt;&gt;=);
<font class='lnum'>3193</font>   $line2_test3 = q(some text from the chunk body);
<font class='lnum'>3194</font>   $line3_test3 = q(second line of the same chunk body);
<font class='lnum'>3195</font>   $chunk_beg_pattern_test3 = "^&lt;\&lt;(.*)&gt;\&gt;=";
<font class='lnum'>3196</font>   %chunks_hash_test3 = ();
<font class='lnum'>3197</font>   
<font class='lnum'>3198</font>   if ( $line1_test3 =~ $chunk_beg_pattern_test3 ) {
<font class='lnum'>3199</font>   
<font class='lnum'>3200</font>     $chunk_name = $1;
<font class='lnum'>3201</font>     print "\n\n............\n$line1_test3\n\n";
<font class='lnum'>3202</font>     print "HHHHHHHHHHH $chunk_name HHHHHHHHHHHH\n";
<font class='lnum'>3203</font>     print "$chunk_name\n";
<font class='lnum'>3204</font>     $chunks_hash_test3{$chunk_name} .= $line2_test3 . "\n";
<font class='lnum'>3205</font>     $chunks_hash_test3{$chunk_name} .= $line3_test3;
<font class='lnum'>3206</font>   
<font class='lnum'>3207</font>   }
<font class='lnum'>3208</font>   else {print "\n
<font class='lnum'>3209</font>       \n===========\ncould not match it\n"};
<font class='lnum'>3210</font>   
<font class='lnum'>3211</font>     print "\n----------\n$chunks_hash_test3{$chunk_name}\n-------------\n";
<font class='lnum'>3212</font>   
<font class='lnum'>3213</font>   
<font class='lnum'>3214</font>   
<font class='lnum'>3215</font>   
<font class='lnum'>3216</font>   #---end---
<font class='lnum'>3217</font>   
<font class='lnum'>3218</font>   </fieldset></pre>
<p>
Script output (from 1,2):<br>
-------------------------------------<br>
    <pre>
    bash-3.1$ perl xxx
    key is -- a long $strange #tring wi# symbols -- and value is -- another long string @$%^ with strange symbols --
    AND NEXT IS hehehe
    dereffing: a am a string whose name is a bad string

    FIRST, the string as I keep it in my buffer:
	    'some string @#$%^ with noise' . " ||| " . $hash{q(a long $strange #tring wi# symbols)}
    NOW THE TRICK::
	    some string @#$%^ with noise ||| another long string @$%^ with strange symbols
    bash-3.1$ 
    </pre><br>
-------------------------------------<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('74');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('75');">
<font class='lnum'><i>(75)</i></font>&nbsp; Scrap pieces for tangler </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3239)</i></sub></font></a></legend></fieldset>
<p>
<div id="75" style="display:none">   
<ul>


<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('76');">
<font class='lnum'><i>(76)</i></font>&nbsp; 1. Use MD5 for chunk titles? </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3244)</i></sub></font></a></legend></fieldset>
<p>
<div id="76" style="display:none">   
<ul>


<p>
    Chunk names are free phrases in a human lang. I need poss. to make a hash of contents with<br>
    the title as  the key. A phrase is not good for that, so could I use MD5 hashes of the titles<br>
    instead??<br>
<p>
    PErl will require a module then:<br>
<p>
<p>
<font class='lnum'>3254</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;md5 hashing from perl&gt;&gt;=</legend>
<font class='lnum'>3255</font>   #!/usr/bin/perl
<font class='lnum'>3256</font>   # Functional style
<font class='lnum'>3257</font>    use Digest::MD5 qw(md5 md5_hex md5_base64);
<font class='lnum'>3258</font>   
<font class='lnum'>3259</font>    #$digest = md5($data);
<font class='lnum'>3260</font>    #$digest = md5_hex($data);
<font class='lnum'>3261</font>    #$digest = md5_base64($data);
<font class='lnum'>3262</font>   
<font class='lnum'>3263</font>    # my test:
<font class='lnum'>3264</font>    $digest1 = md5_base64("md5 hashing from perl");
<font class='lnum'>3265</font>    $digest2 = md5_base64("Chunk names are free phrases in a human lang. I need poss. to make a hash 
<font class='lnum'>3266</font>       of contents with the title as  the key. A phrase is not good for that, so could I use MD5 
<font class='lnum'>3267</font>       hashes of the title");
<font class='lnum'>3268</font>    print "$digest1\n$digest2\n";
<font class='lnum'>3269</font>   </fieldset></pre>
<p>
<b> Nope, it's much simpler </b><br>
<b> 1. </b> In fact, perl can digest "chunk names made of whole phrases" as hash keys - one just <br>
needs to quote them. There may be limitations on the special symbols inside the chunk titles, I<br>
do not know. <br>
Seen in Conway's book, first chapters recapitulating main point of perl<br>
<p>
<b> 2. </b> A more restrictive option can be left as settable in the "mollifying" part of the<br>
script -- use_chunk_names_of_alphanumerics_only with underscores in place of spaces.<br>
Then I could programmatically match for alphanumeric chars during a first tangle pass and<br>
complain if chunk names mismatch. <br>
<p>
So <b> no MD5 is needed after all, it seems </b><br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('76');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('77');">
<font class='lnum'><i>(77)</i></font>&nbsp; 2. ver 1 -- skeleton for tangling </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3288)</i></sub></font></a></legend></fieldset>
<p>
<div id="77" style="display:none">   
<ul>


<p>
<p>
    <i>Cut out code chunks; <br>
    create hash; <br>
    ..concatting parts of the same chunk. </i><br>
<p>
    I will get here if I am "scriptname.tangle" and $builtin_tangler = 1<br>
<p>
<p>
<font class='lnum'>3299</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;built-in tangler skeleton&gt;&gt;=</legend>
<font class='lnum'>3300</font>   #!/usr/bin/perl
<font class='lnum'>3301</font>       use Digest::MD5 qw(md5_base64);
<font class='lnum'>3302</font>   
<font class='lnum'>3303</font>       $use_builtin_tangler = 1;
<font class='lnum'>3304</font>       unless ($use_builtin_tangler) {print "not set to tangle in the options\n"; exit}
<font class='lnum'>3305</font>   
<font class='lnum'>3306</font>       <font class='chunkref'>&lt;&lt;first pass of tangling - accumulate in RAM&gt;&gt</font>;
<font class='lnum'>3307</font>       <font class='chunkref'>&lt;&lt;second pass of tangling - print out&gt;&gt</font>;
<font class='lnum'>3308</font>   </fieldset></pre>
<p>
<p>
    <b> <i> note 1 </i> </b><br>
    The following works with implicit understanting of the correct sequencing of the symbols in the<br>
    Literate SOurce file. If those are mangled, results are not guaranteed. <br>
    I mean, no check is done to complain in case "&lt; &lt;  blabla &gt; &gt;=" and "@" do not follow each other<br>
    or if those nest etc.<br>
<p>
    <b> <i> note 2 </i> </b><br>
    Besides accumulating code, I also need to do indeces (also hashes)?<br>
    One idea is to have immediate access to "parent roots", because I foresee 3 modes of tangling:<br>
    <ul> <li>the default chunk "*"<br>
    </li><li>the specified chunk<br>
    </li><li>and "all root chunks" to kind of "check out the whole project" from the Literate Source<br>
    </li></ul><br>
    If I do not maintain the 3 modes and tangle from the "*" specified in the LitSource file, I won't<br>
    need the indeces, I think.<br>
<p>
<p>
<font class='lnum'>3328</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;first pass of tangling - accumulate in RAM&gt;&gt;=</legend>
<font class='lnum'>3329</font>       open LITSOURCE, "&lt; $ARGV[$1]" || die "could not open the file to tangle\n";
<font class='lnum'>3330</font>   
<font class='lnum'>3331</font>       $chunk_beg_pattern = "^&lt;\&lt;(.*)&gt;\&gt;=";
<font class='lnum'>3332</font>       $chunk_end_pattern = "^@\s*$";
<font class='lnum'>3333</font>       $chunk_ref_pattern = "&lt;\&lt;(.*?)&gt;\&gt;[^=]"; # can be used several times in a line
<font class='lnum'>3334</font>   
<font class='lnum'>3335</font>       %code_chunks_buf = (); # accumulating chunks bodies
<font class='lnum'>3336</font>       %code_chunks_index = (); # like "goto" stack per chunk
<font class='lnum'>3337</font>   
<font class='lnum'>3338</font>     while (&lt;LITSOURCE&gt;) {
<font class='lnum'>3339</font>   
<font class='lnum'>3340</font>       if ( m!$chunk_beg_pattern! .. m!$chunk_end_pattern! ) { # -- CODE CHUNKS -- 
<font class='lnum'>3341</font>   
<font class='lnum'>3342</font>   	if ( $_ =~ m!$chunk_beg_pattern! ) {
<font class='lnum'>3343</font>   	    # form md5 and push into the hash-stack
<font class='lnum'>3344</font>   	    $title_hash = md5_base64($1);
<font class='lnum'>3345</font>   	    }
<font class='lnum'>3346</font>   	elsif ( $_ =~ m!$chunk_end_pattern! )  {
<font class='lnum'>3347</font>   	    # end of code chunk
<font class='lnum'>3348</font>   	    }
<font class='lnum'>3349</font>   	elsif ( $_ =~ m!$chunk_ref_pattern! ) {
<font class='lnum'>3350</font>   	    # 1. form and push "goto" and "cont" into the hash-stack
<font class='lnum'>3351</font>   	    #	.. which are a concatenation of strings
<font class='lnum'>3352</font>   	    # 2. ...and make sure the $ref_chunkname string is defined before
<font class='lnum'>3353</font>   	    # this chunk is processed -- for the strings based subst. and expansion.
<font class='lnum'>3354</font>   	    }
<font class='lnum'>3355</font>   	else { # chunk body: accumulate
<font class='lnum'>3356</font>   	    $code_chunks_buf{$title_hash} .= $_;
<font class='lnum'>3357</font>   	    }
<font class='lnum'>3358</font>       } #fi
<font class='lnum'>3359</font>   
<font class='lnum'>3360</font>   
<font class='lnum'>3361</font>     } #eliwh
<font class='lnum'>3362</font>   </fieldset></pre>
<p>
<p>
    Now all code chunks, concatenated if they have the same name, are in RAM (inside %title_hash), <br>
    I can do the second pass and unravel them.<br>
<p>
<p>
<p>
<p>
<b> 3. Second pass of tangling </b><br>

<p>
    Let's do tangling  from "*" only in this skeleton version<br>
<p>
    The chunks now are in RAM as a string; I need to match &lt; &lt; chunk refs &gt; &gt; and continue right<br>
    after processing them.<br>
    Seems it can be done with a regexp which marks the place of its last match.<br>
<p>
    err.. multiline matching; only-once + continuation -- the regexp options needed -- ??<br>
<p>
    Secondly, it creates a recursive function.<br>
<p>
<font class='lnum'>3384</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;second pass of tangling - print out&gt;&gt;=</legend>
<font class='lnum'>3385</font>    # second pass - tangling from %code_chunks_buf using %code_chunks_index for directions
<font class='lnum'>3386</font>   
<font class='lnum'>3387</font>    $default_root = md5_base64("*");
<font class='lnum'>3388</font>   
<font class='lnum'>3389</font>       # bullshit
<font class='lnum'>3390</font>       #$code_chunks_buf{$default_root} =~ m!!;
<font class='lnum'>3391</font>   
<font class='lnum'>3392</font>   </fieldset></pre>
<p>
    <b> ...STOP... </b><br>
<p>
    <b> Basically, if we use the strings expansion/subst, the call to print out is just<br>
    "print $firstchunkname;" - the rest will work out automatically???<br>
    Or do I  need to "eval" the formed re-ordered strings first??  </b><br>
<p>
    <b> ALSO: </b> "tsort" in pure perl implementing a Don Knuth's algorithm:<br>
    <a href= http://cpansearch.perl.org/src/CWEST/ppt-0.14/html/commands/tsort/index.html > http://cpansearch.perl.org/src/CWEST/ppt-0.14/html/commands/tsort/index.html </a><br>
    It's part of "Perl Power Tools" project, reimplementing Unix tools in perl:<br>
    (or, rather a "Unix Reconstruction Project"):<br>
    <a href= http://cpansearch.perl.org/src/CWEST/ppt-0.14/README > http://cpansearch.perl.org/src/CWEST/ppt-0.14/README </a><br>
<p>
    Actually, I downloaded the whole bundle, 3.9MiB compressed.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('77');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('78');">
<font class='lnum'><i>(78)</i></font>&nbsp; 4. Another idea for tangling </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3412)</i></sub></font></a></legend></fieldset>
<p>
<div id="78" style="display:none">   
<ul>


<p>
    Basically, I should create more chunks in $code_chunks_buf than the number of those <br>
    existing in reality.<br>
<p>
    The idea is to split them at each &lt; &lt;  chunk ref &gt; &gt; to print out without parsing <br>
    the string at all.<br>
    Then all I need is a parent-child index, that's all??<br>
<p>
    The parent-child index must be able to keep multiple offspring then (in case some <br>
    chunk is reused, say if it is a func used in several contexts.<br>
<p>
    <b> and for <i> srings substutution </i> which is done with lazy regexp thingy below<br>
    the first pass is just ........ </b><br>
<p>
<b> 5. One more idea </b> <br>

    if I cannot iterate strings lazily, why not iterate over the file twice?<br>
    Operators which work on the files are by their nature lazy both in perl and in newlisp.<br>
    I.e. first pass - get offsets, form the "goto-index" hash, second pass - unravel.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('78');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('79');">
<font class='lnum'><i>(79)</i></font>&nbsp; 6. Lazy iteration over strings in a memory buf </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3438)</i></sub></font></a></legend></fieldset>
<p>
<div id="79" style="display:none">   
<ul>


<p>
    ..seems possible after all, check <br>
    <a href=http://localhost:8000/perl.docs/perlretut-perldoc.perl.org.weave >http://localhost:8000/perl.docs/perlretut-perldoc.perl.org.weave </a><br>
    as a cumbersome combination of "g" option, "pos()" function and \G ancor<br>
    see "global matching" subsection in the above doc (under "using regexp in Perl")<br>
<p>
<p>
    HEre's a snippet that seems to work:<br>
<p>
<font class='lnum'>3449</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;matchstring2.pl&gt;&gt;=</legend>
<font class='lnum'>3450</font>   #!/usr/bin/perl
<font class='lnum'>3451</font>   
<font class='lnum'>3452</font>   #------JUST a string to test the regexps on ------------
<font class='lnum'>3453</font>   $string = &lt;&lt;end_of_string;
<font class='lnum'>3454</font>   bla-bla-bla /leaving it out/
<font class='lnum'>3455</font>   end_of_string
<font class='lnum'>3456</font>   
<font class='lnum'>3457</font>   #---------------end of string--------------
<font class='lnum'>3458</font>   
<font class='lnum'>3459</font>   =head
<font class='lnum'>3460</font>   # first test, bad:
<font class='lnum'>3461</font>   # match-prematch work, but on the WHOLE string. BAD:
<font class='lnum'>3462</font>     while ( $string =~ m!&lt;\&lt;(.*?)&gt;\&gt;[^=]!gc) {
<font class='lnum'>3463</font>       print "\n\n---PREMATCH---\n$`\n\n";
<font class='lnum'>3464</font>       print "MATCH\n$1\n\n";
<font class='lnum'>3465</font>       }
<font class='lnum'>3466</font>   =cut
<font class='lnum'>3467</font>   
<font class='lnum'>3468</font>   
<font class='lnum'>3469</font>   # --HERE'S ANOTHER IDEA--
<font class='lnum'>3470</font>   # the use of \G ancor and poss the pos() function
<font class='lnum'>3471</font>   #pos($string) = 0;
<font class='lnum'>3472</font>   while ( $string =~ m!\G(.*?)&lt;\&lt;(.*?)&gt;\&gt;!gs) {
<font class='lnum'>3473</font>     
<font class='lnum'>3474</font>     $off = length($2);
<font class='lnum'>3475</font>     $position = pos($string);
<font class='lnum'>3476</font>     #pos($string) = $position + $off;
<font class='lnum'>3477</font>     print "\n\t---title---\n$2 of length $off at $position \n\t----after----\n$1\n========\n";
<font class='lnum'>3478</font>   
<font class='lnum'>3479</font>   }
<font class='lnum'>3480</font>   
<font class='lnum'>3481</font>   </fieldset></pre>
<p>
     ONE PROBLEM:<br>
     last piece, post-chunk ?? OR not a prob when reading from a file??<br>
<p>
     Looks like this can solve the prob of parsing a code chunk with included &lt; &lt;references&gt; &gt;<br>
    when hitting a match:<br>
    <ul>		- append $1 to the chunk buffer<br>
		    - get md5, push it into the index<br>
		    - form an md5 for the continuation and start that new chunk<br>
		    - .. and push "goto" this continuation into the prev chunk index<br>
    </ul><br>
     Do this linearly on all cut out code chunks of the Literate Source file (appending those <br>
     with the same names)<br>
     and print out from memory on pass 2 according to the goto index.<br>
<p>
     Should preserve all offsets as well.<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('79');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('75');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('72');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('58');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('80');">
<font class='lnum'><i>(80)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3509)</i></sub></font></a></legend></fieldset>
<p>
<div id="80" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('80');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('81');">
<font class='lnum'><i>(81)</i></font>&nbsp; WEAVER </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3512)</i></sub></font></a></legend></fieldset>
<p>
<div id="81" style="display:none">   
<ul>


<p>
<p>
The idea of the weaver is simple, again.<br>
<p>
<font class='lnum'>3518</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;weave me&gt;&gt;=</legend>
<font class='lnum'>3519</font>   
<font class='lnum'>3520</font>   
<font class='lnum'>3521</font>   WEAVE_ME:
<font class='lnum'>3522</font>   
<font class='lnum'>3523</font>   #1. Set formatting strings for weaver
<font class='lnum'>3524</font>   <font class='chunkref'>&lt;&lt;set formatting strings for weaver&gt;&gt</font>;
<font class='lnum'>3525</font>   
<font class='lnum'>3526</font>   #2. accumulate result in a buffer
<font class='lnum'>3527</font>   <font class='chunkref'>&lt;&lt;accumulate result in a buffer&gt;&gt</font>;
<font class='lnum'>3528</font>   
<font class='lnum'>3529</font>   #3. print out the TOC, the Chunks Index, the output buffer and close the page.
<font class='lnum'>3530</font>   <font class='chunkref'>&lt;&lt;print out&gt;&gt</font>;
<font class='lnum'>3531</font>   </fieldset></pre>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('82');">
<font class='lnum'><i>(82)</i></font>&nbsp; How formatting is done in the weaver </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3535)</i></sub></font></a></legend></fieldset>
<p>
<div id="82" style="display:none">   
<ul>


<p>
<b>1 The first formatting element </b>  that is  part of the <i> function </i> of the script<br>
rather than formatting decorations is the<br>
<pre> frameset - legend - /legend - /frameset </pre><br>
which create the distinctive look of the documents generated by MOLLY. I do not wish to<br>
change them (although strictly speaking they are not obligatory).<br>
<p>
What can be changed is the Stylesheet (a part of the script, it has its own subsection), so<br>
other people could play with fonts and colors and margins and such by throwing in a simple<br>
switch and copying their alternative stylesheet into the script.<br>
<p>
I do not wish to use external files for any configuration, as the whole idea of MOLLY is to<br>
be a single self-contained script, which does not require any "installation" of many files to<br>
many places.<br>
<p>
<b>2  Secondly,</b> the "actual working test.html" subsection below probably explains best how<br>
<b> text folding and background highlighting </b> which is tied to it (i.e. a TOC click will open the <br>
section + highlight; and click on the section in the body of the doc will toggle it + highlight <br>
the TOC line ) work.<br>
<p>
Actual implementation is spread between several subsections - they are<br>
coded in in the hard way, as I do not expect them to change ever, they are a functional element<br>
not a changeable "skin" or decoration.<br>
<ul><li> vars, JS and styles are set in the weaver "set formatting strings for weaver" subsections;<br>
</li><li> invocations can be seen in "accumulate the result", esp in the "section headings"<br>
</li><li> and more are applied in the "print out the result"<br>
</li></ul><br>
<p>
Some of the vars are set to pieces of formatting strings in the beginning, and later variables<br>
in them are interpolated with "executable" regexs ( the "e" flag at the end of the regex) - see <br>
"process section headings"<br>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('83');">
<font class='lnum'><i>(83)</i></font>&nbsp; actual working test.html </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3571)</i></sub></font></a></legend></fieldset>
<p>
<div id="83" style="display:none">   
<ul>


<p>
Here's the actual script that was used to test the JS folding and<br>
tying of folding to the TOC section highlighting:<br>
<p>
<p>
<font class='lnum'>3578</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;test.html&gt;&gt;=</legend>
<font class='lnum'>3579</font>   
<font class='lnum'>3580</font>   &lt;html&gt;
<font class='lnum'>3581</font>   &lt;head&gt;
<font class='lnum'>3582</font>   
<font class='lnum'>3583</font>   
<font class='lnum'>3584</font>   &lt;style type="text/css"&gt;
<font class='lnum'>3585</font>   
<font class='lnum'>3586</font>   
<font class='lnum'>3587</font>   .unhilited {background-color:white}
<font class='lnum'>3588</font>   .hilited {background-color:yellow; text-decoration:underline}
<font class='lnum'>3589</font>   &lt;/style&gt;
<font class='lnum'>3590</font>   
<font class='lnum'>3591</font>   
<font class='lnum'>3592</font>   &lt;script type="text/javascript"&gt;
<font class='lnum'>3593</font>   
<font class='lnum'>3594</font>       function setHilite(evt) {
<font class='lnum'>3595</font>   	evt = (evt) ? evt : ((window.event) ? window.event : null);
<font class='lnum'>3596</font>   	if (evt) {
<font class='lnum'>3597</font>   	    var elem = (evt.srcElement) ? evt.srcElement : evt.target;
<font class='lnum'>3598</font>   	    elem.className = "hilited";
<font class='lnum'>3599</font>   	}
<font class='lnum'>3600</font>       }
<font class='lnum'>3601</font>   
<font class='lnum'>3602</font>   
<font class='lnum'>3603</font>   function setUnHilite(evt) {
<font class='lnum'>3604</font>       evt = (evt) ? evt : ((window.event) ? window.event : null);
<font class='lnum'>3605</font>   	if (evt) {
<font class='lnum'>3606</font>       	    var elem = (evt.srcElement) ? evt.srcElement : evt.target;
<font class='lnum'>3607</font>       	    elem.className = "unhilited";
<font class='lnum'>3608</font>   	}
<font class='lnum'>3609</font>   }
<font class='lnum'>3610</font>   
<font class='lnum'>3611</font>   function toggleDiv(divid) {
<font class='lnum'>3612</font>   var el = document.getElementById(divid);
<font class='lnum'>3613</font>   el.style.display = (el.style.display == 'block') ? 'none' : 'block';
<font class='lnum'>3614</font>   }
<font class='lnum'>3615</font>   
<font class='lnum'>3616</font>   function toggleCombined(divid){
<font class='lnum'>3617</font>       if(document.getElementById(divid).style.display == 'none'){
<font class='lnum'>3618</font>         document.getElementById(divid).style.display = 'block';
<font class='lnum'>3619</font>   	document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>3620</font>       }
<font class='lnum'>3621</font>       
<font class='lnum'>3622</font>       else{
<font class='lnum'>3623</font>         document.getElementById(divid).style.display = 'none';
<font class='lnum'>3624</font>   	document.getElementById("toc"+divid).className="unhilited";
<font class='lnum'>3625</font>       }
<font class='lnum'>3626</font>   }
<font class='lnum'>3627</font>   
<font class='lnum'>3628</font>   
<font class='lnum'>3629</font>   function expandDiv(divid){
<font class='lnum'>3630</font>   	document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>3631</font>   }
<font class='lnum'>3632</font>   
<font class='lnum'>3633</font>   
<font class='lnum'>3634</font>   
<font class='lnum'>3635</font>   &lt;/script&gt;
<font class='lnum'>3636</font>   &lt;/head&gt;
<font class='lnum'>3637</font>   
<font class='lnum'>3638</font>   &lt;body &gt;
<font class='lnum'>3639</font>   &lt;h2&gt;Here's the tested element&lt;/h2&gt;
<font class='lnum'>3640</font>   Here is some ordinary text&lt;br&gt;
<font class='lnum'>3641</font>   &lt;span class="unhilited" onmouseover="setHilite(event)" 
<font class='lnum'>3642</font>       onmouseout="setUnHilite(event)"&gt; 
<font class='lnum'>3643</font>       &lt;a href="javascript:;" onmousedown="toggleDiv(15);"&gt;&lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>3644</font>       and this is some potentially hot spot text.&lt;/span&gt;
<font class='lnum'>3645</font>   
<font class='lnum'>3646</font>   &lt;div id=15&gt;
<font class='lnum'>3647</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>3648</font>       that should be hidden/collapsed
<font class='lnum'>3649</font>   
<font class='lnum'>3650</font>   &lt;/div&gt;
<font class='lnum'>3651</font>   
<font class='lnum'>3652</font>   
<font class='lnum'>3653</font>   &lt;h2&gt;Here's the tested element 0&lt;/h2&gt;
<font class='lnum'>3654</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>3655</font>   &lt;a href="javascript:;" onmousedown="toggleCombined(13);" id="toc13"&gt;
<font class='lnum'>3656</font>       &lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>3657</font>   
<font class='lnum'>3658</font>   &lt;div id=13 &gt;&lt;script language=javascript&gt; document.getElementById("toc"+13).className='hilited';&lt;/script&gt;
<font class='lnum'>3659</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>3660</font>       that should be hidden/collapsed
<font class='lnum'>3661</font>   
<font class='lnum'>3662</font>   &lt;/div&gt;
<font class='lnum'>3663</font>   
<font class='lnum'>3664</font>   
<font class='lnum'>3665</font>   
<font class='lnum'>3666</font>   
<font class='lnum'>3667</font>   &lt;h2&gt;Here's the tested element 1&lt;/h2&gt;
<font class='lnum'>3668</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>3669</font>   &lt;a href="javascript:;" onmousedown="toggleCombined(14);" id="toc14"&gt;
<font class='lnum'>3670</font>       &lt;script language=javascript&gt; document.getElementById("toc"+14).className='hilited';&lt;/script&gt;
<font class='lnum'>3671</font>       &lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>3672</font>   
<font class='lnum'>3673</font>   &lt;div id=14 &gt;
<font class='lnum'>3674</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>3675</font>       that should be hidden/collapsed
<font class='lnum'>3676</font>   
<font class='lnum'>3677</font>   &lt;/div&gt;
<font class='lnum'>3678</font>   
<font class='lnum'>3679</font>   
<font class='lnum'>3680</font>   &lt;h2&gt;Here's the tested element 2&lt;/h2&gt;
<font class='lnum'>3681</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>3682</font>   &lt;span  id="toc16"&gt; 
<font class='lnum'>3683</font>       &lt;a href="javascript:;" onmousedown="toggleCombined(16);"&gt;&lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>3684</font>       and this is some potentially hot spot text.&lt;/span&gt;
<font class='lnum'>3685</font>   
<font class='lnum'>3686</font>   &lt;div id=16&gt;
<font class='lnum'>3687</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>3688</font>       that should be hidden/collapsed
<font class='lnum'>3689</font>   
<font class='lnum'>3690</font>   &lt;/div&gt;
<font class='lnum'>3691</font>   
<font class='lnum'>3692</font>   
<font class='lnum'>3693</font>   
<font class='lnum'>3694</font>   &lt;/body&gt;
<font class='lnum'>3695</font>   &lt;/html&gt;
<font class='lnum'>3696</font>   
<font class='lnum'>3697</font>   </fieldset></pre>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('83');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('84');">
<font class='lnum'><i>(84)</i></font>&nbsp; changing text style - the basic JS recipy </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3703)</i></sub></font></a></legend></fieldset>
<p>
<div id="84" style="display:none">   
<ul>


<p>
I used this snippet for a start then reworked it into the "working test script" below.<br>
<p>
<ul> <pre>
11.8.2 Solution
First, define two style sheet rules, each with a different class selector. Then design 
an event handler for the element to change the element's className property to the desired 
class selector's identifier: 

		&lt;style type="text/css"&gt;
		.unhilited {background-color:white}
		.hilited {background-color:yellow; text-decoration:underline}
		&lt;/style&gt;
		...
		&lt;script type="text/javascript"&gt;
		function setHilite(evt) {
			evt = (evt) ? evt : ((window.event) ? window.event : null);
			if (evt) {
				var elem = (evt.srcElement) ? evt.srcElement : evt.target;
				elem.className = "hilited";
			}
		}
		function setUnHilite(evt) {
			evt = (evt) ? evt : ((window.event) ? window.event : null);
			if (evt) {
				var elem = (evt.srcElement) ? evt.srcElement : evt.target;
				elem.className = "unhilited";
			}
		}
		...
		&lt;span class="unhilited" onmouseover="setHilite(event)" 
			onmouseout="setUnHilite(event)"&gt;Some potentially hot spot text.&lt;/span&gt;

Adjusting the className property of an element as shown here is a more stable approach 
for early versions of Netscape 6 instead of manipulating styleSheet objects and their 
properties. It is perhaps the most widely used and supported way to implement dynamic styles. 
</pre> </ul><br>
<p>
If I enclose one "onmousedown" inside another, JScript will most probably not pass it into the inner one.<br>
So I should add:<br>
(a) the TOC line IDs ?? Like "toc.1", "toc.2" etc<br>
(b) keep a separate func, not "toggleDiv", but something else like "toggleTOCandDIV", and run 2 things<br>
from there ??<br>
<p>
<b> So, 2 tests: enclosing and if not, then rewriting the collapsing JS func </b><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('84');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('85');">
<font class='lnum'><i>(85)</i></font>&nbsp; Reference - Javascript and DOM </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3754)</i></sub></font></a></legend></fieldset>
<p>
<div id="85" style="display:none">   
<ul>


<p>
<p>
I'll need some javascript and DOM reference for further work;<br>
<p>
a/ http://w3schools.com/htmldom/dom_reference.asp  -- ref from W3C<br>
b/ http://w3schools.com/htmldom/default.asp -- might also be useful<br>
c/ http://www.howtocreate.co.uk/tutorials/javascript/domcss --javascript tutorial (not necessarily best) <br>
d/ http://www.pageresource.com/dhtml/ryan/part4-1.html - another tutorial<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('85');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('82');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('86');">
<font class='lnum'><i>(86)</i></font>&nbsp; set formatting strings for weaver </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3770)</i></sub></font></a></legend></fieldset>
<p>
<div id="86" style="display:none">   
<ul>


<p>
<font class='lnum'>3773</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;set formatting strings for weaver&gt;&gt;=</legend>
<font class='lnum'>3774</font>   
<font class='lnum'>3775</font>     #----SETTING FORMATTING STRINGS-----------
<font class='lnum'>3776</font>     
<font class='lnum'>3777</font>   $html_head = &lt;&lt;head_end_1;  
<font class='lnum'>3778</font>   
<font class='lnum'>3779</font>   &lt;head&gt;
<font class='lnum'>3780</font>   &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt; 
<font class='lnum'>3781</font>   
<font class='lnum'>3782</font>   head_end_1
<font class='lnum'>3783</font>   
<font class='lnum'>3784</font>   #switch on ASCIIMathML.js library if enabled in template options:
<font class='lnum'>3785</font>   if ($enable_ASCIIMathML) {
<font class='lnum'>3786</font>   $html_head .= "\n" . qq(&lt;script type="text/javascript" src="$path_to_ASCIIMathML"&gt;&lt;/script&gt;) . "\n";
<font class='lnum'>3787</font>       }
<font class='lnum'>3788</font>   
<font class='lnum'>3789</font>   $html_head .= &lt;&lt;head_end;
<font class='lnum'>3790</font>   
<font class='lnum'>3791</font>   <font class='chunkref'>&lt;&lt;JS script functions&gt;&gt</font>;
<font class='lnum'>3792</font>   <font class='chunkref'>&lt;&lt;stylesheet&gt;&gt</font>;
<font class='lnum'>3793</font>   
<font class='lnum'>3794</font>   &lt;/head&gt;
<font class='lnum'>3795</font>   head_end
<font class='lnum'>3796</font>   
<font class='lnum'>3797</font>   $html_body_table = "&lt;center&gt;&lt;table class='outertable'&gt;&lt;tr&gt;&lt;td&gt;";
<font class='lnum'>3798</font>   $html_body_table_end = "\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;\n";
<font class='lnum'>3799</font>   
<font class='lnum'>3800</font>   
<font class='lnum'>3801</font>   	
<font class='lnum'>3802</font>   
<font class='lnum'>3803</font>   $folding_section_start1_str = &lt;&lt;'fold_sect_start_1_xxx';
<font class='lnum'>3804</font>   	&lt;fieldset&gt;&lt;legend&gt;&lt;a href="javascript:;" onmousedown="toggleCombined('$section_num');"&gt;
<font class='lnum'>3805</font>   fold_sect_start_1_xxx
<font class='lnum'>3806</font>   
<font class='lnum'>3807</font>   
<font class='lnum'>3808</font>   $folding_section_start2_str = &lt;&lt;'fold_sect_start_2_xxx';
<font class='lnum'>3809</font>   &lt;/a&gt;&lt;/legend&gt;&lt;/fieldset&gt;
<font class='lnum'>3810</font>   &lt;p&gt;
<font class='lnum'>3811</font>   &lt;div id="$section_num" style="display:$fold_state"&gt; $highlight_state  
<font class='lnum'>3812</font>   &lt;ul&gt;
<font class='lnum'>3813</font>   
<font class='lnum'>3814</font>   fold_sect_start_2_xxx
<font class='lnum'>3815</font>   
<font class='lnum'>3816</font>   
<font class='lnum'>3817</font>   $folding_section_end_str = &lt;&lt;'folding_section_end_xxx';
<font class='lnum'>3818</font>   &lt;/ul&gt;
<font class='lnum'>3819</font>   &lt;p&gt;
<font class='lnum'>3820</font>   &lt;br&gt;
<font class='lnum'>3821</font>   &lt;i&gt;&lt;font size=-1&gt;
<font class='lnum'>3822</font>   &lt;a href="javascript:;"onmousedown="toggleCombined('$section_num_prev');"&gt;
<font class='lnum'>3823</font>   Close the subsection&lt;/a&gt;&lt;/font&gt;
<font class='lnum'>3824</font>   &lt;/i&gt; -- &lt;i&gt;&lt;font size=-1&gt;
<font class='lnum'>3825</font>   &lt;a href="javascript:;" onmousedown="showAll();"&gt;
<font class='lnum'>3826</font>   expand all&lt;/a&gt; -- 
<font class='lnum'>3827</font>   &lt;a href="javascript:;" onmousedown="hideAll();"&gt;
<font class='lnum'>3828</font>   collapse all&lt;/a&gt;
<font class='lnum'>3829</font>   &lt;/font&gt;&lt;/i&gt;
<font class='lnum'>3830</font>   
<font class='lnum'>3831</font>   &lt;p&gt;
<font class='lnum'>3832</font>   &lt;/div&gt;
<font class='lnum'>3833</font>   
<font class='lnum'>3834</font>   folding_section_end_xxx
<font class='lnum'>3835</font>   
<font class='lnum'>3836</font>   
<font class='lnum'>3837</font>   $code_frameset_start_pre = "&lt;pre&gt;&lt;fieldset class='codefieldset'&gt;&lt;legend class='codelegend'&gt;";
<font class='lnum'>3838</font>   $code_frameset_start_post = "=&lt;/legend&gt;";
<font class='lnum'>3839</font>   $code_frameset_end = "&lt;/fieldset&gt;&lt;/pre&gt;\n";
<font class='lnum'>3840</font>   
<font class='lnum'>3841</font>   
<font class='lnum'>3842</font>   
<font class='lnum'>3843</font>   
<font class='lnum'>3844</font>   </fieldset></pre>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('87');">
<font class='lnum'><i>(87)</i></font>&nbsp; JS functions </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3847)</i></sub></font></a></legend></fieldset>
<p>
<div id="87" style="display:none">   
<ul>


<p>
In my attempts to insert ASCIIMathML.js, I have tried some variations of<br>
math sections markup (with "a m a t h" -- "e n d a m a t h" words and<br>
with backquotes) -- but the stinking lib insists on garbling my file, as<br>
sth triggers it on earlier.<br>
<p>
So a next step is to change regexps inside the Javascript lib and forse it<br>
to sane markups. Probably by adding ancoring the key word to the beginning<br>
of the line and/or insisting that it is there alone.<br>
<p>
<font class='lnum'>3859</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;JS script functions&gt;&gt;=</legend>
<font class='lnum'>3860</font>   
<font class='lnum'>3861</font>   &lt;script language="javascript"&gt;
<font class='lnum'>3862</font>   
<font class='lnum'>3863</font>   function toggleDiv(divid) {
<font class='lnum'>3864</font>   var el = document.getElementById(divid);
<font class='lnum'>3865</font>   el.style.display = (el.style.display == 'block') ? 'none' : 'block';
<font class='lnum'>3866</font>   }
<font class='lnum'>3867</font>   
<font class='lnum'>3868</font>   
<font class='lnum'>3869</font>   function toggleCombined(divid){
<font class='lnum'>3870</font>       if(document.getElementById(divid).style.display == 'none'){
<font class='lnum'>3871</font>         document.getElementById(divid).style.display = 'block';
<font class='lnum'>3872</font>   	document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>3873</font>       }
<font class='lnum'>3874</font>       else{
<font class='lnum'>3875</font>         document.getElementById(divid).style.display = 'none';
<font class='lnum'>3876</font>   	document.getElementById("toc"+divid).className="unhilited";
<font class='lnum'>3877</font>       }
<font class='lnum'>3878</font>   }
<font class='lnum'>3879</font>   
<font class='lnum'>3880</font>   
<font class='lnum'>3881</font>   function showAll(){
<font class='lnum'>3882</font>   for(i=1; i &lt;= 10000; i++){
<font class='lnum'>3883</font>       document.getElementById(i).style.display = 'block';
<font class='lnum'>3884</font>       document.getElementById("toc"+i).className="hilited";
<font class='lnum'>3885</font>       };
<font class='lnum'>3886</font>   }
<font class='lnum'>3887</font>   
<font class='lnum'>3888</font>   function hideAll(){
<font class='lnum'>3889</font>   for(i=1; i &lt;= 10000; i++){
<font class='lnum'>3890</font>       document.getElementById(i).style.display = 'none';
<font class='lnum'>3891</font>       document.getElementById("toc"+i).className="unhilited";
<font class='lnum'>3892</font>       };
<font class='lnum'>3893</font>   }
<font class='lnum'>3894</font>   
<font class='lnum'>3895</font>   &lt;/script&gt;
<font class='lnum'>3896</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('87');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('88');">
<font class='lnum'><i>(88)</i></font>&nbsp; Stylesheet </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3901)</i></sub></font></a></legend></fieldset>
<p>
<div id="88" style="display:none">   
<ul>


<p>
<font class='lnum'>3904</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;stylesheet&gt;&gt;=</legend>
<font class='lnum'>3905</font>   &lt;style type="text/css" media="screen"&gt;
<font class='lnum'>3906</font>   
<font class='lnum'>3907</font>   
<font class='lnum'>3908</font>   BODY {
<font class='lnum'>3909</font>   	FONT-SIZE: 10pt;
<font class='lnum'>3910</font>   	&lt;!--FONT-FAMILY: sans-serif --&gt;
<font class='lnum'>3911</font>   	background: #f0f0f0;
<font class='lnum'>3912</font>   	}
<font class='lnum'>3913</font>   FIELDSET {
<font class='lnum'>3914</font>   	BORDER-RIGHT: #000000 1px solid; 
<font class='lnum'>3915</font>   	BORDER-TOP: #000000 1px solid; 
<font class='lnum'>3916</font>   	BORDER-LEFT: #000000 1px solid; 
<font class='lnum'>3917</font>   	BORDER-BOTTOM: #000000 1px solid; 
<font class='lnum'>3918</font>   	PADDING-RIGHT: 5px; 
<font class='lnum'>3919</font>   	PADDING-LEFT: 5px; 
<font class='lnum'>3920</font>   	PADDING-BOTTOM: 2px; 
<font class='lnum'>3921</font>   	PADDING-TOP: 5px;
<font class='lnum'>3922</font>   	MARGIN-BOTTOM: 1px; 
<font class='lnum'>3923</font>   	background: #f5f5f5; 
<font class='lnum'>3924</font>   	color: #000000;
<font class='lnum'>3925</font>   	}
<font class='lnum'>3926</font>   LEGEND {
<font class='lnum'>3927</font>   	BORDER-RIGHT: #a9a9a9 1px solid; 
<font class='lnum'>3928</font>   	BORDER-BOTTOM: #a9a9a9 1px solid;
<font class='lnum'>3929</font>   	BORDER-TOP: #a9a9a9 1px solid; 
<font class='lnum'>3930</font>   	BORDER-LEFT: #a9a9a9 1px solid; 
<font class='lnum'>3931</font>   	PADDING-RIGHT: 20px; 
<font class='lnum'>3932</font>   	PADDING-LEFT: 20px; 
<font class='lnum'>3933</font>   	PADDING-BOTTOM: 5px; 
<font class='lnum'>3934</font>   	PADDING-TOP: 5px; 
<font class='lnum'>3935</font>   	FONT-WEIGHT: bold;  
<font class='lnum'>3936</font>   	BACKGROUND: #fdfdfd; 
<font class='lnum'>3937</font>   	color: #000000;
<font class='lnum'>3938</font>   	}
<font class='lnum'>3939</font>   PRE	{
<font class='lnum'>3940</font>           PADDING-LEFT: 20px; 
<font class='lnum'>3941</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>3942</font>           padding-top: 0px; 
<font class='lnum'>3943</font>           padding-bottom: 6px;
<font class='lnum'>3944</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>3945</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>3946</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>3947</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>3948</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>3949</font>   	background: #fefefe;
<font class='lnum'>3950</font>   	}
<font class='lnum'>3951</font>   
<font class='lnum'>3952</font>   
<font class='lnum'>3953</font>   .tocfieldset {
<font class='lnum'>3954</font>   	background: #ffffff; 
<font class='lnum'>3955</font>   	color: #000000;
<font class='lnum'>3956</font>   	}
<font class='lnum'>3957</font>   
<font class='lnum'>3958</font>   .codefieldset {
<font class='lnum'>3959</font>   	BORDER-RIGHT: #000 1px solid; 
<font class='lnum'>3960</font>   	BORDER-TOP: #000 1px solid; 
<font class='lnum'>3961</font>   	BORDER-LEFT: #000 1px solid; 
<font class='lnum'>3962</font>   	BORDER-BOTTOM: #000 1px solid; 
<font class='lnum'>3963</font>   	background: #ffffff; 
<font class='lnum'>3964</font>   	color: #000;
<font class='lnum'>3965</font>   	MARGIN-BOTTOM: 1px; 
<font class='lnum'>3966</font>   	PADDING-LEFT: 15px; 
<font class='lnum'>3967</font>   	PADDING-RIGHT: 5px; 
<font class='lnum'>3968</font>   	PADDING-BOTTOM: 10px; 
<font class='lnum'>3969</font>   	PADDING-TOP: 1px;
<font class='lnum'>3970</font>   	}
<font class='lnum'>3971</font>   .codelegend {
<font class='lnum'>3972</font>   	BORDER-RIGHT: #777 1px solid; 
<font class='lnum'>3973</font>   	BORDER-TOP: #777 1px solid; 
<font class='lnum'>3974</font>   	BORDER-LEFT: #777 1px solid; 
<font class='lnum'>3975</font>   	BORDER-BOTTOM: #777 1px solid
<font class='lnum'>3976</font>   	PADDING-RIGHT: 10px; 
<font class='lnum'>3977</font>   	PADDING-LEFT: 10px; 
<font class='lnum'>3978</font>   	PADDING-TOP: 2px; 
<font class='lnum'>3979</font>   	PADDING-BOTTOM: 2px; 
<font class='lnum'>3980</font>   	background: #ffffff; 
<font class='lnum'>3981</font>   	color: #00b;
<font class='lnum'>3982</font>   	FONT-WEIGHT: bold;  
<font class='lnum'>3983</font>   	/font-variant: small-caps;
<font class='lnum'>3984</font>   	/font-style: italic;
<font class='lnum'>3985</font>   	}
<font class='lnum'>3986</font>   
<font class='lnum'>3987</font>   
<font class='lnum'>3988</font>   
<font class='lnum'>3989</font>   .chunkref {
<font class='lnum'>3990</font>           color: #00b;	
<font class='lnum'>3991</font>           background: #f6f6f6;
<font class='lnum'>3992</font>           /font-style: italic;
<font class='lnum'>3993</font>           font-weight: bold;
<font class='lnum'>3994</font>           /font-variant: small-caps;
<font class='lnum'>3995</font>   	}
<font class='lnum'>3996</font>   
<font class='lnum'>3997</font>   
<font class='lnum'>3998</font>   .outertable {
<font class='lnum'>3999</font>   	width: 99%; 
<font class='lnum'>4000</font>   	cellpadding: 25; 
<font class='lnum'>4001</font>   	background: #ffffff; 
<font class='lnum'>4002</font>   	border: 1px solid;
<font class='lnum'>4003</font>   	}
<font class='lnum'>4004</font>   
<font class='lnum'>4005</font>   .hl	{
<font class='lnum'>4006</font>   	 ;
<font class='lnum'>4007</font>           PADDING-LEFT: 5px; PADDING-RIGHT: 5px; 
<font class='lnum'>4008</font>           padding-top: 5px; padding-bottom: 5px;
<font class='lnum'>4009</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>4010</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>4011</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>4012</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>4013</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>4014</font>           background: #f5f5f5;	
<font class='lnum'>4015</font>           width: 70%;
<font class='lnum'>4016</font>   	}
<font class='lnum'>4017</font>   
<font class='lnum'>4018</font>   .hl-wide {
<font class='lnum'>4019</font>   	 ;
<font class='lnum'>4020</font>           PADDING-LEFT: 5px; 
<font class='lnum'>4021</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>4022</font>           padding-top: 15px; 
<font class='lnum'>4023</font>           padding-bottom: 15px;
<font class='lnum'>4024</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>4025</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>4026</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>4027</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>4028</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>4029</font>           background: #fbfbfb;	
<font class='lnum'>4030</font>   	}
<font class='lnum'>4031</font>   
<font class='lnum'>4032</font>   .lnum {
<font class='lnum'>4033</font>   
<font class='lnum'>4034</font>   	color: #a0a0a0;
<font class='lnum'>4035</font>   	/background: #fbfbfb;
<font class='lnum'>4036</font>   	}
<font class='lnum'>4037</font>   
<font class='lnum'>4038</font>   .unhilited {background-color:white}
<font class='lnum'>4039</font>   .hilited {background-color:#c0c0ff}
<font class='lnum'>4040</font>   
<font class='lnum'>4041</font>   
<font class='lnum'>4042</font>   &lt;/STYLE&gt;
<font class='lnum'>4043</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('88');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('86');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('89');">
<font class='lnum'><i>(89)</i></font>&nbsp; Accumulate the result </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4052)</i></sub></font></a></legend></fieldset>
<p>
<div id="89" style="display:none">   
<ul>


<p>
Some of the vars may be unused later (run perl -wc to check?)<br>
<p>
<font class='lnum'>4057</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;accumulate result in a buffer&gt;&gt;=</legend>
<font class='lnum'>4058</font>   #2. accumulate result in a buffer
<font class='lnum'>4059</font>   
<font class='lnum'>4060</font>   
<font class='lnum'>4061</font>   # vars for the main loop over lines of the target file
<font class='lnum'>4062</font>   
<font class='lnum'>4063</font>    $chunkbuf = ''; # collects whole formatted project file in memory
<font class='lnum'>4064</font>    $tocbuf = "";	# will accumulate TOC contents, i.e. small
<font class='lnum'>4065</font>    @indbuf = ();  # accumulates index of code chunks, small
<font class='lnum'>4066</font>    #%indbuf = ();
<font class='lnum'>4067</font>    @headings = ();	# the stack for nested subsections numbers/ids
<font class='lnum'>4068</font>   
<font class='lnum'>4069</font>    $section_num = 0;
<font class='lnum'>4070</font>    $section_num_prev = 0;
<font class='lnum'>4071</font>    $section_level = 0;
<font class='lnum'>4072</font>    $prev_section_level = $section_level;
<font class='lnum'>4073</font>    $line_counter = 0;
<font class='lnum'>4074</font>    $in_pre_tag = 0;
<font class='lnum'>4075</font>   </fieldset></pre>
<p>
<p>
The logic is this: (a) all project files, unless they are machine-generated code, are<br>
much below the sizes of RAM on modern machines. So I accumulate in memoru (in a string<br>
$chunkbuf) a copy of the whole file, with necessary transformations and formatting.<br>
<p>
Only 3 distinctions need to be made while iterating over hte lines of the Literate Source<br>
file, between section headings, chunks of code and the lines from the body of documentation<br>
chunks.<br>
<p>
<font class='lnum'>4086</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;accumulate result in a buffer&gt;&gt;=</legend>
<font class='lnum'>4087</font>   
<font class='lnum'>4088</font>   open FF, "&lt; $0";
<font class='lnum'>4089</font>   
<font class='lnum'>4090</font>   
<font class='lnum'>4091</font>   while (&lt;FF&gt;) {
<font class='lnum'>4092</font>   
<font class='lnum'>4093</font>      $line_counter++;
<font class='lnum'>4094</font>   
<font class='lnum'>4095</font>       # cut out the MOLLY.pl invocation itself, the top of the Lit src file
<font class='lnum'>4096</font>       #if ( m%^#-+\s*?start of script% ... m%^xxxxxxxxxxxx% ) {  
<font class='lnum'>4097</font>       if ( m%^__DATA__% ... m%^xxxxxxxxxxxx% ) {
<font class='lnum'>4098</font>       s!^__DATA__\s*$!!;
<font class='lnum'>4099</font>   
<font class='lnum'>4100</font>   
<font class='lnum'>4101</font>   
<font class='lnum'>4102</font>   <font class='chunkref'>&lt;&lt;process code chunks&gt;&gt</font>;
<font class='lnum'>4103</font>   <font class='chunkref'>&lt;&lt;process section headings&gt;&gt</font>;
<font class='lnum'>4104</font>   <font class='chunkref'>&lt;&lt;body HTML formatters&gt;&gt</font>;
<font class='lnum'>4105</font>   
<font class='lnum'>4106</font>   
<font class='lnum'>4107</font>   	# debug
<font class='lnum'>4108</font>   	#print "---- $_";
<font class='lnum'>4109</font>   
<font class='lnum'>4110</font>      } # fi "start of script"
<font class='lnum'>4111</font>   
<font class='lnum'>4112</font>   } #elihw over the whole input file
<font class='lnum'>4113</font>   
<font class='lnum'>4114</font>   	
<font class='lnum'>4115</font>   
<font class='lnum'>4116</font>   
<font class='lnum'>4117</font>    foreach (@headings)  {
<font class='lnum'>4118</font>   
<font class='lnum'>4119</font>   	($section_level, $section_num_prev) = split /-/, $_;
<font class='lnum'>4120</font>   	$folding_section_end = $folding_section_end_str;
<font class='lnum'>4121</font>   	$folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>4122</font>   	$chunkbuf .= $folding_section_end; 
<font class='lnum'>4123</font>   
<font class='lnum'>4124</font>   	};
<font class='lnum'>4125</font>   
<font class='lnum'>4126</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('90');">
<font class='lnum'><i>(90)</i></font>&nbsp; process code chunks </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4133)</i></sub></font></a></legend></fieldset>
<p>
<div id="90" style="display:none">   
<ul>


<p>
"goto" is from an old version of this script, with perl-specific options, I'll delete it<br>
later.<br>
<p>
I use perl range operator to cut out the code section between &lt; &lt; chunkname &gt; &gt; and the<br>
closing "at" symbol, as is required in "noweb".<br>
This is a use of the "range" operator inside another "while" loop over each line of the<br>
Lit Source file, and they work together, the range just flips some status var ("in" - "out")<br>
while the outside loop continues over the lines.<br>
<p>
Once the section name is extracted with a regexp, the index buffer (indbuf) is formed and<br>
updated.<br>
Then "fieldset" formatting is written around the code chunk and line numbering (if set<br>
in an option var) is written too<br>
<p>
<font class='lnum'>4150</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process code chunks&gt;&gt;=</legend>
<font class='lnum'>4151</font>   
<font class='lnum'>4152</font>   	if ( m!^(goto)?&lt;\&lt;(.*)&gt;\&gt;=! ... m!^@\s*$! ) { # -- CODE CHUNKS -- 
<font class='lnum'>4153</font>   		$chunk_title = $2;
<font class='lnum'>4154</font>   
<font class='lnum'>4155</font>   		s/&amp;/&amp;amp;/g;	# escape &amp;
<font class='lnum'>4156</font>   		s/&lt;/&amp;lt;/g;	# escape &lt;
<font class='lnum'>4157</font>   		s/&gt;/&amp;gt;/g;	# escape &gt;
<font class='lnum'>4158</font>   
<font class='lnum'>4159</font>   		if (m!(&amp;lt;&amp;lt;(.+?)&amp;gt;&amp;gt);(=)?!) 
<font class='lnum'>4160</font>   		  {
<font class='lnum'>4161</font>   		  $reference = $1;
<font class='lnum'>4162</font>   		  $ind_str = "&amp;lt;&amp;lt;$2&amp;gt;&amp;gt; $section_num";
<font class='lnum'>4163</font>   		  if (defined $3) {$ind_str .= "&lt;sub&gt;def&lt;/sub&gt;"}
<font class='lnum'>4164</font>   		  else { s!$reference!&lt;font class='chunkref'&gt;$reference&lt;/font&gt;! }
<font class='lnum'>4165</font>   
<font class='lnum'>4166</font>   		  unshift @indbuf, $ind_str;
<font class='lnum'>4167</font>   
<font class='lnum'>4168</font>   		} # fi - chunks index accumulation
<font class='lnum'>4169</font>   
<font class='lnum'>4170</font>   		# simple fieldset frames around code snippets
<font class='lnum'>4171</font>   		s!^(goto)?&amp;lt;&amp;lt;(.+)&amp;gt;&amp;gt;=!$code_frameset_start_pre$1&amp;lt;&amp;lt;$2&amp;gt;&amp;gt;$code_frameset_start_post!;
<font class='lnum'>4172</font>   		s!^@\s*$!$code_frameset_end!;
<font class='lnum'>4173</font>   
<font class='lnum'>4174</font>   		if ( $line_numbering ) { 
<font class='lnum'>4175</font>   		$chunkbuf .= "&lt;font class='lnum'&gt;" . $line_counter . "&lt;/font&gt;   " . $_;
<font class='lnum'>4176</font>   		}
<font class='lnum'>4177</font>   		else{
<font class='lnum'>4178</font>   		$chunkbuf .= $_;
<font class='lnum'>4179</font>   		}
<font class='lnum'>4180</font>   
<font class='lnum'>4181</font>   	} # fi code chunks
<font class='lnum'>4182</font>   </fieldset></pre>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('90');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('91');">
<font class='lnum'><i>(91)</i></font>&nbsp; process section headings </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4188)</i></sub></font></a></legend></fieldset>
<p>
<div id="91" style="display:none">   
<ul>


<p>
This is where folding sectons are created.<br>
The more complicated logic is needed to <i>close</i> the sections properly, when subsections<br>
are included (i.e. creating a step and forming the "close subsection" at the end in the correct<br>
place.<br>
<p>
1. Several formats were possible for collapsing sections, I chose the one you can observe while<br>
reading the weaved document: subsections are completely enclosed by their supersections;<br>
once a child subsection is initiated, the parent subsection cannot continue its body after<br>
the end of the child.<br>
I.e. once you started 12.2.1 inside your 12.2, you cannot write into 12.2 after 12.2.1 is finished, <br>
but you can add 12.2.2, 12.2.3, 12.2.2.1 - etc. - inside the enclosing section.<br>
<p>
The logic was tested first in an external skeleton script.<br>
<p>
2. I may need to disassemble this code to create "view mode" for my script - see "versions - <br>
CHANGES" subsection<br>
<p>
<p>
<font class='lnum'>4209</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process section headings&gt;&gt;=</legend>
<font class='lnum'>4210</font>   
<font class='lnum'>4211</font>   	# -- SECTION HEADINGS 
<font class='lnum'>4212</font>      #elsif ( m!\.(\+)?h(\d)\.(.*?)\./h\d\.! ) {	# old version, no "rawHTML" enabled yet
<font class='lnum'>4213</font>      elsif ( m!$tag_open_symbol(\+)?h(\d)$tag_close_symbol(.*?)$tag_open_symbol/h\d$tag_close_symbol! ) {	
<font class='lnum'>4214</font>   
<font class='lnum'>4215</font>   
<font class='lnum'>4216</font>   
<font class='lnum'>4217</font>   	# -- using split vars for substitution to avoid
<font class='lnum'>4218</font>   	#	regexps and need to keep old state --	
<font class='lnum'>4219</font>   
<font class='lnum'>4220</font>   	$section_num_prev = $section_num;
<font class='lnum'>4221</font>   	$section_num = $section_num + 1;
<font class='lnum'>4222</font>   
<font class='lnum'>4223</font>   
<font class='lnum'>4224</font>   		#default for fold state in "settings" ??
<font class='lnum'>4225</font>   		if ($1 eq "+") {
<font class='lnum'>4226</font>   		    $fold_state="block";
<font class='lnum'>4227</font>   		    $highlight_state = qq!  &lt;script language=javascript&gt; 
<font class='lnum'>4228</font>   		    document.getElementById("toc"+ $section_num).className='hilited';
<font class='lnum'>4229</font>   		    &lt;/script&gt; !;
<font class='lnum'>4230</font>   		} 
<font class='lnum'>4231</font>   		else {
<font class='lnum'>4232</font>   		    $fold_state="none";
<font class='lnum'>4233</font>   		    $highlight_state = "";
<font class='lnum'>4234</font>   		};
<font class='lnum'>4235</font>   		$section_level = $2;
<font class='lnum'>4236</font>   		$section_title = $3;
<font class='lnum'>4237</font>   
<font class='lnum'>4238</font>   
<font class='lnum'>4239</font>   	
<font class='lnum'>4240</font>   
<font class='lnum'>4241</font>   	
<font class='lnum'>4242</font>   
<font class='lnum'>4243</font>   	$folding_section_start1 = $folding_section_start1_str;
<font class='lnum'>4244</font>   	$folding_section_start2 = $folding_section_start2_str;
<font class='lnum'>4245</font>   	$folding_section_end = $folding_section_end_str;
<font class='lnum'>4246</font>   
<font class='lnum'>4247</font>   
<font class='lnum'>4248</font>   	$folding_section_start1 =~ s!(\$section_num)!$1!ee;
<font class='lnum'>4249</font>   	$folding_section_start2 =~ s!(\$section_num)!$1!ee;
<font class='lnum'>4250</font>   	$folding_section_start2 =~ s!(\$fold_state)!$1!ee;
<font class='lnum'>4251</font>   	$folding_section_start2 =~ s!(\$highlight_state)!$1!ee;
<font class='lnum'>4252</font>   	$folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>4253</font>   
<font class='lnum'>4254</font>   
<font class='lnum'>4255</font>   	$section_id = $section_level . '-' . $section_num;
<font class='lnum'>4256</font>   
<font class='lnum'>4257</font>   
<font class='lnum'>4258</font>   	# finish previous subsection if not the first section in the file
<font class='lnum'>4259</font>   	# ..and deal with nesting of sections according to their "depth level"
<font class='lnum'>4260</font>   
<font class='lnum'>4261</font>   	# this is NOT the first section:
<font class='lnum'>4262</font>   	if ( exists $headings[0] ){
<font class='lnum'>4263</font>   
<font class='lnum'>4264</font>   		($prev_section_level, $prev_section_num)  = split /-/, $headings[0];
<font class='lnum'>4265</font>   
<font class='lnum'>4266</font>   		if ($section_level == $prev_section_level){
<font class='lnum'>4267</font>   
<font class='lnum'>4268</font>   		# close prev, start new
<font class='lnum'>4269</font>   		$chunkbuf .= $folding_section_end;
<font class='lnum'>4270</font>   		shift @headings;
<font class='lnum'>4271</font>   		
<font class='lnum'>4272</font>   		}
<font class='lnum'>4273</font>   
<font class='lnum'>4274</font>   		elsif($section_level &lt; $prev_section_level){
<font class='lnum'>4275</font>   		
<font class='lnum'>4276</font>   		  # close a bunch of them, in a loop -- THEN start a new one.
<font class='lnum'>4277</font>   		  do  {
<font class='lnum'>4278</font>   			($prev_section_level, $section_num_prev) = split /-/, shift @headings;
<font class='lnum'>4279</font>   			
<font class='lnum'>4280</font>   			$folding_section_end = $folding_section_end_str;
<font class='lnum'>4281</font>   			$folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>4282</font>   			$chunkbuf .= $folding_section_end;
<font class='lnum'>4283</font>   
<font class='lnum'>4284</font>   		   } while ( $section_level &lt; $prev_section_level );
<font class='lnum'>4285</font>   		}
<font class='lnum'>4286</font>   	} # fi not the first section
<font class='lnum'>4287</font>   
<font class='lnum'>4288</font>   
<font class='lnum'>4289</font>   	# common operations		
<font class='lnum'>4290</font>   	unshift @headings, $section_id ;
<font class='lnum'>4291</font>   	$chunkbuf .= $folding_section_start1;
<font class='lnum'>4292</font>   	$chunkbuf .= "&lt;font class='lnum'&gt;&lt;i&gt;(" . $section_num . ")&lt;/i&gt;&lt;/font&gt;" . "&amp;nbsp;" . $section_title .
<font class='lnum'>4293</font>   	    "&lt;/a&gt;&amp;nbsp;&lt;a&gt;&lt;font class='lnum' size=-1&gt;&lt;sub&gt;&lt;i&gt;(line " .
<font class='lnum'>4294</font>   	    $line_counter . ")&lt;/i&gt;&lt;/sub&gt;&lt;/font&gt;"; 
<font class='lnum'>4295</font>   	$chunkbuf .= $folding_section_start2;
<font class='lnum'>4296</font>   
<font class='lnum'>4297</font>   	#$chunkbuf .= "\n" . "&lt;font class='lnum'&gt;&lt;i&gt;------ line " . $line_counter . 
<font class='lnum'>4298</font>   	#	    " ------&lt;/i&gt;&lt;/font&gt;&lt;br&gt;\n";
<font class='lnum'>4299</font>   
<font class='lnum'>4300</font>   
<font class='lnum'>4301</font>   	$toc_indent = "&amp;nbsp;" x ($section_level * 7);
<font class='lnum'>4302</font>   	#$toc_indent = "&amp;nbsp;" x (($section_level-1) * 7 );
<font class='lnum'>4303</font>   	#$tocbuf .= "\n&lt;p&gt;\n" if ( $section_level == 1 ); 
<font class='lnum'>4304</font>   	$tocbuf .= $toc_indent . 
<font class='lnum'>4305</font>   		"&lt;i&gt;" . $section_num . "&lt;/i&gt;" .
<font class='lnum'>4306</font>   		qq/&amp;nbsp;&lt;a href="javascript:;" onmousedown="toggleCombined(/ .  
<font class='lnum'>4307</font>   		$section_num . 
<font class='lnum'>4308</font>   		qq/);" id="toc/ . $section_num .
<font class='lnum'>4309</font>   		qq/"&gt;&lt;b&gt;/ .
<font class='lnum'>4310</font>   		$section_title . "&lt;/a&gt;&amp;nbsp;&lt;a&gt;&lt;font class='lnum' size=-1&gt;&lt;i&gt;(line " .
<font class='lnum'>4311</font>   		    $line_counter . ")&lt;/i&gt;&lt;/font&gt;" .
<font class='lnum'>4312</font>   		    "&lt;/b&gt;&lt;/a&gt;&lt;br&gt;\n";
<font class='lnum'>4313</font>   
<font class='lnum'>4314</font>      } #; fisle: end elif headings
<font class='lnum'>4315</font>   
<font class='lnum'>4316</font>   	
<font class='lnum'>4317</font>   
<font class='lnum'>4318</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('91');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('92');">
<font class='lnum'><i>(92)</i></font>&nbsp; dotHTML formatter and rawHTML </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4323)</i></sub></font></a></legend></fieldset>
<p>
<div id="92" style="display:none">   
<ul>


<p>
It is primitive, and I add needed markup "on the fly", as and when I need it.<br>
The idea is to eliminate angle brackets in html tags, which I cannot type without errors<br>
when typing fast, and substitute those with simple "dots", which do not requre switching<br>
keyboard registers.<br>
<p>
<s> This formatting also has problems with escapes.<br>
<p>
Whether it's the fault of HTML standards or their implementation, web browsers continue to<br>
react to html formatting <b>even inside the "pre" tags</b>, which is obviously insane.<br>
Therefore if your code chunks contain any HTML tags (e.g. processed by your code), you'll<br>
need to escape them to display correctly.<br>
And if you use sth like "&amp; g t ;" in your code, the web page will also lie to you.<br>
This is insane, and there is no good quick solution, one would have to use lengthy escape<br>
tables etc. etc. </s><br>
<p>
<ul> /* OFFTOPIC, ALSO: add &lt; &gt; and &amp; escapes to the weaved code chunks -- for proper display */<br>
    --- DONE ---<br>
    These escapes exist in two places in the Weaver code:<br>
    "process code sections"  and "body HTML formatters"<br>
</ul><br>
<p>
<br><br>
This prototype script fails in some (unimportant to me)  cases.<br>
dotHTML markup would also fail if your programming language uses dot-symbol-dot sequences<br>
Mine do not.<br>
<p>
The formatter is pretty straightforward, but sequencing of regexps is important.<br>
One also needs to remember that once escaped, angle brackets are non-existent any more, <br>
and so the subsequent regexps must match on "&amp; l t ;" not on the angle bracket in some<br>
cases.<br>
<p>
<p>
<font class='lnum'>4358</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>4359</font>   
<font class='lnum'>4360</font>   	elsif( $weave_markup eq "dotHTML" ) {	# dotHTML formatter here
<font class='lnum'>4361</font>   
<font class='lnum'>4362</font>   	      s/^=begin.*$//;	# - eliminate perl escaping, start
<font class='lnum'>4363</font>   	      s/^=cut.*$//;		# - eliminate perl escaping, end
<font class='lnum'>4364</font>      	      #s/^{{{\d+(.*)$/$1/;	# - eliminate vim folding markup, start 
<font class='lnum'>4365</font>   					# - dummy, as it is killed in "headings" processing 
<font class='lnum'>4366</font>   	      s/^}}}\d+//;	# - eliminate vim folding markup, end
<font class='lnum'>4367</font>   
<font class='lnum'>4368</font>   		s/&amp;/&amp;amp;/g;	# escape &amp;
<font class='lnum'>4369</font>   		s/&lt;/&amp;lt;/g;	# escape &lt;
<font class='lnum'>4370</font>   		s/&gt;/&amp;gt;/g;	# escape &gt;
<font class='lnum'>4371</font>   
<font class='lnum'>4372</font>   
<font class='lnum'>4373</font>   	      # Paragraphs and line breaks are automatic now:
<font class='lnum'>4374</font>   	      # ... unless we are dealing with the "preformat" tag
<font class='lnum'>4375</font>   		#--note! that ranges do not work here
<font class='lnum'>4376</font>   		$in_pre_tag = 1 if (m!\.pre\.!);
<font class='lnum'>4377</font>   		$in_pre_tag = 0 if (m!\./pre\.!);;
<font class='lnum'>4378</font>   
<font class='lnum'>4379</font>   		s/\.(\/?)pre\./&lt;$1pre&gt;/g;
<font class='lnum'>4380</font>   
<font class='lnum'>4381</font>   	    unless ($in_pre_tag) {
<font class='lnum'>4382</font>   	    (m/^\s*$/) and s/$_/&lt;p&gt;\n/
<font class='lnum'>4383</font>   	    or s/\n/&lt;br&gt;\n/;
<font class='lnum'>4384</font>   	    }
<font class='lnum'>4385</font>   </fieldset></pre>
<p>
Now the regexps to cut out "#--------" lines and substitute "dot-notation" with angle brackets:<br>
<p>
<font class='lnum'>4389</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>4390</font>   	      # originally I separated header from the body with such a line
<font class='lnum'>4391</font>   	      #s/^#-----.*/starting the table here/;
<font class='lnum'>4392</font>   	      s/^#-----.*//;
<font class='lnum'>4393</font>   
<font class='lnum'>4394</font>   
<font class='lnum'>4395</font>   		# add more here
<font class='lnum'>4396</font>   
<font class='lnum'>4397</font>   		s/\.(\/?)b\./&lt;$1b&gt;/g;
<font class='lnum'>4398</font>   		s/\.(\/?)i\./&lt;$1i&gt;/g;
<font class='lnum'>4399</font>   		s/\.(\/?)ul\./&lt;$1ul&gt;/g;
<font class='lnum'>4400</font>   		s/\.(\/?)li\./&lt;$1li&gt;/g;
<font class='lnum'>4401</font>   		s/\.(\/?)ol\./&lt;$1ol&gt;/g;
<font class='lnum'>4402</font>   		s/\.(\/?)s\./&lt;$1s&gt;/g;
<font class='lnum'>4403</font>   		s/\.(\/?)div\./&lt;$1div&gt;/g;
<font class='lnum'>4404</font>   		s/\.br\./&lt;br&gt;/g;
<font class='lnum'>4405</font>   		s/\.p\./&lt;p&gt;/g;
<font class='lnum'>4406</font>   		s/\.sp\./&amp;nbsp;/g;
<font class='lnum'>4407</font>   
<font class='lnum'>4408</font>   		s/\.(\/?)tab\./&lt;$1ul&gt;/g;	# "tabbing" with "ul"
<font class='lnum'>4409</font>   
<font class='lnum'>4410</font>   
<font class='lnum'>4411</font>   		# this is some bullshit ???
<font class='lnum'>4412</font>   		s/\.hr\./&lt;hr /g;
<font class='lnum'>4413</font>   		s/\.\/hr\./&gt;/g;
<font class='lnum'>4414</font>   
<font class='lnum'>4415</font>   		s!\.a\.(.+?)\.\/a\.!&lt;a href=$1&gt;$1&lt;/a&gt;!g;
<font class='lnum'>4416</font>   
<font class='lnum'>4417</font>   		# rudimentary &amp;nbsp; s p a c i n g &amp;nbsp (one word only)
<font class='lnum'>4418</font>   		#s!\.x\.(.+?)\./x\.!join " ","&amp;nbsp;&amp;nbsp;",(split //, $1),"&amp;nbsp;&amp;nbsp;"!eg;
<font class='lnum'>4419</font>   
<font class='lnum'>4420</font>   		# slightly better spacing (phrases, too):
<font class='lnum'>4421</font>   		# although redundant  with more work than is needed
<font class='lnum'>4422</font>   		if ( m!(\.x\.)(.+?)(\./x\.)!g) {
<font class='lnum'>4423</font>   		    s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>4424</font>   		    s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>4425</font>   		    s!  _  ! &amp;nbsp; !g;
<font class='lnum'>4426</font>   		}
<font class='lnum'>4427</font>   </fieldset></pre>
<p>
<b> BUG! </b> This URL breaks my "ancor" dot-tags: <br>
     <pre> http://www.cs.tufts.edu/~nr/noweb </pre><br>
<b> Got it </b> The substitutions above must explicitly use "slash" for the closing HTML tag<br>
in the regexps - otherwise they match stuff like ".cs." inside URLs<br>
<p>
If an HTML tag is not in the above chunk, either add it or write with the two following generic<br>
tags (slow and not nice on your fingers, though). You might need to use them also when your HTML<br>
tag conntains some options, and so is not of generic simple type.<br>
<p>
<font class='lnum'>4438</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>4439</font>   
<font class='lnum'>4440</font>   
<font class='lnum'>4441</font>   		# generic for all tags with options
<font class='lnum'>4442</font>   		s!\.&amp;lt;\. !&lt;!g;
<font class='lnum'>4443</font>   		s! \.&amp;gt;\.!&gt;!g;
<font class='lnum'>4444</font>   
<font class='lnum'>4445</font>   
<font class='lnum'>4446</font>   		$chunkbuf .= $_;
<font class='lnum'>4447</font>   
<font class='lnum'>4448</font>   	}
<font class='lnum'>4449</font>   </fieldset></pre>
<p>
<p>
<b> rawHTML formatter</b><br>
Raw HTML formatting can be done - either because it is non-restricted, compared to the stripped-down<br>
"dotHTML" of my invention, or because it allows one to convert existing HTML documentation into the<br>
folding format.<br>
I.e. if you have a longish manual in which section headings are marked with HTML h1, h2, h3, ... tags,<br>
you can convert it in 3 simple steps:<br>
<ul> <li> delete opening and closing "html" and "head" "body" tags at the very top and bottom of your <br>
document<br>
</li> <li> put perl invocation as the first line<br>
</li> <li> set up markup mode in a variable: "$weave_markup = "rawHTML";" and "mollify" the document,<br>
putting  "do MOLLY.pl" and DATA marker<br>
</li> </ul><br>
and if there are no interfering div section etc. - no complicated markup inside the headings, you'll get<br>
an automatically generated folding HTML document.<br>
<p>
If you do, it is sometimes easy to clean headings with a few regexps in a good editor like Vim<br>
<p>
It is very convenient and I keep large manuals as folding HTML documents.<br>
<p>
<p>
<font class='lnum'>4472</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>4473</font>   	elsif( $weave_markup eq "rawHTML" ) {	# if the doc chunks marked up with real HTML
<font class='lnum'>4474</font>   		s!^#-----.*!!;
<font class='lnum'>4475</font>   
<font class='lnum'>4476</font>   	      #s/^{{{\d+(.*)$/$1/;	# - eliminate vim folding markup, start 
<font class='lnum'>4477</font>   					# - dummy, as it's killed in "headings" processing 
<font class='lnum'>4478</font>   	      s/^}}}\d+//;	# - eliminate vim folding markup, end
<font class='lnum'>4479</font>   
<font class='lnum'>4480</font>   
<font class='lnum'>4481</font>   	      # Paragraphs and line breaks are automatic now:
<font class='lnum'>4482</font>   	      # ... unless we are dealing with the "preformat" tag
<font class='lnum'>4483</font>   		#--note! that ranges do not work here
<font class='lnum'>4484</font>   		$in_pre_tag = 1 if (m!&lt;pre&gt;!);
<font class='lnum'>4485</font>   		$in_pre_tag = 0 if (m!&lt;/pre&gt;!);;
<font class='lnum'>4486</font>   
<font class='lnum'>4487</font>   
<font class='lnum'>4488</font>   		unless ($in_pre_tag) {
<font class='lnum'>4489</font>   		(m/^\s*$/) and s/$_/&lt;p&gt;\n/
<font class='lnum'>4490</font>   		or s/\n/&lt;br&gt;\n/;
<font class='lnum'>4491</font>   		}
<font class='lnum'>4492</font>   
<font class='lnum'>4493</font>   
<font class='lnum'>4494</font>   		$chunkbuf .= $_;
<font class='lnum'>4495</font>   	} # esle -- for rest of the body
<font class='lnum'>4496</font>   
<font class='lnum'>4497</font>   
<font class='lnum'>4498</font>   
<font class='lnum'>4499</font>   </fieldset></pre>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('93');">
<font class='lnum'><i>(93)</i></font>&nbsp; test of &nbsp;&nbsp; s p a c i n g &nbsp;&nbsp; regexp </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4501)</i></sub></font></a></legend></fieldset>
<p>
<div id="93" style="display:none">   
<ul>

<p>
1. Hell, the thing is multiple sp /sp markups on one line. I need to iterate over<br>
each separately and then put them in their right places, hedging with "nbsp"-ces each word.<br>
<p>
2. The invocation is OK for $str_sp, but for boundaries of the string and word boundaries, <br>
they must be hedged too<br>
<p>
3. Could subst spaces-betwen-words to sth like _ (space-underscore-space) as placeholders,<br>
then subst them into nbspx2 in a following regexp<br>
<p>
4. This tagging can be done cleanly and span severl lines if I do it in a different place - <br>
not while still reading the Literate Source file line by line,  &nbsp;  b u t  &nbsp;  l a t e r  &nbsp;  when<br>
$chunkbuf is completely formed in RAM.<br>
<p>
<p>
<font class='lnum'>4517</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;spacing.pl&gt;&gt;=</legend>
<font class='lnum'>4518</font>   #!/usr/bin/perl
<font class='lnum'>4519</font>   #
<font class='lnum'>4520</font>   $str = $ARGV[0];
<font class='lnum'>4521</font>   $str_sp = $ARGV[0];
<font class='lnum'>4522</font>   #print "string is $str\n";
<font class='lnum'>4523</font>   
<font class='lnum'>4524</font>       # "sp" dot-markup to intersperse spaces: the basic formula
<font class='lnum'>4525</font>       #$spaced_str =~ s!(asdf)!join " ", (split //, $1)!eg;
<font class='lnum'>4526</font>       #
<font class='lnum'>4527</font>       
<font class='lnum'>4528</font>       # -- idea 3 from above: this works but is cumbersome --
<font class='lnum'>4529</font>       #$str_sp =~ s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>4530</font>       #$str_sp =~ s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>4531</font>       #$str_sp =~ s! _ ! &amp;nbsp;&amp;nbsp; !g;
<font class='lnum'>4532</font>   
<font class='lnum'>4533</font>       # -- first get the matching string in "if", then massage it:
<font class='lnum'>4534</font>       if ($str_sp =~ m!(\.x\.)(.+?)(\./x\.)!g) {
<font class='lnum'>4535</font>   	$str_sp =~ s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>4536</font>           $str_sp =~ s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>4537</font>   	$str_sp =~ s!  _  ! &amp;nbsp; !g;
<font class='lnum'>4538</font>       }
<font class='lnum'>4539</font>   
<font class='lnum'>4540</font>       #print "\nthe string is $str\n";
<font class='lnum'>4541</font>       print "\nthe str_sp is $str_sp\n\n";
<font class='lnum'>4542</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('93');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('92');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('89');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('94');">
<font class='lnum'><i>(94)</i></font>&nbsp; Print out the resulting page </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4552)</i></sub></font></a></legend></fieldset>
<p>
<div id="94" style="display:none">   
<ul>


<p>
Page and the outer formatting table:<br>
<p>
<font class='lnum'>4557</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4558</font>   
<font class='lnum'>4559</font>     # begin the page:
<font class='lnum'>4560</font>     #print '&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;', "\n";
<font class='lnum'>4561</font>     print "&lt;html&gt;\n  $html_head\n &lt;body&gt;  $html_body_table \n";
<font class='lnum'>4562</font>   
<font class='lnum'>4563</font>     # print out the TOC, the Chunks Index, the output buffer and close the page.
<font class='lnum'>4564</font>   
<font class='lnum'>4565</font>   </fieldset></pre>
<p>
Next print the short instructions section (collapsible) at the top:<br>
<p>
<font class='lnum'>4569</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4570</font>   
<font class='lnum'>4571</font>   print &lt;&lt;end_of_print;
<font class='lnum'>4572</font>   &lt;p&gt;&lt;fieldset class='tocfieldset'&gt;&lt;legend&gt;&lt;b&gt;TABLE OF CONTENTS: outline of the document structure&lt;/b&gt;&lt;/legend&gt;
<font class='lnum'>4573</font>   
<font class='lnum'>4574</font>   &lt;ul&gt;
<font class='lnum'>4575</font>   &lt;p&gt;
<font class='lnum'>4576</font>   &lt;br&gt;
<font class='lnum'>4577</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>4578</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('tochowto');"&gt;
<font class='lnum'>4579</font>   &lt;b&gt;HOW TO USE THE FOLDING DOCUMENT [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>4580</font>   &lt;/div&gt;
<font class='lnum'>4581</font>   &lt;div id='tochowto' style='display:none' style='background:#ffffff'&gt; 
<font class='lnum'>4582</font>   &lt;p&gt;
<font class='lnum'>4583</font>   &lt;ul&gt;
<font class='lnum'>4584</font>   &lt;li&gt;&lt;b&gt;Collapsing is necessary when&lt;/b&gt; you work on some code and must exclude 
<font class='lnum'>4585</font>   &lt;br&gt;irrelevant sections of the rest of the literate project file. This 
<font class='lnum'>4586</font>   &lt;br&gt;greatly helps to clear thinking by eliminating a general feeling of 
<font class='lnum'>4587</font>   &lt;br&gt;being in a maze of code and unnecessary "housekeeping" tasks.
<font class='lnum'>4588</font>   &lt;br&gt;One can say that there is a limited "buffer capacity" in the human
<font class='lnum'>4589</font>   &lt;br&gt;mind, and relieving it of the need to remember where things are in a 
<font class='lnum'>4590</font>   &lt;br&gt;larger file, at which other points one must fill in values or adjust
<font class='lnum'>4591</font>   &lt;br&gt;invocation etc. &lt;i&gt;immediately makes the user "more intelligent"&lt;/i&gt;
<font class='lnum'>4592</font>   &lt;/li&gt;&lt;li&gt;&lt;b&gt;To toggle&lt;/b&gt; a section open/closed, click on the corresponding link
<font class='lnum'>4593</font>   &lt;br&gt;Remember to open &lt;i&gt;all sections above it&lt;/i&gt; for it to become visible.
<font class='lnum'>4594</font>   &lt;/li&gt;&lt;li&gt;&lt;b&gt;To restore the default view&lt;/b&gt; reload the page in the browser.
<font class='lnum'>4595</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>4596</font>   &lt;b&gt;To keep some sections open&lt;/b&gt; upon each reload - 
<font class='lnum'>4597</font>   &lt;br&gt;e.g. you work on the code, update it constantly and cannot reopen it 
<font class='lnum'>4598</font>   &lt;br&gt;again and again - mark their sections in the source file with a plus, 
<font class='lnum'>4599</font>   &lt;br&gt;i.e. write the opening tag (only)  as +h2, +h3 (in &amp;lt; &amp;gt;  or in dots
<font class='lnum'>4600</font>   &lt;br&gt;for dotHTML). Again, all sections above must be marked open too. 
<font class='lnum'>4601</font>   &lt;p&gt;&lt;b&gt;Note that&lt;/b&gt; "expand all" and "collapse all" disregard these settings.
<font class='lnum'>4602</font>   &lt;br&gt;Reload the page after using those options to again view the text according 
<font class='lnum'>4603</font>   &lt;br&gt;to your preferences.
<font class='lnum'>4604</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>4605</font>   &lt;b&gt; To use the Index &lt;/b&gt;, click on the numbered sections in the TOC above
<font class='lnum'>4606</font>   &lt;br&gt;(opening them; use highlighting as a guide; when sections are visible,
<font class='lnum'>4607</font>   &lt;br&gt;the slider on your browser window  will shorten too), or "expand all", 
<font class='lnum'>4608</font>   &lt;br&gt;and then use your browser's Find function to highlight all chunk name 
<font class='lnum'>4609</font>   &lt;br&gt;instances in the visible text
<font class='lnum'>4610</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>4611</font>   &lt;b&gt;To search for variables etc.&lt;/b&gt;, "expand all" text - or manually 
<font class='lnum'>4612</font>   &lt;br&gt;expand needed sections - and then use your browser's Find function to 
<font class='lnum'>4613</font>   &lt;br&gt;highlight all and jump between the found items.
<font class='lnum'>4614</font>   &lt;p&gt;&lt;/li&gt;
<font class='lnum'>4615</font>   
<font class='lnum'>4616</font>   &lt;/div&gt; 
<font class='lnum'>4617</font>   &lt;p&gt;
<font class='lnum'>4618</font>   &lt;br&gt;
<font class='lnum'>4619</font>   &lt;p&gt;
<font class='lnum'>4620</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>4621</font>   &lt;!--i&gt;&lt;font size=-3&gt; expand all -- collapse all&lt;/font&gt;&lt;/i--&gt;
<font class='lnum'>4622</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('tocmain');"&gt;
<font class='lnum'>4623</font>   &lt;b&gt;TABLE OF CONTENTS [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>4624</font>   &lt;/div&gt;
<font class='lnum'>4625</font>   
<font class='lnum'>4626</font>   &lt;div id='tocmain' style='display:$toc_expanded' style='background:#ffffff'&gt; 
<font class='lnum'>4627</font>   &lt;p&gt;
<font class='lnum'>4628</font>   &lt;br&gt;
<font class='lnum'>4629</font>   &lt;p&gt;
<font class='lnum'>4630</font>   end_of_print
<font class='lnum'>4631</font>   
<font class='lnum'>4632</font>   </fieldset></pre>
<p>
Table of Contents from the formed "tocbuf":<br>
<p>
<font class='lnum'>4636</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4637</font>   
<font class='lnum'>4638</font>    print "$tocbuf" if $print_toc;
<font class='lnum'>4639</font>    #print "$tocbuf";
<font class='lnum'>4640</font>   
<font class='lnum'>4641</font>   print "&lt;/div&gt;\n";
<font class='lnum'>4642</font>   
<font class='lnum'>4643</font>   </fieldset></pre>
<p>
Start the "Index of code chunks", collapsible:<br>
<p>
<font class='lnum'>4647</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4648</font>   
<font class='lnum'>4649</font>   print &lt;&lt;end_of_print;
<font class='lnum'>4650</font>   &lt;p&gt;
<font class='lnum'>4651</font>   &lt;br&gt;
<font class='lnum'>4652</font>   &lt;p&gt;
<font class='lnum'>4653</font>   &lt;!--fieldset&gt;&lt;legend--&gt;
<font class='lnum'>4654</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>4655</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('indbuf');"&gt;
<font class='lnum'>4656</font>   &lt;b&gt;INDEX of Code Chunks [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>4657</font>   &lt;/div&gt;
<font class='lnum'>4658</font>   &lt;!--/legend&gt;&lt;/fieldset--&gt;
<font class='lnum'>4659</font>   &lt;p&gt;
<font class='lnum'>4660</font>   &lt;div id='indbuf' style='display:$ind_expanded' style='background:#ffffff'&gt; 
<font class='lnum'>4661</font>   &lt;ul&gt;
<font class='lnum'>4662</font>   &lt;p&gt;
<font class='lnum'>4663</font>   &lt;b&gt;"Def" subscript&lt;/b&gt; means the chunk is defined, while a bare number means 
<font class='lnum'>4664</font>   &lt;br&gt;the chunk is being used in the given section.
<font class='lnum'>4665</font>   &lt;p&gt;
<font class='lnum'>4666</font>   end_of_print
<font class='lnum'>4667</font>   
<font class='lnum'>4668</font>   </fieldset></pre>
<p>
<p>
Index of code chunks; calculated in this snippet:<br>
<p>
<font class='lnum'>4673</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4674</font>   
<font class='lnum'>4675</font>   	 $ind_outbuf = '';
<font class='lnum'>4676</font>   	 $prev_ch_name = '';
<font class='lnum'>4677</font>   
<font class='lnum'>4678</font>   	 #for (sort @indbuf){ print $_, "&lt;br&gt;";}
<font class='lnum'>4679</font>   
<font class='lnum'>4680</font>   	 for (sort @indbuf){
<font class='lnum'>4681</font>   
<font class='lnum'>4682</font>   	   ($ch_name, $closing_bracket, $ref_num) = split /&amp;gt;/, $_; 
<font class='lnum'>4683</font>   		#/ - for editor colouring bug
<font class='lnum'>4684</font>   
<font class='lnum'>4685</font>   	    if ( $ch_name eq $prev_ch_name ){ 
<font class='lnum'>4686</font>   	      $ind_outbuf .= " &lt;b&gt;" . $ref_num . "&lt;/b&gt; ";
<font class='lnum'>4687</font>   	    }
<font class='lnum'>4688</font>   	    else{
<font class='lnum'>4689</font>   	      print  $ind_outbuf, "&lt;br&gt;\n"; 
<font class='lnum'>4690</font>   	      $ch_namestr = $ch_name;
<font class='lnum'>4691</font>   	      $ch_namestr =~ s!&amp;lt;&amp;lt;!!;
<font class='lnum'>4692</font>   	      $ind_outbuf = 
<font class='lnum'>4693</font>   	      	"&lt;b&gt;&amp;lt;&amp;lt;&lt;/b&gt;&lt;font class='chunkref'&gt;" . 
<font class='lnum'>4694</font>   	      	$ch_namestr . 
<font class='lnum'>4695</font>   	      	"&lt;/font&gt;&lt;b&gt;&amp;gt;&amp;gt;&lt;/b&gt; -- &lt;b&gt;" . 
<font class='lnum'>4696</font>   	      	$ref_num . 
<font class='lnum'>4697</font>   	      	"&lt;/b&gt; ";
<font class='lnum'>4698</font>   	    }
<font class='lnum'>4699</font>   	    $prev_ch_name = $ch_name;
<font class='lnum'>4700</font>   
<font class='lnum'>4701</font>   	 }; # rof - forming the code chunks index
<font class='lnum'>4702</font>   
<font class='lnum'>4703</font>   	print $ind_outbuf, "&lt;br&gt;\n";
<font class='lnum'>4704</font>   
<font class='lnum'>4705</font>   </fieldset></pre>
<p>
<p>
"expand all" and "collapse all" at the end of the TOC/Chunk Index section <br>
at the top of the page:<br>
<p>
<font class='lnum'>4711</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4712</font>   
<font class='lnum'>4713</font>     # The "expand all" "collapse all" control
<font class='lnum'>4714</font>   
<font class='lnum'>4715</font>   print &lt;&lt;end_of_print;
<font class='lnum'>4716</font>   &lt;/div&gt;\n&lt;p&gt;
<font class='lnum'>4717</font>   &lt;br&gt;
<font class='lnum'>4718</font>   &lt;p&gt;&lt;div class='hl' align=center&gt;&lt;i&gt;
<font class='lnum'>4719</font>   &lt;a href="javascript:;" onmousedown="showAll();"&gt;
<font class='lnum'>4720</font>   expand all&lt;/a&gt; -- 
<font class='lnum'>4721</font>   &lt;a href="javascript:;" onmousedown="hideAll();"&gt;
<font class='lnum'>4722</font>   collapse all&lt;/a&gt;
<font class='lnum'>4723</font>   &lt;/i&gt;&lt;/div&gt;&lt;p&gt;
<font class='lnum'>4724</font>   end_of_print
<font class='lnum'>4725</font>   
<font class='lnum'>4726</font>   
<font class='lnum'>4727</font>    print "&lt;/ul&gt;&lt;/fieldset&gt;&lt;p&gt;\n&lt;br&gt;";
<font class='lnum'>4728</font>   
<font class='lnum'>4729</font>   </fieldset></pre>
<p>
<p>
<p>
..and the document itself, formed earlier in the "chunkbuf" string in memory:<br>
<p>
<font class='lnum'>4735</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4736</font>   
<font class='lnum'>4737</font>   # The FULL OUTPUT, the file body:
<font class='lnum'>4738</font>    	print $chunkbuf;
<font class='lnum'>4739</font>   
<font class='lnum'>4740</font>   </fieldset></pre>
<p>
Close the HTML formatting tags at the end of the page:<br>
<p>
<font class='lnum'>4744</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>4745</font>   
<font class='lnum'>4746</font>   # close the page
<font class='lnum'>4747</font>   	print $html_body_table_end;
<font class='lnum'>4748</font>   	
<font class='lnum'>4749</font>   exit;
<font class='lnum'>4750</font>   
<font class='lnum'>4751</font>   #--- END OF SCRIPT ---
<font class='lnum'>4752</font>   
<font class='lnum'>4753</font>   </fieldset></pre>
<p>
End of the project file<br>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('94');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('81');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('95');">
<font class='lnum'><i>(95)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4762)</i></sub></font></a></legend></fieldset>
<p>
<div id="95" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('95');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('96');">
<font class='lnum'><i>(96)</i></font>&nbsp; ADD-ON: example of additional markup - dotHTML - change unfinished</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4765)</i></sub></font></a></legend></fieldset>
<p>
<div id="96" style="display:none">   
<ul>


<p>
<i> This subsection is a good example of the "out-of-order" processing that is<br>
enabled in Literate Programming. Pieces for this subsection come from different<br>
parts of the script and are laid out logically rather than in the order imposed<br>
by the machine </i><br>
<p>
<b> <i> Notes </i> </b><br>
<ul><br>
Implementation of a simple "dotHTML" markup  in which angle brackets are substituted<br>
with dots for some of the commonest HTML tags (to speed up typing and eliminate typos).<br>
<p>
To add your own markup, such as "wiki" or one of the "markdowns", copy this section<br>
and adjust contents. The idea is that MOLLY iterates over documentation sections<br>
line by line, so your filter can use regular expressions for a line-by-line processing<br>
of the documentation chunk text.<br>
<p>
Make sure your new "markdown" does not interfere with the 3 major escapes used in <br>
the "mollified" Literate Source file: the double angle brackets and the "at" symbol<br>
(imposed by "noweb" tools markup) and the double backticks ( MathML interpretation<br>
if you enable it) plus words "a m a t h" and "e n d a m a t h" without spaces btw letters.<br>
</ul><br>
<p>
<p>
<b> <i> ...unfinished... </i> </b><br>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('96');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('97');">
<font class='lnum'><i>(97)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4794)</i></sub></font></a></legend></fieldset>
<p>
<div id="97" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('97');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('98');">
<font class='lnum'><i>(98)</i></font>&nbsp; ADD-ON: ASCIIMathML and LaTeXMathML inside Molly  </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4797)</i></sub></font></a></legend></fieldset>
<p>
<div id="98" style="display:none">   
<ul>


<p>
<b> 1 </b> <i> STATUS </i> - Ok, but may be brittle if escapes (double backticks)<br>
get in conflict with the target prog language or some "markdown" <br>
introduced later into Molly.<br>
<p>
Also - may have lost LaTex functionality because of my need to<br>
preserve $ for programming language use.<br>
<p>
<b> WILL NEED TO DISTRIBUTE THE MODIFIED LIBRARY NOW with Molly </b><br>
<p>
<b> 2  Implementation </b><br>
.. was straightforward: I simply cut in an invocation of ASCIIMathML.js into the header of <br>
my generated output folding-HTML file. That's it.<br>
<p>
Then I tested the lib and found that it reacts to backticks and $ signs in my code sections etc.<br>
Then I made a customized copy.<br>
<p>
If some symbols are missing, you can customize it by simply adding a line to teh MOLLY.weave<br>
source code and re-tangling the MOLLY.pl<br>
<p>
Here is how:<br>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('99');">
<font class='lnum'><i>(99)</i></font>&nbsp; Extending the lib with missing LaTeX or HTML symbols </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4821)</i></sub></font></a></legend></fieldset>
<p>
<div id="99" style="display:none">   
<ul>

<p>
Documentation to the library explains how to add lines in JavaScript to your html file which will<br>
extend the list of symbols known to the library.<br>
<a href= http://www1.chapman.edu/~jipsen/mathml/asciimathextend.html  > http://www1.chapman.edu/~jipsen/mathml/asciimathextend.html  </a><br>
A copy of the page:<br>
<ul><br>
<b>ASCIIMathML.js: Extending the symbol table</b><br>
<p>
The standard symbol table of ASCIIMathML.js does not contain many symbols. <br>
It can be extended by adding additional symbols on any webpage that requires<br>
them. This is done by adding a few lines of JavaScript code.<br>
<p>
<b> 1. For example </b> , suppose we want to add symbols for "not less or equal"<br>
    and "not greater or equal".<br>
<p>
<ul> <li> We first have to find the four-digit hexadecimal Unicode value for these symbols<br>
by looking them up at, say, <br>
<a href= http://www.w3.org/TR/MathML2/chapter6.html#chars.entity.tables > http://www.w3.org/TR/MathML2/chapter6.html#chars.entity.tables </a><br>
<p>
</li> <li> Next we have to decide what input strings we want to associate with these<br>
symbols, say "!&lt;=" and "!&gt;=".<br>
<p>
</li> <li> Finally we add the following lines to the head or body of our HTML file:<br>
<pre>
&lt;script type="text/javascript"&gt;
define("!&lt;=","\u2270")
define("!&gt;=","\u2271")
&lt;/script&gt;
</pre><br>
</li> </ul><br>
<p>
Here we test the modified symbol table: a !&lt;= b !&gt;= c produces ``a !&lt;= b !&gt;= c``<br>
<p>
<b> 2. To add a symbol to the LaTeX commands </b>, use the following alternate syntax:<br>
<p>
<pre>
&lt;script type="text/javascript"&gt;
newcommand("\\nle","\u2270")
newcommand("\\nge","\u2271")
&lt;/script&gt;
</pre><br>
<p>
Now \$a \nle b \nge c\$ produces $a \nle b \nge c$.<br>
<p>
<p>
<b> 3. If you know the numeric entity reference </b>  of the symbol you want <br>
to use on an ASCIIMathML webpage, you can also refer to the symbol <b> directly </b> <br>
by using that reference. <br>
<p>
E.g &amp;#x2270; produces  ``&amp;#x2270;`` . If a symbol is only used occasionally, this is certainly <br>
the simplest way to include it. <br>
</ul><br>
<p>
<i> /error/ My copy of the page in MOLLY does not let ampersand invocations through <br>
ALSO: my copy of the lib, in which I mechanically changed single backticks to double backticks<br>
may have clobbered something, too.<br>
CHECK IT. </i><br>
<p>
Therefore, <b> to extend it in MOLLY </b>, just continue this chunk here (the "script .." --- "/script"<br>
tags are already provided in the code, do NOT retype them, input only the contents):<br>
<p>
<font class='lnum'>4883</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;HTML head section javascript add-ons&gt;&gt;=</legend>
<font class='lnum'>4884</font>   
<font class='lnum'>4885</font>   //type in commands to extend ASCIIMathML.js here;
<font class='lnum'>4886</font>   // no "script" "/script" wrappers needed
<font class='lnum'>4887</font>   // ....NOT FUNCTIONAL YET.....
<font class='lnum'>4888</font>   
<font class='lnum'>4889</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('99');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('100');">
<font class='lnum'><i>(100)</i></font>&nbsp; MathML and Molly -- inclusion of ASCIIMathML.js -- testing - OK partially </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4894)</i></sub></font></a></legend></fieldset>
<p>
<div id="100" style="display:none">   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('101');">
<font class='lnum'><i>(101)</i></font>&nbsp; test one - simple </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4898)</i></sub></font></a></legend></fieldset>
<p>
<div id="101" style="display:none">   
<ul>


<p>
Let's test if it works by adding some formulae here:<br>
<b> I changed the ASCIIMathML.js to use <i> double backticks </i> as escapes </b><br>
So strings wrapped in double-backticks or chunks of text with formulae inside<br>
"a m a t h" .... "e n d a m a t h" are the only ones that should be interpreted.<br>
<p>
NOTE: they appear in blue, so errors, if the math lib picks up other parts of <br>
your LitProg file unnecessarily and mangles them, one could see it with<br>
"expand all" and checking for blue insertions.<br>
<p>
NOTE 2: the math lib stops working between the "pre" - "/pre" tags<br>
<p>
NOTE 3: Rolling the mouse over the interpreted formula will display<br>
a baloon with the ascii coding of the expression (very convenient)<br>
<p>
<ul><br>
Let's try some interesting formulas: ``E=m c^2``<br>
and ``e^(i pi)=-1`` <br>
and ``AA x in CC (sin^2x+cos^2x=1)`` <br>
and one more: ``sum_(i=1)^n i^3=((n(n+1))/2)^2``<br>
<p>
(add your own -- note that text-tokens are only recognized if separated by spaces)<br>
</ul><br>
OK, here we are - in between 2 math sections<br>
<p>
<ul><br>
<p>
amath<br>
Example: Solving the quadratic equation.<br>
Suppose a x^2+b x+c=0 and a!=0. We first divide by \a to get x^2+b/a x+c/a=0. <br>
<p>
Then we complete the square and obtain x^2+b/a x+(b/(2a))^2-(b/(2a))^2+c/a=0. <br>
The first three terms factor to give (x+b/(2a))^2=(b^2)/(4a^2)-c/a.<br>
Now we take square roots on both sides and get x+b/(2a)=+-sqrt((b^2)/(4a^2)-c/a).<br>
<p>
Finally we move the b/(2a) to the right and simplify to get <br>
the two solutions: x_(1,2)=(-b+-sqrt(b^2-4a c))/(2a) <br>
endamath<br>
<p>
</ul><br>
<p>
..and now let's check some LaTeX constants:<br>
<ul><br>
<pre> \int &nbsp; \oint &nbsp; \partial &nbsp; \nabla </pre> <br>
``\int`` &nbsp; ``\oint`` &nbsp; ``\partial`` &nbsp; ``\nabla``<br>
<pre> \pm &nbsp; \emptyset &nbsp; \infty &nbsp; \aleph </pre><br>
``\pm`` &nbsp; ``\emptyset`` &nbsp; ``\infty`` &nbsp; ``\aleph`` <br>
<pre> |\ldots| &nbsp; |\cdots| </pre><br>
``|\ldots|`` &nbsp; ``|\cdots|`` <br>
<pre> |\ | &nbsp; |\quad| &nbsp; \diamond </pre><br>
&nbsp; ``|\ |`` &nbsp; ``|\quad|`` &nbsp; ``\diamond`` <br>
</ul> <br>
<p>
<i> <b> end of math test </b> </i><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('101');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('102');">
<font class='lnum'><i>(102)</i></font>&nbsp; test two - from realistic paper, partially failing  </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 4958)</i></sub></font></a></legend></fieldset>
<p>
<div id="102" style="display:none">   
<ul>


<p>
<hr width=30% align=left><br>
<p>
<b> ..MORE from some paper: </b><br>
<p>
<b> 1. Freudental Formula </b><br>
``mult(\xi)=\frac{2}{(\mu+\rho|\mu+\rho)-(\xi+\rho|\xi+\rho)}\sum_{\alpha\in\Delta^{+}} mult(\alpha) \sum_{k=1}^{\infty}mult(\xi+k\alpha)(\xi+k\alpha|\alpha)``<br>
It includes roots ``\Delta=\left\{k\delta+\alpha|k\in Z,\; \alpha\in \Delta_0\right\}``<br>
positive roots ``\Delta^{+}=\{k\delta+\alpha|k\geq 0,\; \alpha\in \Delta_0^{+}\}\cup \{k\delta+\alpha|k\geq 1,\; \alpha\in \Delta_0\setminus \Delta_0^{+}\}``<br>
<p>
<b> The above is rendered correctly by ASCIIMathML.js and LaTeXMathML.js </b> <br>
libraries from the standalone Editor.It is rendered correctly with <br>
ASCIIMathML_with_modified_escapes.js from Molly <br>
(Testing with LaTeXMathML.js requires wrapping the formulas in dollar signs)<br>
<p>
<p>
<b> 2. The following long formulas <i> fail on both </i> ASCII and LaTeX libraries </b> tested<br>
from the standalone Editor and ASCII_with_modified_escapes from Molly<br>
The number of incorrect renderings is small (1 or 2 elements left unrendered), and<br>
suggests those elemens are simply missing in definitions.<br>
<p>
<p>
 The idea is to use recurrent relations for anomalous branching<br>
coefficients based on the summation over the special set of vectors <br>
``\Gamma_{\fr ak{a}\subset \fr ak{g}}``  called ````fan''. We<br>
need to introduce some notations. Let's consider the reduction of the<br>
representation of the affine Lie algebra ``\math \fr ak{g}`` to <br>
representations of affine Lie algebra ``\math \fr ak{a}``. By<br>
``\pi_{\math \fr ak{a}}`` we denote the projection of the root space<br>
``\fr ak{h}_{\fr ak{g}}^{\ast } to \fr ak{h}_{\fr ak{a}}^{\ast }``. The<br>
set ``\Gamma_{\fr ak{a}\subset \fr ak{g}}``  is introduced as the<br>
combination of projection of positive roots ``\Delta^{+}`` of algebra<br>
``\fr ak{g}`` using formulae:<br>
<p>
<b> <i> The above paragraph is OK </i> </b><br>
The following is rendered incompletely:<br>
<p>
{eq:7}<br>
<p>
 ``\prod_{\alpha \in \left( \pi _{\fr ak{a}}\circ \Delta ^{+}\right) }\left( 1-e^{-\alpha }\right) ^{\mathrm{{mult}\left( \alpha \right) -{mult}}_{\fr ak{a% }}\mathrm{\left( \alpha \right) }}=-\sum_{\gamma \in \Phi _{\fr ak{a}\subset \fr ak{g}}}s\left( \gamma \right) e^{-\gamma }``.  <br>
<p>
 {{{5<br>
<p>
{eq:18}<br>
<p>
 `` \Phi _{\frak{a}\subset \frak{g}}=\left\{ \gamma \in P_{\frak{a}}\mid s\left( \gamma \right) \neq 0\right\} ``;  <br>
<p>
<p>
{eq:19}<br>
<p>
 `` \Gamma_{\frak{a}\subset \frak{g}}=\left\{ \xi -\gamma _{0}|\xi \in \Phi _{% \frak{a}\subset \frak{g}}\right\} \setminus \left\{ 0\right\} .`` <br>
<p>
<p>
{recurrent-relation}<br>
<p>
``  k_{\xi }^{\left( \mu \right) }=-\frac{1}{s\left( \gamma _{0}\right) }\left( \sum_{w\in W}\epsilon \left( w\right) \delta _{\xi ,\pi _{\frak{a}}\circ \left( w\circ (\mu +\rho )-\rho \right) +\gamma _{0}}+\sum_{\gamma \in \Gamma _{\frak{a}\subset \frak{g}}}s\left( \gamma +\gamma _{0}\right) k_{\xi +\gamma }^{\left( \mu \right) }\right)   <br>
``<br>
{{{5<br>
<p>
Fan doesn't depend on the module, but<br>
is determined by the injection of sub-algebra into the algebra. If <br>
sub-algebra is Cartan sub-algebra, this relation gives...<br>
<p>
<p>
<p>
<p>
<hr width=30% align=left><br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('102');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('100');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('103');">
<font class='lnum'><i>(103)</i></font>&nbsp; Two problems - solved </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 5035)</i></sub></font></a></legend></fieldset>
<p>
<div id="103" style="display:none">   
<ul>


<p>
<s> <b> 1.  A BIG PROBLEM </b> is that the rest of the file IS STILL PROCESSED<br>
by the stupid script (!!)<br>
So it garbles code sections etc. creating pseudo subscripts<br>
The "automatic math" recognition is not there <br>
POSSIBLE SOLUTION:<br>
(a) fall back on "backticks" or (b) filter and feed only math subsections<br>
to the stupid library?? Is it possible? - it's happening on the client side.<br>
So, not.<br>
<p>
<b> Moved the math section down </b> - still the whole file is garbled, and<br>
all underscores converted into subscripts etc.<br>
</s> ---- sort of solved for now<br>
<p>
<b> 2. a bug? </b>. I wrote:<br>
<ul> NOTE also that once pages have been rendered dynamically they can be saved<br>
as HTML from your browser and then distributed - no library is needed any more.<br>
The created page remains self-sufficient HTML, and if your browser knows how to display<br>
MathML, the formatting will be preserved. If not, the browser will fall back to what<br>
you typed in ASCII, (which is also often readable, but..).<br>
</ul><br>
<p>
<b> Seems like a bug in my Firefox </b> - it cannot see any previously rendered pages<br>
after saving-reopening them, js library or no library.<br>
<p>
<b> Tried </b> to embed the lib into MOLLY.pl - succeeded after cleaning out all<br>
C-style comments (/* ....*/) <br>
The generated html file loaded -- in 8-10-.. seconds -- and rendered MathML inside<br>
Firefox.<br>
However saving caused THE SAME RESULT - it was not reloadable, readable after saving<br>
from Firefox.<br>
A bug with Firefox, it looks like ;(((((<br>
<p>
..Undid all changes now, should be as before, the lib is external.<br>
<p>
<b> Checked agains a "torture page" from mozilla </b><br>
<a href= http://www.mozilla.org/projects/mathml/demo/texvsmml.xhtml > http://www.mozilla.org/projects/mathml/demo/texvsmml.xhtml </a><br>
saves and displays OK. Is it the library then??!<br>
<p>
<i> one more page about installing math fonts  on Linux etc (oldish) </i><br>
<a href= http://groups.csail.mit.edu/mac/projects/intelligent-book/mathml/ > http://groups.csail.mit.edu/mac/projects/intelligent-book/mathml/ </a><br>
<p>
<b> ANYWAY when the HTML doc is saved from "MOLLY.weave" and is accompanied with<br>
a copy of the library, it all works OK in Firefox, however </b><br>
Just do not mix the "single-backquoted" default copies of the ASCIIMathML.js library<br>
and our customized ones. Use the correct version for your markup.<br>
<p>
<b> note on lib versions and distribution</b> <br>
correct it in the template. Referring to the copy of the lib on its<br>
home site will get WRONG lib for my "double-backticks" markup. It will work OK for <br>
a m a t h tags though. But will garble any included code with $'s (such as shell or<br>
perl or php or ........)<br>
Make available your own copy of the lib, that is the idea.<br>
<p>
"Opera" browser when it creates an *.mht archive out of the weaved HTML doc does<br>
correctly include a base64-encode copy of the custom lib from the same dir.<br>
So my hope that one could distribute the stuff in one piece seems justified.<br>
I cannot view *.mht on Linux (as Opera fails MathML, and Firefox ignores the format),<br>
but I can distribute it as such for IExplorers with a MathML player plugin installed,<br>
hopefully.<br>
<p>
Q. Does Firefox on Windows understand *..mht ??<br>
A. Check <a href= http://www.unmht.org/unmht/en_index.html > http://www.unmht.org/unmht/en_index.html </a><br>
<b> <i> Problem solved by installing UnMHT firefox add-on </i> </b><br>
<a href= http://www.unmht.org/unmht/en_index.html > http://www.unmht.org/unmht/en_index.html </a><br>
Now it can open weaved MathML files + custom library, save them as one "multipart<br>
file", reopen correctly, and also reopen the *.mht created blindly by Opera.<br>
<p>
So this is how it can/should be used for now.<br>
<p>
<b> P.S. </b> One more relevant Mozilla add-on is MAF ("Mozilla Archive files, zipped archives<br>
of pages and their elements)<br>
<a href= http://maf.mozdev.org/ > http://maf.mozdev.org/ </a><br>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('103');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('98');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('104');">
<font class='lnum'><i>(104)</i></font>&nbsp; </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 5114)</i></sub></font></a></legend></fieldset>
<p>
<div id="104" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('104');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('105');">
<font class='lnum'><i>(105)</i></font>&nbsp; ADD-ON: Context diffs and sections editing -- not implemented </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 5117)</i></sub></font></a></legend></fieldset>
<p>
<div id="105" style="display:none">   
<ul>


<p>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('106');">
<font class='lnum'><i>(106)</i></font>&nbsp; Outline of the idea </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 5121)</i></sub></font></a></legend></fieldset>
<p>
<div id="106" style="display:none">   
<ul>

<p>
<ol> <li> Context diffs an be applied by "patch -c" even <i> without their header </i><br>
</li> <li> Secondly, I can ancor them with line numbers from the original "project.weave"<br>
</li> <li> I have to remember that the file the section from which  I edit in-browser <br>
(or in  an external editor) is NOT the original LIterate Source, but an "html-ified"<br>
Literate Source file.<br>
</li> </ol> <br>
<p>
Therefore, I can save a section edit saved under a unique name, like "line1234.patch"<br>
and the general outline of processing will be:<br>
    <ul> <li> (a) add line number references/ancors to the html-ified output of "molly.weave"<br>
    indicating lines in the Literate Source (modify the existing weaver)<br>
    </li> <li> (b) edit sections <br>
	<ol> <li> in a Javascript in=-browser editor, like "tinyMCE" etc.<br>
	which is applied to "div"s <br>
	</li> <li> or in an external editor, to which I cat the piece from<br>
	a subsection heading to the next subsection title; the editor is called with the default<br>
	name of the future patch </li> </ol><br>
    </li> <li> (c) Next, when processing/applying the patches (which should be incorporated into<br>
    a new routine/section of MOLLY.pl) I do the following<br>
    <ol> <li>  add the "****************" line needed to start a context diff without<br>
    a header<br>
    </li> <li> substitute teh context diff line numbers for the target file with the beginning<br>
    line number picked from the patch ancor </li> </ol><br>
    </li> <li> apply "patch -c" to MOLLY<br>
    </li> <li> I should probably add the timestamp into the patch name (or use file mtime) to <br>
    apply only the new patches to the Literate Source, and/or clean the old ones (might keep some<br>
    as a sort of version control for undoing ??? Does "patch" know how to revert itself ???)<br>
    </li> </ul><br>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('106');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('107');">
<font class='lnum'><i>(107)</i></font>&nbsp; Editing - javascript versus external editor </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 5153)</i></sub></font></a></legend></fieldset>
<p>
<div id="107" style="display:none">   
<ul>

<p>
JS editors (wikiwyg, tinyMCE) are not OK: <br>
tinyMCE requires "textarea" tags;<br>
wikiwyg requires writing a save routine that would reverse the wikiwyg-ification.<br>
<p>
Therefore, I could do external editor calls (in an xterm or the GUI version, like<br>
"gvim", 'jedit', or 'bluefish'.<br>
<p>
Then my script - receiving a CGI call - should <br>
    <ul> <li> cat the section identified by the beginning line## (supplied during<br>
    MOLLY.weave html file generation) -- using a hyperlink (created by molly.weave).<br>
    </li> <li> and next cat the portion of Literate Source into an external editor,<br>
    called with the correct "patch-line##-timestamp" name.<br>
    </li> <li> The user edits the text and saves it (not "save as") - then <br>
    EITHER addressing the mollified LitSrc with a new CGI argument, <br>
    OR continuing the first CGI processing - after getting a return from the <br>
    external editor invocation<br>
    </li> </ul><br>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('107');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('108');">
<font class='lnum'><i>(108)</i></font>&nbsp; Patch details and probs </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 5174)</i></sub></font></a></legend></fieldset>
<p>
<div id="108" style="display:none">   
<ul>

<p>
<i> If the entire diff is indented by a constant amount of white space, `patch' automatically<br>
ignores the indentation. </i><br>
<p>
... and this is good:<br>
<i>    For context diffs, and to a lesser extent normal diffs, `patch' can<br>
detect when the line numbers mentioned in the patch are incorrect, and<br>
it attempts to find the correct place to apply each hunk of the patch.<br>
As a first guess, it takes the line number mentioned in the hunk, plus<br>
or minus any offset used in applying the previous hunk.  If that is not<br>
the correct place, `patch' scans both forward and backward for a set of<br>
lines matching the context given in the hunk.<br>
</i><br>
<p>
.. there is an option "-F 3" or "--fuzz=3" setting "fuzz lines" for context &amp; unified diffs<br>
<p>
.. "reject files" -- check them for failed hunks.<br>
    and another possibility is the "--dry-run" option to check before applying.<br>
<p>
    and another possibility is the "--dry-run" option to check before applying.<br>
<p>
<b> Appending patch trunks </b> If I collect edits as "context patches", I do not need<br>
to keep them in many separate files. All edits before an application can be appended to<br>
the same file, the most recent collection of patch "trunks". After application to the<br>
Literate Source it can be renamed (for "undo"s or deleted.<br>
<p>
Actually, the same is true even for overwriting of sections, not patching.<br>
<p>
Patching may be more complicated and relying on external progs, but in some sense <br>
more "intelligent" and "undoable", while overwriting is not unless I keep the old<br>
versions explicitly.<br>
<p>
<i> Am I reinventing Knuth's 'change files' functionality ?? ;)))))) </i><br>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('108');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('109');">
<font class='lnum'><i>(109)</i></font>&nbsp; Implementation steps </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 5210)</i></sub></font></a></legend></fieldset>
<p>
<div id="109" style="display:none">   
<ul>

<p>
(a) add line numbers to docs subsections. --- DONE---<br>
<p>
<p>
(b) This editing "from_the_browser" can be done:<br>
    <ul> <li> by addressing "MOLLY.update" - by extension<br>
    </li> <li> via a CL option -- or via CGI "?update=patch-lineno_ref-datestamp"<br>
    </li> <li> in a separate script (at least for the time of development and testing)<br>
    </li> </ul><br>
<p>
(c) So, step 1: add "edit" hyperlinks to each subsection.<br>
<p>
(d) Modify Despatcher to redirect to the "update" subsection (will be here)<br>
    ?? another extension? OR just args to "*.weave" ?<br>
<p>
<p>
(e) Make the script dump the subsection whose linenum was passed as CGI arguments<br>
<p>
(f) apply it either overwriting or using the diff/patch approach<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('109');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('105');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('38');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('1');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>


</td></tr></table></center></body></html>

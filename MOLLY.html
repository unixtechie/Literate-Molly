<html>
  
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 



<script language="javascript">

function toggleDiv(divid) {
var el = document.getElementById(divid);
el.style.display = (el.style.display == 'block') ? 'none' : 'block';
}


function toggleCombined(divid){
    if(document.getElementById(divid).style.display == 'none'){
      document.getElementById(divid).style.display = 'block';
        document.getElementById("toc"+divid).className="hilited";
    }
    else{
      document.getElementById(divid).style.display = 'none';
        document.getElementById("toc"+divid).className="unhilited";
    }
}


function showAll(){
for(i=1; i <= 10000; i++){
    document.getElementById(i).style.display = 'block';
    document.getElementById("toc"+i).className="hilited";
    };
}

function hideAll(){
for(i=1; i <= 10000; i++){
    document.getElementById(i).style.display = 'none';
    document.getElementById("toc"+i).className="unhilited";
    };
}


function open_all_above(someid){

    elem = document.getElementById(someid);
        elem.style.display = 'block';
        document.getElementById('toc'+someid).className = 'hilited';
        
    while (elem.parentNode.id != 1) {
        if (elem.parentNode.nodeType == 1) {
        elem.parentNode.style.display = 'block';
        //document.getElementById(elem.parentNode.id).className = 'hilited';
        var toc_elem = document.getElementById('toc'+elem.id);
        if (toc_elem) {toc_elem.className = 'hilited'};
        }
        elem = elem.parentNode;
    }
}



// DELETING a CLONE -- this works too:
function DeleteVirtualNode(someid) {
    
    elem = document.getElementById(someid);

    while (elem.childNodes.length > 0) {
    elem.removeChild(elem.firstChild);
    }  
}

// CREATING a CLONE - this works
/* for clean execution - run "delete" before any creation */
function CreateVirtualNode(clone_from_id, append_to_id){
        DeleteVirtualNode(append_to_id);

    if ( document.getElementById(append_to_id).childNodes.length == 0 ) {
    var elem = document.createElement("div");

    elem = document.getElementById(clone_from_id).cloneNode(1);
    elem.style.display = 'block';
    document.getElementById(append_to_id).appendChild(elem); 

    } /* fi - do not create duplicates of the cloned node */ 
    
}


</script>

<style type="text/css" media="screen">


BODY {
        FONT-SIZE: 10pt;
        background: #f0f0f0;
        }
FIELDSET {
        BORDER-RIGHT: #000000 1px solid; 
        BORDER-TOP: #000000 1px solid; 
        BORDER-LEFT: #000000 1px solid; 
        BORDER-BOTTOM: #000000 1px solid; 
        PADDING-RIGHT: 5px; 
        PADDING-LEFT: 5px; 
        PADDING-BOTTOM: 2px; 
        PADDING-TOP: 5px;
        MARGIN-BOTTOM: 1px; 
        background: #f5f5f5; 
        color: #000000;
        }
LEGEND {
        BORDER-RIGHT: #a9a9a9 1px solid; 
        BORDER-BOTTOM: #a9a9a9 1px solid;
        BORDER-TOP: #a9a9a9 1px solid; 
        BORDER-LEFT: #a9a9a9 1px solid; 
        PADDING-RIGHT: 20px; 
        PADDING-LEFT: 20px; 
        PADDING-BOTTOM: 5px; 
        PADDING-TOP: 5px; 
        FONT-WEIGHT: bold;  
        BACKGROUND: #fdfdfd; 
        color: #000000;
        }
PRE     {
        PADDING-LEFT: 20px; 
        PADDING-RIGHT: 5px; 
        padding-top: 0px; 
        padding-bottom: 6px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
        background: #fefefe;
        }
.tocfieldset {
        background: #ffffff; 
        color: #000000;
        }
.codefieldset {
        BORDER-RIGHT: #000 1px solid; 
        BORDER-TOP: #000 1px solid; 
        BORDER-LEFT: #000 1px solid; 
        BORDER-BOTTOM: #000 1px solid; 
        background: #ffffff; 
        color: #000;
        MARGIN-BOTTOM: 1px; 
        PADDING-LEFT: 15px; 
        PADDING-RIGHT: 5px; 
        PADDING-BOTTOM: 10px; 
        PADDING-TOP: 1px;
        }
.codelegend {
        BORDER-RIGHT: #777 1px solid; 
        BORDER-TOP: #777 1px solid; 
        BORDER-LEFT: #777 1px solid; 
        BORDER-BOTTOM: #777 1px solid
        PADDING-RIGHT: 10px; 
        PADDING-LEFT: 10px; 
        PADDING-TOP: 2px; 
        PADDING-BOTTOM: 2px; 
        background: #ffffff; 
        color: #00b;
        FONT-WEIGHT: bold;  
        }
.chunkref {
        color: #00b;    
        background: #f6f6f6;
        font-weight: bold;
        }
.outertable {
        width: 99%; 
        cellpadding: 25; 
        background: #ffffff; 
        border: 1px solid;
        }
.hl     {
        PADDING-LEFT: 5px; PADDING-RIGHT: 5px; 
        padding-top: 5px; padding-bottom: 5px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
        background: #f5f5f5;    
        width: 70%;
        }
.hl-wide {
        PADDING-LEFT: 5px; 
        PADDING-RIGHT: 5px; 
        padding-top: 15px; 
        padding-bottom: 15px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
        background: #fbfbfb;    
        }
.lnum {
        color: #a0a0a0;
        }
.unhilited {background-color:white}
.hilited {background-color:#c0c0ff}
.linked_chunk {
        PADDING-RIGHT: 5px; 
        PADDING-LEFT: 5px; 
        PADDING-BOTTOM: 5px; 
        PADDING-TOP: 5px; 
        BORDER-TOP: #c0c0c0 1px solid;
        BORDER-RIGHT: #c0c0c0 1px solid; 
        BORDER-LEFT: #c0c0c0 1px solid;
        BORDER-BOTTOM: #c0c0c0 1px solid;              
        color: #505050;
        background: #ffffff;
        }
.linked_chunk_legend {
        PADDING-RIGHT: 5px; 
        PADDING-LEFT: 5px; 
        PADDING-BOTTOM: 3px; 
        PADDING-TOP: 3px; 
        BORDER-TOP: #c0c0c0 1px solid;
        BORDER-RIGHT: #c0c0c0 1px solid; 
        BORDER-LEFT: #c0c0c0 1px solid;
        BORDER-BOTTOM: #c0c0c0 1px solid;              
        color: #505050;
        background: #ffffff;
        }
a:visited { color: blue; }

</STYLE>


</head>

 <body>  <center><table class='outertable'><tr><td> 
<p><fieldset class='tocfieldset'>
<legend><b>TABLE OF CONTENTS: outline of the document structure</b></legend>

<ul>
<p>
<br>
<div class='hl' align=center>
<a href="javascript:;" onmousedown="toggleDiv('tochowto');">
<b>HOW TO USE THE FOLDING DOCUMENT [expand/collapse]</b></a>
</div>
<div id='tochowto' style='display:none' style='background:#ffffff'> 
<p>
<ul>
<li><b>Collapsing is necessary when</b> you work on code and must exclude 
<br>irrelevant sections of the rest of the literate project file. This 
<br>greatly helps to clear thinking by eliminating a general feeling of 
<br>being in a maze of code and unnecessary "housekeeping" tasks.
<br>One can say that there is a limited "buffer capacity" in the human
<br>mind, and relieving it of the need to remember where things are in a 
<br>larger file, at which other points one must fill in values or adjust
<br>invocation etc. <i>immediately makes the user "more intelligent"</i>
<p>
</li><li><b>TOC: to toggle</b> a section open/closed, click on the <i>corresponding link</i>
<br>Remember to open <i>all sections above it</i> for it to become visible.
</li><li><b>TOC: to open all sections above</b> some internal subsection to make
<br>it visible, click on the <i>section number</i> in the column on the left.
</li><li><b>TOC: to open all above and jump</b> click on the leftmost symbol.
<p>
</li><li><b>To restore the default view</b> <i>reload</i> the page in the browser.
<p>
</li><li>
<b>To keep some sections open</b> upon each reload: supposing you
<br>work on the code, constantly update it and cannot bother to reopen it 
<br>again and again - mark the headings for the sections in the source file
<br>with a plus, i.e. write the opening tag (only)  as +h2, +h3. Again, all
<br>sections above must be marked open too. 
<br><b>Note that</b> "expand all" and "collapse all" disregard these settings.
<br>Reload the page after using those options to again view the text
<br>according to your preferences.
<p>
</li><li>
<b> To use the Index </b>, click on the numbered sections in the TOC above
<br>(opening them; use highlighting as a guide; when sections are visible,
<br>the slider on your browser window  will shorten too), or "expand all", 
<br>and then use your browser's Find function to highlight all chunk name 
<br>instances in the visible text
<p>
</li><li>
<b>To search for variables etc.</b>, "expand all" text - or manually 
<br>expand needed sections - and then use your browser's Find function to 
<br>highlight all and jump between the found items.
<p></li></ul>

</div> 
<p>
<br>
<p>
<div class='hl' align=center>
<p>
<a href="javascript:;" onmousedown="toggleDiv('tocmain');">
<b>TABLE OF CONTENTS [expand/collapse]</b></a>
<a name="tocancor"></a>
<font size=-1 color=darkgrey><i>
<p><b>Section name</b> toggles expanded state. <b>Subsection number</b> on the left opens
<br>all parent sections to make it visible. <b>Leftmost symbol</b> opens parents and
<br>jumps to the section.
</i></font>
</div>

<div id='tocmain' style='display:block' style='background:#ffffff'> 
<p>
<br>
<p>
&nbsp;<a href="#1" onmousedown="open_all_above(1);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(1);" ><i>1</i></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" onmousedown="toggleCombined(1);" id="toc1"><b> MOLLY MODULE </a>&nbsp;<a><font class='lnum' size=-1><i>(line 103)</i></font></b></a><br>
&nbsp;<a href="#2" onmousedown="open_all_above(2);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(2);" ><i>2</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.......&nbsp;<a href="javascript:;" onmousedown="toggleCombined(2);" id="toc2"><b> THE CHUNK TO TANGLE BY  DEFAULT </a>&nbsp;<a><font class='lnum' size=-1><i>(line 128)</i></font></b></a><br>
&nbsp;<a href="#3" onmousedown="open_all_above(3);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(3);" ><i>3</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.......&nbsp;<a href="javascript:;" onmousedown="toggleCombined(3);" id="toc3"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 165)</i></font></b></a><br>
&nbsp;<a href="#4" onmousedown="open_all_above(4);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(4);" ><i>4</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.......&nbsp;<a href="javascript:;" onmousedown="toggleCombined(4);" id="toc4"><b> PART I ----------- CONCEPTS ------------ </a>&nbsp;<a><font class='lnum' size=-1><i>(line 168)</i></font></b></a><br>
&nbsp;<a href="#5" onmousedown="open_all_above(5);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(5);" ><i>5</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(5);" id="toc5"><b> Краткое описание для русских пользователей </a>&nbsp;<a><font class='lnum' size=-1><i>(line 175)</i></font></b></a><br>
&nbsp;<a href="#6" onmousedown="open_all_above(6);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(6);" ><i>6</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(6);" id="toc6"><b> LP as "management of thinking" </a>&nbsp;<a><font class='lnum' size=-1><i>(line 286)</i></font></b></a><br>
&nbsp;<a href="#7" onmousedown="open_all_above(7);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(7);" ><i>7</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(7);" id="toc7"><b> Three problems with L.P. -- unification of L.P. and folding </a>&nbsp;<a><font class='lnum' size=-1><i>(line 375)</i></font></b></a><br>
&nbsp;<a href="#8" onmousedown="open_all_above(8);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(8);" ><i>8</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.......&nbsp;<a href="javascript:;" onmousedown="toggleCombined(8);" id="toc8"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 482)</i></font></b></a><br>
&nbsp;<a href="#9" onmousedown="open_all_above(9);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(9);" ><i>9</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.......&nbsp;<a href="javascript:;" onmousedown="toggleCombined(9);" id="toc9"><b> PART II ------------ HOW TO USE MOLLY.pl ------------ </a>&nbsp;<a><font class='lnum' size=-1><i>(line 485)</i></font></b></a><br>
&nbsp;<a href="#10" onmousedown="open_all_above(10);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(10);" ><i>10</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(10);" id="toc10"><b> My workflow - literate programming with Molly </a>&nbsp;<a><font class='lnum' size=-1><i>(line 490)</i></font></b></a><br>
&nbsp;<a href="#11" onmousedown="open_all_above(11);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(11);" ><i>11</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(11);" id="toc11"><b> SET UP a Literate Source file and project </a>&nbsp;<a><font class='lnum' size=-1><i>(line 553)</i></font></b></a><br>
&nbsp;<a href="#12" onmousedown="open_all_above(12);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(12);" ><i>12</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(12);" id="toc12"><b> Prerequisites </a>&nbsp;<a><font class='lnum' size=-1><i>(line 559)</i></font></b></a><br>
&nbsp;<a href="#13" onmousedown="open_all_above(13);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(13);" ><i>13</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(13);" id="toc13"><b> Two ways to invoke Molly  </a>&nbsp;<a><font class='lnum' size=-1><i>(line 591)</i></font></b></a><br>
&nbsp;<a href="#14" onmousedown="open_all_above(14);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(14);" ><i>14</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(14);" id="toc14"><b> Command-line options (ref) </a>&nbsp;<a><font class='lnum' size=-1><i>(line 631)</i></font></b></a><br>
&nbsp;<a href="#15" onmousedown="open_all_above(15);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(15);" ><i>15</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(15);" id="toc15"><b> Quick Mode: Setting up the file </a>&nbsp;<a><font class='lnum' size=-1><i>(line 676)</i></font></b></a><br>
&nbsp;<a href="#16" onmousedown="open_all_above(16);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(16);" ><i>16</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(16);" id="toc16"><b> "Mollification" - full configuration template </a>&nbsp;<a><font class='lnum' size=-1><i>(line 770)</i></font></b></a><br>
&nbsp;<a href="#17" onmousedown="open_all_above(17);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(17);" ><i>17</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(17);" id="toc17"><b> Sample minimal configuration of thttpd </a>&nbsp;<a><font class='lnum' size=-1><i>(line 876)</i></font></b></a><br>
&nbsp;<a href="#18" onmousedown="open_all_above(18);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(18);" ><i>18</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(18);" id="toc18"><b> Markup of code and documentation sections </a>&nbsp;<a><font class='lnum' size=-1><i>(line 944)</i></font></b></a><br>
&nbsp;<a href="#19" onmousedown="open_all_above(19);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(19);" ><i>19</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(19);" id="toc19"><b> CREATE a Literate Source file -- documentation chunks markup</a>&nbsp;<a><font class='lnum' size=-1><i>(line 985)</i></font></b></a><br>
&nbsp;<a href="#20" onmousedown="open_all_above(20);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(20);" ><i>20</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(20);" id="toc20"><b> Doc sections markup </a>&nbsp;<a><font class='lnum' size=-1><i>(line 989)</i></font></b></a><br>
&nbsp;<a href="#21" onmousedown="open_all_above(21);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(21);" ><i>21</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(21);" id="toc21"><b> Choking on bad strings - on Markup and Escaping</a>&nbsp;<a><font class='lnum' size=-1><i>(line 1041)</i></font></b></a><br>
&nbsp;<a href="#22" onmousedown="open_all_above(22);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(22);" ><i>22</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(22);" id="toc22"><b> Markup and Editor highlighting </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1074)</i></font></b></a><br>
&nbsp;<a href="#23" onmousedown="open_all_above(23);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(23);" ><i>23</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(23);" id="toc23"><b> Navigation in the Folding HTML document </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1115)</i></font></b></a><br>
&nbsp;<a href="#24" onmousedown="open_all_above(24);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(24);" ><i>24</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(24);" id="toc24"><b> Chunk links and Virtual Views on code </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1123)</i></font></b></a><br>
&nbsp;<a href="#25" onmousedown="open_all_above(25);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(25);" ><i>25</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(25);" id="toc25"><b> Saving multipart work </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1214)</i></font></b></a><br>
&nbsp;<a href="#26" onmousedown="open_all_above(26);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(26);" ><i>26</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(26);" id="toc26"><b> Tangling - extracting code from LSFile </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1235)</i></font></b></a><br>
&nbsp;<a href="#27" onmousedown="open_all_above(27);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(27);" ><i>27</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(27);" id="toc27"><b> Tangling from LSFile </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1240)</i></font></b></a><br>
&nbsp;<a href="#28" onmousedown="open_all_above(28);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(28);" ><i>28</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(28);" id="toc28"><b> Scaling up: tangling from many LS files </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1302)</i></font></b></a><br>
&nbsp;<a href="#29" onmousedown="open_all_above(29);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(29);" ><i>29</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(29);" id="toc29"><b> Mathematical Formulae - MathML inside Mollified Literate source files </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1362)</i></font></b></a><br>
&nbsp;<a href="#30" onmousedown="open_all_above(30);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(30);" ><i>30</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(30);" id="toc30"><b> How to use ASCIIMathML.js in Molly </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1386)</i></font></b></a><br>
&nbsp;<a href="#31" onmousedown="open_all_above(31);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(31);" ><i>31</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(31);" id="toc31"><b> 6 . Some examples and LaTexMathML.js library versions </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1438)</i></font></b></a><br>
&nbsp;<a href="#32" onmousedown="open_all_above(32);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(32);" ><i>32</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(32);" id="toc32"><b> 7 .  ASCIIMathML Markup - reference </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1521)</i></font></b></a><br>
&nbsp;<a href="#33" onmousedown="open_all_above(33);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(33);" ><i>33</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(33);" id="toc33"><b> How to distribute your final folding HTML-formatted work </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1554)</i></font></b></a><br>
&nbsp;<a href="#34" onmousedown="open_all_above(34);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(34);" ><i>34</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(34);" id="toc34"><b> READ and SEARCH inside a Folding Literate Source file </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1594)</i></font></b></a><br>
&nbsp;<a href="#35" onmousedown="open_all_above(35);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(35);" ><i>35</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(35);" id="toc35"><b> Opening many relevant subsections together, TOC highlighting </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1640)</i></font></b></a><br>
&nbsp;<a href="#36" onmousedown="open_all_above(36);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(36);" ><i>36</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(36);" id="toc36"><b> Keeping some sections of the LSFile permanently open </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1656)</i></font></b></a><br>
&nbsp;<a href="#37" onmousedown="open_all_above(37);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(37);" ><i>37</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(37);" id="toc37"><b> TOC and Code Chunks Index </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1709)</i></font></b></a><br>
&nbsp;<a href="#38" onmousedown="open_all_above(38);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(38);" ><i>38</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(38);" id="toc38"><b> Searching for symbols, chunks, phrases </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1733)</i></font></b></a><br>
&nbsp;<a href="#39" onmousedown="open_all_above(39);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(39);" ><i>39</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(39);" id="toc39"><b> TOC/Index unfolding and collapsing </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1749)</i></font></b></a><br>
&nbsp;<a href="#40" onmousedown="open_all_above(40);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(40);" ><i>40</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(40);" id="toc40"><b> Use for printing </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1758)</i></font></b></a><br>
&nbsp;<a href="#41" onmousedown="open_all_above(41);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(41);" ><i>41</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(41);" id="toc41"><b> Text browsers and JavaScript </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1773)</i></font></b></a><br>
&nbsp;<a href="#42" onmousedown="open_all_above(42);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(42);" ><i>42</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(42);" id="toc42"><b> SUGGESTED USES: Work with Folding LSFiles</a>&nbsp;<a><font class='lnum' size=-1><i>(line 1791)</i></font></b></a><br>
&nbsp;<a href="#43" onmousedown="open_all_above(43);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(43);" ><i>43</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(43);" id="toc43"><b> scrap </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1915)</i></font></b></a><br>
&nbsp;<a href="#44" onmousedown="open_all_above(44);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(44);" ><i>44</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.......&nbsp;<a href="javascript:;" onmousedown="toggleCombined(44);" id="toc44"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1947)</i></font></b></a><br>
&nbsp;<a href="#45" onmousedown="open_all_above(45);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(45);" ><i>45</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.......&nbsp;<a href="javascript:;" onmousedown="toggleCombined(45);" id="toc45"><b> PART III ------------ LITERATE SOURCE OF THE SCRIPT ------------ </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1950)</i></font></b></a><br>
&nbsp;<a href="#46" onmousedown="open_all_above(46);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(46);" ><i>46</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(46);" id="toc46"><b> Local Reference </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1955)</i></font></b></a><br>
&nbsp;<a href="#47" onmousedown="open_all_above(47);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(47);" ><i>47</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(47);" id="toc47"><b> Bugs, status, changes </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1980)</i></font></b></a><br>
&nbsp;<a href="#48" onmousedown="open_all_above(48);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(48);" ><i>48</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(48);" id="toc48"><b> Bugs </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1984)</i></font></b></a><br>
&nbsp;<a href="#49" onmousedown="open_all_above(49);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(49);" ><i>49</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(49);" id="toc49"><b> Ideas - versions - changes</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2004)</i></font></b></a><br>
&nbsp;<a href="#50" onmousedown="open_all_above(50);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(50);" ><i>50</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(50);" id="toc50"><b> first ideas </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2027)</i></font></b></a><br>
&nbsp;<a href="#51" onmousedown="open_all_above(51);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(51);" ><i>51</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(51);" id="toc51"><b> more ideas </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2129)</i></font></b></a><br>
&nbsp;<a href="#52" onmousedown="open_all_above(52);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(52);" ><i>52</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(52);" id="toc52"><b>  Contract programming  and Molly?? </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2175)</i></font></b></a><br>
&nbsp;<a href="#53" onmousedown="open_all_above(53);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(53);" ><i>53</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(53);" id="toc53"><b> Editor highlighting, Perl POD and Literate Markup </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2221)</i></font></b></a><br>
&nbsp;<a href="#54" onmousedown="open_all_above(54);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(54);" ><i>54</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(54);" id="toc54"><b>Done </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2250)</i></font></b></a><br>
&nbsp;<a href="#55" onmousedown="open_all_above(55);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(55);" ><i>55</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(55);" id="toc55"><b> done for Tangling </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2255)</i></font></b></a><br>
&nbsp;<a href="#56" onmousedown="open_all_above(56);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(56);" ><i>56</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(56);" id="toc56"><b>Todo -  current</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2280)</i></font></b></a><br>
&nbsp;<a href="#57" onmousedown="open_all_above(57);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(57);" ><i>57</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(57);" id="toc57"><b> PRELIMINARIES: The script layout and idea </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2339)</i></font></b></a><br>
&nbsp;<a href="#58" onmousedown="open_all_above(58);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(58);" ><i>58</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(58);" id="toc58"><b> Makefile</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2420)</i></font></b></a><br>
&nbsp;<a href="#59" onmousedown="open_all_above(59);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(59);" ><i>59</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(59);" id="toc59"><b> Tests to run on a newly tangled script</a>&nbsp;<a><font class='lnum' size=-1><i>(line 2471)</i></font></b></a><br>
&nbsp;<a href="#60" onmousedown="open_all_above(60);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(60);" ><i>60</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(60);" id="toc60"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2503)</i></font></b></a><br>
&nbsp;<a href="#61" onmousedown="open_all_above(61);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(61);" ><i>61</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(61);" id="toc61"><b> MOLLY.pl - top of the script </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2506)</i></font></b></a><br>
&nbsp;<a href="#62" onmousedown="open_all_above(62);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(62);" ><i>62</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(62);" id="toc62"><b> general settings </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2543)</i></font></b></a><br>
&nbsp;<a href="#63" onmousedown="open_all_above(63);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(63);" ><i>63</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(63);" id="toc63"><b> main despatcher </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2669)</i></font></b></a><br>
&nbsp;<a href="#64" onmousedown="open_all_above(64);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(64);" ><i>64</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(64);" id="toc64"><b> "Main despatcher with CL" </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2687)</i></font></b></a><br>
&nbsp;<a href="#65" onmousedown="open_all_above(65);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(65);" ><i>65</i></a>&nbsp;&nbsp;&nbsp;&nbsp;...................................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(65);" id="toc65"><b> running on interactive TTY </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2752)</i></font></b></a><br>
&nbsp;<a href="#66" onmousedown="open_all_above(66);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(66);" ><i>66</i></a>&nbsp;&nbsp;&nbsp;&nbsp;...................................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(66);" id="toc66"><b> write 'nothing here' html message </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2851)</i></font></b></a><br>
&nbsp;<a href="#67" onmousedown="open_all_above(67);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(67);" ><i>67</i></a>&nbsp;&nbsp;&nbsp;&nbsp;...................................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(67);" id="toc67"><b> Sub Print Usage </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2876)</i></font></b></a><br>
&nbsp;<a href="#68" onmousedown="open_all_above(68);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(68);" ><i>68</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(68);" id="toc68"><b> "Main despatcher simple" </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2934)</i></font></b></a><br>
&nbsp;<a href="#69" onmousedown="open_all_above(69);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(69);" ><i>69</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(69);" id="toc69"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2976)</i></font></b></a><br>
&nbsp;<a href="#70" onmousedown="open_all_above(70);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(70);" ><i>70</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(70);" id="toc70"><b> TANGLER </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2979)</i></font></b></a><br>
&nbsp;<a href="#71" onmousedown="open_all_above(71);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(71);" ><i>71</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(71);" id="toc71"><b> Notes on; difference btw built-in and "notangle" </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2983)</i></font></b></a><br>
&nbsp;<a href="#72" onmousedown="open_all_above(72);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(72);" ><i>72</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(72);" id="toc72"><b> Tangler despatcher: run pass-through or built-in tangler </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3046)</i></font></b></a><br>
&nbsp;<a href="#73" onmousedown="open_all_above(73);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(73);" ><i>73</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(73);" id="toc73"><b> seek-peek tangler </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3114)</i></font></b></a><br>
&nbsp;<a href="#74" onmousedown="open_all_above(74);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(74);" ><i>74</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(74);" id="toc74"><b> Advantages, limitations; escapes; the algorithm </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3118)</i></font></b></a><br>
&nbsp;<a href="#75" onmousedown="open_all_above(75);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(75);" ><i>75</i></a>&nbsp;&nbsp;&nbsp;&nbsp;...................................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(75);" id="toc75"><b>todo</a>&nbsp;<a><font class='lnum' size=-1><i>(line 3178)</i></font></b></a><br>
&nbsp;<a href="#76" onmousedown="open_all_above(76);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(76);" ><i>76</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(76);" id="toc76"><b>The code</a>&nbsp;<a><font class='lnum' size=-1><i>(line 3206)</i></font></b></a><br>
&nbsp;<a href="#77" onmousedown="open_all_above(77);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(77);" ><i>77</i></a>&nbsp;&nbsp;&nbsp;&nbsp;...................................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(77);" id="toc77"><b> PAss 1 </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3245)</i></font></b></a><br>
&nbsp;<a href="#78" onmousedown="open_all_above(78);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(78);" ><i>78</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..........................................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(78);" id="toc78"><b> Ref: perl operators </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3302)</i></font></b></a><br>
&nbsp;<a href="#79" onmousedown="open_all_above(79);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(79);" ><i>79</i></a>&nbsp;&nbsp;&nbsp;&nbsp;...................................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(79);" id="toc79"><b> Pass 1: main while-loop and foffs</a>&nbsp;<a><font class='lnum' size=-1><i>(line 3337)</i></font></b></a><br>
&nbsp;<a href="#80" onmousedown="open_all_above(80);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(80);" ><i>80</i></a>&nbsp;&nbsp;&nbsp;&nbsp;...................................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(80);" id="toc80"><b> multiple refs on the same line</a>&nbsp;<a><font class='lnum' size=-1><i>(line 3498)</i></font></b></a><br>
&nbsp;<a href="#81" onmousedown="open_all_above(81);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(81);" ><i>81</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..........................................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(81);" id="toc81"><b> first test: how to iterate over regex, using pos</a>&nbsp;<a><font class='lnum' size=-1><i>(line 3590)</i></font></b></a><br>
&nbsp;<a href="#82" onmousedown="open_all_above(82);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(82);" ><i>82</i></a>&nbsp;&nbsp;&nbsp;&nbsp;...................................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(82);" id="toc82"><b> Topological sort: check for cycles and find roots</a>&nbsp;<a><font class='lnum' size=-1><i>(line 3636)</i></font></b></a><br>
&nbsp;<a href="#83" onmousedown="open_all_above(83);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(83);" ><i>83</i></a>&nbsp;&nbsp;&nbsp;&nbsp;...................................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(83);" id="toc83"><b> pass 2 and print </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3763)</i></font></b></a><br>
&nbsp;<a href="#84" onmousedown="open_all_above(84);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(84);" ><i>84</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..........................................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(84);" id="toc84"><b> two debug chunks</a>&nbsp;<a><font class='lnum' size=-1><i>(line 3920)</i></font></b></a><br>
&nbsp;<a href="#85" onmousedown="open_all_above(85);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(85);" ><i>85</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(85);" id="toc85"><b> (VIRTUAL VIEW): adding multi-file tangling </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3957)</i></font></b></a><br>
&nbsp;<a href="#86" onmousedown="open_all_above(86);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(86);" ><i>86</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(86);" id="toc86"><b> Scrap </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4038)</i></font></b></a><br>
&nbsp;<a href="#87" onmousedown="open_all_above(87);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(87);" ><i>87</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(87);" id="toc87"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4075)</i></font></b></a><br>
&nbsp;<a href="#88" onmousedown="open_all_above(88);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(88);" ><i>88</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(88);" id="toc88"><b> WEAVER </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4078)</i></font></b></a><br>
&nbsp;<a href="#89" onmousedown="open_all_above(89);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(89);" ><i>89</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(89);" id="toc89"><b> How formatting is done in the weaver </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4104)</i></font></b></a><br>
&nbsp;<a href="#90" onmousedown="open_all_above(90);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(90);" ><i>90</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(90);" id="toc90"><b> actual working test.html </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4140)</i></font></b></a><br>
&nbsp;<a href="#91" onmousedown="open_all_above(91);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(91);" ><i>91</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(91);" id="toc91"><b> changing text style - the basic JS recipy </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4272)</i></font></b></a><br>
&nbsp;<a href="#92" onmousedown="open_all_above(92);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(92);" ><i>92</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(92);" id="toc92"><b> Reference - Javascript and DOM </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4323)</i></font></b></a><br>
&nbsp;<a href="#93" onmousedown="open_all_above(93);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(93);" ><i>93</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(93);" id="toc93"><b> set formatting strings for weaver </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4339)</i></font></b></a><br>
&nbsp;<a href="#94" onmousedown="open_all_above(94);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(94);" ><i>94</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(94);" id="toc94"><b> JS functions </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4439)</i></font></b></a><br>
&nbsp;<a href="#95" onmousedown="open_all_above(95);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(95);" ><i>95</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(95);" id="toc95"><b> Stylesheet </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4517)</i></font></b></a><br>
&nbsp;<a href="#96" onmousedown="open_all_above(96);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(96);" ><i>96</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(96);" id="toc96"><b> Accumulate the result </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4672)</i></font></b></a><br>
&nbsp;<a href="#97" onmousedown="open_all_above(97);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(97);" ><i>97</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(97);" id="toc97"><b> process code chunks </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4802)</i></font></b></a><br>
&nbsp;<a href="#98" onmousedown="open_all_above(98);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(98);" ><i>98</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(98);" id="toc98"><b> process section headings </a>&nbsp;<a><font class='lnum' size=-1><i>(line 4898)</i></font></b></a><br>
&nbsp;<a href="#99" onmousedown="open_all_above(99);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(99);" ><i>99</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(99);" id="toc99"><b> Doc body formatters: rawHTML and others</a>&nbsp;<a><font class='lnum' size=-1><i>(line 5098)</i></font></b></a><br>
&nbsp;<a href="#100" onmousedown="open_all_above(100);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(100);" ><i>100</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(100);" id="toc100"><b> Print out the resulting page </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5191)</i></font></b></a><br>
&nbsp;<a href="#101" onmousedown="open_all_above(101);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(101);" ><i>101</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(101);" id="toc101"><b> Linked chunks, sections and Flinks </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5443)</i></font></b></a><br>
&nbsp;<a href="#102" onmousedown="open_all_above(102);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(102);" ><i>102</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(102);" id="toc102"><b> Three chunks excluded from final printing</a>&nbsp;<a><font class='lnum' size=-1><i>(line 5615)</i></font></b></a><br>
&nbsp;<a href="#103" onmousedown="open_all_above(103);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(103);" ><i>103</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(103);" id="toc103"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5722)</i></font></b></a><br>
&nbsp;<a href="#104" onmousedown="open_all_above(104);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(104);" ><i>104</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(104);" id="toc104"><b>(VIRTUAL VIEW): Creation of Linked Chunk functionality</a>&nbsp;<a><font class='lnum' size=-1><i>(line 5725)</i></font></b></a><br>
&nbsp;<a href="#105" onmousedown="open_all_above(105);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(105);" ><i>105</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(105);" id="toc105"><b> First ideas, todo lists </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5756)</i></font></b></a><br>
&nbsp;<a href="#106" onmousedown="open_all_above(106);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(106);" ><i>106</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(106);" id="toc106"><b> Actual implementation (with links to affected code sections </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5812)</i></font></b></a><br>
&nbsp;<a href="#107" onmousedown="open_all_above(107);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(107);" ><i>107</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(107);" id="toc107"><b>  Node Cloning/destruction - JavaScript functions </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5934)</i></font></b></a><br>
&nbsp;<a href="#108" onmousedown="open_all_above(108);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(108);" ><i>108</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(108);" id="toc108"><b> Numbering Chunk Splinters and Putting Links in the Chunks Index </a>&nbsp;<a><font class='lnum' size=-1><i>(line 5975)</i></font></b></a><br>
&nbsp;<a href="#109" onmousedown="open_all_above(109);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(109);" ><i>109</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(109);" id="toc109"><b> Tests of a chunk link, section link and flink functionality </a>&nbsp;<a><font class='lnum' size=-1><i>(line 6011)</i></font></b></a><br>
&nbsp;<a href="#110" onmousedown="open_all_above(110);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(110);" ><i>110</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(110);" id="toc110"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 6096)</i></font></b></a><br>
&nbsp;<a href="#111" onmousedown="open_all_above(111);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(111);" ><i>111</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(111);" id="toc111"><b> (VIRTUAL VIEW): example of additional markup - dotHTML</a>&nbsp;<a><font class='lnum' size=-1><i>(line 6099)</i></font></b></a><br>
&nbsp;<a href="#112" onmousedown="open_all_above(112);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(112);" ><i>112</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(112);" id="toc112"><b> dotHTML formatter </a>&nbsp;<a><font class='lnum' size=-1><i>(line 6167)</i></font></b></a><br>
&nbsp;<a href="#113" onmousedown="open_all_above(113);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(113);" ><i>113</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(113);" id="toc113"><b> test of &nbsp;&nbsp; s p a c i n g &nbsp;&nbsp; regexp </a>&nbsp;<a><font class='lnum' size=-1><i>(line 6314)</i></font></b></a><br>
&nbsp;<a href="#114" onmousedown="open_all_above(114);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(114);" ><i>114</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(114);" id="toc114"><b> </a>&nbsp;<a><font class='lnum' size=-1><i>(line 6363)</i></font></b></a><br>
&nbsp;<a href="#115" onmousedown="open_all_above(115);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(115);" ><i>115</i></a>&nbsp;&nbsp;&nbsp;&nbsp;..............&nbsp;<a href="javascript:;" onmousedown="toggleCombined(115);" id="toc115"><b> ASCIIMathML and LaTeXMathML inside Molly  </a>&nbsp;<a><font class='lnum' size=-1><i>(line 6366)</i></font></b></a><br>
&nbsp;<a href="#116" onmousedown="open_all_above(116);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(116);" ><i>116</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(116);" id="toc116"><b> Extending the lib with missing LaTeX or HTML symbols </a>&nbsp;<a><font class='lnum' size=-1><i>(line 6390)</i></font></b></a><br>
&nbsp;<a href="#117" onmousedown="open_all_above(117);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(117);" ><i>117</i></a>&nbsp;&nbsp;&nbsp;&nbsp;.....................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(117);" id="toc117"><b> Testing ASCIIMathML.js -- OK partially </a>&nbsp;<a><font class='lnum' size=-1><i>(line 6463)</i></font></b></a><br>
&nbsp;<a href="#118" onmousedown="open_all_above(118);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(118);" ><i>118</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(118);" id="toc118"><b> test one - simple </a>&nbsp;<a><font class='lnum' size=-1><i>(line 6467)</i></font></b></a><br>
&nbsp;<a href="#119" onmousedown="open_all_above(119);" >))</a>&nbsp;&nbsp;<a href="javascript:;" onmousedown="open_all_above(119);" ><i>119</i></a>&nbsp;&nbsp;&nbsp;&nbsp;............................&nbsp;<a href="javascript:;" onmousedown="toggleCombined(119);" id="toc119"><b> test two - from realistic paper, partially failing  </a>&nbsp;<a><font class='lnum' size=-1><i>(line 6527)</i></font></b></a><br>
</div>
<p>
<br>
<p>
<!--fieldset><legend-->
<div class='hl' align=center>
<a href="javascript:;" onmousedown="toggleDiv('indbuf');">
<b>INDEX of Code Chunks [expand/collapse]</b></a>
</div>
<!--/legend></fieldset-->
<p>
<div id='indbuf' style='display:none' style='background:#ffffff'> 
<ul>
<p>
A <b>"def" superscript</b> means the chunk is defined,<br>
a <b>"link"</b> that the chunk is being linked to from that section,<br>
and a <b>bare number</b> means the chunk is being used in a section.
<p>
<br>
<b>&lt;&lt;</b><font class='chunkref'>*</font><b>&gt;&gt;</b> -- <b> 2<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>*-dis</font><b>&gt;&gt;</b> -- <b> 2<sup>def</sup></b>  <b> 2<sup>def</sup></b>  <b> 2<sup>def</sup></b>  <b> 2<sup>def</sup></b>  <b> 2<sup>def</sup></b>  <b> 2<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>DEBUG check hash keys</font><b>&gt;&gt;</b> -- <b> 84<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>DEBUG print out full hash</font><b>&gt;&gt;</b> -- <b> 84<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>HTML head section javascript add-ons</font><b>&gt;&gt;</b> -- <b> 116<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>JS script functions</font><b>&gt;&gt;</b> -- <b> 106<sup>link</sup></b>  <b> 93</b>  <b> 94<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>Javascript: node clone and destroy clone</font><b>&gt;&gt;</b> -- <b> 106<sup>link</sup></b>  <b> 107<sup>def</sup></b>  <b> 94</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>MOLLY.pl module</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 61<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>Makefile for split MOLLY-top and MOLLY-bottom</font><b>&gt;&gt;</b> -- <b> 109<sup>link</sup></b>  <b> 58<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>Node clone/destroy - test.html</font><b>&gt;&gt;</b> -- <b> 107<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>a thousand-line-long piece of code</font><b>&gt;&gt;</b> -- <b> 6</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>accumulate result in a buffer - with error</font><b>&gt;&gt;</b> -- <b> 109<sup>link</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>accumulate result in a buffer</font><b>&gt;&gt;</b> -- <b> 88</b>  <b> 96<sup>def</sup></b>  <b> 96<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>another thousand-line-long piece of code</font><b>&gt;&gt;</b> -- <b> 6</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>body HTML formatters</font><b>&gt;&gt;</b> -- <b> 108<sup>link</sup></b>  <b> 111<sup>link</sup></b>  <b> 96</b>  <b> 99<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>check for cycles, search for roots</font><b>&gt;&gt;</b> -- <b> 76</b>  <b> 82<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>check strings expansion</font><b>&gt;&gt;</b> -- <b> 2</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>check topo sort</font><b>&gt;&gt;</b> -- <b> 2</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk beginning</font><b>&gt;&gt;</b> -- <b> 79</b>  <b> 79<sup>def</sup></b>  <b> 85<sup>link</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk body</font><b>&gt;&gt;</b> -- <b> 79</b>  <b> 79<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk ending</font><b>&gt;&gt;</b> -- <b> 79</b>  <b> 79<sup>def</sup></b>  <b> 85<sup>link</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk reference - multiref inside other text</font><b>&gt;&gt;</b> -- <b> 79</b>  <b> 80<sup>def</sup></b>  <b> 85<sup>link</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>chunk reference</font><b>&gt;&gt;</b> -- <b> 79</b>  <b> 79<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>condition A</font><b>&gt;&gt;</b> -- <b> 6</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>cut out the MOLLY.pl invocation at the top of LS file</font><b>&gt;&gt;</b> -- <b> 96</b>  <b> 96<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>declarations and initializations</font><b>&gt;&gt;</b> -- <b> 77</b>  <b> 77<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>dotHTML formatter</font><b>&gt;&gt;</b> -- <b> 111</b>  <b> 112<sup>def</sup></b>  <b> 112<sup>def</sup></b>  <b> 112<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>else print out the chunk</font><b>&gt;&gt;</b> -- <b> 83</b>  <b> 83<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>elsif LINKED_SECTION, create clone-destructclone fieldset</font><b>&gt;&gt;</b> -- <b> 102<sup>def</sup></b>  <b> 106<sup>link</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>elsif create FLINKs</font><b>&gt;&gt;</b> -- <b> 100</b>  <b> 101<sup>def</sup></b>  <b> 106<sup>link</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>full MOLLY template</font><b>&gt;&gt;</b> -- <b> 111<sup>link</sup></b>  <b> 16<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>general settings</font><b>&gt;&gt;</b> -- <b> 61</b>  <b> 62<sup>def</sup></b>  <b> 62<sup>def</sup></b>  <b> 62<sup>def</sup></b>  <b> 62<sup>def</sup></b>  <b> 62<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>if LINKED_CHUNK, create clone-destructclone fieldset - dis - no splinters</font><b>&gt;&gt;</b> -- <b> 102<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>if LINKED_CHUNK, create clone-destructclone fieldset</font><b>&gt;&gt;</b> -- <b> 100</b>  <b> 101<sup>def</sup></b>  <b> 106<sup>link</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>if the record is a ref, call it recursively</font><b>&gt;&gt;</b> -- <b> 83</b>  <b> 83<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>logical switch</font><b>&gt;&gt;</b> -- <b> 6<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher simple</font><b>&gt;&gt;</b> -- <b> 68<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher with CL</font><b>&gt;&gt;</b> -- <b> 63</b>  <b> 64<sup>def</sup></b>  <b> 85<sup>link</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher</font><b>&gt;&gt;</b> -- <b> 61</b>  <b> 63<sup>def</sup></b>  <b> 85<sup>link</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main: call the sub</font><b>&gt;&gt;</b> -- <b> 76</b>  <b> 76<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>md5 hashing from perl</font><b>&gt;&gt;</b> -- <b> 2</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>minimal MOLLY template</font><b>&gt;&gt;</b> -- <b> 15<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>minimal thttpd configuration</font><b>&gt;&gt;</b> -- <b> 17<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>my_new_markup - disabled - add to "other body formatters" below</font><b>&gt;&gt;</b> -- <b> 111<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>other Makefile commands</font><b>&gt;&gt;</b> -- <b> 58</b>  <b> 58<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>other Makefile help commands</font><b>&gt;&gt;</b> -- <b> 58</b>  <b> 58<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>other body formatters</font><b>&gt;&gt;</b> -- <b> 111<sup>def</sup></b>  <b> 99</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>pass 1</font><b>&gt;&gt;</b> -- <b> 76</b>  <b> 77<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>pass 2 and print</font><b>&gt;&gt;</b> -- <b> 76</b>  <b> 83<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>print out - simple</font><b>&gt;&gt;</b> -- <b> 102<sup>def</sup></b>  <b> 106<sup>link</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>print out - with virtual nodes</font><b>&gt;&gt;</b> -- <b> 100</b>  <b> 100<sup>def</sup></b>  <b> 106<sup>link</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>print out</font><b>&gt;&gt;</b> -- <b> 100<sup>def</sup></b>  <b> 100<sup>def</sup></b>  <b> 100<sup>def</sup></b>  <b> 100<sup>def</sup></b>  <b> 100<sup>def</sup></b>  <b> 100<sup>def</sup></b>  <b> 100<sup>def</sup></b>  <b> 100<sup>def</sup></b>  <b> 106<sup>link</sup></b>  <b> 108<sup>link</sup></b>  <b> 88</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process args for tangling an external file from CL</font><b>&gt;&gt;</b> -- <b> 65</b>  <b> 65<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process code chunks</font><b>&gt;&gt;</b> -- <b> 106<sup>link</sup></b>  <b> 108<sup>link</sup></b>  <b> 96</b>  <b> 97<sup>def</sup></b>  <b> 97<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process section headings</font><b>&gt;&gt;</b> -- <b> 106<sup>link</sup></b>  <b> 96</b>  <b> 98<sup>def</sup></b>  <b> 98<sup>def</sup></b>  <b> 98<sup>def</sup></b>  <b> 98<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>rawHTML formatter</font><b>&gt;&gt;</b> -- <b> 111<sup>link</sup></b>  <b> 99</b>  <b> 99<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>run.thttpd.sh</font><b>&gt;&gt;</b> -- <b> 17<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>running on interactive TTY</font><b>&gt;&gt;</b> -- <b> 64</b>  <b> 65<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>seek-peek tangler</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 72</b>  <b> 76<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>set formatting strings for weaver</font><b>&gt;&gt;</b> -- <b> 88</b>  <b> 93<sup>def</sup></b>  <b> 93<sup>def</sup></b>  <b> 93<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>spacing.pl</font><b>&gt;&gt;</b> -- <b> 113<sup>def</sup></b>  <b> 2</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>stylesheet</font><b>&gt;&gt;</b> -- <b> 93</b>  <b> 95<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>sub print usage</font><b>&gt;&gt;</b> -- <b> 24<sup>link</sup></b>  <b> 64</b>  <b> 67<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>sub print_chunk_link</font><b>&gt;&gt;</b> -- <b> 100</b>  <b> 101<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>sub: tangle recursively - nondestructive</font><b>&gt;&gt;</b> -- <b> 83</b>  <b> 83<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tangle me</font><b>&gt;&gt;</b> -- <b> 61</b>  <b> 72<sup>def</sup></b>  <b> 85<sup>link</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tanglediff.test2.pl</font><b>&gt;&gt;</b> -- <b> 2</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>test.html</font><b>&gt;&gt;</b> -- <b> 90<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>toposort</font><b>&gt;&gt;</b> -- <b> 82</b>  <b> 82<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>weave me</font><b>&gt;&gt;</b> -- <b> 61</b>  <b> 88<sup>def</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>while-loop and peek file ofsets</font><b>&gt;&gt;</b> -- <b> 77</b>  <b> 79<sup>def</sup></b>  <b> 85<sup>link</sup></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>write 'nothing here' html message</font><b>&gt;&gt;</b> -- <b> 64</b>  <b> 66<sup>def</sup></b> <br>
</div>
<p>
<br>
<p><div class='hl' align=center><i>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</i></div><p>
</ul></fieldset><p>
<br>


<p>
<center> <b> Licensing </b><br>
MOLLY is licensed under GNU Public License version 3. </center><br>
<p>
<p>
<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('1');">
<font class='lnum'><i>(1)</i></font>&nbsp; MOLLY MODULE </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 103)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='1'></a></legend></fieldset>
<p>
<div id="1" style="display:block">   <script language=javascript> 
            document.getElementById("toc"+ 1).className='hilited';
            </script>   
<ul>


<p>
<b> What is it? </b><br>
<p>
<b><i>Answer: </i></b> Molly, a MO-dule for LI-terate programming is a new type of tool which <br>
creates autogenerated rich "folding HTML" file out of plain raw literate source marked in<br>
the most popular and simple "noweb" notation. Output can be created on the fly as you<br>
work on the file.<br>
Folding HTML format, a marriage of HTML with the idea of outlining,  noticeably reduces<br>
load on a programmer's memory and allows a number of techniques of source management<br>
not avaibable  before in Literate Programming, such as "virtual views" on the code, and greatly<br>
improves scalability encouraging the programmer to keep all files in one Literate Source<br>
Project file.<br>
<p>
Currently Molly includes both a weaver and a tangler and is a standalone tool in core perl.<br>
Generated folding HTML operation <i><b>has been tested</b> on Unix and Windows <b>for Firefox and<br>
Opera only</b></i><br>
<p>
Autogeneration of rich html format can be applied to simple existing html files, such as<br>
documentation or even books, and used for non-programming tasks.<br>
<p>
<p>
<br><br>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('2');">
<font class='lnum'><i>(2)</i></font>&nbsp; THE CHUNK TO TANGLE BY  DEFAULT </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 128)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='2'></a></legend></fieldset>
<p>
<div id="2" style="display:none">   
<ul>


<p>
<b> <i> All disabled for now </i> </b> - I do not tangle anything from here at the moment<br>
(although meaningful pieces exist, such as configuration templates).<br>
I am not going to tangle the 2 pieces together at the moment -- therefore "*" is disabled<br>
<p>
<font class='lnum'>135</font>   
                <div id=codechunk135>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*&gt;&gt<sub></sub>=</legend>
<font class='lnum'>136</font>   <font class='chunkref'>&lt;&lt;MOLLY.pl module&gt;&gt;</font>
<font class='lnum'>137</font>   </fieldset></pre>
</div><p>
<font class='lnum'>139</font>   
                <div id=codechunk139>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt<sub></sub>=</legend>
<font class='lnum'>140</font>   <font class='chunkref'>&lt;&lt;seek-peek tangler&gt;&gt;</font>
<font class='lnum'>141</font>   </fieldset></pre>
</div><p>
<font class='lnum'>143</font>   
                <div id=codechunk143>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt<sub>2</sub>=</legend>
<font class='lnum'>144</font>   <font class='chunkref'>&lt;&lt;spacing.pl&gt;&gt;</font>
<font class='lnum'>145</font>   </fieldset></pre>
</div><font class='lnum'>146</font>   
                <div id=codechunk146>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt<sub>3</sub>=</legend>
<font class='lnum'>147</font>   <font class='chunkref'>&lt;&lt;tanglediff.test2.pl&gt;&gt;</font>
<font class='lnum'>148</font>   </fieldset></pre>
</div><p>
<font class='lnum'>150</font>   
                <div id=codechunk150>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt<sub>4</sub>=</legend>
<font class='lnum'>151</font>   <font class='chunkref'>&lt;&lt;md5 hashing from perl&gt;&gt;</font>
<font class='lnum'>152</font>   </fieldset></pre>
</div><p>
<font class='lnum'>154</font>   
                <div id=codechunk154>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt<sub>5</sub>=</legend>
<font class='lnum'>155</font>   <font class='chunkref'>&lt;&lt;check topo sort&gt;&gt;</font>
<font class='lnum'>156</font>   </fieldset></pre>
</div><p>
<p>
<font class='lnum'>159</font>   
                <div id=codechunk159>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt<sub>6</sub>=</legend>
<font class='lnum'>160</font>   <font class='chunkref'>&lt;&lt;check strings expansion&gt;&gt;</font>
<font class='lnum'>161</font>   </fieldset></pre>
</div><p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('2');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('3');">
<font class='lnum'><i>(3)</i></font>&nbsp; </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 165)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='3'></a></legend></fieldset>
<p>
<div id="3" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('3');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('4');">
<font class='lnum'><i>(4)</i></font>&nbsp; PART I ----------- CONCEPTS ------------ </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 168)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='4'></a></legend></fieldset>
<p>
<div id="4" style="display:none">   
<ul>


<p>
If you do not know what Literate Programming is already, skip this section.<br>
This is mostly argument.<br>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('5');">
<font class='lnum'><i>(5)</i></font>&nbsp; Краткое описание для русских пользователей </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 175)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='5'></a></legend></fieldset>
<p>
<div id="5" style="display:none">   
<ul>


<p>
<b> 1. Что такое Molly? </b> <br>
<p>
Это МО-дуль для ЛИ-тературного программирования (возможно, его лучше называть "Грамотным<br>
Программированием" - термин Дональда Кнута, изобретателя подхода, намеренно двусмыслен).<br>
<p>
Традиционно написанный "на литературном" исходный файл обрабатывался двумя программами:<br>
"weave", дословно "сплетателем", который создавал красиво отформатированный, готовый для<br>
печати (с помощью кнутовского ТеХ'а) текст, или "tangle", "спутывателем",  который выделял<br>
из литературного готовый к компилированию программный код. Философия заключалась в том, что<br>
код надо писать в последовательности естественной для логики мысли, "запутывая" его <br>
в "сеть" или "паутину" как того требует машина. <br>
<i> [Кроме того, в названии заключена игра слов отсылающая на стихотворение  Мармион <br>
Вальтера Скотта, одна фраза из которого осталась популярна в современном журналистском <br>
английском: "oh, what a tangled web we weave when we practice to deceive" Первая программа <br>
для литпрограммирования, написанная Кнутом, называлась WEB. В те былинные времена  <br>
интернет-веба еще не существовало] </i><br>
<p>
<b> Во-первых</b>, Молли подменяет ТеХ более простым и общеизвестным сегодня  HTML-форматированием,<br>
с одним дополнением: результат создается в формате "складного HTML", который облегчает работу<br>
программиста и позволяет масштабировать лит. программирование.<br>
<p>
<b>Во-вторых</b>, Молли может работать в традиционном режиме с командной строки, но позволяет и<br>
упрощенный, ускоренный режим, когда в лит-исходник вставляется вызов Molly, так, что ваш<br>
текст сам становится скриптом на пёрле. Затем держа вашу директорию под местным веб сервером, <br>
вы можете не отдавая промежуточных команд читать отформатированный документ, который вы создаете,<br>
сразу через веб браузер, обновляя страницу  клавишей Ctrl-R.<br>
<p>
При этом ориентироваться в большом исходник и думать лучше глядя на форматированный документ<br>
"орлиным глазом" сверху, видя его структуру и полностью разгрузив мозг от слепого метания<br>
в редакторе (даже если он позволяет "складывать" текст, редактор все равно предполагает, что<br>
общую структуру вы обязаны держать в памяти). <br>
Изменения же в файл легко вносить в "локальном режиме", ссылаясь на нужное место в редакторе<br>
по номерам строк из общего документа. Подробнее об идее "складного HTML" см. ниже.<br>
<p>
<p>
Molly  сейчас <b> самодостаточный скрипт</b> на простом пёрле без дополнительных модулей<br>
и не требует внешних программ. Он использует, однако, <b>разметку Лит. Программирования<br>
примененную в "noweb" tools by Norman Ramsey</b> (с одним ужесточением к формату, <br>
<i> каждый раздел с кодом обязан заканчиваться "@ в первой позиции на отдельной строке"</i><br>
- Ramsey's tool  позволяет эти символы по желанию выкидывать, если за разделом идет другой<br>
раздел с кодом.). Для сравнения результатов (noweb применется больше 10 лет) или ради иных<br>
вариантов обработки вы можете установить noweb  и обрабатывать им файлы, написанные из-под<br>
Molly.<br>
<p>
<p>
<br><br>
<b> 2. Что такое Literate programming? </b><br>
<p>
Нет, это не "программы утопающие в море слов", и не "жирные комментарии, которые можно<br>
вставить в исходник с кодом", самое частое заблуждение относительно Л.П. Это пожалуй даже не<br>
"программы написанные как литературные эссе, с блеском", как тоже часто считают, подслушав<br>
одну из цитат Кнута.<br>
<p>
Во-первых, это <b>"программирование спецификациями, изложенными на человеческом языке"</b>.<br>
Можно сказать, что это написание точных программ произвольными фразами на псевдокоде. Мы<br>
все знаем, что "на псевдокоде - это понятно", потому что чуть ли не все учебники программирования<br>
так нас впервые знакомили с предметом.<br>
Оказывается, и довольно очевидно, такой подход может применяться к строгому программированию.<br>
<p>
Во-вторых, это <b> альтернатива делению программы на подпрограммы/функции </b>, там, где они<br>
не нужны машине (напр. рекурсии используют встроеный конструкт функций по существу), но <br>
применяются лишь для того, чтобы "не потерять нить рассуждений". Наверно, 90% дроблений<br>
делается программистами чтобы не сойти с ума, и, по иронии, один из методов "оптимизации кода"<br>
состоитв "unrolling", разворачивании созданных подделений.<br>
<p>
Кнут, вначале создававший удобную систему документирования мыслей, позже переназвал Literate<br>
Programming "альтернативой процедурному программированию", парадигме победившей после <br>
1970х своего исторического предшественника, который они обозвали spaghetti code и провели<br>
под предлогом угрозы миру программирования от одного мелкого, но террористического<br>
оператора. "Goto" was "considered harmful".<br>
Yep, computer geeks are passionate souls. Программисты пассионарные личности. Интересно, <br>
что Дийкстра и Кнут тогда оказались по разную сторону баррикад, последний издал статью<br>
с примерами "умного" применения goto.<br>
<p>
Поэтому в-третьих, это <b> прием "управления вниманием"</b>, который годаздо более общ, чем<br>
программирование. Как "литературную программу" можно писать что угодно, отчет по работе,<br>
заметки для памяти научную статью или приключенческий роман.<br>
<p>
<p><br>
<b> 3. OK, а как это выглядит практически? </b><br>
<p>
Вот простой конкретный пример.<br>
<p>
Допустим, вы редактор желтой газеты, и однажды обнаруживаете e-mail с сенсационной новостью:<br>
грабители маскируются под мешки с мусором!! (Пояснение для русского пользователя - американцы<br>
выставляют бачки и большие мешки с мусором на тротуары перед домами в своих "спальных районах",<br>
откуда мусор примерно через день забирают мусороуборщики, с которыми подписан контракт).<br>
(Пояснение 2: пример содран с реальной американской городской легенды-страшилки)<br>
<p>
Вы пишете "скелет" статьи, собираете сотрудников и раздаете указания.<br>
<p>
<p>
<i> <b> ..not finished yet.. раздел не завершен.. </b></i><br>
<p>
<i>Должен признаться, что выбор названия отчасти злонамерен. В семидесятые я, как и все,<br>
был насильно вовлечен в реализацию идей структурного программирования, поскольку не мог<br>
вынести обвинения в неструктурированности своих программ. Теперь у меня есть возможность<br>
поквитаться. Вводя термин «грамотное программирование», я возлагаю на всякого, кто его<br>
слышит, моральное обязательство. Никто ведь не захочет признать, что пишет неграмотные<br>
программы.</i><br>
Дональд Э. Кнут <br>
<i>Donald E. Knuth. Literate Programming // The Computer Journal, 27(2):97{111, May 1984 </i><br>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('5');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('6');">
<font class='lnum'><i>(6)</i></font>&nbsp; LP as "management of thinking" </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 286)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='6'></a></legend></fieldset>
<p>
<div id="6" style="display:none">   
<ul>

<p>
    If you never heard of Literate Programming, please read something like the Wikipedia<br>
    article <a href= http://en.wikipedia.org/wiki/Literate_programming > http://en.wikipedia.org/wiki/Literate_programming </a><br>
    and then something like documentation to Norman Ramsey's "noweb" tools and his old<br>
    but excellent article  on the subject (linked from the site).<br>
    <a href= http://www.cs.tufts.edu/~nr/noweb > http://www.cs.tufts.edu/~nr/noweb </a><br>
<p>
    I could actually offer three different definitions of L.P.<br>
<p>
    <b> (1) L.P. is writing programs with arbitrary phrases as pseudocode, which <br>
    then become precise new operators of the literate "meta-language", turned<br>
    into correctly ordered programming statements after "tangling". </b><br>
<p>
    <b> (2) L.P. is writing programs from precise specifications, expressed in<br>
    "normal" human language, rather than with formalized symbols </b><br>
<p>
    <b> (3) L.P. is a technique for "management of thinking" that helps to<br>
    relieve short-term memory of "housekeeping" tasks when creating complicated<br>
    texts and "splits attention levels" for "global thinking" and "local changing"</b><br>
    In this sense the technique is not about programming and is applicable to any<br>
    texts.<br>
<p>
    The general feeling when working with L.P. tools is that of "thinking aloud"<br>
    and writing down notes of your thoughts in the order of your thinking.<br>
<p>
    The biggest problem in managing complex texts of any kind - programming simply<br>
    being the most complicated one - the texts are supposed to contain no errors at<br>
    all - is in holding it all together in one's mind.<br>
<p>
    Human short-term memory is surprisingly tiny, up to 7 to 9 objects simultaneously<br>
    at any one time, psychologists tell us. Therefore, when faced with larger tasks,<br>
    humans need to use a number of "aoivdance techniques" to dance around the limitation.<br>
<p>
    In my experience a script or a program longer than, say 1000 to 1200 lines becomes<br>
    a major problem unless special techniques are used to help one's attention.<br>
<p>
    In programming, probably 90% of "chunking", i.e. division into procedures, or "objects" or<br>
    "functions" are not needed for the machine. They are done <b> simply for the humans not<br>
    to lose the thread of their thinking. </b> Whithout this things would become totally <br>
    unmanageable.<br>
<p>
    This is why people write "domain-specific languages": humans chunk lower-level<br>
    operations into a new 'unit' or 'abstraction', then manipulate higher-level<br>
    abstractions over abstractions over abstractions over abstractions..<br>
<p>
    "Literate Programming" is not a programming-specific technique that allows us to<br>
    create arbitrary systems of abstractions <i> with phrases in a human language </i><br>
    - "in pseudocode" - while staying precise in our specification of the final product.<br>
    Everyone knows that explanation with pseudocode are helpful - that was the way we<br>
    learned of the subject of programming in the first place. Most textbooks are written<br>
    in this way.<br>
<p>
    So L.P. <b><i> is an alternative to procedures and subroutines in the machine language </i></b><br>
<p>
    For example, I can easily write and maintain na LPSource file with<br>
<p>
<font class='lnum'>343</font>   
                <div id=codechunk343>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;logical switch&gt;&gt<sub></sub>=</legend>
<font class='lnum'>344</font>    if (<font class='chunkref'>&lt;&lt;condition A&gt;&gt;</font>) {
<font class='lnum'>345</font>       <font class='chunkref'>&lt;&lt;a thousand-line-long piece of code&gt;&gt;</font>}
<font class='lnum'>346</font>    else { 
<font class='lnum'>347</font>       <font class='chunkref'>&lt;&lt;another thousand-line-long piece of code&gt;&gt;</font>}
<font class='lnum'>348</font>   </fieldset></pre>
</div><p>
    (and specify all those references elsewhere), while such code written directly would be<br>
    unmaintainable and almost impossible to understand to a human. As a result, a human would<br>
    <i> have to </i> wrap his code into some subs, with inherent limitations and complications<br>
    on their parameters and return result, built into his programming language.<br>
    The machine would slow down its execution because internally it will maintain environment<br>
    to switch to when returning etc.<br>
    Isnt't it ironic that "hand-made optimisations" include "unrolling" programming constructs<br>
    programmers introduced on the first place? The reason most probably was that otherwise<br>
    a human mind would not be able to keep the thread, it would have lost it, while  all the<br>
    introduced paraphenalia is totally unnecessary for the machine execution.<br>
<p>
    Subroutines or functions are sometimes necessary. To give one example - to create a recursive<br>
    invocation the programmer uses the built-in ability of a function to push its current state<br>
    on the stack and then to automatically pick up where left upon returning.<br>
    But probably 90% of all sub-dividing in programming is done just for the humans not to get<br>
    lost in the sea of code.<br>
<p>
    So, a slightly expanded third definition, which is relevant to my attempt to marry L.P. and<br>
    outlining is:<br>
    <ul> <i> <b> Literate Programming is a system of free-form macros in a natural human <br>
    language used as an alternative to programming language procedures <br>
    (functions) when those serve as props to limit load on human attention<br>
    span, and totally unnecessary for machine execution in themselves </b> </i> </ul><br>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('6');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('7');">
<font class='lnum'><i>(7)</i></font>&nbsp; Three problems with L.P. -- unification of L.P. and folding </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 375)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='7'></a></legend></fieldset>
<p>
<div id="7" style="display:none">   
<ul>

<p>
    Donald Knuth first was thinking of how to document his code when he created a mish-mash of<br>
    previous attempts at similar management techniques with macros, which he called "WEB" (at<br>
    the time when no "www-web" existed yet).<br>
    Then he proclaimed this was the best way to write programs he knows, and repositioned it<br>
    as "a programming paradigm", in direct competition to the "structural programming",<br>
    introduced in the previous decade.<br>
<p>
    Acceptance of this new method of program writing however was disappointing. I believe, there<br>
    were and still are three factors at play, which hurt it, even though the name of L.P. creator<br>
    ensured L.P. would never fall into complete obscurity.<br>
<p>
    <ul><br>
        <li> <b> First, L.P. used TeX as a formatting tool </b>, which is a sort of programming language in<br>
        itself. Therefore, the first thing to blame L.P. for became "but I'd need to write - <i> and <br>
        debug! </i> - two programs at the same time, in TeX and in my own machine language.<br>
<p>
        Today when much, much simpler markup languages abound - "html" or even "markdown <br>
        html" or even "wiki" for the majority of uses that do not require typesetting complicated<br>
        equations or graphs - this problem has long been solved.<br>
        You do not need to "debug" basic HTML markup - any error is displayed in your browser as a<br>
        distortion of the web page, I do not need to "debug" html when writing with my Molly script<br>
        which uses html markup.<br>
<p>
        </li> <li> <b> Secondly, the first generation of L.P. tools was language-specific. </b> You could <br>
        do Pascal, but not Fortran. Later "C" and "Fortran" literate tools were added, but you could<br>
        not do Lisp or Ada etc.<br>
<p>
        Today with tools like "noweb" by Norman Ramsey this problem has long been solved. Simplified<br>
        to its core idea Literate Programming is now totally language-independent to the degree that<br>
        you can write books or essays with L.P. tools not even knowing how to program for the computer.<br>
<p>
        </li> <li> <b> And the third problem is the flat file structure of Literate Source files </b> and<br>
        (probably that could be listed as the fourth, psychological stumbling block) the insistence<br>
        on "producing clean documentation" or "polished essays" of one's programs other could read<br>
        and enjoy.<br>
<p>
        Flat files continue to limit the size of the literate source files: your mind still <i> has to<br>
        keep internally the overall structure of your program </i> and switch from it to doing concrete<br>
        tasks.<br>
        Technically a Literate Source file can include <i> many </i> program files ( e.g. project.h,<br>
        project.c, a makefile and a README). In reality the size is limited by your "attention horizon"<br>
    </li> </ul><br>
<p>
    <b> I propose to solve  this last problem by combining L.P. with folding or outlining </b> ,<br>
    using html and javascript as the simplest and ubiquitous tools.<br>
<p>
    The Literate Source file is written in basic HTML, or even in "markdown" or "wiki"-style markup<br>
    notation. The script then automatically creates a document with folds at each heading line<br>
    (i.e. "h1", "h2", ...). The file can be "weaved" from command line or produced dynamically <br>
    under a web  server as a CGI document.<br>
<p>
    Folding must allow opening an arbitrary number of sections from any place in the file to create<br>
    a sub-view of the document, a small document which is relevant to some particular sub-task.<br>
    These sub-views must persist for the time of this particular work, i.e. the user should not<br>
    be forced to reopen his subview over and over again. That is, I should in effect be able to read<br>
    snippets constituting 2 pages of text relevant to my immediate task contiguously from  a <br>
    5MB file  and  not even notice that, as the rest is tucked out of the way.<br>
<p>
    Common practice in IDEs and outlining editors is an arrangement of folding in which  a <br>
    programmer is allowed to see only one section at a time, not, say, 5 of them from many places,<br>
    opened as a sort of "view". Opening only a single subsection at a time is the death of the idea<br>
    of folding or outlining. It simply strips it of its usefulness. The human perception then becomes <br>
    "mosaic".<br>
<p>
    <i> As an example of totally wrong presentation, </i> which  fragments perception into poorly<br>
    connected pieces and does not allow a reader to see the forest for the trees and see <br>
    documentation of GNU libavl <a href= http://adtinfo.org/libavl.html/ > http://adtinfo.org/libavl.html/ </a> <br>
    It is not humanly possible to follow the train of thought from such a presentation: one has to<br>
    keep an internal mental map of the document <i> before </i> reading it and inability to see more than<br>
    one snippet puts a stop to perception: once the snippet is left, one has to rely on memory of<br>
    previously read pieces to relate things to each other.<br>
<p>
    Nor the split HTML, nor the flat file format provide for human-friendly perception of code<br>
    unless it is  a small short self-contained piece.<br>
<p>
<p>
    <i> A document that is based on a structure of folding subsections </i> drastically increases<br>
    one's attention span, allows to manage easily thousands and thousands of lines of text, and<br>
    makes easy an inclusion of many different types of files into what becomes one <i> Literate <br>
    Source Project file </i> .<br>
<p>
    A number of techniques becomes possible which have not been possible before in a flat file. <br>
    Snippets testing language constructs, doubling certain "chunks" while keeping a pointer in a<br>
    "linker chunk" to preserve the previous working version of your program while experimenting<br>
    with a new one (previously one would have to use version control or rename files for that), <br>
    making collections of loosely related documents and script, each still obtainable through<br>
    tangling, such as a collection of system administration policies, readmes, config files and <br>
    many scripts -- all become easy with a folding literate source file.<br>
<p>
    And consequently emphasis moves from the creation of usually comparatively compact programs<br>
    exposed as a sort of polished essays (or documented for their logic in the order of thinking)<br>
    --  to using Literate Source folding files as your "work log" or "a log of thinking" when<br>
    developing a program, like a scientist might keep a log of his experiments.<br>
<p>
    Clean version of documentation or program presentation might emerge from it, later, but at the<br>
    moment of conception the most urgent task is to preserve your thinking, however "clever" or<br>
    "stupid" that might be and unload all "houskeeping" from your mind, to stop straining to<br>
    remember where which change must go.<br>
<p>
    Such literate project files however do become good documentation, it seems, even without much<br>
    further polishing, as polishing occurs naturally with developing and rewriting your program.<br>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('7');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('4');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('8');">
<font class='lnum'><i>(8)</i></font>&nbsp; </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 482)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='8'></a></legend></fieldset>
<p>
<div id="8" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('8');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('9');">
<font class='lnum'><i>(9)</i></font>&nbsp; PART II ------------ HOW TO USE MOLLY.pl ------------ </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 485)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='9'></a></legend></fieldset>
<p>
<div id="9" style="display:block">   <script language=javascript> 
            document.getElementById("toc"+ 9).className='hilited';
            </script>   
<ul>


<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('10');">
<font class='lnum'><i>(10)</i></font>&nbsp; My workflow - literate programming with Molly </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 490)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='10'></a></legend></fieldset>
<p>
<div id="10" style="display:none">   
<ul>


<p>
 <img src=eeerotate.jpg align=right hspace=5 width=200 border=2><br>
<i> <b> A prerequisite of sorts </b><br>
Use a vertically rotated screen (with an external keyboard and mouse<br>
on a notebook) or a large  enough screen to see a vertically positioned<br>
A4 sheet of paper to obtain full advantages of outlining and folding <br>
Psychologically, the more we see, the more "clever" we are.<br>
<p>
<b>Stop reading compicated documents through a slit</b>: with mental<br>
perception crippled,  you'll just jump between fragments, and<br>
never truly "get the whole picture". </i> <b> &gt;&gt;&gt; </b><br>
<p>
Rotation on Linux is done by running <pre> xrandr -o right|left|normal </pre><br>
from an X terminal window. Most modern video cards support this.<br>
<p>
<b> The Workflow </b> :<br>
<ol><br>
    <li> I run a web server on localhost:8000, for myself only. My<br>
    development directory is under the web server - or is linked to<br>
    the web server document tree.<br>
<p>
    </li> <li> I write my Literate Source file in a vim editor. I mark up<br>
    the documentation section (i.e. not code) with most basic HTML tags<br>
    (e.g. &lt;h2&gt;, &lt;b&gt;, &lt;ul&gt; ...). <br>
    The code sections live between "&lt;&lt;section name&gt;&gt; =" and "@" <br>
    (in the first position in the line), as is required by "noweb"<br>
    literate programming tools. Other code sections can be referred to<br>
    from inside code section with "&lt;&lt;name of section referred to&gt;&gt;".<br>
<p>
    </li> <li> I view my file in a web browser, and reload the page after editing updates.<br>
    Because I write my Literate Source with help from the MOLLY.pl script<br>
    (see below how to  set it up), every "heading" in HTML (i.e.  h1,  h2  etc. )<br>
    automatically becomes a <b> folding subsection </b> of the document I see in<br>
    the browser, and every code section is  automatically formatted with line<br>
    numbers and a frame.<br>
<p>
    </li> <li> When I think ("globally"), I look at the formatted, immediately updating<br>
    document in the browser, keeping open only the sections relevant to my thinking.<br>
    When I edit, I refer to the line numbers, and avoid navigating "blindly" in the<br>
    programming editor, stressing my memory. I edit "locally".<br>
    This is what makes all the difference.<br>
<p>
    </li> <li> Automatically created folding documents allow me a number of techniques<br>
    and uses impossible previously with flat "literate programming" files.<br>
    Frist, folding HTML and Molly script scale traditional Literate Programming up.<br>
    Then, not only can I avoid stressing memory, but I can also create "virtual<br>
    views" on code that allow me to maintain, debug or develop some aspects of the<br>
    code while totally excluding everything irrelevant, or allow to document overviews<br>
    of functionality, while keeping only scribbles and notes needed for immediate <br>
    programming alongside actual code, etc. etc. etc.<br>
<p>
    </li> <li> I tangle the created code either directly with a built-in Molly tangler, with<br>
    "notangle" tools from "noweb", or by running "MyProject.tangle", which is a link to <br>
    "MyProject.weave", the actual main Literate Source file turned into a perl script by<br>
    inclusion of the MOLLY.pl into it.<br>
</ol><br>
<p>
See details about this setup and possible uses of it below.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('10');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('11');">
<font class='lnum'><i>(11)</i></font>&nbsp; SET UP a Literate Source file and project </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 553)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='11'></a></legend></fieldset>
<p>
<div id="11" style="display:none">   
<ul>


<p>
<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('12');">
<font class='lnum'><i>(12)</i></font>&nbsp; Prerequisites </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 559)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='12'></a></legend></fieldset>
<p>
<div id="12" style="display:none">   
<ul>


<p>
<b> Brief answer: </b> None.<br>
<p>
<b> Detailed answer: </b><br>
    Strictly speaking, none except for core Perl (and any web server and web browser<br>
    for operation in CGI mode).<br>
<p>
    The script now has a built-in tangler, which can tangle arbitrary roots from the<br>
    Literate Source file.<br>
<p>
    However it is possible to  use a "pass-through" tangler, i.e. delegate actual<br>
    tangling to the "notangle" utility from the "noweb" suite - or to tangle from<br>
    your Literate Source file directly with "notangle", as Molly shares markup<br>
    with it.<br>
<p>
    "Noweb" set of tools has been around for more than 10 years, and is well tested.<br>
    It is also more flexible, at least for now.<br>
    It may be prudent to compare tangled output of Molly with that of noweb, until you<br>
    feel sure you can trust it.<br>
<p>
    Please obtain and install "noweb" . <i> Make sure the tangler is in your path </i><br>
     <a href= http://www.cs.tufts.edu/~nr/noweb > http://www.cs.tufts.edu/~nr/noweb </a><br>
<p>
    Any version will do, e.g. the one based on shell and awk. I created the MOLLY script <br>
    to work with the overall markup of the "noweb" tools. It means your project file(s) <br>
    can be directly processed with "noweb" tools. MOLLY is mostly intended as an alternative<br>
    weaver which creates folding HTML documents on the fly.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('12');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('13');">
<font class='lnum'><i>(13)</i></font>&nbsp; Two ways to invoke Molly  </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 591)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='13'></a></legend></fieldset>
<p>
<div id="13" style="display:none">   
<ul>


<p>
<b> Brief answer:</b><br>
<p>
    (a) From command line. Run "MOLLY.pl -h" or "--help" or without args<br>
    to see a help screen<br>
    (b) In "Quick Mode" by turning your Literate Source into a Molly-script. This<br>
    runs as CGI, too. <br>
<p>
<b> Detailed answer: </b><br>
    Molly like any traditional Literate Programming tool can be used on its target<br>
    files from command line. So, to tangle to STDOUT, do:<br>
    <pre>   MOLLY,pl my_literate_source_file  # this will tangle out from "*" 
    or MOLLY.pl -R 'root chunk name' my_literate_source_file </pre><br>
    and to weave to STDOUT<br>
    <pre>   MOLLY.pl -w my_literate_source_file </pre><br>
<p>
    However,  another "shorthand" way to treat your LitSrc file, more convenient during<br>
    development is to include a short section with configuration parameters and a call to<br>
    Molly at the top of it. Your LitSrc file (which you make executable) becomes then a perl <br>
    script that works on itself, choosing weaving or tangling according to its file extension.,<br>
    and you can do a Quick Weave and a Quick Tangle, correspondingly, by running from CL:<br>
    <pre>   ./My_Lit_Src.weave &gt; formatted_documentation.html
    and ./My_Lit_Src.tangle &gt; extracted_code </pre><br>
    (Quick Tangle tangles only from the "default root" chunk, "*").<br>
<p>
    The main idea for this mode was to enable a quick use of it under a local web server:<br>
    the print to STDOUT is picked as CGI and can be immediately seen in your browser <br>
    upon reload of the page ("Ctrl-R").<br>
    So a developer can  read a nicely formatted folding HTML document while he explores<br>
    and thinks, having an "eagle's eye view" of the whole code and concepts,  i.e. "to think<br>
    globally", and use line numbers to get to the right place in his editor, which<br>
    is no longer used for navigating code blindly (and have to keep in his mind the whole <br>
    structure of his program, polluting and  maiming his thinking) , i.e. to "edit locally".<br>
<p>
    The next section explains details of the setup.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('13');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('14');">
<font class='lnum'><i>(14)</i></font>&nbsp; Command-line options (ref) </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 631)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='14'></a></legend></fieldset>
<p>
<div id="14" style="display:none">   
<ul>


<pre>   
<b>COMMAND LINE USAGE: MOLLY.pl [options] [--] filename</b>

   -h, or --help, or no filename
           <i> get this help message </i>


   <b><i>TANGLING Options:</i></b>
           Tangling mode is default, no special option to force needed.

   -R "root_chunk_name", 
           <i>tangle starting from this chunk. if omitted, "*" is default.</i>

   -l 'comment symbol for your language',
           <i>add comments with coresponding line numbers in Lit Src</i>

   -i  <i>information on root chunks: print all roots in your Lit Sourc file(s)
       ALSO: if Molly detects loops, it will abort and print out all chunks, 
       including non-roots, it discovered before the loop</i>


   <b><i>WEAVING options:</i></b>

   -w,  <i>weave from the external target file
       This option presupposes html-marked document sections.</i>


<b>FOR INTERNALLY MOLLIFIED FILES ("Quick Weave" or "Quick Tangle" Mode):</b>
   shortcut invocation - depending on file extension. 

   <i>If run as script:</i>

   "lit_prog_file.tangle" 
           <i>tangles to STDOUT, from default root "*" only.</i>
   "lit_prog_file.weave" 
           <i>weaves to STDOUT as folding HTML; usable under CGI</i>
   
   / You can set your own extensions in the lit.source configuraton section for
   this "Quick Mode" /
</pre>  <br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('14');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('15');">
<font class='lnum'><i>(15)</i></font>&nbsp; Quick Mode: Setting up the file </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 676)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='15'></a></legend></fieldset>
<p>
<div id="15" style="display:none">   
<ul>


<p>
<b> Brief answer: </b><br>
    (a) start from a template (provided in the distribution) or include the Molly invocation<br>
    at the top of your Literate Source file<br>
    (b) make sure it has the right extension for weaving; make a soft link to it with a name<br>
    that has the right extension for tangling<br>
    (c) run from command line to STDOUT or redirect to files, or<br>
    put your directory under a CGI-enabled web server to read output in your browser directly.<br>
    (d) Make sure your file extensions and those that the web server understands as valid CGI<br>
    match.<br>
<p>
<b> Detailed answer: </b><br>
    I aimed at simplifying and eliminating unnecessary steps, and wanted to automate some others.<br>
    Therefore practical work with MOLLY.pl looks like this:<br>
<p>
    <ol> <li> <b> <i> Your Literate Source file must be "mollified" </i> </b>, i.e. you have<br>
    to add an invocation of MOLLY.pl as the first lines of it. Think of it as a template. You<br>
    will write your Literate Source text right after these initial lines.  The minimal template<br>
    is this:<br>
<p>
<font class='lnum'>698</font>   
                <div id=codechunk698>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;minimal MOLLY template&gt;&gt<sub></sub>=</legend>
<font class='lnum'>699</font>       #!/full/path/to/perl
<font class='lnum'>700</font>       do "/full/path/to/script/MOLLY.pl";
<font class='lnum'>701</font>       exit;
<font class='lnum'>702</font>       # delete first space(s) in the next line
<font class='lnum'>703</font>       __DATA__
<font class='lnum'>704</font>       #----------------start of the script------------
<font class='lnum'>705</font>   
<font class='lnum'>706</font>       &lt;h1&gt; And here I start My Project &lt;/h1&gt;
<font class='lnum'>707</font>       Your Literate Source file can be typed here
<font class='lnum'>708</font>   
<font class='lnum'>709</font>       &lt;h2&gt; Subsection &lt;/h2&gt;
<font class='lnum'>710</font>       level 0-99 of subsections are allowed now.
<font class='lnum'>711</font>   
<font class='lnum'>712</font>       Each subsection will be automatically created as "folding". 
<font class='lnum'>713</font>       Javascript must be enabled in your browser to use this functionality
<font class='lnum'>714</font>   </fieldset></pre>
</div><p>
    The perl invocaton and the "__DATA__"  line must start  &nbsp;   &nbsp;  a t  &nbsp;  t h e  &nbsp;  f i r s t  &nbsp;  p o s i t i o n  &nbsp; <br>
<p>
    You do not need any extra perl modules  as pre-requsites, the script uses core perl.  <br>
<p>
    Full template will also set configuration variables which adjust its behaviour.<br>
<p>
    Save this under some name, e.g. MyProject.txt. This turns your Literate Source file into<br>
    a perl script<br>
<p>
    </li> <li> <b> <i> Make it executable. </i> </b> <br>
        <pre> chmod 755 MyProject.txt </pre><br>
<p>
    </li> <li>  <b> <i> The script behaves according to its name extension </i> </b><br>
    The script will produce HTML-formatted documentation, if its name ends with "weave" <br>
    (default - or whatever you selected when setting configuration variables in the <br>
    "mollification" template). <br>
    Invoked under a name with file extension of "*.tangle" (default) it will "tangle",<br>
    i.e. create machine code.<br>
    So,  name or rename your LSFile "MyProject.weave" and create a soft link to it named<br>
    "MyProject.tangle" (or whatever alternative you set in configuration for tangling):<br>
    <pre>
        mv MyProject.txt MyProject.weave
        ln -s MyProject.weave MyProject.tangle </pre><br>
<p>
    Now if you run MyProject.weave, it will dump HTML-formatted documentation of your work to STDOUT<br>
        <pre> ./MyProject.weave &gt; MyProject-formatted.foldingdocument.html </pre><br>
    It you run MyProject.tangle, it will dump machine code from your Literate Source file to STDOUT.<br>
        <pre> ./MyProject.tangle &gt; MyProject-runnable.script.pl </pre><br>
    ( Of course, tangling is independent of the language you program in )<br>
<p>
    For example, if you develop in perl, you can run the resulting script like this:<br>
        <pre> ./MyProject.tangle | perl [perl options here] - </pre><br>
<p>
    Additionally, as the markup is the same as that of "noweb" tools. one can use them directly<br>
    on the My.Project.weave file, with all of their flexibility and extra options.<br>
<p>
    However the idea was to avoid running some of these commands after each change in<br>
    the file manually and to avoid saving the weaved docs: STDOUT can be picked up by<br>
    your local web server as CGI, and you will have an HTML-formatted and which is more<br>
    important, <i> folding </i> document in your browser by simply reloading the page <br>
    (usually with Ctrt+R or a mouse click)<br>
<p>
    </li> <li> Now, <b> <i>  the only other step is to run a local web server </i> </b> <br>
    on localhost, any tiny very simple httpd will do, and tell it to treat "*.weave" as<br>
    valid cgi file extension. (Alternatively, I can set "weaving" to files that end in <br>
    '*.cgi" or "*.pl" etc. in the configuration part of my MOLLY template)<br>
<p>
    One of the simplest WWW servers for such use could be "thttpd", and I will provide you with its<br>
    minimal configuration file below.<br>
    </li> </ol><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('15');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('16');">
<font class='lnum'><i>(16)</i></font>&nbsp; "Mollification" - full configuration template </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 770)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='16'></a></legend></fieldset>
<p>
<div id="16" style="display:none">   
<ul>


Should be self-explanatory, at least after reading this documentation section ;). <br>
May add to this section later. Uncomment to set, otherwise defaults apply.<br>
<p>
<p>
<font class='lnum'>776</font>   
                <div id=codechunk776>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;full MOLLY template&gt;&gt<sub></sub>=</legend>
<font class='lnum'>777</font>   #!/usr/bin/perl
<font class='lnum'>778</font>   
<font class='lnum'>779</font>   #-------------------------------------
<font class='lnum'>780</font>   # -------TOC and INDEX behaviour------
<font class='lnum'>781</font>   
<font class='lnum'>782</font>   # print TOC? 1:0
<font class='lnum'>783</font>   #$print_toc=1;  # default is to print
<font class='lnum'>784</font>   
<font class='lnum'>785</font>   # should we keep TOC expanded? "block":"none"
<font class='lnum'>786</font>   #$toc_expanded="block"; # default is to unfold
<font class='lnum'>787</font>   
<font class='lnum'>788</font>   # should we keep Chunks Index expanded? "block":"none"
<font class='lnum'>789</font>   #$ind_expanded="none";  # default is to keep folded
<font class='lnum'>790</font>   
<font class='lnum'>791</font>   
<font class='lnum'>792</font>   # should we number lines in code sections? 1 : else
<font class='lnum'>793</font>   #$line_numbering = 1;   # default is to number
<font class='lnum'>794</font>   
<font class='lnum'>795</font>   
<font class='lnum'>796</font>   #-------------------------------------
<font class='lnum'>797</font>   #---------MathML options--------------
<font class='lnum'>798</font>   
<font class='lnum'>799</font>   # should we enable MathML via ASCIIMathML.js or LaTeXMathML.js library? 1:0
<font class='lnum'>800</font>   #$enable_ASCIIMathML = 0; #default is to disable as it slows Molly down a lot
<font class='lnum'>801</font>   #$enable_ASCIIMathML = 1;
<font class='lnum'>802</font>   
<font class='lnum'>803</font>   # If yes, what is the full path to the lib? Remember to get the one with proper
<font class='lnum'>804</font>   # escapes for your work, default or modified (see documenation)
<font class='lnum'>805</font>   # CAN BE: (a) local "/full/path/from/root/to/ASCIIMathML_with_modified_escapes.js" or 
<font class='lnum'>806</font>   # (b) in current dir "ASCIIMathML_with_modified_escapes.js" or
<font class='lnum'>807</font>   # (c) on the web, e.g. the original site of the library (unmodified) is:
<font class='lnum'>808</font>   #$path_to_ASCIIMathML = "http://www1.chapman.edu/~jipsen/mathml/ASCIIMathML.js";
<font class='lnum'>809</font>   #$path_to_ASCIIMathML = "ASCIIMathML_with_modified_escapes.js"; # deflt is curr. dir
<font class='lnum'>810</font>   
<font class='lnum'>811</font>   
<font class='lnum'>812</font>   #-------------------------------------
<font class='lnum'>813</font>   #--------Document Markup lang---------
<font class='lnum'>814</font>   
<font class='lnum'>815</font>   # how are doc sections marked? "dotHTML":"rawHTML"
<font class='lnum'>816</font>   #$weave_markup = "rawHTML"; # default is "rawHTML"
<font class='lnum'>817</font>   
<font class='lnum'>818</font>   
<font class='lnum'>819</font>   #--------------------------------------
<font class='lnum'>820</font>   #---------File extensions and tangling options------
<font class='lnum'>821</font>    
<font class='lnum'>822</font>   # what is the file extention to weave it? (perms must allow execution!)
<font class='lnum'>823</font>   # e.g. "scriptname.weave" or "scriptname.cgi" etc.
<font class='lnum'>824</font>   #$weave_extension = "weave";    # default is "weave"
<font class='lnum'>825</font>   
<font class='lnum'>826</font>   # what is the file extention to tangle it? (perms must allow execution!)
<font class='lnum'>827</font>   # e.g. "scriptname.tangle",  "scriptname.pl" etc.
<font class='lnum'>828</font>   #$tangle_extension = "tangle";  # default is "tangle"
<font class='lnum'>829</font>   
<font class='lnum'>830</font>   #When tangling, should I use the built-in tangler? 0:1
<font class='lnum'>831</font>   # (if 0, the "pass-through" tangling will call "notangle"
<font class='lnum'>832</font>   # from Ramsey's "noweb" tools, must be installed and in your path)
<font class='lnum'>833</font>   # $use_builtin_tangler = 0; # default for now is to use external "notangle"
<font class='lnum'>834</font>   
<font class='lnum'>835</font>   # Print LitSource's line no's as a reference in the tangled output?
<font class='lnum'>836</font>   #$print_ref_linenos_when_tangling = 0; # default = 0, no.
<font class='lnum'>837</font>   
<font class='lnum'>838</font>   # ..and the comment for this line-numbering tangle-out and the language will be: 
<font class='lnum'>839</font>   #$code_sections_comment_symbol = "# "; #default is the hash-space
<font class='lnum'>840</font>   
<font class='lnum'>841</font>   # find and print root chunks in the LitSrc (i.e. instead of tangling when run
<font class='lnum'>842</font>   # as "./LitSrc.tangle" from command line) ? 0:1
<font class='lnum'>843</font>   # $show_all_roots = 0; default is not (i.e. to tangle)
<font class='lnum'>844</font>   
<font class='lnum'>845</font>   
<font class='lnum'>846</font>   #--------------------------------------
<font class='lnum'>847</font>   #---------invocation of MOLLY.pl-------
<font class='lnum'>848</font>   
<font class='lnum'>849</font>   # make sure to provide correct and full path to the script here
<font class='lnum'>850</font>   # (default is "current directory"):
<font class='lnum'>851</font>   do "MOLLY.pl";
<font class='lnum'>852</font>   exit;
<font class='lnum'>853</font>   
<font class='lnum'>854</font>   # delete the space before the __DATA__ marker
<font class='lnum'>855</font>    __DATA__
<font class='lnum'>856</font>   #---------------start of script-------------
<font class='lnum'>857</font>   
<font class='lnum'>858</font>   &lt;h1&gt; MY PROJECT &lt;/h1&gt;
<font class='lnum'>859</font>   
<font class='lnum'>860</font>   The main idea for my new project is ..
<font class='lnum'>861</font>   
<font class='lnum'>862</font>   &lt;h2&gt; Subsection 1 &lt;/h2&gt;
<font class='lnum'>863</font>   
<font class='lnum'>864</font>   Here I explain things that come first
<font class='lnum'>865</font>   ................................
<font class='lnum'>866</font>   
<font class='lnum'>867</font>   </fieldset></pre>
</div><p>
<b> "__DATA__" must start at the first position in its line </b><br>
<p>
A better example can be seen in a new project template file that comes with<br>
MOLLY distribution. Copy it to a different name and start editing.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('16');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('17');">
<font class='lnum'><i>(17)</i></font>&nbsp; Sample minimal configuration of thttpd </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 876)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='17'></a></legend></fieldset>
<p>
<div id="17" style="display:none">   
<ul>


<p>
"THTTPD" home is <a href= http://www.acme.com/software/thttpd/ > http://www.acme.com/software/thttpd/ </a> <br>
<p>
From the distro README:<br>
<ul> thttpd is a simple, small, portable, fast, and secure HTTP server. <br>
<b> Simple: </b> It handles only the minimum necessary to implement HTTP/1.1. Well, maybe a <br>
little more than the minimum. <br>
<b> Small: </b>  See the comparison chart. It also has a very small run-time size, since it <br>
does not fork and is very careful about memory allocation. <br>
<b> Portable: </b>  It compiles cleanly on most any Unix-like OS, specifically including FreeBSD, <br>
SunOS 4, Solaris 2, BSD/OS, Linux, OSF. <br>
<b> Fast:  </b>  In typical use it's about as fast as the best full-featured servers (Apache, <br>
NCSA, Netscape). Under extreme load it's much faster. <br>
<b> Secure: </b>  It goes to great lengths to protect the web server machine against attacks and <br>
breakins from other sites. <br>
<p>
It also has one extremely useful feature (URL-traffic-based throttling) that no other server <br>
currently has. Plus, it supports IPv6 out of the box, no patching required.<br>
</ul><br>
<p>
Its compilation is very quick. Its configuration is simpler than that of Apache. <br>
<p>
Supposing I'd like to point my browser at "http://localhost:8000/path/to/MyProject.weave"<br>
Then the minimal configuration will look something like this:<br>
<p>
<p>
<font class='lnum'>904</font>   
                <div id=codechunk904>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;minimal thttpd configuration&gt;&gt<sub></sub>=</legend>
<font class='lnum'>905</font>   #
<font class='lnum'>906</font>   host=localhost
<font class='lnum'>907</font>   port=8000
<font class='lnum'>908</font>   dir=/my/home/00trash/tmp/literate.perl/WORKDIR
<font class='lnum'>909</font>   data_dir=/my/home/00trash/tmp/literate.perl/WORKDIR
<font class='lnum'>910</font>   #chroot
<font class='lnum'>911</font>   
<font class='lnum'>912</font>   # extensions understood as valid "cgi" scripts:
<font class='lnum'>913</font>   cgipat=/**.cgi|/**.weave|/**.tangle|/**.pl
<font class='lnum'>914</font>   #cgipat=/**.tangle
<font class='lnum'>915</font>   #cgipat=/**.weave
<font class='lnum'>916</font>   
<font class='lnum'>917</font>   #logfile=/my/home/00trash/tmp/literate.perl/WWW.server/thttpd.log
<font class='lnum'>918</font>   logfile=/dev/null
<font class='lnum'>919</font>   
<font class='lnum'>920</font>   #pidfile=./thttpd.pid
<font class='lnum'>921</font>   pidfile=/my/home/00trash/tmp/literate.perl/WWW.server/thttpd.pid
<font class='lnum'>922</font>   
<font class='lnum'>923</font>   # uncomment this to be able to link from anywhere to your web server document dir 
<font class='lnum'>924</font>   # (unsecure, for local development only)
<font class='lnum'>925</font>   nosymlink
<font class='lnum'>926</font>   #
<font class='lnum'>927</font>   </fieldset></pre>
</div><b> NOTE </b> that "nosymlink" schizophrenically <i> allows </i> symbolic links in spite of what<br>
thttpd documentation tells you<br>
<p>
The script to start thttpd (it will detach and run as a daemon) is something like this:<br>
<p>
<font class='lnum'>933</font>   
                <div id=codechunk933>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;run.thttpd.sh&gt;&gt<sub></sub>=</legend>
<font class='lnum'>934</font>   #!/bin/sh
<font class='lnum'>935</font>   PROJECT_ADMIN_DIR="/my/home/00trash/tmp/literate.perl/WWW.server";
<font class='lnum'>936</font>   #./thttpd -p 8000 -h localhost -C ./thttpd.config
<font class='lnum'>937</font>   #$PROJECT_ADMIN_DIR/thttpd -nos -C $PROJECT_ADMIN_DIR/thttpd.config
<font class='lnum'>938</font>   $PROJECT_ADMIN_DIR/thttpd -C $PROJECT_ADMIN_DIR/thttpd.config
<font class='lnum'>939</font>   </fieldset></pre>
</div><p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('17');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('18');">
<font class='lnum'><i>(18)</i></font>&nbsp; Markup of code and documentation sections </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 944)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='18'></a></legend></fieldset>
<p>
<div id="18" style="display:none">   
<ul>


<p>
    <b> <i> Markup </i> </b><br>
<p>
    (a) all between <b>&lt;&lt;chunk name&gt;&gt;=</b> and <b>@</b> <b><i>in the first position<br>
    on their own lines</i></b>  is code.<br>
    (b) &lt;&lt;referenced chunk name&gt;&gt; inside code sections means "that chunk contents<br>
    will be put in here". Can be surrounded by other text and one line can have<br>
    multiple references.<br>
<p>
    (c) all the rest is "documentation"<br>
    (d) Documentation is marked with regular HTML - plus two special operators<br>
    for "folding links" and "linked chunks", see below.<br>
    <b> <i> The only difference </i> </b> from the truly "raw" HTML is that except in <br>
    "pre" sections the MOLLY.pl script will add automatic &lt;br&gt; tags at the end of <br>
    each line of your Literate Source file.<br>
<p>
    (e) Top of the file starting with perl invocation to the line starting with "__DATA__"<br>
    in the first position on its own line is considered Molly.pl invocation and is <br>
    filtered out anyway.<br>
<p>
    <i> This coincides with markup for "noweb" tools with one restriction: <b> all code<br>
    chunks must end with "@" in the first postn on its own line</b> <br>
    Noweb allows one to skip them if code sections come one after another.</i><br>
<p>
    <p><br>
    <b> <i> Escapes </i> </b><br>
<p>
    (a) Inside code chunks:  "&lt;&lt;", any text, "&gt;&gt;" on one line will be taken as "chunk ref"<br>
    If your code employs these constructions, substitute with vars (e.g. $lt$lt, $gt$gt <br>
    defined elsewhere for perl), or escape (e.g. &lt;\&lt; inside regular expressions for perl).<br>
<p>
    (b) Inside document chunks: Molly does not stumble on "&lt;&lt;", noweb ("notangle") does.<br>
    So use [[ ... ]], which Noweb understands as escapes - e.g. [[&lt;&lt;text text&gt;&gt;]] - if<br>
    you are going to tangle with "notangle".<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('18');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('11');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('19');">
<font class='lnum'><i>(19)</i></font>&nbsp; CREATE a Literate Source file -- documentation chunks markup</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 985)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='19'></a></legend></fieldset>
<p>
<div id="19" style="display:none">   
<ul>


<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('20');">
<font class='lnum'><i>(20)</i></font>&nbsp; Doc sections markup </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 989)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='20'></a></legend></fieldset>
<p>
<div id="20" style="display:none">   
<ul>


<p>
<ol> <li> <b> The default is to use ordinary 'html' markup </b> in the document sections<br>
The only difference from "true raw" HTML is that MOLLY adds automatic <br>
&lt;br&gt; linebreaks unless lines are inside the &lt;pre&gt;..&lt;/pre&gt; sections<br>
The script also cuts out vim folding marks -- { { { number ... } } } number<br>
-- without spaces  and "#------------" lines.<br>
<p>
<p>
</li> <li> <b> Any "markdown" or "wiki"-style markup can be added </b> to MOLLY. Another <br>
reasonable suggestion could be a simple translator from basic TeX markup etc.<br>
Some of this functionality is unnecessary to reimplement, as "noweb" or third-party <br>
filters can be run on the document after MOLLY weaving or from inside MOLLY.<br>
<p>
</li> <li> <b> dotHTML is an example of a simple markup </b> which can be done with regular<br>
expressions, which is several most basic HTML tags inside "dots" instead <br>
of angle brackets.<br>
<p>
Dots do not require switching the keyboard register, and therefore I can speed up<br>
typing and avoid annoying repeating typos. This is my own "markdown" of sorts.<br>
<p>
Currently implemented tags are (write them inside "dots", not "&lt;..&gt;"):<br>
<ul> &lt;br&gt; &lt;p&gt;  &lt;s&gt; - &lt;/s&gt; &lt;pre&gt; - .. &lt;b&gt; - &lt;/b&gt; &lt;i&gt; - .. &lt;ul&gt; - .. &lt;ol&gt; - ..<br>
&lt;li&gt; - ..<br>
<p>
Special marks are dot-&lt;-dot and dot-&gt;-dot (no dashes, like ". &lt; ." <br>
without spaces) which are needed if the tag includes some options or<br>
is not among the tags "dotHTML" understands already.<br>
These will be converted to single &lt; and &gt; respectively.<br>
This is clumsy, but for quick sample and to speed up typing I found<br>
it sufficient. So far.<br>
<p>
<p>
And there are three special, non-HTML marks I introduced for convenience.<br>
(a) dot-x-dot ... dot-/x-dot <i>on one line only </i> will  &nbsp;   &nbsp;  f o r m a t  &nbsp;  t h e  &nbsp;  p h r a s e  &nbsp;  as spaced<br>
(b) dot-a-dot http://some/URL dot-/a-dot will create a hyperlink <a href= http://some/URL > http://some/URL </a> <br>
(c) dot-sp-dot - creates a space<br>
</ul><br>
<p>
etc. I add them as I go, whenever I need them for my current document.<br>
<p>
This formatting also adds &lt;br&gt; linebreaks unless lines are inside the <br>
&lt;pre&gt;..&lt;/pre&gt; sections.<br>
"dotHTML" also cuts out vim folding marks <br>
<pre> { { { number ... } } } number </pre><br>
without spaces, and  comment lines with dashes<br>
<pre> "#------------" </pre><br>
</li> </ol><br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('20');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('21');">
<font class='lnum'><i>(21)</i></font>&nbsp; Choking on bad strings - on Markup and Escaping</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1041)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='21'></a></legend></fieldset>
<p>
<div id="21" style="display:none">   
<ul>


<p>
<b> Brief answer</b> <br>
.. was given here:         <a href="#18"
        onclick="open_all_above(18);" 
        ><i>(18)</i> Markup of code and documentation sections<sup>flink</sup></a>
<br>
<p>
<b> Detailed answer:</b><br>
<p>
Escaping in files marked in multiple ways is a big source of all kinds of errors.<br>
Currently Molly should be able to take care of most cases.<br>
<p>
Exceptions include:<br>
<p>
1.  <b> double angle brackets "&lt;&lt;" and "&gt;&gt;" and the "@" sign </b><br>
Those confuse the "notangle" tool from Ramsey's "noweb". While Molly treats<br>
double angle brackets and "at" as a switch between documentation and a code chunk <i> only<br>
if those are in the first position in the line </i>, "noweb" stumbles.<br>
<p>
If you tangle through Molly (by running "my_project.tangle &gt; source.code"), Molly will<br>
filter these out. If you run "notangle" directly on the project file ("notangle -R'some <br>
root chunk' my_project.weave &gt; source.code"), it will fail.<br>
<p>
Therefore in this file I always <i> use extra white space btw angle brackets as an escape </i><br>
<p>
2. If you enabled the use of ASCIIMathML.js library to display mathematical exressions in<br>
you document, then <b> double backticks </b> on both sides of any expression pass <br>
processing to the library. (It also processes everything between "a m a t h" and<br>
"e n d a m a t h" tags - no spaces btw letters - in you file).<br>
Make sure that your target programming language or any future "markdown" you are going to <br>
add to Molly does not use these signs at all -- or re-edit the javascript library to<br>
substitute all inclusions of double backticks to sth else.<br>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('21');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('22');">
<font class='lnum'><i>(22)</i></font>&nbsp; Markup and Editor highlighting </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1074)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='22'></a></legend></fieldset>
<p>
<div id="22" style="display:none">   
<ul>


<p>
<b> Brief answer:</b> <br>
<p>
Vim editor, as well as emacs, have literate programming syntax highlighting modes<br>
available for litprogramming with "noweb" markup. Download and install.<br>
<p>
<b> Detailed answer:</b><br>
<p>
Working with Literate Programming documents will throw off your editor highlighting<br>
unless you configure a special 2-language mode: all text as "html" (or "plain text"<br>
if you wish), and the target language(s) inside literate code sections.<br>
One problem is your Literate Source file may include <i> many </i> target languages:<br>
Makefiles, shell scripts, one or more scripting or compile languages etc.<br>
<p>
The Vim editor has a "noweb.vim" and a "nw.vim" sample highlighting configuration files.<br>
They both derive from the same ancestor. "noweb.vim" is more sophisticated, and allows<br>
a user to have many target languages which are switched according to a regex match on the<br>
title of the chunk. I.e. one tactic would be to name your chunks "subtree XX - Makefile",<br>
or "xxxxx - c source" etc.<br>
<p>
The files are obtainable from <a href= http://www.vim.org > http://www.vim.org </a><br>
<p>
It is also possible to have a number of one-language highlighters - "noweb-perl.vim",<br>
"noweb-sh.vim" etc - which are trivially generated, and switch quickly while editing,<br>
without coding the language in the names of the chunks.<br>
<p>
It is possible to keep "noweb.vim" for full highlighting, and "nw.vim" just to recolor<br>
all docs, say, greenish, and all literate code chunks blue, and switch whenever it is<br>
convenient. Make sure to rename internal vars in (the simpler nw.vim), because otherwise<br>
they will clobber each other.<br>
<p>
For Molly also change the "default" (for the doc sections) from TeX to HTML.<br>
<p>
Vim is also good in the sense that its folding and prompts for symbols, nor its completion<br>
of HTML tags depend on teh highlighting mode - in simpler editors those depend on each<br>
other and make life unpleasant.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('22');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('23');">
<font class='lnum'><i>(23)</i></font>&nbsp; Navigation in the Folding HTML document </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1115)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='23'></a></legend></fieldset>
<p>
<div id="23" style="display:none">   
<ul>


<p>
Mostly explained here:<br>
        <a href="#34"
        onclick="open_all_above(34);" 
        ><i>(34)</i> READ and SEARCH inside a Folding Literate Source file<sup>flink</sup></a>
<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('23');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('24');">
<font class='lnum'><i>(24)</i></font>&nbsp; Chunk links and Virtual Views on code </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1123)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='24'></a></legend></fieldset>
<p>
<div id="24" style="display:none">   
<ul>


<p>
<b> Format  </b><br>
<p>
    <i><b>1. A chunk link</b></i> is a fieldset frame which can be clicked open to display<br>
    a clone of any <i>code</i> chunk in your document in any place.<br>
<p>
    (a) <i> Format for chunk, section links </i> - write in your Lit Src file<br>
      <pre>[[LINKED_CHUNK name of chunk verbatim]]</pre><br>
    There can be any number of space chars btw the reserved word<br>
    LINKED_CHUNK and the name of the code chunk being linked to<br>
<p>
    CHUNK_LINKs must reside on their own line (white space before and after is ignored)<br>
    Example:<br>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;sub print usage&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk2880', 'clonebody0');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody0');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody0">
    </div>
    </fieldset>

<p>
    More examples in:         <a href="#109"
        onclick="open_all_above(109);" 
        ><i>(109)</i> Tests of a chunk link, section link and flink functionality<sup>flink</sup></a>
<br>
<p>
    (b) <i> Chunk splinters </i> According to one of the standard features in LitProg,<br>
    a chunk with the same name may be written many times in the LitSource file.<br>
    Each subsuquent "chunk splinter" will be appended to the first one, and placed<br>
    at the location of the first such chunk. This fits perfectly with the need to add<br>
    to C language var definitions from any place where you are logically coding,<br>
    or to header files etc.<br>
<p>
    If you use the straight "[[LINKED_CHUNK ..." invocation, Molly will show all splinters<br>
    in your formatted document. If you wish to address a particular splinter (e.g. 3), use<br>
    <pre> [[LINKED_CHUNK_3 verbatim_chunk_name]] </pre> <br>
    i.e. append "underscore-the splinter number" to the reserved word. Splinter numbers<br>
    are displayed as subscripts in the document ouput by Molly.<br>
<p>
<p>
    <p><br>
    <i><b> 2. "Flink"</b></i> is like a local href link, but for a folding document<i>section</i><br>
    It opens all sections above the target, so that target becomes <br>
    visible, then jumps to it<br>
<p>
    <i> format of a flink</i> in Lit Source file is <br>
      <pre>[[F L I N K name of flinked section verbatim]]</pre><br>
    /* spaces in FLINK were escapes, do not use them - write "[[FLINK" exactly */<br>
<p>
    There can be any number of space chars btw the reserved word FLINK<br>
    and the name of the section<br>
<p>
    Currently one FLINK per line is allowed, although there can be other text around it.<br>
<p>
    Examples can be found at the end of the Molly code sections (PART III of this document)<br>
    See         <a href="#109"
        onclick="open_all_above(109);" 
        ><i>(109)</i> Tests of a chunk link, section link and flink functionality<sup>flink</sup></a>
<br>
<p>
    <p><br>
    <i><b> 3. Virtual Views on code </b> </i><br>
    Linked chunks can be used to create "virtual views on your code. <br>
    The idea is described in <br>
            <a href="#104"
        onclick="open_all_above(104);" 
        ><i>(104)</i> (VIRTUAL VIEW): Creation of Linked Chunk functionality<sup>flink</sup></a>
<br>
<p>
    See tentative examples of VVs here (and the link below is an example of a  "Flink"):<br>
            <a href="#108"
        onclick="open_all_above(108);" 
        ><i>(108)</i> Numbering Chunk Splinters and Putting Links in the Chunks Index<sup>flink</sup></a>
<br>
            <a href="#111"
        onclick="open_all_above(111);" 
        ><i>(111)</i> (VIRTUAL VIEW): example of additional markup - dotHTML<sup>flink</sup></a>
<br>
<p>
    <p><br>
    <b> Suggested Uses </b><br>
<p>
    CHUNK_LINKs allow the developer to keep alternative text around code chunks and collect <br>
    those chunks in sections in any arbitraty number and order, thus creating multiple "Virtual<br>
    Views" on the code. Consider:<br>
<p>
    <i><b>Scenario (a)</b></i> I have main code with comments which are more like programmer's notes for <br>
    memory, not polished documentation. However I can write a section post-factum with clean<br>
    explanation and overview of the code, inserting CHUNK_LINKs to refer to  the necessary chunks.<br>
<p>
    <i><b>Scenario (b)</b></i> I have my main code written out, but for maintenance, or to correct a bug, I'll<br>
    need to modify code in many places.<br>
    I'll first think and decide where the code resides. I'll create a folding subsection  and start <br>
    putting down chunk links in there, with brief explanatory notes. Then I'll use this quickly<br>
    created "virtual view" to jump to the correct line by its number in my text editor to do<br>
    the fix or changes. I attempted something similar here:<br>
            <a href="#108"
        onclick="open_all_above(108);" 
        ><i>(108)</i> Numbering Chunk Splinters and Putting Links in the Chunks Index<sup>flink</sup></a>
 (I actually did the<br>
    change the described way and liked the experience)<br>
    or here         <a href="#106"
        onclick="open_all_above(106);" 
        ><i>(106)</i> Actual implementation (with links to affected code sections<sup>flink</sup></a>
 (in this example<br>
    the section was written post-factum, and is more of an overview or documentation of <br>
    introduced changes)<br>
<p>
    <i><b>Scenario (c)</b></i> I have a huge Literate Source Project file and need to create an explanation or<br>
    a presentation of some side of the project. A Virtual View will do that.<br>
<p>
    Note that subsections, implemented as a V.V. can be printed out, too, while the rest of the <br>
    document is kept folded away.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('24');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('25');">
<font class='lnum'><i>(25)</i></font>&nbsp; Saving multipart work </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1214)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='25'></a></legend></fieldset>
<p>
<div id="25" style="display:none">   
<ul>


<p>
<b> Brief answer: </b><br>
<p>
Basically, save your "weaved" work, which is a "folding HTML" file, and may include<br>
images and/or extra javascript libraries (e.g. for handling MathML, or for code sections<br>
highlighting etc.), as *.mht, which will pack all files into one.<br>
<p>
MHT, while being a Microsoft  format, is readable by most browsers now, e.g. Opera, but <br>
you'll have to install a plug-in for Firefox and family.<br>
<p>
<b> A longer answer</b><br>
.. is given here:         <a href="#33"
        onclick="open_all_above(33);" 
        ><i>(33)</i> How to distribute your final folding HTML-formatted work<sup>flink</sup></a>
<br>
<p>
Note that "folding HTML" has not been tested with Internet Explorer, but has been with<br>
Opera and Firefox.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('25');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('19');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('26');">
<font class='lnum'><i>(26)</i></font>&nbsp; Tangling - extracting code from LSFile </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1235)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='26'></a></legend></fieldset>
<p>
<div id="26" style="display:none">   
<ul>


<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('27');">
<font class='lnum'><i>(27)</i></font>&nbsp; Tangling from LSFile </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1240)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='27'></a></legend></fieldset>
<p>
<div id="27" style="display:none">   
<ul>


<p>
    <ol> <li>  <b> Tangling "default root", "*" </b><br>
    Usually only one file needs to be tangled constantly, the file the developer<br>
    is working on.  It's easiest to do by using the "default root", which is a code chunk<br>
    called "*". When you run <br>
    <pre> MyProject.tangle &gt; source.pl </pre> <br>
    MOLLY will tangle it itself (or pass the command to "notangle" from Ramsey's "noweb"<br>
    tools, as configured at the top of your project file, and then it will print code<br>
    chunks starting from the one named "*". Therefore, I drag along the default root to<br>
    wherever I am editing now and reassigning to it the chunk I need to tangle currently.<br>
    I usually keep the pointer subsection at the top of the Literate Source file. See <br>
    "THE CHUNK TO TANGLE BY DEFAULT" in the file you are reading as an example of this<br>
    technique.<br>
<p>
    This is the task for which MOLLY "quick tangling" is designed.<br>
<p>
    </li> <li> If, however, you need <b> to tangle out non-"*" root </b>, you have two options:<br>
<p>
    (a) run MOLLY.pl from command line:<br>
   <pre> MOLLY.pl -R 'root chunk name' literate_project_file </pre><br>
    If chunk name is not supplied, the script will tangle from "*", the default root. <br>
<p>
    (b) ..or you might run N.Ramsey's "notangle" utility directly on your Lit.Source file. <br>
    <pre> notangle -R 'root chunk name' literate_project_file </pre><br>
    This is the most flexible way, as "noweave" allows for extra pre- and post-processing.<br>
<p>
    </li> <li> If you need <b> to tangle out many source files </b>, then probably the easiest way<br>
    to arrange it is through many invocations of Molly.pl or "notangle" in a makefile.<br>
    Include "Makefile" subsection into your Literate Source file and create a target that<br>
    combines several "notangle -R ... " commands in it.<br>
    Assing default root "*" to the Makefile, then run "MyProject.tangle &gt; Makefile" to create<br>
    it and next run "make targetname" to tangle (and compile, run etc) many files included<br>
    into your Literate Source project file.<br>
    </li> <li><br>
        <b> Numbering lines in the tangle output </b><br>
        Sometimes your scripts or programs fail giving the line number at which error occured.<br>
        Then it is convenient to know where in the Literate Source this piece of code lives.<br>
        There is an option both in "notangle" and in Molly to print LitSource line numbers as<br>
        comments in the tangled output.<br>
<p>
        From command line: <br>
        <pre>   MOLLY.pl [-R 'root chunk name'] -l 'comment symbol' Lit_Source_file </pre><br>
        When using QuickTangling, set the corresponding option in the config section at the top.<br>
        "Comment symbol" is prepended to the line number printout, set it for the language you <br>
        used in this particular tangle-out. <br>
        Default for QuickTangling mode is "# " (hash-space).<br>
<p>
        </li> </ol><br>
<p>
<p>
<p>
    <i> <b> NOTE </b> </i><br>
    that Molly uses the same markup for document and code sections as "noweb".<br>
    Nowever <b> "notangle" allows to skip "@" signs</b> in the first position on the line if<br>
    the next chunk is also code.<br>
    <b> Molly insists on full markup. </b> Molly tangled examples from 'noweb' distribution correctly<br>
    when those were canonized to use full notation.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('27');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('28');">
<font class='lnum'><i>(28)</i></font>&nbsp; Scaling up: tangling from many LS files </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1302)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='28'></a></legend></fieldset>
<p>
<div id="28" style="display:none">   
<ul>


<p>
Built-in Tangler in Molly makes 2 passes over LitSrc file(s) on disk, it does not process<br>
them in buffer memory. Therefore it cannot take piped input. However this type of tangler<br>
is easy to adjust for processing many LitSource files <i> (note: this is different from<br>
extracting several <b>target, code</b> files from one or many Literate Source project files) </i><br>
<p>
When you project scales up so that even folding features of Molly cannot overcome<br>
inconvenience (e.g. when TOC and chunks index become unmanageable), you can <b> <i><br>
mechanically split </i> </b> your Literate Source file into parts. Remember to "mollify"<br>
the pieces (prepend Molly template at the top) if you use Quick mode based on file<br>
extension. If you use Molly as a traditional weaver and tangler from command line or<br>
scripts, just cut LitSrc mechanically.<br>
<p>
(It also follows from above that you can then "cat" the pieces together into one big whole,<br>
if you wish. Just remove the "mollification" headers from all but the first one, if you<br>
added them, or otherwise simply mechanically "cat" them together.)<br>
<p>
The cut cannot tear your code line inside a code chunk, obviously. You'll most probably<br>
do your cutting at HTML section headings. <b> Code chunk names must remain unique<br>
over the whole project, </b> so you might include file names into their namestrings for<br>
a largish setup, something like this: <br>
<pre> &lt; &lt;code to proces XX - "backengine.section.weave"&gt; &gt; </pre><br>
But that is left to your own imagination.<br>
<p>
However your chunk chains can run anywhere over the parts of your project, and it<br>
will still be tangled correctly. Just supply the names of all partial Literate Source<br>
file names on command line to Molly:<br>
<pre> MOLLY.pl -R'root chunk name' [-l 'comment symbol'] file1 file2 .... </pre><br>
You do not need to give explicit name of the root to tangle from if it is "*", the default.<br>
You might want line numbering for debugging, but otherwise not use it.<br>
(It would be a mistake to set a default root "*" in several partial LitSrc files: these<br>
will be appended together, as follows from the lit. programming format for incremental<br>
definition of a chunk done with splinters under the same chunk name).<br>
<p>
<b> Partial definitions of one chunk, e.g. "chunk A"can be scattered </b> in various<br>
LS files now.<br>
According to Knuth and descending tradition, the first mention of "chunk A" will<br>
begin it, any other code under this name will append to the body of the chunk in<br>
the order it is scanned down the file(s), and inserted in teh first location the chunk<br>
was used.<br>
<p>
Therefore if you have such split chunks and sequencing of code inside is important,<br>
<b> supply filenames to MOLLY in proper order</b>  In other cases order is unimportant.<br>
<p>
This is traditional treatment in Literate Programming and Molly just implements it.<br>
<p>
<b> <i> NOTE 1</i> </b> that multi-file tangling can be used from command line only.<br>
Quick Tangle mode, Quick Weave and all other weaving are done on one file only.<br>
<p>
<b> <i> NOTE 2</i> </b> Do not adjust the HTML sections levels in the split LitSrc<br>
subproject files. Molly won't care if the file to weave and turn into "folding HTML"<br>
headings start not on level 0 or 1 and display all nicely aligned to the left.<br>
This once again means that you can mechanically cut your LitSrc project into pieces<br>
and reassemble them at your  will.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('28');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('26');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('29');">
<font class='lnum'><i>(29)</i></font>&nbsp; Mathematical Formulae - MathML inside Mollified Literate source files </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1362)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='29'></a></legend></fieldset>
<p>
<div id="29" style="display:none">   
<ul>


<p>
<b><i> /-- section needs rewriting - too disorganized and redundant --/ </i></b><br>
<p>
<i> The most common reason users put forward for the continued use of (La)TeX in this day <br>
is its facility in dealing with mathematical notation. However today much <b> simpler HTML </b> <br>
(which is often further reduced to "markdown" level) if <b> used with MathML </b> can cover <br>
most of such needs</i><br>
<p>
<b> 1 </b> There are two libraries in JavaScript, ASCIIMathML.js and LaTeXMathML.js (derived <br>
from the former) which do translation "on the fly" in the reader's browser. Those provide <br>
almost a drop-in  functionality and can be used with Molly.<br>
<p>
The latest version of the ASCIIMathML.js library (2.0.1) includes <b> <i> both </i> </b> <br>
ASCII and LaTex processing. <br>
<p>
<b> 2 </b> There is a very nice "mimeTeX" application which is a C program that can be run<br>
as CGI (i.e. under the same web browser you use for Molly), which produces GIF renderings<br>
of LaTeX formulas on the fly. It is more complete that ASCIIMathML.js.<br>
I will include an option to use it with Molly if it is dropped into your work directory in<br>
a next version.<br>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('30');">
<font class='lnum'><i>(30)</i></font>&nbsp; How to use ASCIIMathML.js in Molly </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1386)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='30'></a></legend></fieldset>
<p>
<div id="30" style="display:none">   
<ul>


<p>
<b> 1 </b>. To enable MathML one needs to use a compliant browser. Currently MathML is built in<br>
Firefox, or it can be enabled in Internet Explorer with a (free) plugin.<br>
<p>
For Opera the support is also built-in, however the library actually checks for the browser type<br>
and then it seems disallows Opera. The Opera browser, however, has another feature to bypass<br>
exactly that and lie about its identity. If "identify as Firefox" is set in your Opera browser,<br>
the MathML output is caught and rendered.<br>
I did not see any difference between Firefox and Opera_pretending_to_be_Firefox in rendering<br>
output of the library.<br>
<p>
<b> 2 </b>. To enable MathML while dynamically creating the folding-html file, I use an LGPLed<br>
Javascript library called "ASCIIMathML.js" from <br>
<a href= http://www1.chapman.edu/~jipsen/mathml/asciimath.html > http://www1.chapman.edu/~jipsen/mathml/asciimath.html </a><br>
(the home page), while only the library itself can be copied from<br>
<a href= http://www1.chapman.edu/~jipsen/mathml/ASCIIMathML.js > http://www1.chapman.edu/~jipsen/mathml/ASCIIMathML.js </a><br>
<p>
<b> 3 </b>. The use of MathML must be <b> enabled in the "mollifying" template </b> at the top of your<br>
Literate Project file, and the path to the ASCIIMathML.js added. See the config. <br>
template subsection above<br>
<p>
<b> 4 </b>. I had to <b> change escape symbols </b> in the library not to conflict with <br>
<i> programming symbols </i> - now it's double backticks instead of single ones -- and <br>
change config option enabling "preservation of $ and $$"<br>
<p>
Therefore a copy of modified library is distributed with the Molly script.<br>
The default location for Molly to work with is in the same directory as the Molly.pl.<br>
Adjust configuration as needed at the top of your script.<br>
<p>
If the rest of your file does not conflict with default ASCIIMathML.js escapes, i.e. does not use<br>
$ signs and single backtics, you can point to the original unmodified library and distribute that<br>
one with your work (see detailed explanations below).<br>
<p>
<b> 5 </b>. This javascript library allows a user <b> to type math formulas in simple calculator-<br>
like ASCII notation with LaTeX constants </b> if needed.<br>
<p>
The interpreted parts of the text must be either:<br>
<p>
(a) <b> <i> between "a m a t h" ...... "e n d a m a t h" tags (no brackets). </i> </b> The script<br>
then tries to differentiate between ordinary text and math expressions and renders the latter<br>
dynamically as MathML - which is then displayed by your browser.<br>
<p>
It might get confused etc. (e.g. because you used underscores somewhere); then your math<br>
could be<br>
<p>
(b) <i> <b> escaped (the math expressions only) with DOUBLE BACKTICKS around them. </b> </i><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('30');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('31');">
<font class='lnum'><i>(31)</i></font>&nbsp; 6 . Some examples and LaTexMathML.js library versions </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1438)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='31'></a></legend></fieldset>
<p>
<div id="31" style="display:none">   
<ul>


<p>
<p>
..are quite intuitive:<br>
<p>
Let's try some interesting formulas: <br>
E=m c^2 ---&gt; ``E=m c^2`` and e^(i pi)=-1 ---&gt; ``e^(i pi)=-1``<br>
<p>
and AA x in CC (sin^2x+cos^2x=1) ---&gt; ``AA x in CC (sin^2x+cos^2x=1)``<br>
and one more: sum_(i=1)^n i^3=((n(n+1))/2)^2 ---&gt; ``sum_(i=1)^n i^3=((n(n+1))/2)^2``<br>
<p>
..and here are <b> more realistic math expressions </b> taken from a depository of some math <br>
    student and written in TeX notation. I drop $$ .. $$ wrapping the in-lined expressions <br>
    though and delimit it with double backticks instead. Here's the test:<br>
<p>
    Hover your mouse over the expression to see the ASCII/TeX coding:<br>
<p>
Freudental Formula<br>
``mult(\xi)=\frac{2}{(\mu+\rho|\mu+\rho)-(\xi+\rho|\xi+\rho)}\sum_{\alpha\in\Delta^{+}} mult(\alpha) \sum_{k=1}^{\infty}mult(\xi+k\alpha)(\xi+k\alpha|\alpha)``<br>
It includes roots ``\Delta=\left\{k\delta+\alpha|k\in Z,\; \alpha\in \Delta_0\right\}``<br>
positive roots ``\Delta^{+}=\{k\delta+\alpha|k\geq 0,\; \alpha\in \Delta_0^{+}\}\cup \{k\delta+\alpha|k\geq 1,\; \alpha\in \Delta_0\setminus \Delta_0^{+}\}``<br>
<p>
<i> NOTE </i> If you hover with your mouse over some interpreted expression, a baloon<br>
will appear showing the original ASCII markup for the expression. Very nice.<br>
<p>
<i> NOTE 2 </i> the "pre" (preformat) "/pre" HTML tags prevent the library from<br>
rendering the expressions and might even be used as a quick escape tool when you are writing<br>
your page.<br>
<p>
<p>
<p>
<b> Some TeX operators are not understood by ASCIIMathML.js </b><br>
(the failing test is in the ADD-ON MAthML subsection of the Source Code<br>
 section in this document). The reason is most likely that the lib was <br>
never told about those 1 or 2 constants and operators on which it fails<br>
<p>
<b> To solve </b> the problem one might explore another version of the library, "LaTexMathML.js"<br>
(of which there are 2 or 3 versions) changed to  interpret  the actual LaTex code:<br>
<a href= http://www.maths.nottingham.ac.uk/personal/drw/lm.html > http://www.maths.nottingham.ac.uk/personal/drw/lm.html </a><br>
<p>
One more version is here:<br>
<a href= http://math.etsu.edu/LaTeXMathML/ > http://math.etsu.edu/LaTeXMathML/ </a><br>
<p>
One more version (related) of LaTexMathML.js is here:<br>
<a href= http://pillars.che.pitt.edu/LaTeXMathML/ > http://pillars.che.pitt.edu/LaTeXMathML/ </a><br>
<a href= http://pillars.che.pitt.edu/LaTeXMathML/latexmathmlguide.xhtml > http://pillars.che.pitt.edu/LaTeXMathML/latexmathmlguide.xhtml </a><br>
<p>
.. and there is even a perl port for that<br>
<a href= http://pillars.che.pitt.edu/LaTeXMathML/ > http://pillars.che.pitt.edu/LaTeXMathML/ </a><br>
(which also can potentially be used from MOLLY)<br>
<p>
<p>
I have not tested those in full, but the use of JavaScript libraries from MOLLY should be<br>
identical (and so it says in the documentation inside the libraries) to that of ASCIIMathML.js<br>
They are directly interchangeable in a standalone HTML-based editor. Just point to a copy of the <br>
needed lib in the configuration section of your Literate Source file.<br>
<p>
<b> Secondly </b> the home page for the library mentions (at the very bottom) that the library<br>
encoding in its JavaScript source file is straightforward and more translations can be added<br>
as needed.<br>
Here is the URL: <a href= http://www1.chapman.edu/~jipsen/mathml/asciimathextend.html > http://www1.chapman.edu/~jipsen/mathml/asciimathextend.html </a><br>
<p>
I will provide a section in the Literater Source of Molly (in the ADD-ON section for MathML) <br>
to add all necessary definitions. It <b> <i> is </i> </b> very easy ;))<br>
<p>
<b> NOTE </b> <br>
<ul> <li> I had to adjust the lib (double backticks and preservation of $) because I was concerned<br>
with programming languages. The source code must stay untouched by the math library <br>
(mis)translations. That is why I provide a copy of the lib with MOLLY.<br>
<p>
</li> <li> If one wishes to use MOLLY for writing mathematical notation without conflicting computer\<br>
language code sections, one can always <b> link to an unmodified copy of the same lib </b><br>
and distribute that one with your work ( in *.mht files, see below) or even link to an <br>
address on the web.<br>
<p>
</li> <li>The same applies to a version of the lib to interpret TeX rather than ASCII math notation: <br>
MOLLY inclusion of the library is generic, just point to the correct javascript library.<br>
</li> </ul><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('31');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('32');">
<font class='lnum'><i>(32)</i></font>&nbsp; 7 .  ASCIIMathML Markup - reference </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1521)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='32'></a></legend></fieldset>
<p>
<div id="32" style="display:none">   
<ul>


<p>
The full set of ASCII notation conventions for the library can be found on its<br>
home page.<br>
<a href= http://www1.chapman.edu/~jipsen/mathml/asciimathsyntax.html > http://www1.chapman.edu/~jipsen/mathml/asciimathsyntax.html </a><br>
<p>
There are 2 pages there, the first describes the syntax, and the second one shows allowed <br>
LaTex escapes.<br>
<p>
The easiest way to see the ascii code and to use any interpreted page as a reference is to<br>
hover your mouse over an interpreted math symbol or expression. In about a second a baloon <br>
appears  with the ascii source in it.<br>
<p>
There is an on-line tutorial in the use of ASCII math notation  for the library at<br>
<a href= http://www.wjagray.co.uk/maths/ASCIIMathTutorial.html > http://www.wjagray.co.uk/maths/ASCIIMathTutorial.html </a><br>
and <a href= http://www.wjagray.co.uk/maths/ASCIIMathMLinfo.html > http://www.wjagray.co.uk/maths/ASCIIMathMLinfo.html </a><br>
<p>
<b> One more URL </b><br>
"an on-line ASCIIMathEditor" is here<br>
<a href= http://www1.chapman.edu/~jipsen/mathml/asciimatheditor/ > http://www1.chapman.edu/~jipsen/mathml/asciimatheditor/ </a><br>
<p>
It is great to quickly test your expressions. <br>
<p>
Works in my case (firefox on Linux) if I save the page ("full page") and use it from<br>
local files. Could immediately see what I am typing, next copy and paste expressions<br>
into my target file.<br>
<p>
Useful. Just delete the spy from google, "the urchin tracker" from the page ;)) .<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('32');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('33');">
<font class='lnum'><i>(33)</i></font>&nbsp; How to distribute your final folding HTML-formatted work </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1554)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='33'></a></legend></fieldset>
<p>
<div id="33" style="display:none">   
<ul>


<p>
<b> 8 . To distribute your HTML-weaved folding files with MathML notation </b><br>
afterwards you'll have to provide a copy of the JavaScript library with the weaved html <br>
file, as well as any images you might have used there.<br>
This can be done by creating <b> *.mht archives </b> from them.<br>
<p>
(to explain: MHT is a base64-encoded concatenation of elements of a page<br>
    and its images, scripts etc.;<br>
    MAF is a Mozilla zip-comression of page or several with all images etc into one<br>
    archive file).<br>
<p>
Note that because I had to modify escapes in the library for it not to clobber single <br>
backticks and $ symbols, so common in programming, one has to provide a copy of the <br>
modified lib with your HTML work.  You cannot simply link to any copy ot ASCIIMathML.js <br>
found on the Net. (You could if you use an unmodified copy though).<br>
<p>
Internet Explorer has built-in support for *.mht (as it is a MSoft standard).<br>
For Firefox the problem is solved easily by installing either<br>
"UnMHT" add-on: <a href= http://www.unmht.org/unmht/en_index.html > http://www.unmht.org/unmht/en_index.html </a><br>
or "MAF" add-on: <a href= http://maf.mozdev.org/ > http://maf.mozdev.org/ </a><br>
<p>
Then just open the weaved html file in your browser, and "Save As" *.MHT, it will <br>
include all images and the library with it.<br>
<p>
So: (a) weave an HTML file from Molly<br>
    (b) open it in IE or Firefox with MHT add-on, and <br>
    (c) save it as one file.<br>
<p>
This will allow you to distribute your MathML marked files with included images, plots<br>
etc. in a convenient manner.<br>
If you are strictly Firefox-based, you can also use the open zip-based MAF format.<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('33');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('29');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('34');">
<font class='lnum'><i>(34)</i></font>&nbsp; READ and SEARCH inside a Folding Literate Source file </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1594)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='34'></a></legend></fieldset>
<p>
<div id="34" style="display:none">   
<ul>


<p>
<b> Brief answer </b><br>
<ul><br>
<li><b>Collapsing is necessary when</b> you work on code and must exclude <br>
irrelevant sections of the rest of the literate project file. This <br>
greatly helps to clear thinking by eliminating a general feeling of <br>
being in a maze of code and unnecessary "housekeeping" tasks.<br>
One can say that there is a limited "buffer capacity" in the human<br>
mind, and relieving it of the need to remember where things are in a <br>
larger file, at which other points one must fill in values or adjust<br>
invocation etc. <i>immediately makes the user "more intelligent"</i><br>
</li><li><br>
<b>TOC: to toggle</b> a section open/closed, click on the <i>corresponding link</i><br>
Remember to open <i>all sections above it</i> for it to become visible.<br>
</li><li><b>TOC: to open all sections above</b> some internal subsection to make<br>
it visible, click on the <i>section number</i> in the column on the left.<br>
</li><li><b>TOC: to open all above and jump</b> click on the leftmost symbol.<br>
</li><li><br>
<b>To restore the default view</b> <i>reload</i> the page in the browser.<br>
</li><li><br>
<b>To keep some sections open</b> upon each reload: supposing you<br>
work on the code, constantly update it and cannot bother to reopen it <br>
again and again - mark the headings for the sections in the source file<br>
with a plus, i.e. write the opening tag (only)  as +h2, +h3. Again, all<br>
sections above must be marked open too. <br>
<b>Note that</b> "expand all" and "collapse all" disregard these settings.<br>
Reload the page after using those options to again view the text<br>
according to your preferences.<br>
</li><li><br>
<b> To use the Index </b>, click on the numbered sections in the TOC above<br>
(opening them; use highlighting as a guide; when sections are visible,<br>
the slider on your browser window  will shorten too), or "expand all", <br>
and then use your browser's Find function to highlight all chunk name <br>
instances in the visible text<br>
</li><li><br>
<b>To search for variables etc.</b>, "expand all" text - or manually <br>
expand needed sections - and then use your browser's Find function to <br>
highlight all and jump between the found items.<br>
</li></ul><br>
<p>
<b> Detailed answer </b> is in sections below.<br>
<p><br>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('35');">
<font class='lnum'><i>(35)</i></font>&nbsp; Opening many relevant subsections together, TOC highlighting </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1640)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='35'></a></legend></fieldset>
<p>
<div id="35" style="display:none">   
<ul>


<p>
One advantage of the folding format is that - in contrast to most other tools - it allows<br>
    the programmer to open <i> many </i> relevant sections from any parts of the file <i> at the <br>
    same time </i><br>
<p>
    This can be done by "walking" the Literate Source file, as its sections and subsections are a <br>
    kind of TOC of themselves.<br>
    This can be done from the TOC section as well. The open sections get a highlighted background,<br>
    and highlighting appears irrespective of whether the section was opened from the TOC or in the<br>
    body of the text.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('35');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('36');">
<font class='lnum'><i>(36)</i></font>&nbsp; Keeping some sections of the LSFile permanently open </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1656)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='36'></a></legend></fieldset>
<p>
<div id="36" style="display:none">   
<ul>


<p>
The behaviour of folding sections in the mollified LSFile is as follows:<br>
    <ul> <li> If you click on the <b> "expand all" </b> link anywhere in the document, all folding <br>
    sections in the body (not TOC/Index) will open. The limitation is 10000 objects per document,<br>
    hardcoded.<br>
    </li> <li> If you click on <b> "collapse all" </b>, all folding sections in the body will fold. <br>
    The limit is 10k objects per document<br>
    </li> <li> If you <b> reload the document </b> in your browser ("Ctrl-R" or an icon click), the<br>
    document will be shown with sections open or closed <b> as marked </b> in the document itself.<br>
    </li> </ul><br>
<p>
    <b> The markup </b> is simple: if you'd like a section to stay open upon load/reload,  <br>
    add a "+" before "h" in the opening  heading tag:<br>
    <pre> &lt;+h1&gt;, or &lt;+h2&gt;, ... </pre><br>
<p>
    This is important when you work on a section or many sections of your LIterate Source file for<br>
    a longer period and could not click them open in teh browser time and time again, after each <br>
    minor code change when you reload the "project.weave" in your browser to see the updates.<br>
<p>
    Such changes - adding or deleting a "+" - can often be done with one command in a programming editor.<br>
    For example, to open the whole subthread in vim, issue a range command, sth like<br>
    <pre> 1024,1150s/&lt;h/&lt;+h/ </pre> (i.e. substitute between lines 1024 and 1150 of your Literate Source file)<br>
<p>
    Another suggestion is, when you, for example, work with several program files inside your LIterate<br>
    Source (project) file, you might keep subthreads marked open, while changing only the topmost <br>
    heading to show/hide the whole of that file/subthread code and notes.<br>
<p>
    Even when you handpick the sections to keep open, I found, this arrangement suits me well, at least<br>
    for medium-sized LSFiles up to several thousand lines long.<br>
    I also use folding inside "vim", and so line ranges are visible at one glance: "z-a" to collapse the<br>
    vim fold, and then see the range and issue the range command.<br>
<p>
    <i> Note </i> <br>
        <ul> Use of folding inside your programming editor  &nbsp;   &nbsp;  i s  &nbsp;  n o t  &nbsp;  a  &nbsp;  s u b s t i t u t e  &nbsp;  for reading <br>
        a well-laid out formatted document in the browser. Vim folding is still "blind" and  navigation<br>
        inside such a file still has to rely on your memory of the full layout. <br>
<p>
        MOLLY numbers lines in the code sections by default, making jumps from reading in your browser<br>
        to editing a particular line in your editor painless. I could also put it like this: <b> I view<br>
        the file globally </b> in my browser as a folding document when I am thinking, <b> while editing <br>
        "locally" </b> in a programming editor, without thinking about the overall layout of the file.<br>
<p>
        </ul><br>
<p>
    MOLLY.pl is written to filter out vim folding markups ( {{{number ... }}}number ) and those <br>
    will not show on your web page.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('36');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('37');">
<font class='lnum'><i>(37)</i></font>&nbsp; TOC and Code Chunks Index </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1709)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='37'></a></legend></fieldset>
<p>
<div id="37" style="display:none">   
<ul>


<p>
Traditional literate programming tools create extensive indeces of variables and code chunks.<br>
<p>
    The approach in this script is as follows:<br>
<p>
    Index of all code chunks in your LSFile exists (unless a configuration opton in the <br>
    template tells MOLLY to skip it) right under TOC. Click on teh line to expand it, and then use<br>
    TOC section numbers to click open the sections which contain or define the chunks you need.<br>
<p>
    Remember that <i> all parent sections </i> above the needed one must be open for you to see <br>
    the innermost subsection in your browser. This is easy to control through TOC highlighting, and<br>
    as an additional indicator, the slider on your web browser will visibly jerk and shorten when <br>
    new sections will become visible in the browser window.<br>
<p>
    It's also convenient to keep some inner subsections open, but click closed the topmost section to<br>
    quickly hide and unhide larger pieces of code (e.g.complete files which live inside the Literate<br>
    Source File when it is used as a common Project file for many source files, test files, makefile(s)<br>
    etc.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('37');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('38');">
<font class='lnum'><i>(38)</i></font>&nbsp; Searching for symbols, chunks, phrases </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1733)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='38'></a></legend></fieldset>
<p>
<div id="38" style="display:none">   
<ul>


<p>
Web browsers "search" functions  will work on open sections only, at least that's the behaviour of<br>
    Opera and Mozilla browsers.<br>
    This means that instead of creating exhaustive indeces of symbols, which clutter program text, <br>
    especially when they display as HTML links in the output of Weaver tools, one can ensure only the<br>
    interesting subsections are open and then search using the built-in browser function. It usually<br>
    highlights the results and iterates over the found items, which is a nice behaviour.<br>
<p>
    To search in the whole of the LSFile, simply click on the "expand all" under any of the subsections,<br>
    and then again use the browser search function.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('38');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('39');">
<font class='lnum'><i>(39)</i></font>&nbsp; TOC/Index unfolding and collapsing </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1749)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='39'></a></legend></fieldset>
<p>
<div id="39" style="display:none">   
<ul>


<p>
    The TOC and Index at the top of the document can be kept folded or expanded upon initial load<br>
    depending on the configuration variables in the "mollifying" template you add at the top of <br>
    your Literate Project file. Please see the subsection titled '"Mollification" - full template' above<br>
    Of course, those subsections can always be opened/closed manually at any time<br>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('39');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('40');">
<font class='lnum'><i>(40)</i></font>&nbsp; Use for printing </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1758)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='40'></a></legend></fieldset>
<p>
<div id="40" style="display:none">   
<ul>


<p>
Unfolding only the needed sections also seems to work well with printing from the browser window.<br>
    You can therefore avoid picking certain pages manually from "print preview". You'll print only<br>
    the visible part(s) - i.e. the open sections and the topmost folded section names, which do not<br>
    take place if your document is marked in a sane way, and rather help the reader to orient himself<br>
    while looking at the printout.<br>
<p>
    Just remember to check the font size in the "print preview" when preparing to print for the first <br>
    time.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('40');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('41');">
<font class='lnum'><i>(41)</i></font>&nbsp; Text browsers and JavaScript </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1773)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='41'></a></legend></fieldset>
<p>
<div id="41" style="display:none">   
<ul>


<p>
Web page folding seems to work well with text-only www browsers, such as  "lynx" or 'w3m': they do not <br>
understand javascript folding, and so display the whole document.<br>
<p>
Here's an example invocation with w3m:<br>
<pre>  ./MOLLY.weave | w3m -T text/html  </pre><br>
<i> Note </i>MOLLY does not issue HTTP headers, and this may affect browser behaviour. The web server<br>
 and/or browser may add them or not, or ignore them or not. I might need to correct that.<br>
<p>
If JavaScript in your GUI browser is turned off, you'll see only the sections marked in the body<br>
of the Literate Source file as open.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('41');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('34');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('42');">
<font class='lnum'><i>(42)</i></font>&nbsp; SUGGESTED USES: Work with Folding LSFiles</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1791)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='42'></a></legend></fieldset>
<p>
<div id="42" style="display:none">   
<ul>


<i> <b>  section unfinished; an outline of major points for now </b> </i><br>
<p>
I do not show examples below, as the document you are reading itself is an example of the<br>
techniques (and that may be the reason it is too bloated and somewhat unorderly ;)) ).<br>
<p>
<ol> <li> <b> Literate Programming proper.</b><br>
<p>
    Emphasis on note-taking rather than producing a polished "essay" or "documentation"<br>
<p>
    Traditional Literate Programming texts place much emphasis on the fact that it is a means of <br>
    providing <i> documentation </i> (albeit with source code, and reflecting the thinking rather<br>
    than machine-imposed order).<br>
    Knuth first thought of LP as a documentation tool, then upgraded it to a "programming paradigm",<br>
    but insisted on writing programs "like literary essays".<br>
<p>
    However I would like to suggest placing emphasis on NOT documenting and NOT producing <br>
    polished code or an essay in thinking. The first use of this programming technique is <br>
    to  <i> keep a full log of your thinking </i> irrespective of how polished or stupid it is.<br>
<p>
    This is most precious. When you first attack a problem, several directions might come to mind,<br>
    but once you began to work out one of then in detail, everything else is lost. This is the<br>
    way human mind works. Keeping even briefest notes is more valuable than attempting to produce<br>
    polished exposition.<br>
<p>
    Psychological restrain people feel when they are compelled to prepare something for other people<br>
    is probably the third major hurdle to wide spreading of L.P. (the first two were flat file <br>
    structure and formatting languages which doubled the effort of programming and debugging).<br>
<p>
    My MOLLY Literate Source file is a log of my thinking, trials and experiments. I might later offer<br>
    a cleaned version to other people, but I do not give a damn about them in the beginning.<br>
<p>
    Non-folding L.P. source files could not accomodate inclusion of old versions, test files, bad<br>
    versions and skeletons without polutting the file to the degree of becoming unusable.<br>
<p>
    Folding version of L.P. source allows one to relegate bad trials into subsections  nicely folded<br>
    out of the way by merely adding a single header line.<br>
<p>
    When creating documentation, I could double the content of some sections, by copy-pasting the<br>
    "cleaned" versions, and then save a version with the original snippets bypassed, which is<br>
    easy and mechanical with tools like "gema", "awk" or "perl", just put a code word like<br>
    "scrap" in the beginning and end of those sections you'd like to avoid.<br>
<p>
    This ability to bypass marked sections when weaving, by the way, might be incorporated as an<br>
    option into a future version of MOLLY, to produce both 'clean' and 'dirty' versions of the<br>
   formatted Literate Source doc from one file.<br>
<p>
</li> <li> <b> Virtual Views </b><br>
<p>
    CHUNK_LINKs allow the developer to keep alternative text around code chunks and collect <br>
    those chunks in sections in any arbitraty number and order, thus creating multiple "Virtual<br>
    Views" on the code. Consider:<br>
<p>
    Scenario (a). I have main code with comments which are more like programmers notes for <br>
    memory, not polished documentation. However I can write post-factum a section with clean<br>
    explanation and overview of the code, inserting CHUNK_LINKs to quote the necessary chunks.<br>
<p>
    Scenario (b) I have my main code written out, but for maintenance, or to correct a bug, I'll<br>
    need to modify code in 5 places.<br>
    I'll first think and decide where the code resides. I'll create a folding subsection  and start <br>
    putting down chunk links in there, with brief explanatory notes. Then I'll use this quickly<br>
    created "virtual view" to jump to the correct line by their numbers in my text editor to do<br>
    the fix or changes.<br>
    I attempted something similar here:<br>
            <a href="#108"
        onclick="open_all_above(108);" 
        ><i>(108)</i> Numbering Chunk Splinters and Putting Links in the Chunks Index<sup>flink</sup></a>
 (I actually did the<br>
    change the described way and liked the experience)<br>
    or here         <a href="#106"
        onclick="open_all_above(106);" 
        ><i>(106)</i> Actual implementation (with links to affected code sections<sup>flink</sup></a>
 (in this example<br>
    the section was written post-factum, and is more of an overview or documentation of <br>
    introduced changes)<br>
<p>
    Scenario (c) I have a huge Literate Source Project file and need to create an explanation or<br>
    a presentation of some side of the project. A Virtual View will do that.<br>
<p>
    Note that subsections, implemented a VV can be printed out, too (while the rest of the <br>
    document can be kept folded away)<br>
<p>
<p>
</li> <li> <b> Use as a combined Project file </b><br>
<p>
    <ul> <li> to include tests and snippets that implement skeleton functionality to<br>
    be embedded into the main program<br>
    </li> <li> to include versioning and changes in the way  that does not break what<br>
    has been working so far (there was even a special term for that as a programming <br>
    principle). Keep the old version, put it into a subsection, and rename the chunk<br>
    to bypass it. The newer version of the piece of code that is being reworked will<br>
    get the old chunk name to be included into the chain to tangle out.<br>
    </li> <li> To keep a makefile (split, to which I can add lines from many places in<br>
    my Literate Source as I grow it) together with source file(s)<br>
    </li> <li> To keep several source files related logically in teh same Literate Source file.<br>
    </li> </ul><br>
<p>
    <i> Folding meta-files </i> could be used for larger projects, in which <br>
    the meta-file, a folding document, would describe teh topmost level layout of the <br>
    project, and contain ordinary HTML links to partial Folding Literate Sourcefiles, which<br>
    will keep all the junk as described above.<br>
<p>
    In any case, the use of Folding Literate Source files would considerably simplify tracking<br>
    of the project files in a version control system.<br>
<p>
</li> <li> <b> Use for system administration etc.</b> - as a single file to keep many sysadmin scripts, <br>
    descriptions of conventions and procedures, bugs and changes in the system <b> <i> in one place </i> </b><br>
    from which any of the included source (or texts, if they are kept in the "source chunks") <br>
    can be obtained easily with a single command.<br>
    ALSO: combine LIterate Source project file with a makefile as a simple means to keep <br>
    one-command tangling of multiple targets.<br>
<p>
    This Literate Source can live in a central place (e.g. root home) and be under version control.<br>
    The tangled pieces, config files or scripts could be copied to files on one or many machines.<br>
<p>
</li> <li> <b>Use for non-programming tasks:</b><br>
    <ul> <li> as a note-keeper. E.g. I kept job listings and followi-up info in a folding<br>
   MOLLY file and found it quite convenient. <br>
    </li> <li> as an outliner for general purpose texts.<br>
    </li> <li> for keeping documentation, books etc. I keep documentation for a number of<br>
    software tools (e.g. "awk", "newlisp", "monotone") in folding format. It <i> is </i> helpful.<br>
    </li> <li> for editorial work on larger texts. The text itself will become "code chunks", <br>
    and editorial remarks and meta-thinking will remain as "documentation" in a Literate <br>
    Source file.<br>
    </li> </ul><br>
<p>
</li> </ol><br>
<p>
<p>
        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('43');">
<font class='lnum'><i>(43)</i></font>&nbsp; scrap </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1915)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='43'></a></legend></fieldset>
<p>
<div id="43" style="display:none">   
<ul>

(a) //CGI and CL invocations - compared to "noweb"<br>
    // dotHTML tagging; alternative tagging, translations<br>
    // alternative tanglers and pass-through tangler; makefile problem<br>
<p>
(b) ideas - how to incorporate tests; how to keep a single project file;<br>
how to set up dummy plugs and alternatives (i.e. to develop without destroying<br>
the old working version)<br>
Maybe: for distribution of a lot of small scripts (admin etc), the  way I used<br>
Makefiles?<br>
<p>
(c) It's possible even to do development in smallest chunks -- and later (e.g. for<br>
outside clients or for higher-level documentation, etc.) to consolidate the tiny fractured <br>
bits and pieces, with plenty of alternatives, dummies, plugs and trials etc. etc.<br>
How? - by tangling those from some certain level and copy-pasting the result into the<br>
Literate Project File.<br>
One could even keep the actual development fractions in a subsection, while retaining<br>
higher-level and cleaner view in higher level sections. I do not care about doubling the<br>
text at all.<br>
<p>
<b>suggestion from a Slashdot 2002 discussion </b>(see ref above) about style or approach:<br>
do not document what the code does (which is redundant, as can be seen from the code itself),<br>
document rather WHY it does it (what's the purpose or the idea).<br>
<p>
<b> Also </b> use this file itself as an example of all illustrated techniques.<br>
<p>
Use <b>"mollify"</b> as  a technical term (insert MOLLY.pl invocation into the LitProject file)<br>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('43');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('42');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('9');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('44');">
<font class='lnum'><i>(44)</i></font>&nbsp; </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1947)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='44'></a></legend></fieldset>
<p>
<div id="44" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('44');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('45');">
<font class='lnum'><i>(45)</i></font>&nbsp; PART III ------------ LITERATE SOURCE OF THE SCRIPT ------------ </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1950)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='45'></a></legend></fieldset>
<p>
<div id="45" style="display:none">   
<ul>


<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('46');">
<font class='lnum'><i>(46)</i></font>&nbsp; Local Reference </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1955)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='46'></a></legend></fieldset>
<p>
<div id="46" style="display:none">   
<ul>


<p>
<b> VIM regexp to highlight literate code sections only: </b><br>
<i> HAD TO spoil it because "notangle" complained about double diamonds <br>
"in documentation chunk", bastard </i> <b> delete spaces btw angl brckrs </b><br>
<pre> ^&lt; &lt;.*&gt; &gt;=\_.\{-1,}\n^@/e </pre><br>
.. and vice versa, highlight text, leave only code unhighlighted:<br>
<pre> ^@\_.\{-1,}\n^&lt; &lt;.*&gt; &gt;=/e </pre><br>
<p>
<p>
<b> In SciTE, and works in geany, too. Poss. built into Scincilla </b><br>
the //{ and //} allow explicit folding marks in "languages like C etc"<br>
Seems to work in Perl. At least, I could correct/improve geany's folding<br>
by adding leading // to my vim closing fold marks, what does not afect vim.<br>
<p>
Should add that to the filtering expression in MOLLY<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('46');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('47');">
<font class='lnum'><i>(47)</i></font>&nbsp; Bugs, status, changes </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1980)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='47'></a></legend></fieldset>
<p>
<div id="47" style="display:none">   
<ul>


<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('48');">
<font class='lnum'><i>(48)</i></font>&nbsp; Bugs </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 1984)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='48'></a></legend></fieldset>
<p>
<div id="48" style="display:none">   
<ul>


<p>
<b>Mistreatment of tabs in _some_ cases. </b><br>
<s>       (*) Molly tangler will treat tabs OK <i> unless </i> they were met<br>
        in the "while over regexp" where Molly just calculates the length<br>
        of the left margin, which is filled with spaces in "pass 2 - print"<br>
<p>
I.e. chunks referenced from within Makefiles <i> have to </i> be in pos 1<br>
on the line and all tabs used explicitly in their bodies.<br>
<p>
This can be fixed, but not now. </s><br>
<p>
I made sure to "et!" (=expand tabs)  and "retab" in vim to make sure<br>
all indentation I type in code is preserved in folding html <br>
/which may be a good idea generally/<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('48');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('49');">
<font class='lnum'><i>(49)</i></font>&nbsp; Ideas - versions - changes</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2004)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='49'></a></legend></fieldset>
<p>
<div id="49" style="display:none">   
<ul>


<p>
Current version:<br>
<ul><br>
    <li> creates folding documents on the fly..<br>
    </li><li> ..based on rawHTML or dotHTML markup <br>
    (i.e. either creates new docs or displays some existing HTML in folding format);<br>
    </li><li> and generates dynamically TOC and code chunks index;<br>
    </li><li> ties collapsing/expandind of sections with TOC highlighting;<br>
    </li><li> ..provides pass-through tangling with "noweb".<br>
    </li><li> provides built-in fully-fledged tangler which does not clobber tabs<br>
    </li><li> provides a tie to ASCIIMathML.js library for inclusion of <br>
            mathematical expressions in your documents.<br>
    </li><li> can tangle and weave from command line like traditiona lit prog tools<br>
    </li><li> allows for the project to be split into several files or reassembled<br>
            at will: the tangler can process many LitSrc arguments on command line<br>
    </li></ul><br>
<p>
    This script is a test of the concept (LitProg+folding+dynamic web formatting)<br>
<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('50');">
<font class='lnum'><i>(50)</i></font>&nbsp; first ideas </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2027)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='50'></a></legend></fieldset>
<p>
<div id="50" style="display:none">   
<ul>


<p>
<p>
    Options for future versions --  3 ideas for now:<br>
    <ul><br>
    <li> <s> add a built-in tangler (while retaining the possibility to tangle<br>
    through an external tool, such as "notangle" with all its options and filters). </s><br>
    -- DONE<br>
<p>
    </li><li>  &nbsp;  c r e a t e  &nbsp;  a  &nbsp;  f u l l y  &nbsp;  s e l f - c o n t a i n e d  &nbsp;  folding web-based  &nbsp;  w e a v e r  &nbsp; <br>
    ("Lilit") (plus possibly a built-in tangler).<br>
    This can be done in newlisp (www.newlisp.org), which has a built-in httpd<br>
    and allows creation of 250k+(size of script) standalone executables on all<br>
    major platforms (unix/linux, windows mac).<br>
<p>
    </li><li> maybe -  &nbsp;  a d d  &nbsp;  " v i e w s "  &nbsp;  ( a  &nbsp;  l a  &nbsp;  L e o  &nbsp;  v i e w s )  &nbsp;  and maybe editing of single<br>
    subsections (in a pop-up term window with a running editor).<br>
    This - as I see it now - may/will involve storing each subsection in its <br>
    own little file and dynamically concatenating them both for dynamic weaving<br>
    and for tangling ( keep a third name, some "scriptname.src" for dumping the<br>
    full file to STDOUT?? )<br>
    This can be done dynamically: a huge project file will be displayed fully<br>
    collapsed, and then only the sections marked open will be dumped to the web<br>
    browser dynamically.<br>
    The whole thingy can be kept either as a bunch of section-files in a subdir,<br>
    or (and/or) in a tar file (gzipped or not, indexed or not).<br>
<p>
    <b> One possible implementation </b> is with <a href= http://www.wikiwyg.net > http://www.wikiwyg.net </a><br>
    - the "wikiwyg" library, which can turn any "div" into an editable section.<br>
<p>
    The lib as it is distribted does not save (no sub that saves, actually), but<br>
    one can "save in the browser" and next save the page from the browser to a <br>
    local file<br>
<p>
    For a local programming setup ( thttpd on localhost:8000 for example) this<br>
    will do. However one still needs to figure out if there is a possible post-<br>
    processing of the dynamically created (and then saved from the browser) page<br>
    with some script that would strip back the "fieldset" decorations and the <br>
    invocations of folding plus the html head and TOC/chunks index sections.<br>
<p>
    I might say, I need the "reverse weaver" (although not as thorough ?)<br>
<p>
    .. and, secondly, after post-processing, if there is an invocation of "patch"<br>
    which would apply the diffs back to the Literate SOurce file.<br>
<p>
    <ul> <li> Will a "context patch" do? Can I postprocess<br>
    </li> <li> Can I postprocess the dynamically generated HTML to mimic some<br>
    sort of diff markup (unified? Context? ...)<br>
    </li> <li> Third, the exact invocation to apply it to an LSF.<br>
    Is manual restoration of this kind possible? Is it poss to run through a GUI<br>
    merge tool? An "apply all left to the right one" automatic tool?<br>
    </li> <li> This can be presented as buttons on the page (when the wikiwyg<br>
    option is enabled) etc.<br>
    The script then would take another option (your_filename?apply_changes) to<br>
    run this, and fail with a request to do a manual merge if not possible.<br>
    </li> </ul><br>
<p>
    Then the question   remains, how practically useful/convenient that is.<br>
<p>
<p>
    <i>How to do it</i><br>
    /* Basically, to manage sectionfiles I'd have to code as if those are comments<br>
    to a blog entry (and dynamic gathering of them is the same, too. Should be<br>
    rather obvious and possibly quite easy*/<br>
    This 'views_enabled' mode will switch to sect-files in a ./.molly/ and will<br>
    add dynamic links to each section: "edit section" (in an external editor);<br>
    "update Literate Source Project file". And the script will start to check the<br>
    subdir and dynamically reconstruct its HTML output in this mode.<br>
    Same must be true for the "tangler" pre-filter, too - it will reconstruct<br>
    the whole before passing it to the "notangle" utility.<br>
<p>
    </li><li> Is it possible to do  &nbsp;  " p r o m o t i n g / d e m o t i n g "  &nbsp;   &nbsp;  o f  &nbsp;  b r a n c h e s ? ?  &nbsp; <br>
    Is it possible in the view-enabled weaver?<br>
<p>
    </li><li>  &nbsp;  a d d  &nbsp;  " w e b  &nbsp;  t a n g l e  &nbsp;  m o d e "  &nbsp; , in which MOLLY will dump coloured diff<br>
    of the subsections (or the whole file if not too large), of the current version,<br>
    tangled via the browser form versus a file on disk.<br>
    (I do it all the time firing fldiff after each tangle - would be convenient to<br>
    have the functionality before tangling to disk (with file renaming etc), just<br>
    by reloading a page in a browser.<br>
    Will need to allow saving files (or some branch of chunks) from the browser, then.<br>
<p>
    Do I underuse  &nbsp;   &nbsp;  V i m  &nbsp;  ? - it does have <b> some "diff" mode </b> for side-to-side<br>
    display. Just open 2 files, current and prev. vers. and toggle btw one-file<br>
    view and edit or side-by-side coloured diff ???<br>
<p>
    <i>How to do it</i><br>
    .. by first (poss) checking that the files are not identical, and then by<br>
    filtering into "diff":<br>
    <pre> MOLLY.tangle|diff -y -w --left-column xxz - |less </pre><br>
    Just wrap it into html-body-pre tags and colour if there's something in the <br>
    right half (not necessary, really)<br>
<p>
</li> <li> <b> context diffs and sections editing </b>   <br>
</li> </ul><br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('50');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('51');">
<font class='lnum'><i>(51)</i></font>&nbsp; more ideas </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2129)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='51'></a></legend></fieldset>
<p>
<div id="51" style="display:none">   
<ul>


<p>
<b> More ideas: </b><br>
<p>
<b> 1. Maybe </b>  have the  &nbsp;   &nbsp;  " c o m p o s i t e  &nbsp;  d o c u m e n t "  &nbsp;  (or "fragmented document") <br>
    option for  &nbsp;   &nbsp;  t h e  &nbsp;  s e c o n d - l e v e l  &nbsp;  meta-management  &nbsp;   &nbsp;  o f  &nbsp;  p r o j e c t  &nbsp;  f i l e s  &nbsp; <br>
    I.e. one project could be split into many file-sections, and MOLLY weaver will <br>
    assemble them into the doc.<br>
    OR: I maintain logically consistent pieces in medium-size project files, and<br>
    keep a meta-project file with the split option enabled.<br>
    The "edit" links from it will pop up gvim or another editor of choice with<br>
    the full piece in it.<br>
    While viewing will present it all as if one LIterate Source project file.<br>
    I'll need only to mark the pieces in the TOC, possibly, as a separate doc,<br>
    and -- <b> how will I treat TOC compilation then ? </b><br>
<p>
<b> 2. Maybe </b> - if I find an ASCII script (ascii art from commands and <br>
    descriptions), I could automatically generate  &nbsp;   &nbsp;  a s c i i - a r t  &nbsp;  " m a p s "  &nbsp;  <br>
    of the chunks ??<br>
<p>
<p>
<b> 3. introduce horizontal/vertical layouts? </b> <br>
    I.e. TOC and Chunks Index either on top of the file or on the left of it for<br>
    "wide screens", like those on notebooks ??<br>
    Changes are in  "Print out the resulting page" (currently line 3359)<br>
     - plus options, of course<br>
<p>
    Note: will require gluing TOC or the body to stick at the top, not simple table<br>
    cells, which will center and resize depending on relative cell content sizes.<br>
    May require separate scrolling for the two panes?<br>
<p>
OR: <b> TOC/Index in a floating window? </b> -- should be easy, just  name the<br>
    output windows.<br>
<p>
<b> 4. Maybe </b> add ancors to folding section names to be able to 'hyperlink' <br>
    and refer to them from other parts of the document??<br>
    // no jumps from the TOC? or with a separate 'jump' icon? //<br>
    // no jumps to closed sections will work anyway, then what to do? //<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('51');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('52');">
<font class='lnum'><i>(52)</i></font>&nbsp;  Contract programming  and Molly?? </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2175)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='52'></a></legend></fieldset>
<p>
<div id="52" style="display:none">   
<ul>


<p>
possibly add conditional tangling to produce a contract-assertion-littereted prog during<br>
development and debugging --<br>
versus a "clean" copy -- ???<br>
<p>
<b> OR </b> just keep an "assertion-full" skeleton  by using a simple "rename" or a <br>
meta-chunk which is a dispatcher??<br>
<pre> [chunk_to_do_sth]=
 code code code code
 [another_chunk_ref]
 more code more code
 @
</pre><br>
...NO, I cannot do that without conditional tangling<br>
...or - do it in the target language using a "lazy and" for conditionals:<br>
(and (debug_assert_flag) (block .....with some code.....))<br>
<p>
<b> Well, this is what I can do: </b><br>
<pre>
&lt; &lt; main code chunk &gt; &gt; =
if ($DEBUG) {
&lt; &lt; pre-chunk assertions and if-checks &gt; &gt;
} # fi DEBUG

# main chunk code goes here

if ($DEBUG) {
&lt; &lt; post-chunk assertions and if-checks &gt;&gt;
} # fi DEBUG
#end of chunk here @
</pre><br>
<p>
Then I'll be able to produce debug code by tangling:<br>
<pre> notangle -R"some root" project.weave </pre><br>
and the "clean code" without assertion checks I'll get from it<br>
by simply filtering with<br>
<pre> perl -ne 'print unless m!^if ($DEBUG) {! .. m!^\} # fi DEBUG!' tangled.code \
&gt; clean.distribution.code </pre><br>
<p>
Should be easy enough ;))<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('52');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('53');">
<font class='lnum'><i>(53)</i></font>&nbsp; Editor highlighting, Perl POD and Literate Markup </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2221)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='53'></a></legend></fieldset>
<p>
<div id="53" style="display:none">   
<ul>


<p>
The editor highlighting and literate marks  - is <i> bullshit </i><br>
The way I danced around it in Molly is half-insane.<br>
<p>
<b> SO: the solution might be </b> to configure POD marks as <br>
alternative literate markup boundaries, and/or filter the shit<br>
substituting for the real ones in the "pass-through tangler".<br>
Will be Ok at least for quick development, won't it?<br>
<p>
The namess of the POD sections are the names of literate chunks, then.<br>
<p>
I coould try "=pod Name of the Chunk"<br>
as simple PODs stand for nothing<br>
<p>
        (a) need empty lines around all POD markers<br>
        (b) =pod is ignored unless there is a =meaningful_mark<br>
        before<br>
        (c) =pod SOME TEXT -- text is ignored<br>
<p>
So, I could use it, it seems? OR: is there any sense in that??<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('53');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('49');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('54');">
<font class='lnum'><i>(54)</i></font>&nbsp;Done </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2250)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='54'></a></legend></fieldset>
<p>
<div id="54" style="display:none">   
<ul>


<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('55');">
<font class='lnum'><i>(55)</i></font>&nbsp; done for Tangling </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2255)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='55'></a></legend></fieldset>
<p>
<div id="55" style="display:none">   
<ul>


<p>
1. command-line options (for weaver, too?) to imitate "noweb" (?)<br>
Options: <br>
    <ul> -to show all roots??<br>
    - <s> mark refline nums and offsets of the Lit Source in the tangled code </s><br>
    - <s> root to tangle </s><br>
    - keep docs in comments (and/or Pod sections?? </ul><br>
<p>
2. ability   to tangle over several file. I.e.<br>
    <ul> <s> I grow my LitSource for a while, then split it almost<br>
    mechanically, not making splinters self-contained<br>
    I then supply all splinter file names to "MOLLY.pl my.project-*.weave"<br>
    and it tangles them out, however my prog is going through the splinters. </s><br>
    </ul><br>
<p>
3. <br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('55');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('54');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('56');">
<font class='lnum'><i>(56)</i></font>&nbsp;Todo -  current</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2280)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='56'></a></legend></fieldset>
<p>
<div id="56" style="display:none">   
<ul>


<p>
<b>1. Problem of double diamonds in doc chunks </b><br>
<ul><br>
    <s> change the pass-through tangler to isolate the "notangle" from docs sections???<br>
    (will squash the prob of double angle brackets in documentation chunks)<br>
<p>
    OR - introduce a sort of escape?? Because sol 1 would clobber correct line numbering??<br>
    But I do not number lines in the default pass-through invocation..<br>
    The standalone will be affected, anyway.<br>
<p>
    I could add regex conversion to hexadecimals in the pass-through tangler.<br>
    However it would still break the "notangle" when run standalone. </s> -- DONE<br>
<p>
    I could collect command-line options in case of "scriptname.tangle" invocation<br>
    and pass them to "notangle" - that could be a sort of solution.<br>
</ul><br>
<p>
2. <s> Change logic of "weave-tangle" ("main despatcher"), as it is stupidly convoluted <br>
and ugly now </s> -- DONE<br>
<p>
3 and 8. (++) <s> rawHTML mode </s> -- done<br>
<p>
4. (++-) see below in "done"<br>
<p>
5. <s> <b> BUG of sorts </b><br>
the "lt" and "gt" escapes in the code chunks right above ("tangle me with filtering") are not <br>
displayed correctly  by the web weaver: the browser displays them as real angle brackets. </s> <br>
-- DONE<br>
<p>
6. <s>HTMLize the error message in the main despatcher (if "I am a module", print it as<br>
an html file). Otherwise it won't look good in the browser. </s> <br>
<b> NOT NEEDED </b> as "tangling" is done from CL only<br>
<p>
9 (++). DATA or ---start of script-- to filter?? - done<br>
<p>
10. Add "expand subthread" ?? - to open only the current branch of the L.T.File?<br>
<p>
11. <s> Add auto-href creation (i.e. posting a URL with minimal markup must create a valid<br>
    HTML link with URL as the name of it. </s> -- done<br>
<p>
12 (+--). and checking <br>
<s> qwer qwer  &nbsp;  s p a c i n g  &nbsp;  of one word and <i> &nbsp;  o f  &nbsp;   &nbsp;  m a n y  &nbsp;   &nbsp;  o n  &nbsp;   &nbsp;  t h e  &nbsp;   &nbsp;  s a m e  &nbsp;  l i n e  &nbsp; </i> asdf asd  <br>
SO: to do word boundaries properly. </s><br>
DONE although not very cleanly. The tag will break across several lines<br>
<p>
13. Add a full set of HTML escapes to "dotHTML" and "rawHTML" ?<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('56');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('47');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('57');">
<font class='lnum'><i>(57)</i></font>&nbsp; PRELIMINARIES: The script layout and idea </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2339)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='57'></a></legend></fieldset>
<p>
<div id="57" style="display:none">   
<ul>


<p>
.. are very simple.<br>
<p>
<b>1. </b> It is possible to include an invocation of a  perl script with <br>
<pre> "do script.pl" or "use script.pl"  </pre><br>
as the first lines in a Literate Source file.  This turns the source into a standalone perl script. <br>
If we write the script to process the L.Source file itself ($0 in perl parlance) then the script can do <br>
weaving and tangling of it. The output, which is formatted documentation (which was "weaved" from L.P.) <br>
or the sources usable by a computer ("tangled") can be  saved in a file, as with traditional literate <br>
programming tools. But which is more convenient, the formatted documentation on STDOUT can <br>
be  picked up by a web  server.  We'll see formatted representation of work in progress immediately<br>
upon reload of the page in a web browser. <br>
<p>
When I think, I prefer to look at the formatted document, and when I edit, I do it "locally" in a good<br>
programming editor (such as "vim"). Even with vim folding the difference in perception is enormous.<br>
<p>
<b> 2. </b>I see three advantages to such an arrangement:  <br>
<ul><li>first, web markup is ubiquitous today, and it is quite sufficient for most publishing needs. <br>
So Literate Programming with HTML will free us from a tie to TeX which so negatively affected <br>
perception of L.P. by the masses of programmers. The markup becomes very, very simple. <br>
<p>
This eliminates a source of one major complaint about the traditional L.P. - that the programmer<br>
has to maintain not one, but two "programming languages" while working with LP, the target one<br>
and the formatting one. This - the complaint goes - becomes a source of errors from an additional<br>
layer of programming in addition to writing the code itself. It taxes the programmer's mind rather<br>
than relieving it.<br>
<p>
In fact, simple HTML is almost self-correcting, as wrong markup becomes immediately obvious<br>
in the browser. <br>
<p>
</li> <li> secondly, this eliminates "weaving" as a separate step during development, but more<br>
importantly, such an arrangement allows a programmer to think about his program while looking<br>
at a <i>folding</i> document, in which only relevant sections are open.<br>
<p>
I perceive <i> folding </i> as a major advantage<br>
<p>
With <i>folding</i> the Literate Source file becomes manageable even for really large texts. <br>
This in turn allows the programmer to keep <i> many files </i> inside the LPSource, including<br>
test snippets, the makefile, preserve old versions of parts of the source etc. etc.<br>
Literate Source file is painlessely turned into a Project File, one file, from which anything<br>
can be easily generated.<br>
It is this one file that my version control system must track now. For really large projects,<br>
we can keep a meta-file (also in the folding format) with largish partial files as links,<br>
corresponding to logical pieces of the project, which will open in the browser as automatically<br>
weaved Literate Source Files.<br>
<p>
I attempted to explain this at length in introductory sections above.<br>
</li></ul><br>
<p>
<b>3. </b> How the script works overall<br>
<p>
After figuring out how it was invoked, the script:<br>
<ul><li> <b>when it is supposed to weave</b>, scans into memory the Literate Source <br>
file, marked up in "noweb" notation (and its document sections marked with raw HTML <br>
or in "dotHTML") doing necessary substitutions and conversions along the way.<br>
Then the buffered string thus formed and several auxilliary buffers (for document TOC <br>
and Index sections) are printed out to STDOUT. They can be redirected into files, if <br>
LPSource, now also an executable script itself, is run from command line, or they can <br>
be picked up by a local personal web server that is used by the developer, which  should <br>
recognize the LPSource as a valid CGI script<br>
<p>
After any changes in the script, the user can reload the page in his web browser and <br>
immediately see the changes.<br>
<p>
</li><li> <b>If invoked to tangle</b> the source of the program, this version of the <br>
script will either use the built-in tangler, or refer the actual tangling to the <br>
"notangle" utility from "noweb" suite of  tools by Ramsey, depending on configuration <br>
at the top of your litsource file<br>
<p>
The built-in tangler does not scan the file into memory. Rather, it does a first pass over<br>
the file noting the offsets where code chunks start, end or get referred to.<br>
The second pass then recursively prints them to STDOUT.<br>
</li></ul><br>
<b>5. </b>  &nbsp;   &nbsp;  A  &nbsp;  f u t u r e  &nbsp;  v e r s i o n  &nbsp;  of the script may be made completely self-contained, i.e. <br>
include a mini-web server as well as a folding weaver and a tangler.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('57');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('58');">
<font class='lnum'><i>(58)</i></font>&nbsp; Makefile</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2420)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='58'></a></legend></fieldset>
<p>
<div id="58" style="display:none">   
<ul>


<p>
<p>
<font class='lnum'>2424</font>   
                <div id=codechunk2424>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;Makefile for split MOLLY-top and MOLLY-bottom&gt;&gt<sub></sub>=</legend>
<font class='lnum'>2425</font>   
<font class='lnum'>2426</font>   all: help
<font class='lnum'>2427</font>   #-
<font class='lnum'>2428</font>   
<font class='lnum'>2429</font>   help:
<font class='lnum'>2430</font>           @echo;
<font class='lnum'>2431</font>           @echo " ---TARGETS---";
<font class='lnum'>2432</font>           @echo " new - tangle out MOLLYs-new.pl";
<font class='lnum'>2433</font>           <font class='chunkref'>&lt;&lt;other Makefile help commands&gt;&gt;</font>
<font class='lnum'>2434</font>           @echo;
<font class='lnum'>2435</font>   #-
<font class='lnum'>2436</font>   
<font class='lnum'>2437</font>   new:
<font class='lnum'>2438</font>           perl ./MOLLY.pl -R'MOLLY.pl module' MOLLYs-bottom.weave &gt;MOLLYs-new.pl;
<font class='lnum'>2439</font>   #-
<font class='lnum'>2440</font>   
<font class='lnum'>2441</font>   <font class='chunkref'>&lt;&lt;other Makefile commands&gt;&gt;</font>
<font class='lnum'>2442</font>   
<font class='lnum'>2443</font>   </fieldset></pre>
</div><p>
Checking my Makefile insertions ;)). This is going to be a test of M's tangling<br>
as well, actually<br>
<p>
The help insertions have already been indented with  a tab<br>
<p>
<font class='lnum'>2450</font>   
                <div id=codechunk2450>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;other Makefile help commands&gt;&gt<sub></sub>=</legend>
<font class='lnum'>2451</font>   @echo " td  - run a tanglediff against MOLLY.pl";
<font class='lnum'>2452</font>   @echo " fld - tangle and run a GUI diff tool, fldiff";
<font class='lnum'>2453</font>   </fieldset></pre>
</div><p>
<font class='lnum'>2455</font>   
                <div id=codechunk2455>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;other Makefile commands&gt;&gt<sub></sub>=</legend>
<font class='lnum'>2456</font>   
<font class='lnum'>2457</font>   td:
<font class='lnum'>2458</font>           MOLLYs-bottom.tangle | diff -y -w --left-column MOLLY.pl - |less;
<font class='lnum'>2459</font>   #-
<font class='lnum'>2460</font>   
<font class='lnum'>2461</font>   fld:
<font class='lnum'>2462</font>           perl ./MOLLY.pl -R'MOLLY.pl module' MOLLYs-bottom.weave &gt;MOLLYs-new.pl;
<font class='lnum'>2463</font>           fldiff MOLLY.pl MOLLYs-new.pl;
<font class='lnum'>2464</font>   #-
<font class='lnum'>2465</font>   
<font class='lnum'>2466</font>   </fieldset></pre>
</div><p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('58');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('59');">
<font class='lnum'><i>(59)</i></font>&nbsp; Tests to run on a newly tangled script</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2471)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='59'></a></legend></fieldset>
<p>
<div id="59" style="display:none">   
<ul>


<p>
.. will append to the Makefile, mostly.<br>
<p>
FIRST, tests go into ./tests.and.examples subdir<br>
<p>
TANGLING<br>
1. Check it tangles itself out<br>
    "make fd" "make fld" already do that<br>
    maybe: check sizes and/or MD5s<br>
<p>
2. Check tangling of the "substitution torture test"(s)<br>
<p>
3. Check tangling of split script(s)<br>
<p>
4. I have 2 modes: command line and Quick Mode<br>
Testing CL involves:<br>
<p>
    Usage printout - no ARGV[0], wrong options (several poss)<br>
    weaving from CL<br>
    tangling from CL<br>
    weaving, tangling from Quick Mode; compare output?<br>
<p>
Running against "notangle" in several tests above.<br>
<p>
ALSO: tangling, split or not: test for DAG loops<br>
/toposort not added yet/<br>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('59');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('60');">
<font class='lnum'><i>(60)</i></font>&nbsp; </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2503)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='60'></a></legend></fieldset>
<p>
<div id="60" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('60');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('61');">
<font class='lnum'><i>(61)</i></font>&nbsp; MOLLY.pl - top of the script </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2506)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='61'></a></legend></fieldset>
<p>
<div id="61" style="display:none">   
<ul>


<p>
<font class='lnum'>2509</font>   
                <div id=codechunk2509>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;MOLLY.pl module&gt;&gt<sub></sub>=</legend>
<font class='lnum'>2510</font>   #!/usr/bin/perl
<font class='lnum'>2511</font>   
<font class='lnum'>2512</font>   #-----------------------------------------------------------------------------------------
<font class='lnum'>2513</font>   # MOLLY - A MO-DULE FOR LI-TERATE PROGRAMMING
<font class='lnum'>2514</font>   #-----------------------------------------------------------------------------------------
<font class='lnum'>2515</font>   # ............................................
<font class='lnum'>2516</font>   # .......licensed under GPL version 3.........
<font class='lnum'>2517</font>   # ............................................
<font class='lnum'>2518</font>   # ....... Author: unixtechie; email: .........
<font class='lnum'>2519</font>   # .. /same/ ..  at .. yahoo .. dot .. com ....
<font class='lnum'>2520</font>   # ............................................
<font class='lnum'>2521</font>   # ..... Git depos. - docs and download: ......
<font class='lnum'>2522</font>   # http://github.com/unixtechie/Literate-Molly/
<font class='lnum'>2523</font>   # ............................................
<font class='lnum'>2524</font>   #
<font class='lnum'>2525</font>   #-----------------------------------------------------------------------------------------
<font class='lnum'>2526</font>   #---|-4-|-8-|-12----|-20------|-30------|-40------|-50------|-60------|-70------|-80------|
<font class='lnum'>2527</font>   
<font class='lnum'>2528</font>   
<font class='lnum'>2529</font>   <font class='chunkref'>&lt;&lt;general settings&gt;&gt;</font>
<font class='lnum'>2530</font>   <font class='chunkref'>&lt;&lt;main despatcher&gt;&gt;</font>
<font class='lnum'>2531</font>   <font class='chunkref'>&lt;&lt;tangle me&gt;&gt;</font>
<font class='lnum'>2532</font>   <font class='chunkref'>&lt;&lt;weave me&gt;&gt;</font>
<font class='lnum'>2533</font>   
<font class='lnum'>2534</font>   # just in case:
<font class='lnum'>2535</font>   exit;
<font class='lnum'>2536</font>   
<font class='lnum'>2537</font>   # END OF SCRIPT
<font class='lnum'>2538</font>   
<font class='lnum'>2539</font>   </fieldset></pre>
</div><p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('62');">
<font class='lnum'><i>(62)</i></font>&nbsp; general settings </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2543)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='62'></a></legend></fieldset>
<p>
<div id="62" style="display:none">   
<ul>


<p>
<p>
Some internal script parameters are set here.<br>
E.g. "noweb" tangler gets confused if it finds double angle brackets<br>
anywhere, so sometimes it's possible to fool it by setting a var in the<br>
perl script like this:<br>
<p>
<font class='lnum'>2552</font>   
                <div id=codechunk2552>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt<sub></sub>=</legend>
<font class='lnum'>2553</font>     # need to fool the noweb "notangle" utility, switch markup modes etc.
<font class='lnum'>2554</font>     $lt = "&lt;";
<font class='lnum'>2555</font>     $gt = "&gt;";
<font class='lnum'>2556</font>     $lt_esc = "&amp;lt;";
<font class='lnum'>2557</font>     $gt_esc = "&amp;gt;";
<font class='lnum'>2558</font>     $dash = "-";
<font class='lnum'>2559</font>     $dot = "\.";
<font class='lnum'>2560</font>   </fieldset></pre>
</div><p>
But more importantly:<br>
There are a number of parameters that can be set from the literate source file<br>
at the very top before loading the module with "do MOLLY.pl" (or "use MOLLY.pl").<br>
These are assigned defaults here. You can refer to this portion of the script<br>
to find out what parameters are settable in your document template and expand the<br>
tunings if you modify MOLLY.pl<br>
<p>
<font class='lnum'>2569</font>   
                <div id=codechunk2569>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt<sub>2</sub>=</legend>
<font class='lnum'>2570</font>   
<font class='lnum'>2571</font>     # ----- GENERAL settings -----
<font class='lnum'>2572</font>     
<font class='lnum'>2573</font>           # print toc? 1:0
<font class='lnum'>2574</font>           $print_toc = 1 unless defined $print_toc;
<font class='lnum'>2575</font>           
<font class='lnum'>2576</font>           # keep TOC expanded on initial load? "block":"none"
<font class='lnum'>2577</font>           $toc_expanded = $toc_expanded || "block";
<font class='lnum'>2578</font>           
<font class='lnum'>2579</font>           # keep TOC expanded in initial load? "block":"none"
<font class='lnum'>2580</font>           $ind_expanded = $ind_expanded || "none";
<font class='lnum'>2581</font>   
<font class='lnum'>2582</font>   </fieldset></pre>
</div><p>
The script will behave differently depending on its own name. One "major" name<br>
can be used with others existing as soft links (although an "thttpd" lightweight<br>
web server insisted on a hard link in one case).<br>
The modes are detected by file extensions, which are set here.<br>
'Weaving' = creating a formatted HTML documentation file on STDOUT<br>
'Tangling' = creating the program/script source on STDOUT<br>
<p>
<font class='lnum'>2591</font>   
                <div id=codechunk2591>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt<sub>3</sub>=</legend>
<font class='lnum'>2592</font>           # what is the file extention to weave it? (perms must allow execution!)
<font class='lnum'>2593</font>           # e.g. "scriptname.weave" or "scriptname.cgi" etc.
<font class='lnum'>2594</font>           $weave_extension = $weave_extension || "weave"; # default is "weave"
<font class='lnum'>2595</font>   
<font class='lnum'>2596</font>           # what is the file extention to tangle it? (perms must allow execution!)
<font class='lnum'>2597</font>           # e.g. "scriptname.tangle",  "scriptname.pl" etc.
<font class='lnum'>2598</font>           $tangle_extension = $tangle_extension || "tangle";      # default is "tangle"
<font class='lnum'>2599</font>           
<font class='lnum'>2600</font>           
<font class='lnum'>2601</font>           #When tangling, should I use the built-in tangler? 0:1
<font class='lnum'>2602</font>           # (if 0, the "pass-through" tangling will call "notangle"
<font class='lnum'>2603</font>           # from Ramsey's "noweb" tools, must be installed and in your path)
<font class='lnum'>2604</font>           # use_builtin_tangler = 0; # default for now is to use external "notangle"
<font class='lnum'>2605</font>           $use_builtin_tangler = $use_builtin_tangler || 0; 
<font class='lnum'>2606</font>           
<font class='lnum'>2607</font>           # Actually, let's always do it and disallow unsetting
<font class='lnum'>2608</font>           # number lines ? 1 : else
<font class='lnum'>2609</font>           $line_numbering = 1;
<font class='lnum'>2610</font>   
<font class='lnum'>2611</font>           # Print LitSource's line nums as a reference in the tangled output? deflt is 0.
<font class='lnum'>2612</font>           $print_ref_linenos_when_tangling = $print_ref_linenos_when_tangling || 0; 
<font class='lnum'>2613</font>           $code_sections_comment_symbol = $code_sections_comment_symbol || "# ";
<font class='lnum'>2614</font>   
<font class='lnum'>2615</font>   
<font class='lnum'>2616</font>           # find and print root chunks in the LitSrc (i.e. instead of tangling when it is run
<font class='lnum'>2617</font>           # as "./LitSrc.tangle" from command line) ? 0:1
<font class='lnum'>2618</font>           $show_all_roots = $show_all_roots || 0; # default is not (i.e. to tangle)
<font class='lnum'>2619</font>   
<font class='lnum'>2620</font>   
<font class='lnum'>2621</font>   </fieldset></pre>
</div><p>
The document sections ("chunks") can be marked with actual HTML tags ("rawHTML") or<br>
with a smaller number of the same tags in "dots" in place of "angle brackets", i.e.<br>
dot-br-dot, not open.angle-br-closing.angle<br>
This is selected here:<br>
<p>
<font class='lnum'>2628</font>   
                <div id=codechunk2628>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt<sub>4</sub>=</legend>
<font class='lnum'>2629</font>           # how are doc sections marked? "dotHTML":"rawHTML"
<font class='lnum'>2630</font>           $weave_markup = $weave_markup || "rawHTML"; # default is "rawHTML"
<font class='lnum'>2631</font>           
<font class='lnum'>2632</font>           if ($weave_markup eq "dotHTML") {
<font class='lnum'>2633</font>           $tag_open_symbol = $dot;        # this will take care of default
<font class='lnum'>2634</font>           $tag_close_symbol = $dot;       # when no var is set in the Lit Src file
<font class='lnum'>2635</font>           }
<font class='lnum'>2636</font>           elsif ($weave_markup eq "rawHTML") { 
<font class='lnum'>2637</font>           $tag_open_symbol = $lt;
<font class='lnum'>2638</font>           $tag_close_symbol = $gt;
<font class='lnum'>2639</font>           } #fi
<font class='lnum'>2640</font>   
<font class='lnum'>2641</font>   </fieldset></pre>
</div><p>
<p>
Do we need to enable MathML functionality? If "yes", set the path to the js library<br>
"ASCIIMathML.js" and enable the switch.<br>
This slows down interpretation of the file on reload drastically (from nothing to<br>
3 seconds with 4-5 example formulas), so for sfw development usually this should be off.<br>
<p>
<font class='lnum'>2649</font>   
                <div id=codechunk2649>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt<sub>5</sub>=</legend>
<font class='lnum'>2650</font>   
<font class='lnum'>2651</font>           # enable MathML interpretation? 1 : 0
<font class='lnum'>2652</font>           $enable_ASCIIMathML = $enable_ASCIIMathML || 0;
<font class='lnum'>2653</font>           # If enabled, set the path; default is local in current dir
<font class='lnum'>2654</font>           $path_to_ASCIIMathML = $path_to_ASCIIMathML || "ASCIIMathML_with_modified_escapes.js";
<font class='lnum'>2655</font>   
<font class='lnum'>2656</font>   </fieldset></pre>
</div><p>
<p>
It would make sense to add a few more markups to the program, i.e. some "wiki" many use,<br>
and some TeX basic tags for automatic translation, if the doc is tagged as a TeX file.<br>
<p>
In more detail dotHTML is explained in its own section<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('62');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('63');">
<font class='lnum'><i>(63)</i></font>&nbsp; main despatcher </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2669)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='63'></a></legend></fieldset>
<p>
<div id="63" style="display:none">   
<ul>


<p>
The script figures out how it was invoked and then starts either a tangler<br>
or a weaver, or fails with a usage line.<br>
<p>
If the script name ends in "weave" (e.g. script.weave), it will be weaved to STDOUT.<br>
If the name ends in "tangle", the source starting from the default chunk &lt; &lt;*&gt; &gt;<br>
(without spaces) will be dumped to STDOUT:<br>
<p>
<font class='lnum'>2679</font>   
                <div id=codechunk2679>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher&gt;&gt<sub></sub>=</legend>
<font class='lnum'>2680</font>   <font class='chunkref'>&lt;&lt;main despatcher with CL&gt;&gt;</font>
<font class='lnum'>2681</font>   </fieldset></pre>
</div><p>
There later may be other versions of despatchers to take care of command-line invocations<br>
of Molly etc.<br>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('64');">
<font class='lnum'><i>(64)</i></font>&nbsp; "Main despatcher with CL" </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2687)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='64'></a></legend></fieldset>
<p>
<div id="64" style="display:none">   
<ul>


<p>
Adding command-line processing.<br>
For now the logic is as described below in sub "usage".<br>
<p>
More options are typed below, but they are disabled for now.<br>
This version allows using MOLLY.pl from command line to tangle from any root<br>
in addition to the standard "mollified" file weaving and tangling as described<br>
in the docs.<br>
<p>
<font class='lnum'>2698</font>   
                <div id=codechunk2698>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher with CL&gt;&gt<sub></sub>=</legend>
<font class='lnum'>2699</font>     # -- MAIN DESPATCHER WITH CL----
<font class='lnum'>2700</font>     use Getopt::Std;
<font class='lnum'>2701</font>   
<font class='lnum'>2702</font>   <font class='chunkref'>&lt;&lt;sub print usage&gt;&gt;</font>
<font class='lnum'>2703</font>   
<font class='lnum'>2704</font>   my @LITSOURCE_list = ();
<font class='lnum'>2705</font>   my %LITSOURCE_hash = ();
<font class='lnum'>2706</font>   
<font class='lnum'>2707</font>     # -1- shortcut invocations for "mollified" LitSrc file depending on its extension ---
<font class='lnum'>2708</font>   
<font class='lnum'>2709</font>     if ( $0 =~ m!\w+\.$weave_extension$! ) { 
<font class='lnum'>2710</font>   
<font class='lnum'>2711</font>           open LITSOURCE, "&lt; $0" or die "\n\tcould not open the target file\n\n";
<font class='lnum'>2712</font>           goto WEAVE_ME;
<font class='lnum'>2713</font>       }
<font class='lnum'>2714</font>       elsif ( $0 =~ m!\w+\.$tangle_extension$! )  {
<font class='lnum'>2715</font>   
<font class='lnum'>2716</font>           open LITSOURCE0, "&lt; $0" or die "\n\tcould not open the target file for tangling\n\n";
<font class='lnum'>2717</font>           push @LITSOURCE_list, 'LITSOURCE0';
<font class='lnum'>2718</font>           $LITSOURCE_hash{'LITSOURCE0'} = $0;
<font class='lnum'>2719</font>           goto TANGLE_ME;
<font class='lnum'>2720</font>     }
<font class='lnum'>2721</font>   
<font class='lnum'>2722</font>     # -2- several cases for application of Molly to an external target file. --- 
<font class='lnum'>2723</font>   
<font class='lnum'>2724</font>     elsif (-t STDIN) { 
<font class='lnum'>2725</font>   
<font class='lnum'>2726</font>       <font class='chunkref'>&lt;&lt;running on interactive TTY&gt;&gt;</font>
<font class='lnum'>2727</font>   
<font class='lnum'>2728</font>       }
<font class='lnum'>2729</font>   
<font class='lnum'>2730</font>     # -3- MOLLY.pl as a standalone script is called from CGI, nothing in here yet ---
<font class='lnum'>2731</font>   
<font class='lnum'>2732</font>     elsif (defined $ENV{'REQUEST_METHOD'}) {
<font class='lnum'>2733</font>   
<font class='lnum'>2734</font>   <font class='chunkref'>&lt;&lt;write 'nothing here' html message&gt;&gt;</font>
<font class='lnum'>2735</font>   
<font class='lnum'>2736</font>     }
<font class='lnum'>2737</font>   
<font class='lnum'>2738</font>     # -4- other cases ---
<font class='lnum'>2739</font>   
<font class='lnum'>2740</font>     else {
<font class='lnum'>2741</font>   
<font class='lnum'>2742</font>           die "MOLLY.pl: I do not know how I was called, exiting anyway\n";
<font class='lnum'>2743</font>   
<font class='lnum'>2744</font>     } # esle, fi - end of despatcher
<font class='lnum'>2745</font>   
<font class='lnum'>2746</font>   exit;  # just in case
<font class='lnum'>2747</font>     
<font class='lnum'>2748</font>   </fieldset></pre>
</div><p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('65');">
<font class='lnum'><i>(65)</i></font>&nbsp; running on interactive TTY </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2752)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='65'></a></legend></fieldset>
<p>
<div id="65" style="display:none">   
<ul>


<p>
<p>
<font class='lnum'>2756</font>   
                <div id=codechunk2756>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;running on interactive TTY&gt;&gt<sub></sub>=</legend>
<font class='lnum'>2757</font>   
<font class='lnum'>2758</font>       #print STDERR "$0 was called from command line..\n";
<font class='lnum'>2759</font>   
<font class='lnum'>2760</font>       #getopts("hwu:l:d:R:", \%cl_args);
<font class='lnum'>2761</font>           getopts("hwl:R:i", \%cl_args);
<font class='lnum'>2762</font>   
<font class='lnum'>2763</font>       # -- print USAGE if not evoked correctly
<font class='lnum'>2764</font>           if( (! defined $ARGV[0] ) or  ( $cl_args{h} ) ) { usage(); exit };
<font class='lnum'>2765</font>   
<font class='lnum'>2766</font>       # -- does target file exist?
<font class='lnum'>2767</font>           if ( -f $ARGV[0] ) {
<font class='lnum'>2768</font>               ; # nop, a debug printout
<font class='lnum'>2769</font>               #print STDERR "target file to operate on is $ARGV[0]\n";
<font class='lnum'>2770</font>           }
<font class='lnum'>2771</font>           else { 
<font class='lnum'>2772</font>               die "\n\tERROR: No target file $ARGV[0] seem to exist\n\n";
<font class='lnum'>2773</font>           };
<font class='lnum'>2774</font>   
<font class='lnum'>2775</font>   
<font class='lnum'>2776</font>       # -- Final CL despatch, do it: --
<font class='lnum'>2777</font>           
<font class='lnum'>2778</font>   
<font class='lnum'>2779</font>           if($cl_args{w}) { # this is weaving
<font class='lnum'>2780</font>   
<font class='lnum'>2781</font>               if (@ARGV &gt; 1) {
<font class='lnum'>2782</font>               print STDERR "\n\n\tDo not know how to weave several files\n";
<font class='lnum'>2783</font>               print STDERR "\tweaving the first one: $cl_args{w}\n\n"; 
<font class='lnum'>2784</font>               }
<font class='lnum'>2785</font>   
<font class='lnum'>2786</font>               open LITSOURCE, "&lt; $ARGV[0]" || die "could not open the target file\n";
<font class='lnum'>2787</font>               goto WEAVE_ME;
<font class='lnum'>2788</font>   
<font class='lnum'>2789</font>           }
<font class='lnum'>2790</font>   
<font class='lnum'>2791</font>           else { # this is tangling, default action, no opt
<font class='lnum'>2792</font>   
<font class='lnum'>2793</font>               <font class='chunkref'>&lt;&lt;process args for tangling an external file from CL&gt;&gt;</font>
<font class='lnum'>2794</font>   
<font class='lnum'>2795</font>               for (my $countem=0; $countem &lt; @ARGV; $countem++) {
<font class='lnum'>2796</font>   
<font class='lnum'>2797</font>                $LITSOURCE_multi = 'LITSOURCE' . $countem;
<font class='lnum'>2798</font>                open $LITSOURCE_multi, "&lt; $ARGV[$countem]"
<font class='lnum'>2799</font>                    or die "\n\tCould not open target file $ARGV[$countem]\n\n";
<font class='lnum'>2800</font>   
<font class='lnum'>2801</font>                push @LITSOURCE_list, $LITSOURCE_multi;
<font class='lnum'>2802</font>                $LITSOURCE_hash{$LITSOURCE_multi} = $ARGV[$countem];
<font class='lnum'>2803</font>   
<font class='lnum'>2804</font>               } # rof
<font class='lnum'>2805</font>   
<font class='lnum'>2806</font>               goto SEEK_PEEK_TANGLER;
<font class='lnum'>2807</font>   
<font class='lnum'>2808</font>           } # fi - CL final despatch
<font class='lnum'>2809</font>   
<font class='lnum'>2810</font>       exit; #redundant and unused
<font class='lnum'>2811</font>   
<font class='lnum'>2812</font>   </fieldset></pre>
</div><p>
<p>
<font class='lnum'>2815</font>   
                <div id=codechunk2815>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process args for tangling an external file from CL&gt;&gt<sub></sub>=</legend>
<font class='lnum'>2816</font>   
<font class='lnum'>2817</font>           if($cl_args{d}) { 
<font class='lnum'>2818</font>               #print STDERR "doc sections in coments; comment char is $cl_args{d}\n" 
<font class='lnum'>2819</font>               };
<font class='lnum'>2820</font>   
<font class='lnum'>2821</font>           if($cl_args{u}) { 
<font class='lnum'>2822</font>               #print STDERR "applying UN-tangling with script char is $cl_args{u}\n" 
<font class='lnum'>2823</font>               };
<font class='lnum'>2824</font>   
<font class='lnum'>2825</font>           if($cl_args{i}) { 
<font class='lnum'>2826</font>               #print STDERR "printing information on roots, discovered chunks\n" 
<font class='lnum'>2827</font>               $show_all_roots = 1;
<font class='lnum'>2828</font>               
<font class='lnum'>2829</font>               };
<font class='lnum'>2830</font>   
<font class='lnum'>2831</font>           if($cl_args{l}) { 
<font class='lnum'>2832</font>               #print STDERR "will add reflines; comment char is $cl_args{l}\n" 
<font class='lnum'>2833</font>               $print_ref_linenos_when_tangling = 1;
<font class='lnum'>2834</font>               $code_sections_comment_symbol = $cl_args{l};
<font class='lnum'>2835</font>               };
<font class='lnum'>2836</font>   
<font class='lnum'>2837</font>           # -- getting the root chunk for tangling --
<font class='lnum'>2838</font>           if($cl_args{R}) { 
<font class='lnum'>2839</font>               $root_chunk = $cl_args{R};
<font class='lnum'>2840</font>               print STDERR "tangling root chunk '$root_chunk'\n"
<font class='lnum'>2841</font>               };
<font class='lnum'>2842</font>   
<font class='lnum'>2843</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('65');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('66');">
<font class='lnum'><i>(66)</i></font>&nbsp; write 'nothing here' html message </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2851)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='66'></a></legend></fieldset>
<p>
<div id="66" style="display:none">   
<ul>


<p>
<font class='lnum'>2854</font>   
                <div id=codechunk2854>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;write 'nothing here' html message&gt;&gt<sub></sub>=</legend>
<font class='lnum'>2855</font>   
<font class='lnum'>2856</font>       print "Content-Type: text/html; charset=utf-8\n\n";
<font class='lnum'>2857</font>           print &lt;&lt;_XXX_;
<font class='lnum'>2858</font>           &lt;html&gt;&lt;body&gt;
<font class='lnum'>2859</font>           &lt;p&gt;
<font class='lnum'>2860</font>           &lt;b&gt;I was caled as CGI, but this invocation seems to be meaningless.&lt;/b&gt;&lt;br&gt;
<font class='lnum'>2861</font>           Maybe you meant to "weave", but set a wrong file extension.&lt;br&gt;
<font class='lnum'>2862</font>           Goodbye.&lt;br&gt;
<font class='lnum'>2863</font>           &lt;i&gt;-- MOLLY.pl --&lt;/i&gt;
<font class='lnum'>2864</font>           &lt;p&gt;
<font class='lnum'>2865</font>           &lt;/body&gt;&lt;/html&gt;
<font class='lnum'>2866</font>   _XXX_
<font class='lnum'>2867</font>   
<font class='lnum'>2868</font>     exit;
<font class='lnum'>2869</font>   
<font class='lnum'>2870</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('66');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('67');">
<font class='lnum'><i>(67)</i></font>&nbsp; Sub Print Usage </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2876)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='67'></a></legend></fieldset>
<p>
<div id="67" style="display:none">   
<ul>


<p>
<p>
<font class='lnum'>2880</font>   
                <div id=codechunk2880>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;sub print usage&gt;&gt<sub></sub>=</legend>
<font class='lnum'>2881</font>   
<font class='lnum'>2882</font>   sub usage {
<font class='lnum'>2883</font>   
<font class='lnum'>2884</font>       print STDERR&lt;&lt;'end_of_usage';
<font class='lnum'>2885</font>   
<font class='lnum'>2886</font>       USAGE: MOLLY.pl [options] [--] filename
<font class='lnum'>2887</font>   
<font class='lnum'>2888</font>           -h, or no filename
<font class='lnum'>2889</font>                   get this help message
<font class='lnum'>2890</font>   
<font class='lnum'>2891</font>   
<font class='lnum'>2892</font>           TANGLING Options:
<font class='lnum'>2893</font>                   Tangling mode is default, no special option to force needed.
<font class='lnum'>2894</font>   
<font class='lnum'>2895</font>           -R "root_chunk_name", 
<font class='lnum'>2896</font>                   tangle starting from this chunk. if omitted, "*" is default.
<font class='lnum'>2897</font>   
<font class='lnum'>2898</font>           -l 'comment symbol for your language',
<font class='lnum'>2899</font>                   add comments with coresponding line numbers in Lit Src
<font class='lnum'>2900</font>   
<font class='lnum'>2901</font>           -i  information on root chunks
<font class='lnum'>2902</font>   
<font class='lnum'>2903</font>   
<font class='lnum'>2904</font>           WEAVING options:
<font class='lnum'>2905</font>   
<font class='lnum'>2906</font>           -w,  weave from the external target file
<font class='lnum'>2907</font>               This option presupposes html-marked document sections,
<font class='lnum'>2908</font>   
<font class='lnum'>2909</font>   
<font class='lnum'>2910</font>       FOR INTERNALLY MOLLIFIED FILES:
<font class='lnum'>2911</font>           shortcut invocation - depending on file extension. If run as script
<font class='lnum'>2912</font>   
<font class='lnum'>2913</font>           "lit_prog_file.tangle" 
<font class='lnum'>2914</font>                   tangles to STDOUT, from default root "*" only. 
<font class='lnum'>2915</font>           "lit_prog_file.weave" 
<font class='lnum'>2916</font>                   weaves to STDOUT as folding HTML; usable under CGI
<font class='lnum'>2917</font>           
<font class='lnum'>2918</font>           / OR: set your own extensions in your lit.source configuraton section /
<font class='lnum'>2919</font>   
<font class='lnum'>2920</font>   end_of_usage
<font class='lnum'>2921</font>   
<font class='lnum'>2922</font>    exit;
<font class='lnum'>2923</font>   }
<font class='lnum'>2924</font>   
<font class='lnum'>2925</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('67');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('64');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('68');">
<font class='lnum'><i>(68)</i></font>&nbsp; "Main despatcher simple" </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2934)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='68'></a></legend></fieldset>
<p>
<div id="68" style="display:none">   
<ul>


<p>
<p>
This one is for "mollified" file processing only; no use of MOLLY.pl as<br>
a standalone script on external files will be possible.<br>
For that enable the "main despatcher with CL" chunk.<br>
<p>
<b> Note </b> Now that I'm redoing target file opening there, this despatcher<br>
needs to be adjusted too, or it will break (open $0 as LITSOURCE here)<br>
<p>
<font class='lnum'>2945</font>   
                <div id=codechunk2945>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher simple&gt;&gt<sub></sub>=</legend>
<font class='lnum'>2946</font>     # -- MAIN DESPATCHER ----
<font class='lnum'>2947</font>   
<font class='lnum'>2948</font>     # check if $i_am_module and set filenames to $0 - or 
<font class='lnum'>2949</font>     # process CL options otherwise
<font class='lnum'>2950</font>   
<font class='lnum'>2951</font>     # (temp) - 2 options, to weave and to tangle in module mode:
<font class='lnum'>2952</font>     #
<font class='lnum'>2953</font>     if ( $0 =~ m!\w+\.$weave_extension$! ) { goto WEAVE_ME }
<font class='lnum'>2954</font>     elsif ( $0 =~ m!\w+\.$tangle_extension$! )  {goto TANGLE_ME}
<font class='lnum'>2955</font>     else {
<font class='lnum'>2956</font>     print &lt;&lt;end_of_print;
<font class='lnum'>2957</font>   
<font class='lnum'>2958</font>           USAGE:
<font class='lnum'>2959</font>           Not set to tangle (wrong file extension).
<font class='lnum'>2960</font>           Set config variables at the top of the script.  
<font class='lnum'>2961</font>   
<font class='lnum'>2962</font>   end_of_print
<font class='lnum'>2963</font>   
<font class='lnum'>2964</font>   exit;
<font class='lnum'>2965</font>     }
<font class='lnum'>2966</font>   
<font class='lnum'>2967</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('68');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('63');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('61');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('69');">
<font class='lnum'><i>(69)</i></font>&nbsp; </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2976)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='69'></a></legend></fieldset>
<p>
<div id="69" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('69');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('70');">
<font class='lnum'><i>(70)</i></font>&nbsp; TANGLER </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2979)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='70'></a></legend></fieldset>
<p>
<div id="70" style="display:none">   
<ul>


<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('71');">
<font class='lnum'><i>(71)</i></font>&nbsp; Notes on; difference btw built-in and "notangle" </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 2983)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='71'></a></legend></fieldset>
<p>
<div id="71" style="display:none">   
<ul>


<p>
<p>
<p>
    This version of the script includes a built-in tangler. However if you set<br>
    "$use_builtin_tangler" to 0 in the settings, the script will pass ithe request <br>
    through to the "notangle" utility of the "noweb" Literate Programming tool <br>
    to tangle starting with <i>the default chunk &lt; &lt;*&gt; &gt;</i>   and without other <br>
    options passed. I only set "notangle" below to preserve the tabs in case you <br>
    are tangling Makefiles.<br>
<p>
    If you set $use_builtin_tangler to 1, the "seek-peek" tangler will be used.<br>
    It does not clobber tabs at all, so tangling out Makefiles is possible.<br>
    It does not choke on double &lt; &lt; in text chunks, either.<br>
<p>
    It is:<br>
   <ul> <li> not so much tested (but seem to handle example from "noweb" distribution<br>
    after those have been brought to "canonical form", i.e. <b> all code chunks<br>
    end with "@", no exceptions </b> <br>
    </li> <li> can handle multiple refs on the same line surrounded by other text,<br>
        </li> <li> can tangle starting from arbitrary chunks (option "-R 'chunkname'" on CL)<br>
    </li> </ul><br>
    You might want to use the Ramsey's tool sometimes  to check the Molly's output.<br>
    Norman Ramsey's "noweb" has been around for more than 10 years and been used<br>
    on thousands of lines of other projects.<br>
<p>
        <ul> <b>  1. Note</b> that for <b> "notangle" </b> you have   to make sure your <br>
        double angle brackets are broken by spaces "&lt; &lt;"  or with actual escapes <br>
        "&lt;\&lt;" even in doc chunks (and escape them in your code, too. "Notangle" <br>
        reacts to them NOT only at the beginning of the line, as my tangler does, <br>
        but everywhere and chokes if finds them.<br>
<p>
        <b> 2.  Note</b> that the built-in tangler </b> uses "noweb" markup, but it is <br>
        <i> more restrictive </i> in one sense: <b> all code chunks MUST end with "@"</b> <br>
            <pre>&lt; &lt;name of chunk&gt; &gt;=
            ......
            @ </pre><br>
        Norman Ramsey's convention was: <i> you are allowed not to close the code chunk<br>
        with "@" if the next code chunk is coming right after it </i><br>
        </ul><br>
<p>
<p>
    So, when the script is invoked as "script.tangle" (which can be a link or a soft<br>
    link to something like "script.weave", it's "real" name), it will dump the source<br>
    to STDOUT, very convenient for development.<br>
<p>
    I usually move the root chunk &lt; &lt;*&gt; &gt; along inside the LIterate Source project<br>
    file and assign it to the test script or the part I am working on. The Literate Source<br>
    project file includes several actual source files usually. By the way, it's quite<br>
    nice to be able to keep all partial tests that you do before including those into<br>
    the target program all in one place, your common project file.<br>
<p>
    To tangle with more specific options, run "notangle" directly on your "mollified"<br>
    literate source file, e.g.<br>
    <pre>notangle -R my_root_chunk -L script.weave </pre><br>
<p>
    Later other modes of operation may be incorporated here.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('71');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('72');">
<font class='lnum'><i>(72)</i></font>&nbsp; Tangler despatcher: run pass-through or built-in tangler </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3046)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='72'></a></legend></fieldset>
<p>
<div id="72" style="display:none">   
<ul>


<p>
    Passes the request to "notangle" from the "noweb" literate tools suite -<br>
    OR starts the built-in tangler chunks.<br>
<p>
    1. Pre-filtering needs to be done. E.g. "notangle" gets confused by double angle <br>
    brackets even when those are inside the document chunks.<br>
    Therefore I will simply cut out document chunks altogether and not pass them to the<br>
    tangler.<br>
<p>
    Test line (delete spaces to test): &lt; &lt; get it, choke on this, bastard &gt; &gt;<br>
    &lt; &lt; or this&gt; &gt;=<br>
        or even this<br>
    @<br>
<p>
    <b> ADD-ON: multi-file tangling </b><br>
    LITSOURCE  opened in the main despatcher for Quick Mode<br>
    and for weaving, both modes. That is always <i> one file only </i><br>
<p>
    Many files must be opened here now for multi-file tangling, pass-through<br>
    disabled ("notangle" cannot do it).<br>
<p>
    ALSO: an error in logic to check for $use_builtin_tangler? Will be unset and false<br>
    in Command-line mode anyway.<br>
<p>
<p>
<font class='lnum'>3073</font>   
                <div id=codechunk3073>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tangle me&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3074</font>   
<font class='lnum'>3075</font>   TANGLE_ME:
<font class='lnum'>3076</font>   
<font class='lnum'>3077</font>   
<font class='lnum'>3078</font>     if ( $use_builtin_tangler ) {
<font class='lnum'>3079</font>   
<font class='lnum'>3080</font>       <font class='chunkref'>&lt;&lt;seek-peek tangler&gt;&gt;</font>
<font class='lnum'>3081</font>   
<font class='lnum'>3082</font>     } 
<font class='lnum'>3083</font>     else { # pass to "notangle" from "noweb" tools by Ramsey
<font class='lnum'>3084</font>   
<font class='lnum'>3085</font>       open TANGLE_PIPE, "| notangle -t4 -";
<font class='lnum'>3086</font>   
<font class='lnum'>3087</font>       while  (&lt;LITSOURCE0&gt;) {
<font class='lnum'>3088</font>   
<font class='lnum'>3089</font>               if ( m!^&lt;\&lt;(.*)&gt;\&gt;=! ... m!^@\s*$! ) { # -- CODE CHUNKS ONLY -- 
<font class='lnum'>3090</font>                   print TANGLE_PIPE $_;
<font class='lnum'>3091</font>               }
<font class='lnum'>3092</font>   
<font class='lnum'>3093</font>       } # elihw
<font class='lnum'>3094</font>   
<font class='lnum'>3095</font>       close TANGLE_PIPE;
<font class='lnum'>3096</font>       close LITSOURCE0;
<font class='lnum'>3097</font>   
<font class='lnum'>3098</font>     } #; esle, pass-through clause end
<font class='lnum'>3099</font>   
<font class='lnum'>3100</font>    exit;
<font class='lnum'>3101</font>   
<font class='lnum'>3102</font>   </fieldset></pre>
</div><p>
    <s> <b> Speculative: Immediate execution of the script ? Do I need it?  </b><br>
    It did not work exactly, but then I did not try it for real -- if it is needed and if your<br>
    language supports taking input from STDIN, it may be possible also to immediately run your<br>
    script skipping the stage of "tangling-into-a-file" before running.<br>
    To be added (possibly). </s><br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('72');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('73');">
<font class='lnum'><i>(73)</i></font>&nbsp; seek-peek tangler </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3114)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='73'></a></legend></fieldset>
<p>
<div id="73" style="display:none">   
<ul>


<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('74');">
<font class='lnum'><i>(74)</i></font>&nbsp; Advantages, limitations; escapes; the algorithm </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3118)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='74'></a></legend></fieldset>
<p>
<div id="74" style="display:none">   
<ul>


<p>
<b> Advantages, limitations and escapes </b><br>
<p>
(a) <s> The first version can only take care of one litprog chunk reference per line, and<br>
this ref cannot be surrounded by other text. </s><br>
Built-in tangler can handle multiple references per line surrounded by other text<br>
<p>
(b) However it does not clobber tabs, so you can tangle out Makefiles with it.<br>
<p>
(c) Built-in tangler insists on ending every code block with an explicit "@"<br>
("notangle" allows to drop them if the next chunk is code, too)<br>
<p>
(d) "notangle" by Ramsey is confused by &lt; &lt;  even inside documentation chunk, in any position.<br>
My default "pass-through" tangler filters those out and treats as "real" only the dbl-angle<br>
bracketed stuff <i> in the first position in its line </i><br>
<p>
This 'seek-peek' tangler also filters out all of documentation chunks and looks only for <br>
<b> dbl angles and the @ sign in the first position of the line </b><br>
<p>
(e) The used regexps ensure that if you have both opening and closing double brackets<br>
somewhere <b> in your code </b>, the S-P tangler will get screwed.<br>
This and the first-positioned symbols are the only escapes one needs to observe as<br>
far as I understand.<br>
<p>
(f) The S-P tangler only reads files on disk, two times actually. So for now at least<br>
you cannot pipe into it. (It works roughly 3 times faster though and can potentially<br>
work across several litsource files (not implemented yet))<br>
<p>
<b>The idea/algorithm is to:</b><br>
<p>
(a) run a first pass over the file collecting a list of <br>
        chunk offsets, or "addresses"<br>
<p>
(b) run a second pass recursively, already knowing where to read the<br>
        bits and pieces from . That's all there is to "tangling".<br>
<p>
(c) Filters could apply to some chunks for:<br>
        /weaving/<br>
        * feeding the text to a markdown lang<br>
        * cutting sth out for a math processor <br>
                (e.g. mimeTeX, or to ASCIIMathML.js)<br>
        /tangling/<br>
        * for conditional tangling of certain chunks<br>
        (e.g. those whose names start with DEBUG, negative<br>
        or the opposint, CLEAN, for a positive filtering)<br>
/none of the above are used now/        <br>
<p>
This type of tangler will not be able to get input via pipes,<br>
but - it should be fine working across <b>several literate source<br>
files</b>, the only requirement is that their chunk namespace should be<br>
flat (unique names across your whole project). <br>
It can be managed by prepending the chunk names by their file IDs, for<br>
example.<br>
/* command line option to get several files and their processing by the <br>
script are not implemented yet */<br>
<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('75');">
<font class='lnum'><i>(75)</i></font>&nbsp;todo</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3178)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='75'></a></legend></fieldset>
<p>
<div id="75" style="display:none">   
<ul>


<s> Now, the next step is to fix the trailing line with @<br>
<p>
<i> HOW: </i><br>
I'll "tell" on each line and use as my end-of-splinter address<br>
the one from the previous line (i.e. just before the last line, <br>
which contains the trailing rubbish).  </s> -- DONE<br>
<p>
<s> NEXT is many chunk refs on teh same line surrounded by other text/code </s><br>
--done--<br>
<p>
<s> NEXT is command-line processing for tangling any given root </s> --done<br>
<p>
<s> NEXT is adding comments with line nums and offsets in teh original Lit Source<br>
into the tangled out code </s><br>
<p>
NEXT is "un-tangling", i.e. reimporting code, changed during testing back into<br>
LitSource (? possibly)<br>
<p>
<s> NEXT possibly - processing over several files, which are mechanical splinters<br>
of the same Literate Project </s><br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('75');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('74');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('76');">
<font class='lnum'><i>(76)</i></font>&nbsp;The code</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3206)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='76'></a></legend></fieldset>
<p>
<div id="76" style="display:none">   
<ul>


<p>
<font class='lnum'>3209</font>   
                <div id=codechunk3209>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;seek-peek tangler&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3210</font>   
<font class='lnum'>3211</font>   SEEK_PEEK_TANGLER:
<font class='lnum'>3212</font>   
<font class='lnum'>3213</font>   <font class='chunkref'>&lt;&lt;pass 1&gt;&gt;</font>
<font class='lnum'>3214</font>   <font class='chunkref'>&lt;&lt;check for cycles, search for roots&gt;&gt;</font>
<font class='lnum'>3215</font>   <font class='chunkref'>&lt;&lt;pass 2 and print&gt;&gt;</font>
<font class='lnum'>3216</font>   <font class='chunkref'>&lt;&lt;main: call the sub&gt;&gt;</font>
<font class='lnum'>3217</font>   
<font class='lnum'>3218</font>   exit;
<font class='lnum'>3219</font>   
<font class='lnum'>3220</font>   </fieldset></pre>
</div><p>
"pass 1" "goes through the file collecting addresses.<br>
<p>
Then "pass 2" sets a recursive sub to "untangle" the chunks with<br>
their included references.<br>
<p>
The "main" sets the root chunk and calls the sub<br>
<p>
I'll ' add command-line and CGI arguments processing later.<br>
<p>
<font class='lnum'>3231</font>   
                <div id=codechunk3231>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main: call the sub&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3232</font>   
<font class='lnum'>3233</font>           $root_chunk = $root_chunk || "*";
<font class='lnum'>3234</font>   
<font class='lnum'>3235</font>   # USAGE: print_chunk(name_of_chunk, left_margin, print_newline_flag)
<font class='lnum'>3236</font>           print_chunk($root_chunk, "", 1); 
<font class='lnum'>3237</font>   
<font class='lnum'>3238</font>           # and close all the opened files
<font class='lnum'>3239</font>           for (@LITSOURCE_list){close $_;}
<font class='lnum'>3240</font>   
<font class='lnum'>3241</font>   </fieldset></pre>
</div><p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('77');">
<font class='lnum'><i>(77)</i></font>&nbsp; PAss 1 </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3245)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='77'></a></legend></fieldset>
<p>
<div id="77" style="display:none">   
<ul>


<p>
declare and initialize some vars<br>
<p>
<font class='lnum'>3250</font>   
                <div id=codechunk3250>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;pass 1&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3251</font>   
<font class='lnum'>3252</font>   <font class='chunkref'>&lt;&lt;declarations and initializations&gt;&gt;</font>
<font class='lnum'>3253</font>   <font class='chunkref'>&lt;&lt;while-loop and peek file ofsets&gt;&gt;</font>
<font class='lnum'>3254</font>   
<font class='lnum'>3255</font>   </fieldset></pre>
</div><p>
<font class='lnum'>3257</font>   
                <div id=codechunk3257>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;declarations and initializations&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3258</font>   
<font class='lnum'>3259</font>       my $chunk_beg_pattern = q(^&lt;\&lt;(.*)&gt;\&gt;=);
<font class='lnum'>3260</font>       my $chunk_end_pattern = q(^@\s.*$);
<font class='lnum'>3261</font>       my $chunk_ref_pattern = q(&lt;\&lt;(.*?)&gt;\&gt;[^=]); # can be used several times in a line
<font class='lnum'>3262</font>       
<font class='lnum'>3263</font>       my $current_chunk_name = "";
<font class='lnum'>3264</font>       my $current_chunk_start_foff = 0;; # "foff" is a "file offset"
<font class='lnum'>3265</font>       my $current_chunk_end_foff = 0;
<font class='lnum'>3266</font>   
<font class='lnum'>3267</font>       my %file_offsets_hash = ();
<font class='lnum'>3268</font>       my %file_lines_hash = ();
<font class='lnum'>3269</font>       my $parents_list = ();
<font class='lnum'>3270</font>   
<font class='lnum'>3271</font>       my $line_num = 0;
<font class='lnum'>3272</font>       my $previous_line_foff = 0; # "foff" is a "file offset"
<font class='lnum'>3273</font>   
<font class='lnum'>3274</font>   </fieldset></pre>
</div><p>
<p>
<b>Main loop</b><br>
Need to collect chunk addresses (with "tell"), and keep <i> a hash of lists</i><br>
with addresses of all chunk continuations (if any)<br>
    <pre> (beg_offset, end_offset) </pre><br>
<p>
I'll need to push them in, and in pass 2 I'll iterate over them, <br>
and so ensure all of a split chunk is read.<br>
<p>
<b>Anyway,</b> to deal with references to chunks from inside chunks I <br>
will insert ("ref", "referred_chunk_name", left_indentation) into my <br>
    <pre>%file_offsets_hash </pre><br>
during the first pass. This pair is different from numeric beg-end offset pairs,<br>
and I'll start a recursive printout of the chunk referred to when I detect it.<br>
<p>
I'll need to keep "left margin", the indent for the reference as a next value<br>
in the list/array, so it is<br>
    <ul><li>pairs (beg_chunk_offset, end_chunk_offset) for regular chunks<br>
    </li><li> and a triple ("ref", name_of_referred_chnk, its_left_indent) for refs<br>
    </li></ul><br>
<p>
I might need to keep more information (e.g. "line numbers in the Literate Source),<br>
then those become quadruples and quintil.. whatever ;)<br>
<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('78');">
<font class='lnum'><i>(78)</i></font>&nbsp; Ref: perl operators </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3302)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='78'></a></legend></fieldset>
<p>
<div id="78" style="display:none">   
<ul>


<p>
<b>---Perl operators----</b><br>
<p>
<b>pos</b><br>
<p>
<ul><br>
3253   while ( $string =~ m!\G(.*?)&lt;\&lt;(.*?)&gt;\&gt;!gs) {<br>
3254     <br>
3255     $off = length($2);<br>
3256     $position = pos($string);<br>
3257     #pos($string) = $position + $off;<br>
3258     print "\n\t---title---\n$2 of length $off at $position \n\t----after----\n$1\n========\n";<br>
3259   <br>
3260   }<br>
</ul><br>
<p>
<b>tell filehandle</b> (if omitted, the last file read)<br>
<p>
<b>seek FILEHANDLE,POSITION,WHENCE </b><br>
Sets FILEHANDLE's position, just like the fseek call of stdio . <br>
FILEHANDLE may be an expression whose value gives the name of the filehandle. <br>
The values for WHENCE are 0 to set the new position in bytes to POSITION,<br>
<p>
<b>read FROM_FILEHANDLE, IN_SCALAR_BUFER_VAR_OR_STREM, LENGTH_IN_BYTES_OR_CHARS</b><br>
There <b>may be problems</b> if FH is opened in non-bytes mode, or if some pragma is used<br>
<p>
-------------------<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('78');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('77');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('79');">
<font class='lnum'><i>(79)</i></font>&nbsp; Pass 1: main while-loop and foffs</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3337)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='79'></a></legend></fieldset>
<p>
<div id="79" style="display:none">   
<ul>


<p>
<p>
<i> A loop over the doc starts here </i><br>
Process inside doc sections:<br>
<p>
<b> ADD-ON: multi-file tangling </b><br>
LITSOURCE  opened in the main despatcher for Quick Mode<br>
and for weaving, both modes. That is always <i> one file only </i><br>
<p>
Many files must be opened here now for multi-file tangling, pass-through<br>
disabled ("notangle" cannot do it).<br>
<p>
mm.. (a) all fh's must be opened at the same time for pass2; not for pass1.<br>
Then: can I still call it "LITSOURCE" here, but rename down the line?<br>
Is it kludgier than renaming the whole chain from despatcher?<br>
<p>
<b> the problem is this </b><br>
I <b> </i> absolute have to </i> </b> process files in the correct order,<br>
which is presupposed to be the one given on CL.<br>
Why? - bcs splinters of a chunk spread across several files must start with<br>
the correct first splinter, etc., get assembled in correct order.<br>
<p>
Now, as I assigned names like "LITSOURCE0", 1,2,... to my opened filehandles,<br>
if I sort hte hash keys, I'll get them right (I iterated over ARGV to open<br>
them and therefore the numbering is good) -- IF I sort NUMERICALLY.<br>
<p>
Question: will sort do 0,1,2,3..10.11.12... -- or 0,1,10,11,12...,2... ??<br>
Check, or I'll get a hidden error here.<br>
<p>
<p>
<font class='lnum'>3369</font>   
                <div id=codechunk3369>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;while-loop and peek file ofsets&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3370</font>   
<font class='lnum'>3371</font>   foreach $LITSOURCE_multi(@LITSOURCE_list) {
<font class='lnum'>3372</font>   
<font class='lnum'>3373</font>   
<font class='lnum'>3374</font>    while (&lt;$LITSOURCE_multi&gt;) {
<font class='lnum'>3375</font>       $line_num++;
<font class='lnum'>3376</font>   
<font class='lnum'>3377</font>       # --- CODE CHUNKS -- not inside documentation section
<font class='lnum'>3378</font>       if ( m!$chunk_beg_pattern! .. m!$chunk_end_pattern! ) {
<font class='lnum'>3379</font>   
<font class='lnum'>3380</font>       <font class='chunkref'>&lt;&lt;chunk beginning&gt;&gt;</font>
<font class='lnum'>3381</font>       <font class='chunkref'>&lt;&lt;chunk ending&gt;&gt;</font>
<font class='lnum'>3382</font>       <font class='chunkref'>&lt;&lt;chunk reference&gt;&gt;</font>
<font class='lnum'>3383</font>       <font class='chunkref'>&lt;&lt;chunk body&gt;&gt;</font>
<font class='lnum'>3384</font>   
<font class='lnum'>3385</font>       } #fi
<font class='lnum'>3386</font>   
<font class='lnum'>3387</font>       $previous_line_foff = tell $LITSOURCE_multi;
<font class='lnum'>3388</font>   
<font class='lnum'>3389</font>     } # eliwh
<font class='lnum'>3390</font>   
<font class='lnum'>3391</font>   } # hcaerof iteration over all files collecting file offsets
<font class='lnum'>3392</font>   
<font class='lnum'>3393</font>   </fieldset></pre>
</div><p>
<b>A later adjustement, actually to rid of the last line trash</b><br>
    "tell" gives addr <i> at the end of the matched line</i> So,<br>
    I'll have to use <i> offset from the previous match</i> to<br>
    rid of the current line rubbish - this is what the last<br>
    var assignement in the loop is about.<br>
<p>
<p>
<b>First, the chunk body</b> <br>
It closes the "if" opened in "chunk beginning", The rest of then are<br>
"elsif" clauses. <br>
<p>
There's nothing to do here in pass 1; just here not to leave it<br>
implicit and hidden<br>
<p>
<font class='lnum'>3409</font>   
                <div id=codechunk3409>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk body&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3410</font>   
<font class='lnum'>3411</font>   else { # chunk body
<font class='lnum'>3412</font>       ; # nop; here just not to hide an implicit case
<font class='lnum'>3413</font>       #~ print "."; # debug: show dots for lines 
<font class='lnum'>3414</font>   }
<font class='lnum'>3415</font>   
<font class='lnum'>3416</font>   </fieldset></pre>
</div><p>
<p>
<b>Next, match for a first line of a new chunk</b> (which can continue<br>
some previous splinters of the same chunk in the LitSource file)<br>
<p>
If a chunk begins (or continues) here, <br>
        - set the current chunk name<br>
        -pick up its "peeked" offset in  the file <br>
        - and push it in the hash of f_offs under the current chunk name<br>
<p>
Hmm.. The perl "tell" gives the position after the read line, I understand.<br>
No adjustment is needed for the beginning chunk match, and it'll eliminate<br>
the title from the later output.<br>
<p>
<b> Multifile </b> - not touching line numbering yet. First, do tangling.<br>
Line numbers are analogous.<br>
<p>
<font class='lnum'>3434</font>   
                <div id=codechunk3434>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk beginning&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3435</font>   
<font class='lnum'>3436</font>       if ( $_ =~ m!$chunk_beg_pattern! ) {
<font class='lnum'>3437</font>           $current_chunk_name = $1;
<font class='lnum'>3438</font>           $current_chunk_start_foff = $LITSOURCE_multi . "-" . (tell $LITSOURCE_multi);
<font class='lnum'>3439</font>   
<font class='lnum'>3440</font>           # -- collecting offset and line number, actually
<font class='lnum'>3441</font>           push @{$file_offsets_hash{$current_chunk_name}}, $current_chunk_start_foff;
<font class='lnum'>3442</font>           push @{$file_lines_hash{$current_chunk_name}}, $LITSOURCE_multi . "-" . $.;
<font class='lnum'>3443</font>           #~ print "----&gt; chunk $1 line $. offset $current_chunk_start_foff\n";
<font class='lnum'>3444</font>   
<font class='lnum'>3445</font>       }
<font class='lnum'>3446</font>   
<font class='lnum'>3447</font>   </fieldset></pre>
</div><p>
<p>
<b>If a chunk ends,</b> peek its end offset in the file ("f_off") Actually, not to pick<br>
up the closing "at" signs, get the previous line's told offset.<br>
<p>
.. and push it in the hash of lists<br>
Plus - set $current_chunk_name=""; # just in case<br>
<p>
<font class='lnum'>3456</font>   
                <div id=codechunk3456>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk ending&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3457</font>   
<font class='lnum'>3458</font>       elsif ( $_ =~ m!$chunk_end_pattern! )  {
<font class='lnum'>3459</font>   
<font class='lnum'>3460</font>           $current_chunk_end_foff = $LITSOURCE_multi . "-" . $previous_line_foff;
<font class='lnum'>3461</font>           # -- collecting offset and line number:
<font class='lnum'>3462</font>           push @{$file_offsets_hash{$current_chunk_name}}, $current_chunk_end_foff;
<font class='lnum'>3463</font>           push @{$file_lines_hash{$current_chunk_name}}, $LITSOURCE_multi . "-" . $.;
<font class='lnum'>3464</font>           #~ print "\tline $. offset $current_chunk_end_foff&lt;------\n";
<font class='lnum'>3465</font>   
<font class='lnum'>3466</font>           $current_chunk_name = "";
<font class='lnum'>3467</font>       }
<font class='lnum'>3468</font>   
<font class='lnum'>3469</font>   </fieldset></pre>
</div><p>
<b>Ok, so we put the foffs and line numbers  in the <br>
(beg offset,  end offset) order</b>.<br>
<p>
<p>
<b>Now, the chunk refs </b><br>
<p>
If we get a reference, regex-split the line <br>
        - set the end offset of the current chunk<br>
        - push it in the hash of lists<br>
        - figure the offset after the chunk ref<br>
        - push it into the hash of lists using the current chunkname<br>
        - IMPORTANT COMPLICATION<br>
                deal with the case when several chunk refs on the same<br>
                line are present;<br>
                do <i>not</i> do it for the first version of the script.<br>
<p>
for many matches on a line - <br>
Here we'll have to match with continuation and repeat matching in a loop until the line <br>
with matches is exhausted.<br>
<p>
<font class='lnum'>3491</font>   
                <div id=codechunk3491>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk reference&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3492</font>   <font class='chunkref'>&lt;&lt;chunk reference - multiref inside other text&gt;&gt;</font>
<font class='lnum'>3493</font>   </fieldset></pre>
</div><p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('79');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('80');">
<font class='lnum'><i>(80)</i></font>&nbsp; multiple refs on the same line</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3498)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='80'></a></legend></fieldset>
<p>
<div id="80" style="display:none">   
<ul>


<p>
<p>
<b> Multiple references on the same line surrounded by other text</b><br>
<p>
First, I'll need to change the regexp pattern:<br>
mm.. I probably needn't. I'll get to it on a normal regexp, and use the<br>
multiref regexp only within<br>
The "chunk_ref_pattern" is set to q(&lt;\&lt;(.*?)&gt;\&gt;[^=])<br>
<p>
So, if I got (one, first) reference using a normal regex,<br>
start iterating on this line using a multi-match regex.<br>
'The rest of the line' can be got right after the while{} loop.<br>
I'll need to subtract<br>
<s>"told offset" - "line length" + "pos-given offset".</s><br>
I have $previous_line_foff<br>
<p>
<i> NOTE: "pos" does not work intuitively, so I do not use it below </i><br>
<p>
I'll write out logic later, after I have tested and adjusted it enough<br>
<p>
<font class='lnum'>3520</font>   
                <div id=codechunk3520>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;chunk reference - multiref inside other text&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3521</font>   
<font class='lnum'>3522</font>    elsif ( $_ =~ m!$chunk_ref_pattern!g ) {
<font class='lnum'>3523</font>   
<font class='lnum'>3524</font>       my $line = $_;
<font class='lnum'>3525</font>       my $current_foff_pos =  $previous_line_foff;
<font class='lnum'>3526</font>       my $initial_margin = "";
<font class='lnum'>3527</font>       my $homegrown_pos = 0;
<font class='lnum'>3528</font>   
<font class='lnum'>3529</font>       while ($line =~ m!(.*?)&lt;\&lt;(.*?)&gt;\&gt;!g) {
<font class='lnum'>3530</font>   
<font class='lnum'>3531</font>           my $pre_ref_match = $1;
<font class='lnum'>3532</font>           my $ref_match = $2;
<font class='lnum'>3533</font>           my $len_pre_ref_match = length $pre_ref_match;
<font class='lnum'>3534</font>           my $len_ref_match = length $ref_match;
<font class='lnum'>3535</font>   
<font class='lnum'>3536</font>           # "end" of prev pair; collecting offset and line number
<font class='lnum'>3537</font>           push @{$file_offsets_hash{$current_chunk_name}}, 
<font class='lnum'>3538</font>               $LITSOURCE_multi . "-" . ($current_foff_pos + $len_pre_ref_match); 
<font class='lnum'>3539</font>           push @{$file_lines_hash{$current_chunk_name}}, $LITSOURCE_multi . "-" . $.;
<font class='lnum'>3540</font>   
<font class='lnum'>3541</font>   
<font class='lnum'>3542</font>           #-------deal with pushing ("ref", "chunkname") pair -----
<font class='lnum'>3543</font>           # special id string for refs
<font class='lnum'>3544</font>           push @{$file_offsets_hash{$current_chunk_name}}, "ref";
<font class='lnum'>3545</font>           # name of reference
<font class='lnum'>3546</font>           push @{$file_offsets_hash{$current_chunk_name}}, $ref_match; 
<font class='lnum'>3547</font>           # .. and form pairs for toposort (cycles check, search roots):
<font class='lnum'>3548</font>           push @parents_list, ($current_chunk_name, $ref_match);
<font class='lnum'>3549</font>   
<font class='lnum'>3550</font>           # -- next a special entry for refs: (left_margin)
<font class='lnum'>3551</font>           # I keep tabs and spaces and subst all else to spaces
<font class='lnum'>3552</font>           $pre_ref_match =~ s!\S! !g;
<font class='lnum'>3553</font>           $initial_margin .= $pre_ref_match;
<font class='lnum'>3554</font>           push @{$file_offsets_hash{$current_chunk_name}}, $initial_margin; 
<font class='lnum'>3555</font>           $initial_margin .= " " x ( $len_ref_match + 2*( length "&lt;&gt;") );      
<font class='lnum'>3556</font>   
<font class='lnum'>3557</font>           my $homegrown_pos = $len_pre_ref_match + $len_ref_match + 2*(length "&lt;&gt;");
<font class='lnum'>3558</font>           my $end_of_match_pos = $current_foff_pos + $homegrown_pos;
<font class='lnum'>3559</font>   
<font class='lnum'>3560</font>           # "start" a new pair.. - ok, let's not use "pos" at all, if it fails
<font class='lnum'>3561</font>           # .. and collect both offset and the line number
<font class='lnum'>3562</font>           push @{$file_offsets_hash{$current_chunk_name}}, 
<font class='lnum'>3563</font>               $LITSOURCE_multi . "-" . $end_of_match_pos;
<font class='lnum'>3564</font>           push @{$file_lines_hash{$current_chunk_name}}, $LITSOURCE_multi . "-" . $.;
<font class='lnum'>3565</font>   
<font class='lnum'>3566</font>           #  I'll need to reset current_foff_pos to the pos
<font class='lnum'>3567</font>           #   (or to the directly caclucalted offset, if I prefer that):
<font class='lnum'>3568</font>           $current_foff_pos = $end_of_match_pos; 
<font class='lnum'>3569</font>   
<font class='lnum'>3570</font>       } # elihw
<font class='lnum'>3571</font>   
<font class='lnum'>3572</font>       # This is where chunk refs get an extra newline ?
<font class='lnum'>3573</font>   
<font class='lnum'>3574</font>    } # fisle
<font class='lnum'>3575</font>   
<font class='lnum'>3576</font>   </fieldset></pre>
</div><p>
 <b>This works.</b><br>
<p>
  Handles Ramsey's test progs <b>when those are cleaned of an annoying<br>
 irregularity in his notation</b>, i.e. when <b>all</b> prog chunks start<br>
 with title in dbl brackets and end with an "at" (exactly in the first<br>
 position on the line)<br>
<p>
<b> aligning printout</b><br>
Need to save left margin (here) and apply it in the sub print_chunk below<br>
<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('81');">
<font class='lnum'><i>(81)</i></font>&nbsp; first test: how to iterate over regex, using pos</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3590)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='81'></a></legend></fieldset>
<p>
<div id="81" style="display:none">   
<ul>


<p>
<p>
This is a snippet showing how it can be treated:<br>
<i> broken with whitespaces as escapes for the half-brain "notangle" not to<br>
stumble. Delete spaces btw &lt;_&lt;  </i><br>
<pre>

#~ Nope, they use it inside "while" 
#~ OK, this is how it will work in the script:
#~ /the while loop is over the line that contained at least 
#~ one ref; the loop body includes pushes into the hash/

        $line = "asdfas asd &lt; &lt;qewrqw&gt;&gt; opiopiopi &lt; &lt;2345&gt;&gt; asdasdf";
        $llen = length $line;
        print "the original line:: [$line] -- of length $llen\n";


        while ($line =~ m!(.*?)&lt;\&lt;(.*?)&gt;&gt;!g) {
                print "$1 -- $2\n";
                $ancor_off  = pos $line;

                print "ancor position is $ancor_off\n";
        }

        print "THE LAST PART IS  ", (substr $line, $ancor_off), "\n";

</pre><br>
<p>
And this is its output:<br>
<p>
<pre>
the original line:: [asdfas asd &lt; &lt;qewrqw&gt;&gt; opiopiopi &lt; &lt;2345&gt;&gt; asdasdf] -- of length 48
asdfas asd  -- qewrqw
ancor position is 21
 opiopiopi  -- 2345
ancor position is 40
THE LAST PART IS   asdasdf
</pre><br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('81');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('80');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('82');">
<font class='lnum'><i>(82)</i></font>&nbsp; Topological sort: check for cycles and find roots</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3636)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='82'></a></legend></fieldset>
<p>
<div id="82" style="display:none">   
<ul>


<p>
So, let's cut the root search (if an options is set) and cycles check (always,<br>
unless an option is given to bypass, maybe), into the program flow.<br>
<p>
<font class='lnum'>3642</font>   
                <div id=codechunk3642>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;check for cycles, search for roots&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3643</font>   
<font class='lnum'>3644</font>   <font class='chunkref'>&lt;&lt;toposort&gt;&gt;</font>
<font class='lnum'>3645</font>   
<font class='lnum'>3646</font>   # will abort if cycles detected. Does not detect all cycles? - need to check
<font class='lnum'>3647</font>   my @chunks_in_chains = topological_sort($show_all_roots, @parents_list);
<font class='lnum'>3648</font>   
<font class='lnum'>3649</font>   if ($show_all_roots){
<font class='lnum'>3650</font>   
<font class='lnum'>3651</font>       # non-standalone roots are already printed from inside "topological_sort"
<font class='lnum'>3652</font>       print "\n\t------single-chunk roots-------\n";
<font class='lnum'>3653</font>       my %lookup_hash = ();
<font class='lnum'>3654</font>       for (@chunks_in_chains){ $lookup_hash{$_} = 1;}
<font class='lnum'>3655</font>   
<font class='lnum'>3656</font>       for (keys %file_offsets_hash) { 
<font class='lnum'>3657</font>           print "\t$lt$lt$_$gt$gt\n"
<font class='lnum'>3658</font>               unless exists $lookup_hash{$_};
<font class='lnum'>3659</font>           }
<font class='lnum'>3660</font>       print "\t-------------------------------\n\n";
<font class='lnum'>3661</font>   exit;
<font class='lnum'>3662</font>   }
<font class='lnum'>3663</font>   
<font class='lnum'>3664</font>   </fieldset></pre>
</div><p>
1. This sub is taken from .............. and is a perl reimplementation of an<br>
algorithm taken from "Programming Pearls" by Bentley, who borrowed it from<br>
Knuth.<br>
<p>
2. I have modified it trivially to abort at cycles and print roots. <br>
Should I offer an option to force Molly to ignore this with a "-f" flag from<br>
command line (?? and config var ??).<br>
<p>
3. .. and added an option, both CL and from mollifying template to print roots.<br>
    Now, the prob with printing roots is that standalone chunks, which can be<br>
    tangled out, are not in my collected pairs list, and so not printed among<br>
    possible roots.<br>
    -&gt; collect them as children of some 'dummy' and print out in a second<br>
    invocation of topological_sort?? <br>
<p>
<p>
<font class='lnum'>3682</font>   
                <div id=codechunk3682>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;toposort&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3683</font>   
<font class='lnum'>3684</font>   sub topological_sort {
<font class='lnum'>3685</font>   
<font class='lnum'>3686</font>       my $flag_show_roots = shift;
<font class='lnum'>3687</font>       my %pairs;  # all pairs ($l, $r)
<font class='lnum'>3688</font>       my %npred;  # number of predecessors
<font class='lnum'>3689</font>       my %succ;   # list of successors
<font class='lnum'>3690</font>       my $opt_b = 0;
<font class='lnum'>3691</font>   
<font class='lnum'>3692</font>       my @topo_list_out = '';
<font class='lnum'>3693</font>   
<font class='lnum'>3694</font>       while ( @_ ) {
<font class='lnum'>3695</font>           my $l = shift @_;
<font class='lnum'>3696</font>           my $r = shift @_;
<font class='lnum'>3697</font>           my @l = ($l, $r);
<font class='lnum'>3698</font>           #my ($l, $r) = my @l = split;
<font class='lnum'>3699</font>           next unless @l == 2;
<font class='lnum'>3700</font>           next if defined $pairs{$l}{$r};
<font class='lnum'>3701</font>           $pairs{$l}{$r}++;
<font class='lnum'>3702</font>           $npred {$l} += 0;
<font class='lnum'>3703</font>           ++$npred{$r};
<font class='lnum'>3704</font>           push @{$succ{$l}}, $r;
<font class='lnum'>3705</font>       }
<font class='lnum'>3706</font>   
<font class='lnum'>3707</font>       # create a list of nodes without predecessors
<font class='lnum'>3708</font>       my @list = grep {!$npred{$_}} keys %npred;
<font class='lnum'>3709</font>   
<font class='lnum'>3710</font>       #--print discovered roots, if asked--
<font class='lnum'>3711</font>       if ($flag_show_roots) {
<font class='lnum'>3712</font>       print "\n\t--roots of multi-chunk chains--\n";
<font class='lnum'>3713</font>       for (@list) { print "\t$lt$lt$_$gt$gt\n";}
<font class='lnum'>3714</font>       print "\t-------------------------------\n";
<font class='lnum'>3715</font>       }
<font class='lnum'>3716</font>   
<font class='lnum'>3717</font>       while (@list) {
<font class='lnum'>3718</font>           $_ = pop @list;
<font class='lnum'>3719</font>           unshift @topo_list_out, $_;
<font class='lnum'>3720</font>           #print "$_\n";
<font class='lnum'>3721</font>           foreach my $child (@{$succ{$_}}) {
<font class='lnum'>3722</font>               if ($opt_b) {       # breadth-first
<font class='lnum'>3723</font>                   unshift @list, $child unless --$npred{$child};
<font class='lnum'>3724</font>               } else {    # depth-first (default)
<font class='lnum'>3725</font>                   push @list, $child unless --$npred{$child};
<font class='lnum'>3726</font>               }
<font class='lnum'>3727</font>   
<font class='lnum'>3728</font>           }
<font class='lnum'>3729</font>       }
<font class='lnum'>3730</font>   
<font class='lnum'>3731</font>       # mm.. better if I warn, print out the list so far, and then exit
<font class='lnum'>3732</font>       #   the user will have the place where the problem occured 
<font class='lnum'>3733</font>       #~ warn "cycle detected\n" if grep {$npred{$_}} keys %npred;
<font class='lnum'>3734</font>       if ( grep {$npred{$_}} keys %npred ){
<font class='lnum'>3735</font>           warn  "\n\tERROR: cycle detected - aborting execution!\n"; 
<font class='lnum'>3736</font>           print "\n---chunks discovered before the 'cycle' ERROR - sorted topologically ---\n";
<font class='lnum'>3737</font>           for (@topo_list_out) {
<font class='lnum'>3738</font>               print "$_\n";
<font class='lnum'>3739</font>           } # rof
<font class='lnum'>3740</font>   
<font class='lnum'>3741</font>       exit;
<font class='lnum'>3742</font>       } # fi check for cycles
<font class='lnum'>3743</font>   
<font class='lnum'>3744</font>       # -DEBUG-
<font class='lnum'>3745</font>       #    if ($flag_show_roots){
<font class='lnum'>3746</font>       #    print "\t--all chunks discovered--\n";
<font class='lnum'>3747</font>       #    for (@topo_list_out) {
<font class='lnum'>3748</font>       #        print $_, "\n";
<font class='lnum'>3749</font>       #    }
<font class='lnum'>3750</font>       #    exit;
<font class='lnum'>3751</font>       #    }
<font class='lnum'>3752</font>   
<font class='lnum'>3753</font>   return @topo_list_out;
<font class='lnum'>3754</font>   #return 1;
<font class='lnum'>3755</font>   } # tros_lacigolopot
<font class='lnum'>3756</font>   
<font class='lnum'>3757</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('82');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('83');">
<font class='lnum'><i>(83)</i></font>&nbsp; pass 2 and print </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3763)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='83'></a></legend></fieldset>
<p>
<div id="83" style="display:none">   
<ul>


<p>
OK, now we have a hash of pairs (beg_chunk_offset, end_chunk_offset) with triples <br>
("ref", "ref_chunkname", left_indent) interspersed where there were references included.<br>
    - start from the given root<br>
    - iterate over subchunks of a given chunk - beg_f_off, end_f_off<br>
    - print out the file verbatim<br>
    ...<br>
      IF there WAS a ref, RECURSE on the new chunk name<br>
<p>
That should be it<br>
<p>
<font class='lnum'>3776</font>   
                <div id=codechunk3776>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;pass 2 and print&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3777</font>           <font class='chunkref'>&lt;&lt;sub: tangle recursively - nondestructive&gt;&gt;</font>
<font class='lnum'>3778</font>   </fieldset></pre>
</div><p>
<p>
Now - the RECURSIVE PRINTOUT untangling from the default/given root.<br>
--seek, then "read" into some $buf, which then is printed--<br>
<p>
    (a) if the pair got from the hash of lists is digits, print out <br>
    (b) if the first is a specia string "ref", get the ref name from<br>
    the second item in the pair and go there recursively<br>
<p>
<p>
<font class='lnum'>3789</font>   
                <div id=codechunk3789>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;sub: tangle recursively - nondestructive&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3790</font>   
<font class='lnum'>3791</font>   # USAGE: print_chunk(name_of_chunk, left_margin, print_newline_flag)
<font class='lnum'>3792</font>   sub print_chunk {
<font class='lnum'>3793</font>   
<font class='lnum'>3794</font>    (my $chunk_being_printed,
<font class='lnum'>3795</font>       my $snippet_left_margin, 
<font class='lnum'>3796</font>             my $snippet_print_newline_flag, @rest) = @_; 
<font class='lnum'>3797</font>   
<font class='lnum'>3798</font>   
<font class='lnum'>3799</font>    #~ print "\n---- printing chunk $chunk_being_printed --------\n";
<font class='lnum'>3800</font>    #~ print "DEBUG: got left.m. $snippet_left_margin nl. flag $snippet_print_newline_flag \n";
<font class='lnum'>3801</font>   
<font class='lnum'>3802</font>    # -- error mess. not to fail silently --
<font class='lnum'>3803</font>    unless ( defined $file_offsets_hash{$chunk_being_printed} ) {
<font class='lnum'>3804</font>       die "\n\tERROR: chunk $chunk_being_printed not found in file $ARGV[0]\n\n";
<font class='lnum'>3805</font>    }
<font class='lnum'>3806</font>   
<font class='lnum'>3807</font>   
<font class='lnum'>3808</font>    # iterate over splinters of a chunk, which are foff pairs
<font class='lnum'>3809</font>    my $iterate_lines = 0;
<font class='lnum'>3810</font>    for ( my $iterate_foffs = 0;
<font class='lnum'>3811</font>               exists $file_offsets_hash{$chunk_being_printed}[$iterate_foffs];)
<font class='lnum'>3812</font>    {
<font class='lnum'>3813</font>   
<font class='lnum'>3814</font>       my $snippet_position =  $file_offsets_hash{$chunk_being_printed}[$iterate_foffs++];
<font class='lnum'>3815</font>       my $snippet_end = $file_offsets_hash{$chunk_being_printed}[$iterate_foffs++];
<font class='lnum'>3816</font>   
<font class='lnum'>3817</font>       #~ print "debug got: beg $snippet_position -- end $snippet_end\n";
<font class='lnum'>3818</font>   
<font class='lnum'>3819</font>       <font class='chunkref'>&lt;&lt;if the record is a ref, call it recursively&gt;&gt;</font>
<font class='lnum'>3820</font>       <font class='chunkref'>&lt;&lt;else print out the chunk&gt;&gt;</font>
<font class='lnum'>3821</font>   
<font class='lnum'>3822</font>    } # rof non-destructive
<font class='lnum'>3823</font>           
<font class='lnum'>3824</font>        return 1;
<font class='lnum'>3825</font>   } # bus -- ends the recursive sub
<font class='lnum'>3826</font>   
<font class='lnum'>3827</font>   </fieldset></pre>
</div><p>
ok, if we got a chunk ref in our array of pairs, then the next entry after it is <br>
        (left_margin) <br>
(that is my nano-protocol here ;)  ). I use these numbers to keep the <br>
"printer state" before recursively calling this function for the referred <br>
chunk.<br>
<p>
<font class='lnum'>3835</font>   
                <div id=codechunk3835>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;if the record is a ref, call it recursively&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3836</font>   
<font class='lnum'>3837</font>       if ($snippet_position eq "ref") {
<font class='lnum'>3838</font>   
<font class='lnum'>3839</font>           my $snippet_left_margin_ref = 
<font class='lnum'>3840</font>               $file_offsets_hash{$chunk_being_printed}[$iterate_foffs++];
<font class='lnum'>3841</font>   
<font class='lnum'>3842</font>           # any call to a ref uncurs "print newline" flag of 0
<font class='lnum'>3843</font>           print_chunk($snippet_end, $snippet_left_margin_ref, 0);
<font class='lnum'>3844</font>       
<font class='lnum'>3845</font>       }
<font class='lnum'>3846</font>   </fieldset></pre>
</div><p>
if the next data you got from your list is pairs of offsets (beg, end), <br>
print them out, observing (a) left margine this chunk is at, and<br>
(b) skipping newlines after a chunk (could be an in-lined ref) unless <br>
this chunk is last in the referring line.<br>
<p>
For that I'll have to keep "a printer state" wth two flags for (a) and (b).<br>
<p>
<b> Multifile </b><br>
Now $snippet_position and $snippet_end are not just offsets, but strings like<br>
"LITSOURCE0-2365"<br>
I'll need to split them and supply the two pieces to "seek" and "read".<br>
<p>
<font class='lnum'>3860</font>   
                <div id=codechunk3860>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;else print out the chunk&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3861</font>       else { # .. print it here
<font class='lnum'>3862</font>   
<font class='lnum'>3863</font>           (my $litsrc_fhname_beg, my $litsrc_line_beg) =
<font class='lnum'>3864</font>               split '-', $file_lines_hash{$chunk_being_printed}[$iterate_lines++];
<font class='lnum'>3865</font>           (my $litsrc_fhname_end, my $litsrc_line_end) =
<font class='lnum'>3866</font>               split '-', $file_lines_hash{$chunk_being_printed}[$iterate_lines++];
<font class='lnum'>3867</font>   
<font class='lnum'>3868</font>           (my $litsrc_fhname_beg, my $litsrc_foff_beg) = split '-', $snippet_position;
<font class='lnum'>3869</font>           (my $litsrc_fhname_end, my $litsrc_foff_end) = split '-', $snippet_end;
<font class='lnum'>3870</font>           # DEBUG prints:
<font class='lnum'>3871</font>           #print "in file_beg $litsrc_fhname_beg $litsrc_foff_beg\n";
<font class='lnum'>3872</font>           #print "in file_end $litsrc_fhname_end $litsrc_foff_end\n------\n"; 
<font class='lnum'>3873</font>   
<font class='lnum'>3874</font>   
<font class='lnum'>3875</font>           # the file is always the same, though. You cannot have one chunk splinter
<font class='lnum'>3876</font>           # start in one file and end in another one. (2 splinters can live in 2 files)
<font class='lnum'>3877</font>           seek $litsrc_fhname_beg, $litsrc_foff_beg,  0;
<font class='lnum'>3878</font>           read $litsrc_fhname_end, $buffer_out, ($litsrc_foff_end - $litsrc_foff_beg);
<font class='lnum'>3879</font>   
<font class='lnum'>3880</font>           #----Newlines at the end of chunks and refs. 
<font class='lnum'>3881</font>           # only for the last splinter of a chunk, do newline control:
<font class='lnum'>3882</font>           if ( ((scalar @{$file_offsets_hash{$chunk_being_printed}}) - $iterate_foffs ) == 0 )
<font class='lnum'>3883</font>           { 
<font class='lnum'>3884</font>                   # works, but is suspicious logically:
<font class='lnum'>3885</font>                   # maybe I just have not invented a counterexample yet, and
<font class='lnum'>3886</font>                   # it's a trap waiting for its quarry. But it works
<font class='lnum'>3887</font>                   $buffer_out =~ s!\n([\s]*)$!$1! unless ($snippet_print_newline_flag);
<font class='lnum'>3888</font>           }
<font class='lnum'>3889</font>   
<font class='lnum'>3890</font>           #----Left indent/margin. Seems OK
<font class='lnum'>3891</font>   
<font class='lnum'>3892</font>           $chunk_left_margin =  $snippet_left_margin;
<font class='lnum'>3893</font>           $buffer_out =~ s!(\n)!$1$chunk_left_margin!sg;
<font class='lnum'>3894</font>   
<font class='lnum'>3895</font>   
<font class='lnum'>3896</font>           #----And Print Out:
<font class='lnum'>3897</font>   
<font class='lnum'>3898</font>           if ($print_ref_linenos_when_tangling){
<font class='lnum'>3899</font>           print $code_sections_comment_symbol, 
<font class='lnum'>3900</font>               "[line ", $litsrc_line_beg," in file ",
<font class='lnum'>3901</font>               $LITSOURCE_hash{$litsrc_fhname_beg}, "]__start" ;
<font class='lnum'>3902</font>           print "_________________________________\n";
<font class='lnum'>3903</font>           }
<font class='lnum'>3904</font>           
<font class='lnum'>3905</font>           print $buffer_out;
<font class='lnum'>3906</font>   
<font class='lnum'>3907</font>           if ($print_ref_linenos_when_tangling) {
<font class='lnum'>3908</font>           print $code_sections_comment_symbol,
<font class='lnum'>3909</font>               "[line ", $litsrc_line_end," in file ",
<font class='lnum'>3910</font>               $LITSOURCE_hash{$litsrc_fhname_end}, "]__end" ;
<font class='lnum'>3911</font>           print "___________________________________\n";
<font class='lnum'>3912</font>           }
<font class='lnum'>3913</font>   
<font class='lnum'>3914</font>       } #esle for printout
<font class='lnum'>3915</font>   
<font class='lnum'>3916</font>   </fieldset></pre>
</div><p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('84');">
<font class='lnum'><i>(84)</i></font>&nbsp; two debug chunks</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3920)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='84'></a></legend></fieldset>
<p>
<div id="84" style="display:none">   
<ul>


<p>
<p>
<font class='lnum'>3924</font>   
                <div id=codechunk3924>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;DEBUG print out full hash&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3925</font>   
<font class='lnum'>3926</font>           for $k (keys %file_offsets_hash) {
<font class='lnum'>3927</font>                   #~ print @{$file_offsets_hash{$k}}, "\n";
<font class='lnum'>3928</font>   
<font class='lnum'>3929</font>            while (scalar @{$file_offsets_hash{$k}}){
<font class='lnum'>3930</font>                   print "beg $k foff - ", shift @{$file_offsets_hash{$k}};
<font class='lnum'>3931</font>                   print " -- end foff - ", shift @{$file_offsets_hash{$k}}, "\n";
<font class='lnum'>3932</font>                   }
<font class='lnum'>3933</font>           }
<font class='lnum'>3934</font>   </fieldset></pre>
</div><p>
<font class='lnum'>3936</font>   
                <div id=codechunk3936>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;DEBUG check hash keys&gt;&gt<sub></sub>=</legend>
<font class='lnum'>3937</font>   
<font class='lnum'>3938</font>    #~ for $k (keys  %file_offsets_hash){
<font class='lnum'>3939</font>           #~ print $k, "\n";
<font class='lnum'>3940</font>           #~ }
<font class='lnum'>3941</font>   
<font class='lnum'>3942</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>
<p>
<p>
/* end of tangler part of script in the litsource file */<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('84');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('83');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('76');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('73');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('85');">
<font class='lnum'><i>(85)</i></font>&nbsp; (VIRTUAL VIEW): adding multi-file tangling </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 3957)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='85'></a></legend></fieldset>
<p>
<div id="85" style="display:none">   
<ul>


<p>
<i> This is (VIRTUAL VIEW) - a Virtual View on the code with LINKED_CHUNKs</i><br>
<p>
The tangler was developed incrementally, and ealier variation could tangle from one<br>
file only, and only in Quick Mode (i.e. by running mollified "Lit.Src.tangle" as<br>
script file to dump the code to STDOUT)<br>
<p>
Later command-line invocation was added, and ability to tangle from many files, <br>
supplied on command line. ("Quick Mode" still tangles from the only mollified<br>
file, and uses whatever is assigned as the current default root chunk, "*")<br>
<p>
This change affected a number of code chunks in various places.<br>
<p>
First, the "despatcher" at the top of Molly script was modified.<br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;main despatcher&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk2679', 'clonebody1');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody1');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody1">
    </div>
    </fieldset>

<p>
while the previous simple despatcher was renamed and put away.<br>
<p>
There are several comments I could make on the newer one..........<br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;main despatcher with CL&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk2698', 'clonebody2');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody2');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody2">
    </div>
    </fieldset>

<p>
Then, because I still wanted to preserve pass-through Quick Tangling, which <br>
hands the job to "notangle" from "noweb" tools by N. Ramsey, I had to split<br>
dispatching and keep a second part in<br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;tangle me&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk3073', 'clonebody3');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody3');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody3">
    </div>
    </fieldset>

<p>
Actually, the first, main despatcher uses two labels, "TANGLE_ME" if there is<br>
only one file to tangle, to enable pass-through or built-in tangler use, and<br>
"SEEK_PEEK_TANGLER", to send execution for multi-file tangling with the built-in<br>
tangler.<br>
<b>Note</b> that "notangle" by Ramsey also can tangle from multiple Literate Source files<br>
when supplied those on its command line.<br>
<b>Note</b> also that pass-through tanlging filters out doc chunks - something practical<br>
because Ramsey's tool dies on finding unescaped &lt;&lt;bla-bla&gt;&gt; anywhere in the file.<br>
I switch "doc section - code section" only on &lt;&lt;bla-bla&gt;&gt;= in the <b> first position </b><br>
on the line, and do not react to &lt;&lt;bla-blas&gt;&gt; anywhere, but inside code chunks.<br>
<p>
Now, the tangling has been wrapped inside a "foreach" loop, going over a list of <br>
opened files. I had to keep their names standard, "LITSOURCE0", "LITSOURCE1", ...<br>
for the code to work in all cases, and LITSOURCE0 is given as a handle even  in case of<br>
one file only. This and the wish to preserve pass-through tangling was the reason for a<br>
certain clumsiness in the despatcher.<br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;while-loop and peek file ofsets&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk3369', 'clonebody4');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody4');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody4">
    </div>
    </fieldset>

<p>
<p>
Now, the "seek-peek" tangler algorithm is this: <br>
(1) make pass 1 over all LitSource files collecting offsets for code chunks and for<br>
references to other code chunks embedded in them. The information is collected in<br>
hashes.<br>
(2) Then make another pass, starting from the given root chunk and "seek" jumping<br>
between files and known offsets, then printing out. No building of a tree with <br>
subsequent topological sort in memory.<br>
<p>
To turn this algoritm into a multi-file app, it was sufficient to prepend filehandle<br>
names to collected offsets, and on the second pass to split the strings and proceed<br>
to the known filename and offset.<br>
Note the use of $LITSOURCE-multi in the first pass chunks:<br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;chunk beginning&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk3434', 'clonebody5');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody5');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody5">
    </div>
    </fieldset>

<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;chunk ending&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk3456', 'clonebody6');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody6');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody6">
    </div>
    </fieldset>

<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;chunk reference - multiref inside other text&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk3520', 'clonebody7');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody7');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody7">
    </div>
    </fieldset>

<p>
............................<br>
............................<br>
............................<br>
<p>
One more later addition was "topological sort" subroutine. It is not needed for tangling<br>
itself and provides (a) some check for reference loops and (b) allows one to print out<br>
all possible root chunks in a Literate Source file.<br>
<p>
<p>
<b> <i> ....unfinished.... </i> </b><br>
<p>
        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('86');">
<font class='lnum'><i>(86)</i></font>&nbsp; Scrap </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 4038)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='86'></a></legend></fieldset>
<p>
<div id="86" style="display:none">   
<ul>

<b> Brief descrtiption </b><br>
<p>
1. Files opened with universal filehandles LITSOURCE0, 1, ...<br>
Both for 1-file case (both for QuickTangle and CL), then<br>
despatched correctly (one file, pass-through, multifile-CL) - <br>
multifile can happen only on CL only for external files.<br>
<p>
File opening, the whole chain not changed for weaving.<br>
<p>
2. Order of files on CL is <i> important </i>, as there are<br>
cases of one chunk living in its additive splinters in many<br>
files. According to Knuth, Ramsey such a chunk is added to<br>
in the order or occurrence. This behavious is implemented<br>
with a LITSOURCE_list. /fh-fhame/ correspondence for line ##<br>
printout is kept in a hash.<br>
<p>
<p>
<p>
<b> Tests for </b> /to add to the Makefile/<br>
<p>
Tests live in their own directory, ./tmp-tests/assembly.order*<br>
<pre>
 perl ../../MOLLY.pl -l# -R 'chunk A' nl-0 nl-1 nl-2 nl-3 nl-4 nl-10 nl-11
</pre><br>
<p>
<b> <i> not finished </i> </b><br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('86');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('85');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('70');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('87');">
<font class='lnum'><i>(87)</i></font>&nbsp; </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 4075)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='87'></a></legend></fieldset>
<p>
<div id="87" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('87');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('88');">
<font class='lnum'><i>(88)</i></font>&nbsp; WEAVER </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 4078)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='88'></a></legend></fieldset>
<p>
<div id="88" style="display:none">   
<ul>


<p>
<p>
The idea of the weaver is simple, again.<br>
<p>
<font class='lnum'>4084</font>   
                <div id=codechunk4084>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;weave me&gt;&gt<sub></sub>=</legend>
<font class='lnum'>4085</font>   
<font class='lnum'>4086</font>   
<font class='lnum'>4087</font>   WEAVE_ME:
<font class='lnum'>4088</font>   
<font class='lnum'>4089</font>   #1. Set formatting strings for weaver
<font class='lnum'>4090</font>   <font class='chunkref'>&lt;&lt;set formatting strings for weaver&gt;&gt;</font>
<font class='lnum'>4091</font>   
<font class='lnum'>4092</font>   #2. accumulate result in a buffer
<font class='lnum'>4093</font>   <font class='chunkref'>&lt;&lt;accumulate result in a buffer&gt;&gt;</font>
<font class='lnum'>4094</font>   
<font class='lnum'>4095</font>   #3. print out the TOC, the Chunks Index, the output buffer and close the page.
<font class='lnum'>4096</font>   <font class='chunkref'>&lt;&lt;print out&gt;&gt;</font>
<font class='lnum'>4097</font>   
<font class='lnum'>4098</font>   exit;
<font class='lnum'>4099</font>   
<font class='lnum'>4100</font>   </fieldset></pre>
</div><p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('89');">
<font class='lnum'><i>(89)</i></font>&nbsp; How formatting is done in the weaver </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 4104)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='89'></a></legend></fieldset>
<p>
<div id="89" style="display:none">   
<ul>


<p>
<b>1 The first formatting element </b>  that is  part of the <i> function </i> of the script<br>
rather than formatting decorations is the<br>
<pre> fieldset - legend - /legend - /fieldset </pre><br>
which create the distinctive look of the documents generated by MOLLY. I do not wish to<br>
change them (although strictly speaking they are not obligatory).<br>
<p>
What can be changed is the Stylesheet (a part of the script, it has its own subsection), so<br>
other people could play with fonts and colors and margins and such by throwing in a simple<br>
switch and copying their alternative stylesheet into the script.<br>
<p>
I do not wish to use external files for any configuration, as the whole idea of MOLLY is to<br>
be a single self-contained script, which does not require any "installation" of many files to<br>
many places.<br>
<p>
<b>2  Secondly,</b> the "actual working test.html" subsection below probably explains best how<br>
<b> text folding and background highlighting </b> which is tied to it (i.e. a TOC click will open the <br>
section + highlight; and click on the section in the body of the doc will toggle it + highlight <br>
the TOC line ) work.<br>
<p>
Actual implementation is spread between several subsections - they are<br>
coded in in the hard way, as I do not expect them to change ever, they are a functional element<br>
not a changeable "skin" or decoration.<br>
<ul><li> vars, JS and styles are set in the weaver "set formatting strings for weaver" subsections;<br>
</li><li> invocations can be seen in "accumulate the result", esp in the "section headings"<br>
</li><li> and more are applied in the "print out the result"<br>
</li></ul><br>
<p>
Some of the vars are set to pieces of formatting strings in the beginning, and later variables<br>
in them are interpolated with "executable" regexs ( the "e" flag at the end of the regex) - see <br>
"process section headings"<br>
<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('90');">
<font class='lnum'><i>(90)</i></font>&nbsp; actual working test.html </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 4140)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='90'></a></legend></fieldset>
<p>
<div id="90" style="display:none">   
<ul>


<p>
Here's the actual script that was used to test the JS folding and<br>
tying of folding to the TOC section highlighting:<br>
<p>
<p>
<font class='lnum'>4147</font>   
                <div id=codechunk4147>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;test.html&gt;&gt<sub></sub>=</legend>
<font class='lnum'>4148</font>   
<font class='lnum'>4149</font>   &lt;html&gt;
<font class='lnum'>4150</font>   &lt;head&gt;
<font class='lnum'>4151</font>   
<font class='lnum'>4152</font>   
<font class='lnum'>4153</font>   &lt;style type="text/css"&gt;
<font class='lnum'>4154</font>   
<font class='lnum'>4155</font>   
<font class='lnum'>4156</font>   .unhilited {background-color:white}
<font class='lnum'>4157</font>   .hilited {background-color:yellow; text-decoration:underline}
<font class='lnum'>4158</font>   &lt;/style&gt;
<font class='lnum'>4159</font>   
<font class='lnum'>4160</font>   
<font class='lnum'>4161</font>   &lt;script type="text/javascript"&gt;
<font class='lnum'>4162</font>   
<font class='lnum'>4163</font>       function setHilite(evt) {
<font class='lnum'>4164</font>           evt = (evt) ? evt : ((window.event) ? window.event : null);
<font class='lnum'>4165</font>           if (evt) {
<font class='lnum'>4166</font>               var elem = (evt.srcElement) ? evt.srcElement : evt.target;
<font class='lnum'>4167</font>               elem.className = "hilited";
<font class='lnum'>4168</font>           }
<font class='lnum'>4169</font>       }
<font class='lnum'>4170</font>   
<font class='lnum'>4171</font>   
<font class='lnum'>4172</font>   function setUnHilite(evt) {
<font class='lnum'>4173</font>       evt = (evt) ? evt : ((window.event) ? window.event : null);
<font class='lnum'>4174</font>           if (evt) {
<font class='lnum'>4175</font>               var elem = (evt.srcElement) ? evt.srcElement : evt.target;
<font class='lnum'>4176</font>               elem.className = "unhilited";
<font class='lnum'>4177</font>           }
<font class='lnum'>4178</font>   }
<font class='lnum'>4179</font>   
<font class='lnum'>4180</font>   function toggleDiv(divid) {
<font class='lnum'>4181</font>   var el = document.getElementById(divid);
<font class='lnum'>4182</font>   el.style.display = (el.style.display == 'block') ? 'none' : 'block';
<font class='lnum'>4183</font>   }
<font class='lnum'>4184</font>   
<font class='lnum'>4185</font>   function toggleCombined(divid){
<font class='lnum'>4186</font>       if(document.getElementById(divid).style.display == 'none'){
<font class='lnum'>4187</font>         document.getElementById(divid).style.display = 'block';
<font class='lnum'>4188</font>           document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>4189</font>       }
<font class='lnum'>4190</font>       
<font class='lnum'>4191</font>       else{
<font class='lnum'>4192</font>         document.getElementById(divid).style.display = 'none';
<font class='lnum'>4193</font>           document.getElementById("toc"+divid).className="unhilited";
<font class='lnum'>4194</font>       }
<font class='lnum'>4195</font>   }
<font class='lnum'>4196</font>   
<font class='lnum'>4197</font>   
<font class='lnum'>4198</font>   function expandDiv(divid){
<font class='lnum'>4199</font>           document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>4200</font>   }
<font class='lnum'>4201</font>   
<font class='lnum'>4202</font>   
<font class='lnum'>4203</font>   
<font class='lnum'>4204</font>   &lt;/script&gt;
<font class='lnum'>4205</font>   &lt;/head&gt;
<font class='lnum'>4206</font>   
<font class='lnum'>4207</font>   &lt;body &gt;
<font class='lnum'>4208</font>   &lt;h2&gt;Here's the tested element&lt;/h2&gt;
<font class='lnum'>4209</font>   Here is some ordinary text&lt;br&gt;
<font class='lnum'>4210</font>   &lt;span class="unhilited" onmouseover="setHilite(event)" 
<font class='lnum'>4211</font>       onmouseout="setUnHilite(event)"&gt; 
<font class='lnum'>4212</font>       &lt;a href="javascript:;" onmousedown="toggleDiv(15);"&gt;&lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>4213</font>       and this is some potentially hot spot text.&lt;/span&gt;
<font class='lnum'>4214</font>   
<font class='lnum'>4215</font>   &lt;div id=15&gt;
<font class='lnum'>4216</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>4217</font>       that should be hidden/collapsed
<font class='lnum'>4218</font>   
<font class='lnum'>4219</font>   &lt;/div&gt;
<font class='lnum'>4220</font>   
<font class='lnum'>4221</font>   
<font class='lnum'>4222</font>   &lt;h2&gt;Here's the tested element 0&lt;/h2&gt;
<font class='lnum'>4223</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>4224</font>   &lt;a href="javascript:;" onmousedown="toggleCombined(13);" id="toc13"&gt;
<font class='lnum'>4225</font>       &lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>4226</font>   
<font class='lnum'>4227</font>   &lt;div id=13 &gt;&lt;script language=javascript&gt; document.getElementById("toc"+13).className='hilited';&lt;/script&gt;
<font class='lnum'>4228</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>4229</font>       that should be hidden/collapsed
<font class='lnum'>4230</font>   
<font class='lnum'>4231</font>   &lt;/div&gt;
<font class='lnum'>4232</font>   
<font class='lnum'>4233</font>   
<font class='lnum'>4234</font>   
<font class='lnum'>4235</font>   
<font class='lnum'>4236</font>   &lt;h2&gt;Here's the tested element 1&lt;/h2&gt;
<font class='lnum'>4237</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>4238</font>   &lt;a href="javascript:;" onmousedown="toggleCombined(14);" id="toc14"&gt;
<font class='lnum'>4239</font>       &lt;script language=javascript&gt; document.getElementById("toc"+14).className='hilited';&lt;/script&gt;
<font class='lnum'>4240</font>       &lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>4241</font>   
<font class='lnum'>4242</font>   &lt;div id=14 &gt;
<font class='lnum'>4243</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>4244</font>       that should be hidden/collapsed
<font class='lnum'>4245</font>   
<font class='lnum'>4246</font>   &lt;/div&gt;
<font class='lnum'>4247</font>   
<font class='lnum'>4248</font>   
<font class='lnum'>4249</font>   &lt;h2&gt;Here's the tested element 2&lt;/h2&gt;
<font class='lnum'>4250</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>4251</font>   &lt;span  id="toc16"&gt; 
<font class='lnum'>4252</font>       &lt;a href="javascript:;" onmousedown="toggleCombined(16);"&gt;&lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>4253</font>       and this is some potentially hot spot text.&lt;/span&gt;
<font class='lnum'>4254</font>   
<font class='lnum'>4255</font>   &lt;div id=16&gt;
<font class='lnum'>4256</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>4257</font>       that should be hidden/collapsed
<font class='lnum'>4258</font>   
<font class='lnum'>4259</font>   &lt;/div&gt;
<font class='lnum'>4260</font>   
<font class='lnum'>4261</font>   
<font class='lnum'>4262</font>   
<font class='lnum'>4263</font>   &lt;/body&gt;
<font class='lnum'>4264</font>   &lt;/html&gt;
<font class='lnum'>4265</font>   
<font class='lnum'>4266</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('90');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('91');">
<font class='lnum'><i>(91)</i></font>&nbsp; changing text style - the basic JS recipy </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 4272)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='91'></a></legend></fieldset>
<p>
<div id="91" style="display:none">   
<ul>


<p>
I used this snippet for a start then reworked it into the "working test script" below.<br>
<p>
<ul> <pre>
11.8.2 Solution
First, define two style sheet rules, each with a different class selector. Then design 
an event handler for the element to change the element's className property to the desired 
class selector's identifier: 

                &lt;style type="text/css"&gt;
                .unhilited {background-color:white}
                .hilited {background-color:yellow; text-decoration:underline}
                &lt;/style&gt;
                ...
                &lt;script type="text/javascript"&gt;
                function setHilite(evt) {
                        evt = (evt) ? evt : ((window.event) ? window.event : null);
                        if (evt) {
                                var elem = (evt.srcElement) ? evt.srcElement : evt.target;
                                elem.className = "hilited";
                        }
                }
                function setUnHilite(evt) {
                        evt = (evt) ? evt : ((window.event) ? window.event : null);
                        if (evt) {
                                var elem = (evt.srcElement) ? evt.srcElement : evt.target;
                                elem.className = "unhilited";
                        }
                }
                ...
                &lt;span class="unhilited" onmouseover="setHilite(event)" 
                        onmouseout="setUnHilite(event)"&gt;Some potentially hot spot text.&lt;/span&gt;

Adjusting the className property of an element as shown here is a more stable approach 
for early versions of Netscape 6 instead of manipulating styleSheet objects and their 
properties. It is perhaps the most widely used and supported way to implement dynamic styles. 
</pre> </ul><br>
<p>
If I enclose one "onmousedown" inside another, JScript will most probably not pass it into the inner one.<br>
So I should add:<br>
(a) the TOC line IDs ?? Like "toc.1", "toc.2" etc<br>
(b) keep a separate func, not "toggleDiv", but something else like "toggleTOCandDIV", and run 2 things<br>
from there ??<br>
<p>
<b> So, 2 tests: enclosing and if not, then rewriting the collapsing JS func </b><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('91');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('92');">
<font class='lnum'><i>(92)</i></font>&nbsp; Reference - Javascript and DOM </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 4323)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='92'></a></legend></fieldset>
<p>
<div id="92" style="display:none">   
<ul>


<p>
<p>
I'll need some javascript and DOM reference for further work;<br>
<p>
a/ <a href= http://w3schools.com/htmldom/dom_reference.asp > http://w3schools.com/htmldom/dom_reference.asp </a>  -- ref from W3C<br>
b/ <a href= http://w3schools.com/htmldom/default.asp > http://w3schools.com/htmldom/default.asp </a> -- might also be useful<br>
c/ <a href= http://www.howtocreate.co.uk/tutorials/javascript/domcss > http://www.howtocreate.co.uk/tutorials/javascript/domcss </a> --javascript tutorial (not necessarily best) <br>
d/ <a href= http://www.pageresource.com/dhtml/ryan/part4-1.html > http://www.pageresource.com/dhtml/ryan/part4-1.html </a> - another tutorial<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('92');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('89');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('93');">
<font class='lnum'><i>(93)</i></font>&nbsp; set formatting strings for weaver </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 4339)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='93'></a></legend></fieldset>
<p>
<div id="93" style="display:none">   
<ul>


<p>
1. Formatting strings include variables, later substituted for each new section and chunk.<br>
One idea would be to interpolate these strings with regexps then - with "s/X/Y/ee"<br>
Another is to split the strings into "pre-X" and "post-X" and leave the var outside.<br>
I use both methods. The second one is clumsier, but maybe not, as the first might<br>
require keeping state in vars and copying strings anyway.<br>
<p>
But both solutions are used.<br>
<p>
2. Output file header and the outer table.<br>
<p>
ASCIIMathML.js is cut in in a trivial way. <br>
The library allows extension with new operators/translatons from LaTeX into MathML.<br>
Those can be cut in here, too.<br>
<p>
<font class='lnum'>4356</font>   
                <div id=codechunk4356>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;set formatting strings for weaver&gt;&gt<sub></sub>=</legend>
<font class='lnum'>4357</font>   
<font class='lnum'>4358</font>     #----SETTING FORMATTING STRINGS-----------
<font class='lnum'>4359</font>     
<font class='lnum'>4360</font>   $html_head = &lt;&lt;head_end_1;  
<font class='lnum'>4361</font>   
<font class='lnum'>4362</font>   &lt;head&gt;
<font class='lnum'>4363</font>   &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt; 
<font class='lnum'>4364</font>   
<font class='lnum'>4365</font>   head_end_1
<font class='lnum'>4366</font>   
<font class='lnum'>4367</font>   #switch on ASCIIMathML.js library if enabled in template options:
<font class='lnum'>4368</font>   if ($enable_ASCIIMathML) {
<font class='lnum'>4369</font>       $html_head .= "\n"
<font class='lnum'>4370</font>       . qq(&lt;script type="text/javascript" src="$path_to_ASCIIMathML"&gt;&lt;/script&gt;)
<font class='lnum'>4371</font>       . "\n";
<font class='lnum'>4372</font>       }
<font class='lnum'>4373</font>   
<font class='lnum'>4374</font>   $html_head .= &lt;&lt;head_end;
<font class='lnum'>4375</font>   
<font class='lnum'>4376</font>   <font class='chunkref'>&lt;&lt;JS script functions&gt;&gt;</font>
<font class='lnum'>4377</font>   <font class='chunkref'>&lt;&lt;stylesheet&gt;&gt;</font>
<font class='lnum'>4378</font>   
<font class='lnum'>4379</font>   &lt;/head&gt;
<font class='lnum'>4380</font>   head_end
<font class='lnum'>4381</font>   
<font class='lnum'>4382</font>   $html_body_table = "&lt;center&gt;&lt;table class='outertable'&gt;&lt;tr&gt;&lt;td&gt;";
<font class='lnum'>4383</font>   $html_body_table_end = "\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;\n";
<font class='lnum'>4384</font>   
<font class='lnum'>4385</font>   </fieldset></pre>
</div><p>
<p>
3. This is split vars around each of the HTML folding sections; they substitute simple <br>
HTML headings in the literate source<br>
<p>
<font class='lnum'>4391</font>   
                <div id=codechunk4391>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;set formatting strings for weaver&gt;&gt<sub>2</sub>=</legend>
<font class='lnum'>4392</font>   
<font class='lnum'>4393</font>   $folding_section_start1_str = &lt;&lt;'fold_sect_start_1_xxx';
<font class='lnum'>4394</font>           &lt;fieldset&gt;&lt;legend&gt;&lt;a href="javascript:;" onmousedown="toggleCombined('$section_num');"&gt;
<font class='lnum'>4395</font>   fold_sect_start_1_xxx
<font class='lnum'>4396</font>   
<font class='lnum'>4397</font>   
<font class='lnum'>4398</font>   $folding_section_start2_str = &lt;&lt;'fold_sect_start_2_xxx';
<font class='lnum'>4399</font>   &lt;/a&gt;&lt;/legend&gt;&lt;/fieldset&gt;
<font class='lnum'>4400</font>   &lt;p&gt;
<font class='lnum'>4401</font>   &lt;div id="$section_num" style="display:$fold_state"&gt; $highlight_state  
<font class='lnum'>4402</font>   &lt;ul&gt;
<font class='lnum'>4403</font>   
<font class='lnum'>4404</font>   fold_sect_start_2_xxx
<font class='lnum'>4405</font>   
<font class='lnum'>4406</font>   
<font class='lnum'>4407</font>   $folding_section_end_str = &lt;&lt;'folding_section_end_xxx';
<font class='lnum'>4408</font>   &lt;/ul&gt;
<font class='lnum'>4409</font>   &lt;p&gt;
<font class='lnum'>4410</font>   &lt;br&gt;
<font class='lnum'>4411</font>   &lt;i&gt;&lt;font size=-1&gt;
<font class='lnum'>4412</font>   &lt;a href="javascript:;"onmousedown="toggleCombined('$section_num_prev');"&gt;
<font class='lnum'>4413</font>   Close the subsection&lt;/a&gt;&lt;/font&gt;
<font class='lnum'>4414</font>   &lt;/i&gt; -- &lt;i&gt;&lt;font size=-1&gt;
<font class='lnum'>4415</font>   &lt;a href="javascript:;" onmousedown="showAll();"&gt;
<font class='lnum'>4416</font>   expand all&lt;/a&gt; -- 
<font class='lnum'>4417</font>   &lt;a href="javascript:;" onmousedown="hideAll();"&gt;
<font class='lnum'>4418</font>   collapse all&lt;/a&gt;
<font class='lnum'>4419</font>   &lt;/font&gt;&lt;/i&gt;
<font class='lnum'>4420</font>   
<font class='lnum'>4421</font>   &lt;p&gt;
<font class='lnum'>4422</font>   &lt;/div&gt;
<font class='lnum'>4423</font>   
<font class='lnum'>4424</font>   folding_section_end_xxx
<font class='lnum'>4425</font>   
<font class='lnum'>4426</font>   </fieldset></pre>
</div><p>
4. This is for the frames around the code chunks:<br>
<p>
<font class='lnum'>4430</font>   
                <div id=codechunk4430>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;set formatting strings for weaver&gt;&gt<sub>3</sub>=</legend>
<font class='lnum'>4431</font>   
<font class='lnum'>4432</font>   $code_fieldset_start_pre = q(&lt;pre&gt;&lt;fieldset class='codefieldset'&gt;&lt;legend class='codelegend'&gt;);
<font class='lnum'>4433</font>   $code_fieldset_start_post = "=&lt;/legend&gt;";
<font class='lnum'>4434</font>   $code_fieldset_end = "&lt;/fieldset&gt;&lt;/pre&gt;\n";
<font class='lnum'>4435</font>   
<font class='lnum'>4436</font>   </fieldset></pre>
</div><p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('94');">
<font class='lnum'><i>(94)</i></font>&nbsp; JS functions </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 4439)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='94'></a></legend></fieldset>
<p>
<div id="94" style="display:none">   
<ul>


<p>
In my attempts to insert ASCIIMathML.js, I have tried some variations of<br>
math sections markup (with "a m a t h" -- "e n d a m a t h" words and<br>
with backquotes) -- but the stinking lib insists on garbling my file, as<br>
sth triggers it on earlier.<br>
<p>
So a next step is to change regexps inside the Javascript lib and forse it<br>
to sane markups. Probably by adding ancoring the key word to the beginning<br>
of the line and/or insisting that it is there alone.<br>
<p>
<font class='lnum'>4451</font>   
                <div id=codechunk4451>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;JS script functions&gt;&gt<sub></sub>=</legend>
<font class='lnum'>4452</font>   
<font class='lnum'>4453</font>   &lt;script language="javascript"&gt;
<font class='lnum'>4454</font>   
<font class='lnum'>4455</font>   function toggleDiv(divid) {
<font class='lnum'>4456</font>   var el = document.getElementById(divid);
<font class='lnum'>4457</font>   el.style.display = (el.style.display == 'block') ? 'none' : 'block';
<font class='lnum'>4458</font>   }
<font class='lnum'>4459</font>   
<font class='lnum'>4460</font>   
<font class='lnum'>4461</font>   function toggleCombined(divid){
<font class='lnum'>4462</font>       if(document.getElementById(divid).style.display == 'none'){
<font class='lnum'>4463</font>         document.getElementById(divid).style.display = 'block';
<font class='lnum'>4464</font>           document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>4465</font>       }
<font class='lnum'>4466</font>       else{
<font class='lnum'>4467</font>         document.getElementById(divid).style.display = 'none';
<font class='lnum'>4468</font>           document.getElementById("toc"+divid).className="unhilited";
<font class='lnum'>4469</font>       }
<font class='lnum'>4470</font>   }
<font class='lnum'>4471</font>   
<font class='lnum'>4472</font>   
<font class='lnum'>4473</font>   function showAll(){
<font class='lnum'>4474</font>   for(i=1; i &lt;= 10000; i++){
<font class='lnum'>4475</font>       document.getElementById(i).style.display = 'block';
<font class='lnum'>4476</font>       document.getElementById("toc"+i).className="hilited";
<font class='lnum'>4477</font>       };
<font class='lnum'>4478</font>   }
<font class='lnum'>4479</font>   
<font class='lnum'>4480</font>   function hideAll(){
<font class='lnum'>4481</font>   for(i=1; i &lt;= 10000; i++){
<font class='lnum'>4482</font>       document.getElementById(i).style.display = 'none';
<font class='lnum'>4483</font>       document.getElementById("toc"+i).className="unhilited";
<font class='lnum'>4484</font>       };
<font class='lnum'>4485</font>   }
<font class='lnum'>4486</font>   
<font class='lnum'>4487</font>   
<font class='lnum'>4488</font>   function open_all_above(someid){
<font class='lnum'>4489</font>   
<font class='lnum'>4490</font>       elem = document.getElementById(someid);
<font class='lnum'>4491</font>           elem.style.display = 'block';
<font class='lnum'>4492</font>           document.getElementById('toc'+someid).className = 'hilited';
<font class='lnum'>4493</font>           
<font class='lnum'>4494</font>       while (elem.parentNode.id != 1) {
<font class='lnum'>4495</font>           if (elem.parentNode.nodeType == 1) {
<font class='lnum'>4496</font>           elem.parentNode.style.display = 'block';
<font class='lnum'>4497</font>           //document.getElementById(elem.parentNode.id).className = 'hilited';
<font class='lnum'>4498</font>           var toc_elem = document.getElementById('toc'+elem.id);
<font class='lnum'>4499</font>           if (toc_elem) {toc_elem.className = 'hilited'};
<font class='lnum'>4500</font>           }
<font class='lnum'>4501</font>           elem = elem.parentNode;
<font class='lnum'>4502</font>       }
<font class='lnum'>4503</font>   }
<font class='lnum'>4504</font>   
<font class='lnum'>4505</font>   
<font class='lnum'>4506</font>   <font class='chunkref'>&lt;&lt;Javascript: node clone and destroy clone&gt;&gt;</font>
<font class='lnum'>4507</font>   
<font class='lnum'>4508</font>   &lt;/script&gt;
<font class='lnum'>4509</font>   
<font class='lnum'>4510</font>   </fieldset></pre>
</div><p>
note that  "Javascript: node clone and destroy clone" is in the "virtual" ADD-ON section<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('94');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('95');">
<font class='lnum'><i>(95)</i></font>&nbsp; Stylesheet </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 4517)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='95'></a></legend></fieldset>
<p>
<div id="95" style="display:none">   
<ul>


<p>
<font class='lnum'>4520</font>   
                <div id=codechunk4520>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;stylesheet&gt;&gt<sub></sub>=</legend>
<font class='lnum'>4521</font>   &lt;style type="text/css" media="screen"&gt;
<font class='lnum'>4522</font>   
<font class='lnum'>4523</font>   
<font class='lnum'>4524</font>   BODY {
<font class='lnum'>4525</font>           FONT-SIZE: 10pt;
<font class='lnum'>4526</font>           background: #f0f0f0;
<font class='lnum'>4527</font>           }
<font class='lnum'>4528</font>   FIELDSET {
<font class='lnum'>4529</font>           BORDER-RIGHT: #000000 1px solid; 
<font class='lnum'>4530</font>           BORDER-TOP: #000000 1px solid; 
<font class='lnum'>4531</font>           BORDER-LEFT: #000000 1px solid; 
<font class='lnum'>4532</font>           BORDER-BOTTOM: #000000 1px solid; 
<font class='lnum'>4533</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>4534</font>           PADDING-LEFT: 5px; 
<font class='lnum'>4535</font>           PADDING-BOTTOM: 2px; 
<font class='lnum'>4536</font>           PADDING-TOP: 5px;
<font class='lnum'>4537</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>4538</font>           background: #f5f5f5; 
<font class='lnum'>4539</font>           color: #000000;
<font class='lnum'>4540</font>           }
<font class='lnum'>4541</font>   LEGEND {
<font class='lnum'>4542</font>           BORDER-RIGHT: #a9a9a9 1px solid; 
<font class='lnum'>4543</font>           BORDER-BOTTOM: #a9a9a9 1px solid;
<font class='lnum'>4544</font>           BORDER-TOP: #a9a9a9 1px solid; 
<font class='lnum'>4545</font>           BORDER-LEFT: #a9a9a9 1px solid; 
<font class='lnum'>4546</font>           PADDING-RIGHT: 20px; 
<font class='lnum'>4547</font>           PADDING-LEFT: 20px; 
<font class='lnum'>4548</font>           PADDING-BOTTOM: 5px; 
<font class='lnum'>4549</font>           PADDING-TOP: 5px; 
<font class='lnum'>4550</font>           FONT-WEIGHT: bold;  
<font class='lnum'>4551</font>           BACKGROUND: #fdfdfd; 
<font class='lnum'>4552</font>           color: #000000;
<font class='lnum'>4553</font>           }
<font class='lnum'>4554</font>   PRE     {
<font class='lnum'>4555</font>           PADDING-LEFT: 20px; 
<font class='lnum'>4556</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>4557</font>           padding-top: 0px; 
<font class='lnum'>4558</font>           padding-bottom: 6px;
<font class='lnum'>4559</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>4560</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>4561</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>4562</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>4563</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>4564</font>           background: #fefefe;
<font class='lnum'>4565</font>           }
<font class='lnum'>4566</font>   .tocfieldset {
<font class='lnum'>4567</font>           background: #ffffff; 
<font class='lnum'>4568</font>           color: #000000;
<font class='lnum'>4569</font>           }
<font class='lnum'>4570</font>   .codefieldset {
<font class='lnum'>4571</font>           BORDER-RIGHT: #000 1px solid; 
<font class='lnum'>4572</font>           BORDER-TOP: #000 1px solid; 
<font class='lnum'>4573</font>           BORDER-LEFT: #000 1px solid; 
<font class='lnum'>4574</font>           BORDER-BOTTOM: #000 1px solid; 
<font class='lnum'>4575</font>           background: #ffffff; 
<font class='lnum'>4576</font>           color: #000;
<font class='lnum'>4577</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>4578</font>           PADDING-LEFT: 15px; 
<font class='lnum'>4579</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>4580</font>           PADDING-BOTTOM: 10px; 
<font class='lnum'>4581</font>           PADDING-TOP: 1px;
<font class='lnum'>4582</font>           }
<font class='lnum'>4583</font>   .codelegend {
<font class='lnum'>4584</font>           BORDER-RIGHT: #777 1px solid; 
<font class='lnum'>4585</font>           BORDER-TOP: #777 1px solid; 
<font class='lnum'>4586</font>           BORDER-LEFT: #777 1px solid; 
<font class='lnum'>4587</font>           BORDER-BOTTOM: #777 1px solid
<font class='lnum'>4588</font>           PADDING-RIGHT: 10px; 
<font class='lnum'>4589</font>           PADDING-LEFT: 10px; 
<font class='lnum'>4590</font>           PADDING-TOP: 2px; 
<font class='lnum'>4591</font>           PADDING-BOTTOM: 2px; 
<font class='lnum'>4592</font>           background: #ffffff; 
<font class='lnum'>4593</font>           color: #00b;
<font class='lnum'>4594</font>           FONT-WEIGHT: bold;  
<font class='lnum'>4595</font>           }
<font class='lnum'>4596</font>   .chunkref {
<font class='lnum'>4597</font>           color: #00b;    
<font class='lnum'>4598</font>           background: #f6f6f6;
<font class='lnum'>4599</font>           font-weight: bold;
<font class='lnum'>4600</font>           }
<font class='lnum'>4601</font>   .outertable {
<font class='lnum'>4602</font>           width: 99%; 
<font class='lnum'>4603</font>           cellpadding: 25; 
<font class='lnum'>4604</font>           background: #ffffff; 
<font class='lnum'>4605</font>           border: 1px solid;
<font class='lnum'>4606</font>           }
<font class='lnum'>4607</font>   .hl     {
<font class='lnum'>4608</font>           PADDING-LEFT: 5px; PADDING-RIGHT: 5px; 
<font class='lnum'>4609</font>           padding-top: 5px; padding-bottom: 5px;
<font class='lnum'>4610</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>4611</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>4612</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>4613</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>4614</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>4615</font>           background: #f5f5f5;    
<font class='lnum'>4616</font>           width: 70%;
<font class='lnum'>4617</font>           }
<font class='lnum'>4618</font>   .hl-wide {
<font class='lnum'>4619</font>           PADDING-LEFT: 5px; 
<font class='lnum'>4620</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>4621</font>           padding-top: 15px; 
<font class='lnum'>4622</font>           padding-bottom: 15px;
<font class='lnum'>4623</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>4624</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>4625</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>4626</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>4627</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>4628</font>           background: #fbfbfb;    
<font class='lnum'>4629</font>           }
<font class='lnum'>4630</font>   .lnum {
<font class='lnum'>4631</font>           color: #a0a0a0;
<font class='lnum'>4632</font>           }
<font class='lnum'>4633</font>   .unhilited {background-color:white}
<font class='lnum'>4634</font>   .hilited {background-color:#c0c0ff}
<font class='lnum'>4635</font>   .linked_chunk {
<font class='lnum'>4636</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>4637</font>           PADDING-LEFT: 5px; 
<font class='lnum'>4638</font>           PADDING-BOTTOM: 5px; 
<font class='lnum'>4639</font>           PADDING-TOP: 5px; 
<font class='lnum'>4640</font>           BORDER-TOP: #c0c0c0 1px solid;
<font class='lnum'>4641</font>           BORDER-RIGHT: #c0c0c0 1px solid; 
<font class='lnum'>4642</font>           BORDER-LEFT: #c0c0c0 1px solid;
<font class='lnum'>4643</font>           BORDER-BOTTOM: #c0c0c0 1px solid;              
<font class='lnum'>4644</font>           color: #505050;
<font class='lnum'>4645</font>           background: #ffffff;
<font class='lnum'>4646</font>           }
<font class='lnum'>4647</font>   .linked_chunk_legend {
<font class='lnum'>4648</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>4649</font>           PADDING-LEFT: 5px; 
<font class='lnum'>4650</font>           PADDING-BOTTOM: 3px; 
<font class='lnum'>4651</font>           PADDING-TOP: 3px; 
<font class='lnum'>4652</font>           BORDER-TOP: #c0c0c0 1px solid;
<font class='lnum'>4653</font>           BORDER-RIGHT: #c0c0c0 1px solid; 
<font class='lnum'>4654</font>           BORDER-LEFT: #c0c0c0 1px solid;
<font class='lnum'>4655</font>           BORDER-BOTTOM: #c0c0c0 1px solid;              
<font class='lnum'>4656</font>           color: #505050;
<font class='lnum'>4657</font>           background: #ffffff;
<font class='lnum'>4658</font>           }
<font class='lnum'>4659</font>   a:visited { color: blue; }
<font class='lnum'>4660</font>   
<font class='lnum'>4661</font>   &lt;/STYLE&gt;
<font class='lnum'>4662</font>   
<font class='lnum'>4663</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('95');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('93');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('96');">
<font class='lnum'><i>(96)</i></font>&nbsp; Accumulate the result </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 4672)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='96'></a></legend></fieldset>
<p>
<div id="96" style="display:none">   
<ul>


<p>
Some of the vars may be unused later (run perl -wc to check?)<br>
<p>
<font class='lnum'>4677</font>   
                <div id=codechunk4677>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;accumulate result in a buffer&gt;&gt<sub></sub>=</legend>
<font class='lnum'>4678</font>   #2. accumulate result in a buffer
<font class='lnum'>4679</font>   
<font class='lnum'>4680</font>   
<font class='lnum'>4681</font>   # vars for the main loop over lines of the target file
<font class='lnum'>4682</font>   
<font class='lnum'>4683</font>    $chunkbuf = ''; # collects whole formatted project file in memory
<font class='lnum'>4684</font>    $tocbuf = "";  # will accumulate TOC contents, i.e. small
<font class='lnum'>4685</font>    @indbuf = ();  # accumulates index of code chunks, small
<font class='lnum'>4686</font>    @headings = ();  # the stack for nested subsections numbers/ids
<font class='lnum'>4687</font>    %headings_id_hash = ();
<font class='lnum'>4688</font>    %chunks_id_hash = ();
<font class='lnum'>4689</font>   
<font class='lnum'>4690</font>    $section_num = 0;
<font class='lnum'>4691</font>    $section_num_prev = 0;
<font class='lnum'>4692</font>    $section_level = 0;
<font class='lnum'>4693</font>    $prev_section_level = $section_level;
<font class='lnum'>4694</font>    $line_counter = 0;
<font class='lnum'>4695</font>    $in_pre_tag = 0;
<font class='lnum'>4696</font>   </fieldset></pre>
</div><p>
<p>
<b> 1. </b> We can weave "mollified" files as well as use MOLLY.pl on external<br>
files from command line, which do not necessarily include the config and<br>
invocation of Molly at the top. <br>
So, first let's get rid of that part of the file, if it exists.<br>
<p>
The idea is this.<br>
    <ul><br>
    (a) not to clobber the overall "while" loop, do it inside it<br>
    (b) If the first line of the file is a perl invocation,<br>
        then check for "MOLLY.pl" call, then for _ _ D A T A _ _ line<br>
        then for first white line or sth<br>
        This cuts the "mollifier" part out.<br>
        OR - drop off letting out a scream "wrongly formatted file"<br>
    (c) for lines other than first, do regular processing<br>
    </ul><br>
<p>
This version of "mollified" template  will pass many<br>
perl scripts with DATA sections, will just print those sections.<br>
But I do not care at the moment.<br>
<p>
No attempt is done to filter any other files in non-lit.src format etc.<br>
This is just to quickly cut out the Molly perly template at the top.<br>
<p>
<font class='lnum'>4722</font>   
                <div id=codechunk4722>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;cut out the MOLLY.pl invocation at the top of LS file&gt;&gt<sub></sub>=</legend>
<font class='lnum'>4723</font>   
<font class='lnum'>4724</font>   if ( ($line_counter == 1) &amp;&amp; (m!^#.*perl!) ) {
<font class='lnum'>4725</font>   
<font class='lnum'>4726</font>       # Matched? - this must be either the mollifying template or some perl script.
<font class='lnum'>4727</font>       
<font class='lnum'>4728</font>       do {
<font class='lnum'>4729</font>           $_ = &lt;LITSOURCE&gt;;
<font class='lnum'>4730</font>           $line_counter++;
<font class='lnum'>4731</font>           if (eof LITSOURCE) {
<font class='lnum'>4732</font>               print "\n\t--------ERROR: wrong target file format for weaving--------\n";
<font class='lnum'>4733</font>               print "\tmay be a regular perl script, without a call for Molly\n\n";
<font class='lnum'>4734</font>               exit;
<font class='lnum'>4735</font>           }
<font class='lnum'>4736</font>       } until ( lc($_) =~ m!^do.*molly!) ;    
<font class='lnum'>4737</font>       
<font class='lnum'>4738</font>       # throw away lines until DATA, then process/weave normally
<font class='lnum'>4739</font>       do {
<font class='lnum'>4740</font>           $_ = &lt;LITSOURCE&gt;;
<font class='lnum'>4741</font>           $line_counter++;
<font class='lnum'>4742</font>           if (eof LITSOURCE) {
<font class='lnum'>4743</font>               print "\n\t--------ERROR: wrong target file format for weaving--------\n";
<font class='lnum'>4744</font>               print "\tdid not find the  __DATA__ keyword  in first pos on its line\n\n";
<font class='lnum'>4745</font>               exit;
<font class='lnum'>4746</font>           }
<font class='lnum'>4747</font>       } until ( m!^__DATA__! ) ;
<font class='lnum'>4748</font>   
<font class='lnum'>4749</font>       next;
<font class='lnum'>4750</font>   
<font class='lnum'>4751</font>   } # fi cutting out MOLLY.pl template/config  if present in lit.source target file
<font class='lnum'>4752</font>   
<font class='lnum'>4753</font>   </fieldset></pre>
</div><p>
<b> 2. The logic of processing is this: </b><br>
(a) all project files, unless they are machine-generated code, are much below the <br>
sizes of RAM on modern machines. So I accumulate in memory (in a string $chunkbuf)<br>
a copy of the whole file, with necessary transformations and formatting on the fly.<br>
<p>
Only 3 distinctions need to be made while iterating over hte lines of the Literate Source<br>
file, between section headings, chunks of code and the lines from the body of documentation<br>
chunks.<br>
<p>
<font class='lnum'>4764</font>   
                <div id=codechunk4764>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;accumulate result in a buffer&gt;&gt<sub>2</sub>=</legend>
<font class='lnum'>4765</font>   
<font class='lnum'>4766</font>   
<font class='lnum'>4767</font>   
<font class='lnum'>4768</font>   while (&lt;LITSOURCE&gt;) {
<font class='lnum'>4769</font>   
<font class='lnum'>4770</font>   $line_counter++;
<font class='lnum'>4771</font>   
<font class='lnum'>4772</font>   <font class='chunkref'>&lt;&lt;cut out the MOLLY.pl invocation at the top of LS file&gt;&gt;</font>
<font class='lnum'>4773</font>   
<font class='lnum'>4774</font>   <font class='chunkref'>&lt;&lt;process code chunks&gt;&gt;</font>
<font class='lnum'>4775</font>   <font class='chunkref'>&lt;&lt;process section headings&gt;&gt;</font>
<font class='lnum'>4776</font>   <font class='chunkref'>&lt;&lt;body HTML formatters&gt;&gt;</font>
<font class='lnum'>4777</font>   
<font class='lnum'>4778</font>       # debug
<font class='lnum'>4779</font>       #print "---- $_";
<font class='lnum'>4780</font>   
<font class='lnum'>4781</font>   
<font class='lnum'>4782</font>   } #elihw over the whole input file
<font class='lnum'>4783</font>   
<font class='lnum'>4784</font>   close LITSOURCE;
<font class='lnum'>4785</font>   
<font class='lnum'>4786</font>    foreach (@headings)  {
<font class='lnum'>4787</font>   
<font class='lnum'>4788</font>           ($section_level, $section_num_prev) = split /-/, $_;
<font class='lnum'>4789</font>           $folding_section_end = $folding_section_end_str;
<font class='lnum'>4790</font>           $folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>4791</font>           $chunkbuf .= $folding_section_end; 
<font class='lnum'>4792</font>   
<font class='lnum'>4793</font>           };
<font class='lnum'>4794</font>   
<font class='lnum'>4795</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('97');">
<font class='lnum'><i>(97)</i></font>&nbsp; process code chunks </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 4802)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='97'></a></legend></fieldset>
<p>
<div id="97" style="display:none">   
<ul>


<p>
"goto" is from an old version of this script, with perl-specific options, I'll delete it<br>
later.<br>
<p>
I use perl range operator to cut out the code section between &lt; &lt; chunkname &gt; &gt; and the<br>
closing "at" symbol, as is required in "noweb".<br>
This is a use of the "range" operator inside another "while" loop over each line of the<br>
Lit Source file, and they work together, the range just flips some status var ("in" - "out")<br>
while the outside loop continues over the lines.<br>
<p>
Once the section name is extracted with a regexp, the index buffer (indbuf) is formed and<br>
updated.<br>
Then "fieldset" formatting is written around the code chunk and line numbering (if set<br>
in an option var) is written too<br>
<p>
<font class='lnum'>4819</font>   
                <div id=codechunk4819>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process code chunks&gt;&gt<sub></sub>=</legend>
<font class='lnum'>4820</font>   
<font class='lnum'>4821</font>   if ( m!^&lt;\&lt;(.*)&gt;\&gt;=! ... m!^@\s*$! ) { # -- CODE CHUNKS -- 
<font class='lnum'>4822</font>   
<font class='lnum'>4823</font>           s/&amp;/&amp;amp;/g;    # escape &amp;
<font class='lnum'>4824</font>           s/&lt;/&amp;lt;/g;     # escape &lt;
<font class='lnum'>4825</font>           s/&gt;/&amp;gt;/g;     # escape &gt;
<font class='lnum'>4826</font>           my $codechunk_id = "";
<font class='lnum'>4827</font>   
<font class='lnum'>4828</font>         if ( m!(&amp;lt;&amp;lt;(.+?)&amp;gt;&amp;gt;)(=)?! ) 
<font class='lnum'>4829</font>             {
<font class='lnum'>4830</font>             $chunk_title = $2;
<font class='lnum'>4831</font>             $reference = $1;
<font class='lnum'>4832</font>             $ind_str = "&amp;lt;&amp;lt;$2&amp;gt;&amp;gt; $section_num";
<font class='lnum'>4833</font>             if (defined $3) {$ind_str .= "&lt;sup&gt;def&lt;/sup&gt;"}
<font class='lnum'>4834</font>             else { s!$reference!&lt;font class='chunkref'&gt;$reference&lt;/font&gt;! }
<font class='lnum'>4835</font>   
<font class='lnum'>4836</font>             unshift @indbuf, $ind_str;
<font class='lnum'>4837</font>   
<font class='lnum'>4838</font>           # /.. "if" is not finished in this chunk yet.. read on/
<font class='lnum'>4839</font>   </fieldset></pre>
</div><p>
Here I have to create a unique $codechunk_id, save it in %chunks_id_hash, and<br>
assign to the created fieldset by <s> interpolating it in $code_fieldset_start_pre </s><br>
.. - was buggy, so I create a wrapping "div" and assign this ID to it.<br>
Unique IDs can be calculated from a counter -- or taken from line numbers, which <br>
are also unique and an increasing sequence. Those are available as $line_counter<br>
<p>
It also allows us to preserve line numbers for the second pass, interpolated print<br>
of the formed $chunkbuf string.<br>
<p>
I could do the same with section IDs, too. Will have to change code, but it will<br>
allow me to get line numbers painlessly. Check this.<br>
<p>
Second question - how to treat splintered chunks (like this one, split by this very<br>
text).  Push IDs as a list? - possibly the simplest idea. <br>
<p>
<font class='lnum'>4856</font>   
                <div id=codechunk4856>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process code chunks&gt;&gt<sub>2</sub>=</legend>
<font class='lnum'>4857</font>   
<font class='lnum'>4858</font>               # cut-in for virtual links handling: create codechunk_id 
<font class='lnum'>4859</font>               if (defined $3) {
<font class='lnum'>4860</font>               
<font class='lnum'>4861</font>                   $codechunk_id = 'codechunk' . $.;
<font class='lnum'>4862</font>                   push @{$chunks_id_hash{$chunk_title}}, $codechunk_id; # with splinters
<font class='lnum'>4863</font>   
<font class='lnum'>4864</font>                   my $splinter_number = '';
<font class='lnum'>4865</font>                   $splinter_number = @{$chunks_id_hash{$chunk_title}}
<font class='lnum'>4866</font>                       if @{$chunks_id_hash{$chunk_title}} &gt; 1;
<font class='lnum'>4867</font>   
<font class='lnum'>4868</font>                   # simple fieldset frames around code snippets if chunk definition
<font class='lnum'>4869</font>                   # /changing current line $_ which will get appended to $chunkbuf/
<font class='lnum'>4870</font>                   s!^&amp;lt;&amp;lt;(.+)&amp;gt;&amp;gt;=!
<font class='lnum'>4871</font>                   &lt;div id=$codechunk_id&gt;
<font class='lnum'>4872</font>       $code_fieldset_start_pre&amp;lt;&amp;lt;$1&amp;gt;&amp;gt&lt;sub&gt;$splinter_number&lt;/sub&gt;$code_fieldset_start_post!x;
<font class='lnum'>4873</font>   
<font class='lnum'>4874</font>               } # fi - cut-in for virtual chunk links
<font class='lnum'>4875</font>   
<font class='lnum'>4876</font>           } # fi - chunks index accumulation
<font class='lnum'>4877</font>   
<font class='lnum'>4878</font>   
<font class='lnum'>4879</font>           # close fieldset frame at end of code chunk
<font class='lnum'>4880</font>           s!^@\s*$!$code_fieldset_end&lt;/div&gt;!;
<font class='lnum'>4881</font>   
<font class='lnum'>4882</font>   
<font class='lnum'>4883</font>           if ( $line_numbering ) { 
<font class='lnum'>4884</font>           $chunkbuf .= "&lt;font class='lnum'&gt;" . $line_counter . "&lt;/font&gt;   " . $_;
<font class='lnum'>4885</font>           }
<font class='lnum'>4886</font>           else{
<font class='lnum'>4887</font>           $chunkbuf .= $_;
<font class='lnum'>4888</font>           }
<font class='lnum'>4889</font>   
<font class='lnum'>4890</font>   } # fi code chunks
<font class='lnum'>4891</font>   
<font class='lnum'>4892</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('97');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('98');">
<font class='lnum'><i>(98)</i></font>&nbsp; process section headings </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 4898)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='98'></a></legend></fieldset>
<p>
<div id="98" style="display:none">   
<ul>


<p>
This is where folding sectons are created.<br>
The more complicated logic is needed to <i>close</i> the sections properly, when subsections<br>
are included (i.e. creating a step and forming the "close subsection" at the end in the correct<br>
place.<br>
<p>
1. Several formats were possible for collapsing sections, I chose the one you can observe while<br>
reading the weaved document: subsections are completely enclosed by their supersections;<br>
once a child subsection is initiated, the parent subsection cannot continue its body after<br>
the end of the child.<br>
I.e. once you started 12.2.1 inside your 12.2, you cannot write into 12.2 after 12.2.1 is finished, <br>
but you can add 12.2.2, 12.2.3, 12.2.2.1 - etc. - inside the enclosing section.<br>
<p>
The logic was tested first in an external skeleton script.<br>
<p>
2. I may need to disassemble this code to create "view mode" for my script - see "versions - <br>
CHANGES" subsection<br>
<p>
<p>
<b> First</b> get the info from the heading and set several vars for substitutions etc.:<br>
Also: print subsections marked with a "+" as unfolded (JS stype 'block'), rather than <br>
collapsed ('none')<br>
<p>
<font class='lnum'>4923</font>   
                <div id=codechunk4923>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process section headings&gt;&gt<sub></sub>=</legend>
<font class='lnum'>4924</font>   
<font class='lnum'>4925</font>   # -- SECTION HEADINGS 
<font class='lnum'>4926</font>   #elsif ( m!\.(\+)?h(\d)\.(.*?)\./h\d\.! ) {     # old version, no "rawHTML" enabled yet
<font class='lnum'>4927</font>   elsif
<font class='lnum'>4928</font>     ( m!$tag_open_symbol(\+)?h(\d{1,2})$tag_close_symbol(.*?)$tag_open_symbol/h\d{1,2}$tag_close_symbol! )
<font class='lnum'>4929</font>     {  
<font class='lnum'>4930</font>   
<font class='lnum'>4931</font>           # -- using split vars for substitution to avoid
<font class='lnum'>4932</font>           #       regexps and need to keep old state --   
<font class='lnum'>4933</font>   
<font class='lnum'>4934</font>           $section_num_prev = $section_num;
<font class='lnum'>4935</font>           $section_num = $section_num + 1;
<font class='lnum'>4936</font>   
<font class='lnum'>4937</font>   
<font class='lnum'>4938</font>           #default for fold state in "settings" ??
<font class='lnum'>4939</font>           if ($1 eq "+") {
<font class='lnum'>4940</font>               $fold_state="block";
<font class='lnum'>4941</font>               $highlight_state = qq!  &lt;script language=javascript&gt; 
<font class='lnum'>4942</font>               document.getElementById("toc"+ $section_num).className='hilited';
<font class='lnum'>4943</font>               &lt;/script&gt; !;
<font class='lnum'>4944</font>           } 
<font class='lnum'>4945</font>           else {
<font class='lnum'>4946</font>               $fold_state="none";
<font class='lnum'>4947</font>               $highlight_state = "";
<font class='lnum'>4948</font>           };
<font class='lnum'>4949</font>           $section_level = $2;
<font class='lnum'>4950</font>           $section_title = $3;
<font class='lnum'>4951</font>   
<font class='lnum'>4952</font>           # add-on for virtual nodes; DEBUG for now
<font class='lnum'>4953</font>           $stripped_section_title = $section_title;
<font class='lnum'>4954</font>           $stripped_section_title =~ s!\s*(.*\S)\s*!$1!;
<font class='lnum'>4955</font>           $headings_id_hash{$stripped_section_title} = $section_num;
<font class='lnum'>4956</font>   
<font class='lnum'>4957</font>   </fieldset></pre>
</div><p>
<b> Secondly, </b> copy the formatting strings and modify copies with substitutions<br>
<p>
<font class='lnum'>4961</font>   
                <div id=codechunk4961>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process section headings&gt;&gt<sub>2</sub>=</legend>        
<font class='lnum'>4962</font>   
<font class='lnum'>4963</font>           $folding_section_start1 = $folding_section_start1_str;
<font class='lnum'>4964</font>           $folding_section_start2 = $folding_section_start2_str;
<font class='lnum'>4965</font>           $folding_section_end = $folding_section_end_str;
<font class='lnum'>4966</font>   
<font class='lnum'>4967</font>   
<font class='lnum'>4968</font>           $folding_section_start1 =~ s!(\$section_num)!$1!ee;
<font class='lnum'>4969</font>           $folding_section_start2 =~ s!(\$section_num)!$1!ee;
<font class='lnum'>4970</font>           $folding_section_start2 =~ s!(\$fold_state)!$1!ee;
<font class='lnum'>4971</font>           $folding_section_start2 =~ s!(\$highlight_state)!$1!ee;
<font class='lnum'>4972</font>           $folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>4973</font>   
<font class='lnum'>4974</font>   
<font class='lnum'>4975</font>           $section_id = $section_level . '-' . $section_num;
<font class='lnum'>4976</font>   
<font class='lnum'>4977</font>   </fieldset></pre>
</div><p>
Note that "$section_id"  above is a string with a dash that contains two pieces of info<br>
<p>
<b> Three </b> Take care of the contained folding subsections<br>
The idea below is this:<br>
When will I need to insert "close subsection" and refs to its folding JS funcs?<br>
Supposing I started with h2. Then I'll skip h3, h4, .. - and must close it when<br>
the next met subsection is again h2.<br>
Array @headings keeps a stack of headings met during parsing.<br>
<p>
//Q: Should I check if ($section_level &gt;= $prev_section_level){ .. } ??<br>
// To cleanly close sections when a prog made a mistake and missed a level?<br>
// OR: should I leave it as it is, as it gives a visual clue of the error?<br>
// OR: has it been taken care of already? - reading my own code ;))))))))))<br>
<p>
<font class='lnum'>4993</font>   
                <div id=codechunk4993>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process section headings&gt;&gt<sub>3</sub>=</legend>        
<font class='lnum'>4994</font>           # finish previous subsection if not the first section in the file
<font class='lnum'>4995</font>           # ..and deal with nesting of sections according to their "depth level"
<font class='lnum'>4996</font>   
<font class='lnum'>4997</font>           # this is NOT the first section:
<font class='lnum'>4998</font>           if ( exists $headings[0] ){
<font class='lnum'>4999</font>   
<font class='lnum'>5000</font>               ($prev_section_level, $prev_section_num)  = split /-/, $headings[0];
<font class='lnum'>5001</font>   
<font class='lnum'>5002</font>               if ($section_level == $prev_section_level){
<font class='lnum'>5003</font>   
<font class='lnum'>5004</font>               # close prev, start new
<font class='lnum'>5005</font>               $chunkbuf .= $folding_section_end;
<font class='lnum'>5006</font>               shift @headings;
<font class='lnum'>5007</font>               
<font class='lnum'>5008</font>               }
<font class='lnum'>5009</font>   
<font class='lnum'>5010</font>               elsif($section_level &lt; $prev_section_level){
<font class='lnum'>5011</font>               
<font class='lnum'>5012</font>                 # close a bunch of them, in a loop -- THEN start a new one.
<font class='lnum'>5013</font>                 do  {
<font class='lnum'>5014</font>                       ($prev_section_level, $section_num_prev) = split /-/, shift @headings;
<font class='lnum'>5015</font>                       
<font class='lnum'>5016</font>                       $folding_section_end = $folding_section_end_str;
<font class='lnum'>5017</font>                       $folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>5018</font>                       $chunkbuf .= $folding_section_end;
<font class='lnum'>5019</font>   
<font class='lnum'>5020</font>                  } while ( $section_level &lt; $prev_section_level );
<font class='lnum'>5021</font>               }
<font class='lnum'>5022</font>           } # fi not the first section
<font class='lnum'>5023</font>   
<font class='lnum'>5024</font>           # end of "finish previous subsection if not the first section in the file"
<font class='lnum'>5025</font>   </fieldset></pre>
</div><p>
<b> Four </b><br>
And the common operations, which form the output buffer string, "$chunkbuf", and<br>
output buffer for printing TOC with needed indentation, "$tocbuf"<br>
<p>
<font class='lnum'>5031</font>   
                <div id=codechunk5031>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process section headings&gt;&gt<sub>4</sub>=</legend>        
<font class='lnum'>5032</font>   
<font class='lnum'>5033</font>           # common operations             
<font class='lnum'>5034</font>           unshift @headings, $section_id ;
<font class='lnum'>5035</font>           $chunkbuf .= $folding_section_start1;
<font class='lnum'>5036</font>           $chunkbuf .= "&lt;font class='lnum'&gt;&lt;i&gt;(" . $section_num . ")&lt;/i&gt;&lt;/font&gt;"
<font class='lnum'>5037</font>               . "&amp;nbsp;" . $section_title
<font class='lnum'>5038</font>               . "&lt;/a&gt;&amp;nbsp;&lt;font class='lnum' size=-1&gt;&lt;sub&gt;&lt;i&gt;(line "
<font class='lnum'>5039</font>               . $line_counter
<font class='lnum'>5040</font>               . ")&lt;/i&gt;&lt;/sub&gt;&lt;/font&gt;"; 
<font class='lnum'>5041</font>   
<font class='lnum'>5042</font>           $chunkbuf .= " &lt;font size=-2&gt;&lt;i&gt;&lt;a href='#tocancor'&gt;toc&lt;/a&gt;&lt;/i&gt;&lt;/font&gt;";
<font class='lnum'>5043</font>   
<font class='lnum'>5044</font>           #for F-links
<font class='lnum'>5045</font>           $chunkbuf .= "&lt;a name='" . $section_num . "'&gt;"; 
<font class='lnum'>5046</font>   
<font class='lnum'>5047</font>           $chunkbuf .= $folding_section_start2;
<font class='lnum'>5048</font>   
<font class='lnum'>5049</font>           #$chunkbuf .= "\n" . "&lt;font class='lnum'&gt;&lt;i&gt;------ line " . $line_counter . 
<font class='lnum'>5050</font>           #           " ------&lt;/i&gt;&lt;/font&gt;&lt;br&gt;\n";
<font class='lnum'>5051</font>   
<font class='lnum'>5052</font>           # TOC Navigation: open all parents, then junp to section
<font class='lnum'>5053</font>           my $open_all_and_jump =  
<font class='lnum'>5054</font>                   q/&amp;nbsp;&lt;a href="#/
<font class='lnum'>5055</font>                   . $section_num
<font class='lnum'>5056</font>                   . q/" onmousedown="open_all_above(/  
<font class='lnum'>5057</font>                   . $section_num . 
<font class='lnum'>5058</font>                   q/);" &gt;/ . '))&lt;/a&gt;';
<font class='lnum'>5059</font>   
<font class='lnum'>5060</font>   
<font class='lnum'>5061</font>           # TOC Navigation: open_all_above(someid)
<font class='lnum'>5062</font>           $tocbuf .= 
<font class='lnum'>5063</font>                   $open_all_and_jump . "&amp;nbsp;" 
<font class='lnum'>5064</font>                   . q/&amp;nbsp;&lt;a href="javascript:;" onmousedown="open_all_above(/  
<font class='lnum'>5065</font>                   . $section_num . 
<font class='lnum'>5066</font>                   q/);" &gt;/ . '&lt;i&gt;' . $section_num . '&lt;/i&gt;&lt;/a&gt;';
<font class='lnum'>5067</font>   
<font class='lnum'>5068</font>           $toc_indent = "&amp;nbsp;"x4 . "." x (($section_level-1) * 7);
<font class='lnum'>5069</font>   
<font class='lnum'>5070</font>           # old-disabled
<font class='lnum'>5071</font>           #$toc_indent = "&amp;nbsp;" x ($section_level * 7);
<font class='lnum'>5072</font>           #$toc_indent = "&amp;nbsp;" x (($section_level-1) * 7 );
<font class='lnum'>5073</font>           #$tocbuf .= "\n&lt;p&gt;\n" if ( $section_level == 1 ); 
<font class='lnum'>5074</font>   
<font class='lnum'>5075</font>           $tocbuf .= $toc_indent . 
<font class='lnum'>5076</font>                   #--disabled--#"&lt;i&gt;" . $section_num . "&lt;/i&gt;" .
<font class='lnum'>5077</font>                   qq/&amp;nbsp;&lt;a href="javascript:;" onmousedown="toggleCombined(/ .  
<font class='lnum'>5078</font>                   $section_num . 
<font class='lnum'>5079</font>                   qq/);" id="toc/ . $section_num .
<font class='lnum'>5080</font>                   qq/"&gt;&lt;b&gt;/ .
<font class='lnum'>5081</font>                   $section_title . "&lt;/a&gt;&amp;nbsp;&lt;a&gt;&lt;font class='lnum' size=-1&gt;&lt;i&gt;(line " .
<font class='lnum'>5082</font>                       $line_counter . ")&lt;/i&gt;&lt;/font&gt;" .
<font class='lnum'>5083</font>                       "&lt;/b&gt;&lt;/a&gt;";
<font class='lnum'>5084</font>   
<font class='lnum'>5085</font>           # and end the line
<font class='lnum'>5086</font>           $tocbuf .= "&lt;br&gt;\n";
<font class='lnum'>5087</font>   
<font class='lnum'>5088</font>   
<font class='lnum'>5089</font>   
<font class='lnum'>5090</font>   } #; fisle: end elif headings
<font class='lnum'>5091</font>           
<font class='lnum'>5092</font>   
<font class='lnum'>5093</font>   </fieldset></pre>
</div><p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('98');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('99');">
<font class='lnum'><i>(99)</i></font>&nbsp; Doc body formatters: rawHTML and others</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 5098)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='99'></a></legend></fieldset>
<p>
<div id="99" style="display:none">   
<ul>


<p>
The last "else" case is the documentation chunk body.<br>
It includes one default formatter, which is "rawHTML", and can include a number<br>
of other markups. That section should be made extensible by users.<br>
<p>
Secondly, docsection  body may contain LINKED_CHUNKs (or LINKED_SECTIONs), so<br>
I'll have to add them to @indbuf here.<br>
<p>
So here we are:<br>
<p>
<font class='lnum'>5110</font>   
                <div id=codechunk5110>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt<sub></sub>=</legend>
<font class='lnum'>5111</font>   
<font class='lnum'>5112</font>   else { # this is the body of the doc section
<font class='lnum'>5113</font>   
<font class='lnum'>5114</font>   <font class='chunkref'>&lt;&lt;rawHTML formatter&gt;&gt;</font>
<font class='lnum'>5115</font>   <font class='chunkref'>&lt;&lt;other body formatters&gt;&gt;</font>
<font class='lnum'>5116</font>   
<font class='lnum'>5117</font>       if (m!^\s*\[\[LINKED_CHUNK(_\d+)?\s+(.*\S)\s*\]\]\s*&lt;br&gt;$!) { # -- CHUNK LINKS --
<font class='lnum'>5118</font>           my $index_str = "&amp;lt;&amp;lt;$2&amp;gt;&amp;gt; " . $section_num . "&lt;sup&gt;link&lt;/sup&gt;";
<font class='lnum'>5119</font>           unshift @indbuf, $index_str;
<font class='lnum'>5120</font>       }
<font class='lnum'>5121</font>   
<font class='lnum'>5122</font>   } # esle, fi -- end of processing inside 'while' over the file lines.
<font class='lnum'>5123</font>   
<font class='lnum'>5124</font>   </fieldset></pre>
</div><p>
<p>
<b> Body formatters </b><br>
Now, the default formatter starts an "if" (selecting with a config variable $weave_markup),<br>
and all other selection clauses must implement "elsif" clauses. Those are not obligatory, <br>
as "if" is extensible, of course.<br>
<p>
For the convenience of the users who might wish to add other markups to Molly, all<br>
non-default sections are moved to the end to <b> ADD-ON: example of additional markup<br>
</b> folding sections of this Literate Source file.<br>
<p>
<b> rawHTML formatter</b><br>
Raw HTML formatting can be done. It is non-restricted, compared to the stripped-down<br>
"dotHTML" of my invention, and  it also allows one to convert existing HTML documentation<br>
into the folding format.<br>
I.e. if you have a longish manual in which section headings are marked with HTML<br>
h1, h2, h3, ... tags, you can convert it in 3 simple steps:<br>
<ul> <li> delete opening and closing "html" and "head" "body" tags at the very top and<br>
bottom of your  document<br>
</li> <li> put perl invocation as the first line<br>
</li> <li> set up markup mode in a variable: "$weave_markup = "rawHTML";" and "mollify"<br>
the document, putting  "do MOLLY.pl" and DATA marker<br>
</li> </ul><br>
and if there are no interfering div section etc. - no complicated markup inside the<br>
headings, you'll get an automatically generated folding HTML document.<br>
<p>
If you do, it is sometimes easy to clean headings with a few regexps in a good editor<br>
like Vim<br>
<p>
It is very convenient and I keep large manuals as folding HTML documents.<br>
<p>
<p>
<font class='lnum'>5157</font>   
                <div id=codechunk5157>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;rawHTML formatter&gt;&gt<sub></sub>=</legend>
<font class='lnum'>5158</font>           if( $weave_markup eq "rawHTML" ) {      # if the doc chunks marked up with real HTML
<font class='lnum'>5159</font>                   s!^#-----.*!!;
<font class='lnum'>5160</font>   
<font class='lnum'>5161</font>                 #s/^{{{\d+(.*)$/$1/;      # - eliminate vim folding markup, start 
<font class='lnum'>5162</font>                                           # - dummy, as it's killed in "headings" processing 
<font class='lnum'>5163</font>                 s/^}}}\d+//;      # - eliminate vim folding markup, end
<font class='lnum'>5164</font>   
<font class='lnum'>5165</font>   
<font class='lnum'>5166</font>                 # Paragraphs and line breaks are automatic now:
<font class='lnum'>5167</font>                 # ... unless we are dealing with the "preformat" tag
<font class='lnum'>5168</font>                   #--note! that ranges do not work here
<font class='lnum'>5169</font>                   $in_pre_tag = 1 if (m!&lt;pre&gt;!);
<font class='lnum'>5170</font>                   $in_pre_tag = 0 if (m!&lt;/pre&gt;!);;
<font class='lnum'>5171</font>   
<font class='lnum'>5172</font>   
<font class='lnum'>5173</font>                   unless ($in_pre_tag) {
<font class='lnum'>5174</font>                   (m/^\s*$/) and s/$_/&lt;p&gt;\n/
<font class='lnum'>5175</font>                   or s/\n/&lt;br&gt;\n/;
<font class='lnum'>5176</font>                   }
<font class='lnum'>5177</font>   
<font class='lnum'>5178</font>                   $chunkbuf .= $_;
<font class='lnum'>5179</font>   
<font class='lnum'>5180</font>           } # fi - default rawHTML formatter for body of doc chunks
<font class='lnum'>5181</font>   
<font class='lnum'>5182</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('99');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('96');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('100');">
<font class='lnum'><i>(100)</i></font>&nbsp; Print out the resulting page </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 5191)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='100'></a></legend></fieldset>
<p>
<div id="100" style="display:none">   
<ul>


<p>
Page and the outer formatting table:<br>
<p>
<font class='lnum'>5196</font>   
                <div id=codechunk5196>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt<sub></sub>=</legend>
<font class='lnum'>5197</font>   
<font class='lnum'>5198</font>   # begin the page:
<font class='lnum'>5199</font>   
<font class='lnum'>5200</font>     # /disabled doctype line/ - it garbles output of TOC (!!)
<font class='lnum'>5201</font>     #print q(&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
<font class='lnum'>5202</font>     #                 "http://www.w3.org/TR/html4/loose.dtd"&gt;), "\n";
<font class='lnum'>5203</font>   
<font class='lnum'>5204</font>     print "&lt;html&gt;\n  $html_head\n &lt;body&gt;  $html_body_table \n";
<font class='lnum'>5205</font>   
<font class='lnum'>5206</font>   # print out the TOC, the Chunks Index, the output buffer and close the page.
<font class='lnum'>5207</font>   
<font class='lnum'>5208</font>   </fieldset></pre>
</div><p>
Next print the short instructions section (collapsible) at the top:<br>
<p>
<font class='lnum'>5212</font>   
                <div id=codechunk5212>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt<sub>2</sub>=</legend>
<font class='lnum'>5213</font>   
<font class='lnum'>5214</font>   print &lt;&lt;end_of_print;
<font class='lnum'>5215</font>   &lt;p&gt;&lt;fieldset class='tocfieldset'&gt;
<font class='lnum'>5216</font>   &lt;legend&gt;&lt;b&gt;TABLE OF CONTENTS: outline of the document structure&lt;/b&gt;&lt;/legend&gt;
<font class='lnum'>5217</font>   
<font class='lnum'>5218</font>   &lt;ul&gt;
<font class='lnum'>5219</font>   &lt;p&gt;
<font class='lnum'>5220</font>   &lt;br&gt;
<font class='lnum'>5221</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>5222</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('tochowto');"&gt;
<font class='lnum'>5223</font>   &lt;b&gt;HOW TO USE THE FOLDING DOCUMENT [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>5224</font>   &lt;/div&gt;
<font class='lnum'>5225</font>   &lt;div id='tochowto' style='display:none' style='background:#ffffff'&gt; 
<font class='lnum'>5226</font>   &lt;p&gt;
<font class='lnum'>5227</font>   &lt;ul&gt;
<font class='lnum'>5228</font>   &lt;li&gt;&lt;b&gt;Collapsing is necessary when&lt;/b&gt; you work on code and must exclude 
<font class='lnum'>5229</font>   &lt;br&gt;irrelevant sections of the rest of the literate project file. This 
<font class='lnum'>5230</font>   &lt;br&gt;greatly helps to clear thinking by eliminating a general feeling of 
<font class='lnum'>5231</font>   &lt;br&gt;being in a maze of code and unnecessary "housekeeping" tasks.
<font class='lnum'>5232</font>   &lt;br&gt;One can say that there is a limited "buffer capacity" in the human
<font class='lnum'>5233</font>   &lt;br&gt;mind, and relieving it of the need to remember where things are in a 
<font class='lnum'>5234</font>   &lt;br&gt;larger file, at which other points one must fill in values or adjust
<font class='lnum'>5235</font>   &lt;br&gt;invocation etc. &lt;i&gt;immediately makes the user "more intelligent"&lt;/i&gt;
<font class='lnum'>5236</font>   &lt;p&gt;
<font class='lnum'>5237</font>   &lt;/li&gt;&lt;li&gt;&lt;b&gt;TOC: to toggle&lt;/b&gt; a section open/closed, click on the &lt;i&gt;corresponding link&lt;/i&gt;
<font class='lnum'>5238</font>   &lt;br&gt;Remember to open &lt;i&gt;all sections above it&lt;/i&gt; for it to become visible.
<font class='lnum'>5239</font>   &lt;/li&gt;&lt;li&gt;&lt;b&gt;TOC: to open all sections above&lt;/b&gt; some internal subsection to make
<font class='lnum'>5240</font>   &lt;br&gt;it visible, click on the &lt;i&gt;section number&lt;/i&gt; in the column on the left.
<font class='lnum'>5241</font>   &lt;/li&gt;&lt;li&gt;&lt;b&gt;TOC: to open all above and jump&lt;/b&gt; click on the leftmost symbol.
<font class='lnum'>5242</font>   &lt;p&gt;
<font class='lnum'>5243</font>   &lt;/li&gt;&lt;li&gt;&lt;b&gt;To restore the default view&lt;/b&gt; &lt;i&gt;reload&lt;/i&gt; the page in the browser.
<font class='lnum'>5244</font>   &lt;p&gt;
<font class='lnum'>5245</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>5246</font>   &lt;b&gt;To keep some sections open&lt;/b&gt; upon each reload: supposing you
<font class='lnum'>5247</font>   &lt;br&gt;work on the code, constantly update it and cannot bother to reopen it 
<font class='lnum'>5248</font>   &lt;br&gt;again and again - mark the headings for the sections in the source file
<font class='lnum'>5249</font>   &lt;br&gt;with a plus, i.e. write the opening tag (only)  as +h2, +h3. Again, all
<font class='lnum'>5250</font>   &lt;br&gt;sections above must be marked open too. 
<font class='lnum'>5251</font>   &lt;br&gt;&lt;b&gt;Note that&lt;/b&gt; "expand all" and "collapse all" disregard these settings.
<font class='lnum'>5252</font>   &lt;br&gt;Reload the page after using those options to again view the text
<font class='lnum'>5253</font>   &lt;br&gt;according to your preferences.
<font class='lnum'>5254</font>   &lt;p&gt;
<font class='lnum'>5255</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>5256</font>   &lt;b&gt; To use the Index &lt;/b&gt;, click on the numbered sections in the TOC above
<font class='lnum'>5257</font>   &lt;br&gt;(opening them; use highlighting as a guide; when sections are visible,
<font class='lnum'>5258</font>   &lt;br&gt;the slider on your browser window  will shorten too), or "expand all", 
<font class='lnum'>5259</font>   &lt;br&gt;and then use your browser's Find function to highlight all chunk name 
<font class='lnum'>5260</font>   &lt;br&gt;instances in the visible text
<font class='lnum'>5261</font>   &lt;p&gt;
<font class='lnum'>5262</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>5263</font>   &lt;b&gt;To search for variables etc.&lt;/b&gt;, "expand all" text - or manually 
<font class='lnum'>5264</font>   &lt;br&gt;expand needed sections - and then use your browser's Find function to 
<font class='lnum'>5265</font>   &lt;br&gt;highlight all and jump between the found items.
<font class='lnum'>5266</font>   &lt;p&gt;&lt;/li&gt;&lt;/ul&gt;
<font class='lnum'>5267</font>   
<font class='lnum'>5268</font>   &lt;/div&gt; 
<font class='lnum'>5269</font>   &lt;p&gt;
<font class='lnum'>5270</font>   &lt;br&gt;
<font class='lnum'>5271</font>   &lt;p&gt;
<font class='lnum'>5272</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>5273</font>   &lt;p&gt;
<font class='lnum'>5274</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('tocmain');"&gt;
<font class='lnum'>5275</font>   &lt;b&gt;TABLE OF CONTENTS [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>5276</font>   &lt;a name="tocancor"&gt;&lt;/a&gt;
<font class='lnum'>5277</font>   &lt;font size=-1 color=darkgrey&gt;&lt;i&gt;
<font class='lnum'>5278</font>   &lt;p&gt;&lt;b&gt;Section name&lt;/b&gt; toggles expanded state. &lt;b&gt;Subsection number&lt;/b&gt; on the left opens
<font class='lnum'>5279</font>   &lt;br&gt;all parent sections to make it visible. &lt;b&gt;Leftmost symbol&lt;/b&gt; opens parents and
<font class='lnum'>5280</font>   &lt;br&gt;jumps to the section.
<font class='lnum'>5281</font>   &lt;/i&gt;&lt;/font&gt;
<font class='lnum'>5282</font>   &lt;/div&gt;
<font class='lnum'>5283</font>   
<font class='lnum'>5284</font>   &lt;div id='tocmain' style='display:$toc_expanded' style='background:#ffffff'&gt; 
<font class='lnum'>5285</font>   &lt;p&gt;
<font class='lnum'>5286</font>   &lt;br&gt;
<font class='lnum'>5287</font>   &lt;p&gt;
<font class='lnum'>5288</font>   end_of_print
<font class='lnum'>5289</font>   
<font class='lnum'>5290</font>   </fieldset></pre>
</div><p>
Table of Contents from the formed "tocbuf":<br>
<p>
<font class='lnum'>5294</font>   
                <div id=codechunk5294>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt<sub>3</sub>=</legend>
<font class='lnum'>5295</font>   
<font class='lnum'>5296</font>    print "$tocbuf" if $print_toc;
<font class='lnum'>5297</font>    #print "$tocbuf";
<font class='lnum'>5298</font>   
<font class='lnum'>5299</font>   print "&lt;/div&gt;\n";
<font class='lnum'>5300</font>   
<font class='lnum'>5301</font>   </fieldset></pre>
</div><p>
Start the "Index of code chunks", collapsible:<br>
<p>
<font class='lnum'>5305</font>   
                <div id=codechunk5305>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt<sub>4</sub>=</legend>
<font class='lnum'>5306</font>   
<font class='lnum'>5307</font>   print &lt;&lt;end_of_print;
<font class='lnum'>5308</font>   &lt;p&gt;
<font class='lnum'>5309</font>   &lt;br&gt;
<font class='lnum'>5310</font>   &lt;p&gt;
<font class='lnum'>5311</font>   &lt;!--fieldset&gt;&lt;legend--&gt;
<font class='lnum'>5312</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>5313</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('indbuf');"&gt;
<font class='lnum'>5314</font>   &lt;b&gt;INDEX of Code Chunks [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>5315</font>   &lt;/div&gt;
<font class='lnum'>5316</font>   &lt;!--/legend&gt;&lt;/fieldset--&gt;
<font class='lnum'>5317</font>   &lt;p&gt;
<font class='lnum'>5318</font>   &lt;div id='indbuf' style='display:$ind_expanded' style='background:#ffffff'&gt; 
<font class='lnum'>5319</font>   &lt;ul&gt;
<font class='lnum'>5320</font>   &lt;p&gt;
<font class='lnum'>5321</font>   A &lt;b&gt;"def" superscript&lt;/b&gt; means the chunk is defined,&lt;br&gt;
<font class='lnum'>5322</font>   a &lt;b&gt;"link"&lt;/b&gt; that the chunk is being linked to from that section,&lt;br&gt;
<font class='lnum'>5323</font>   and a &lt;b&gt;bare number&lt;/b&gt; means the chunk is being used in a section.
<font class='lnum'>5324</font>   &lt;p&gt;
<font class='lnum'>5325</font>   end_of_print
<font class='lnum'>5326</font>   
<font class='lnum'>5327</font>   </fieldset></pre>
</div><p>
<p>
Index of code chunks; calculated in this snippet:<br>
<p>
<font class='lnum'>5332</font>   
                <div id=codechunk5332>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt<sub>5</sub>=</legend>
<font class='lnum'>5333</font>   
<font class='lnum'>5334</font>    $ind_outbuf = '';
<font class='lnum'>5335</font>    $prev_ch_name = '';
<font class='lnum'>5336</font>   
<font class='lnum'>5337</font>    #for (sort @indbuf){ print $_, "&lt;br&gt;";}
<font class='lnum'>5338</font>   
<font class='lnum'>5339</font>    for (sort @indbuf){
<font class='lnum'>5340</font>   
<font class='lnum'>5341</font>      ($ch_name, $closing_bracket, $ref_num) = split /&amp;gt;/, $_; 
<font class='lnum'>5342</font>           #/ - for editor colouring bug
<font class='lnum'>5343</font>   
<font class='lnum'>5344</font>       if ( $ch_name eq $prev_ch_name ){ 
<font class='lnum'>5345</font>         $ind_outbuf .= " &lt;b&gt;" . $ref_num . "&lt;/b&gt; ";
<font class='lnum'>5346</font>       }
<font class='lnum'>5347</font>       else{
<font class='lnum'>5348</font>         print  $ind_outbuf, "&lt;br&gt;\n"; 
<font class='lnum'>5349</font>         $ch_namestr = $ch_name;
<font class='lnum'>5350</font>         $ch_namestr =~ s!&amp;lt;&amp;lt;!!;
<font class='lnum'>5351</font>         $ind_outbuf = 
<font class='lnum'>5352</font>           "&lt;b&gt;&amp;lt;&amp;lt;&lt;/b&gt;&lt;font class='chunkref'&gt;" . 
<font class='lnum'>5353</font>           $ch_namestr . 
<font class='lnum'>5354</font>           "&lt;/font&gt;&lt;b&gt;&amp;gt;&amp;gt;&lt;/b&gt; -- &lt;b&gt;" . 
<font class='lnum'>5355</font>           $ref_num . 
<font class='lnum'>5356</font>           "&lt;/b&gt; ";
<font class='lnum'>5357</font>       }
<font class='lnum'>5358</font>       $prev_ch_name = $ch_name;
<font class='lnum'>5359</font>   
<font class='lnum'>5360</font>    }; # rof - forming the code chunks index
<font class='lnum'>5361</font>   
<font class='lnum'>5362</font>   print $ind_outbuf, "&lt;br&gt;\n";
<font class='lnum'>5363</font>   
<font class='lnum'>5364</font>   </fieldset></pre>
</div><p>
<p>
"expand all" and "collapse all" at the end of the TOC/Chunk Index section <br>
at the top of the page:<br>
<p>
<font class='lnum'>5370</font>   
                <div id=codechunk5370>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt<sub>6</sub>=</legend>
<font class='lnum'>5371</font>   
<font class='lnum'>5372</font>     # The "expand all" "collapse all" control
<font class='lnum'>5373</font>   
<font class='lnum'>5374</font>   print &lt;&lt;end_of_print;
<font class='lnum'>5375</font>   &lt;/div&gt;\n&lt;p&gt;
<font class='lnum'>5376</font>   &lt;br&gt;
<font class='lnum'>5377</font>   &lt;p&gt;&lt;div class='hl' align=center&gt;&lt;i&gt;
<font class='lnum'>5378</font>   &lt;a href="javascript:;" onmousedown="showAll();"&gt;
<font class='lnum'>5379</font>   expand all&lt;/a&gt; -- 
<font class='lnum'>5380</font>   &lt;a href="javascript:;" onmousedown="hideAll();"&gt;
<font class='lnum'>5381</font>   collapse all&lt;/a&gt;
<font class='lnum'>5382</font>   &lt;/i&gt;&lt;/div&gt;&lt;p&gt;
<font class='lnum'>5383</font>   end_of_print
<font class='lnum'>5384</font>   
<font class='lnum'>5385</font>   
<font class='lnum'>5386</font>    print "&lt;/ul&gt;&lt;/fieldset&gt;&lt;p&gt;\n&lt;br&gt;";
<font class='lnum'>5387</font>   
<font class='lnum'>5388</font>   </fieldset></pre>
</div><p>
<p>
<p>
..and..<br>
<b> PRINT the document itself</b>, formed earlier in the "chunkbuf" string in memory.<br>
This section was greatly modified for LINKED_CHUNKs and LINKED_SECTIONs to "while"<br>
over lines in the $chunkbuf with regexps and do the substitutions if links are presentat<br>
in the document.<br>
<p>
<p>
<font class='lnum'>5399</font>   
                <div id=codechunk5399>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt<sub>7</sub>=</legend>
<font class='lnum'>5400</font>   <font class='chunkref'>&lt;&lt;print out - with virtual nodes&gt;&gt;</font>
<font class='lnum'>5401</font>   </fieldset></pre>
</div><p>
<p>
<p>
<font class='lnum'>5405</font>   
                <div id=codechunk5405>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out - with virtual nodes&gt;&gt<sub></sub>=</legend>
<font class='lnum'>5406</font>   
<font class='lnum'>5407</font>   #The FULL OUTPUT, the file body (with links handling  added):
<font class='lnum'>5408</font>   
<font class='lnum'>5409</font>   <font class='chunkref'>&lt;&lt;sub print_chunk_link&gt;&gt;</font>
<font class='lnum'>5410</font>   
<font class='lnum'>5411</font>   my $clonebody_cnt = 0; # to assign unique id's to divs to put clones in.
<font class='lnum'>5412</font>   
<font class='lnum'>5413</font>   while ($chunkbuf =~ m!^(.*)$!gm ) { # -- line by line iteration over the doc as string in mem
<font class='lnum'>5414</font>       my $printed_line = $1;
<font class='lnum'>5415</font>   
<font class='lnum'>5416</font>   <font class='chunkref'>&lt;&lt;if LINKED_CHUNK, create clone-destructclone fieldset&gt;&gt;</font>
<font class='lnum'>5417</font>   <font class='chunkref'>&lt;&lt;elsif create FLINKs&gt;&gt;</font>
<font class='lnum'>5418</font>   
<font class='lnum'>5419</font>   else{ # -- BODY OF THE DOCUMENT--  no virtual links met. Just print
<font class='lnum'>5420</font>               print $printed_line, "\n"; 
<font class='lnum'>5421</font>   } # 
<font class='lnum'>5422</font>   } # eliwh - end of line-by-line iteration over the buffer string in memory 
<font class='lnum'>5423</font>   
<font class='lnum'>5424</font>   </fieldset></pre>
</div><p>
<p>
<b> Finally </b> close the HTML formatting tags at the end of the page:<br>
<p>
<font class='lnum'>5429</font>   
                <div id=codechunk5429>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt<sub>8</sub>=</legend>
<font class='lnum'>5430</font>   
<font class='lnum'>5431</font>   # close the page
<font class='lnum'>5432</font>           print $html_body_table_end;
<font class='lnum'>5433</font>           
<font class='lnum'>5434</font>   
<font class='lnum'>5435</font>   #--- END OF SCRIPT ---
<font class='lnum'>5436</font>   
<font class='lnum'>5437</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('101');">
<font class='lnum'><i>(101)</i></font>&nbsp; Linked chunks, sections and Flinks </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 5443)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='101'></a></legend></fieldset>
<p>
<div id="101" style="display:none">   
<ul>


<p>
<b> see ADD_ON for "Virtual Nodes" </b> - there's a logical overview of <br>
all changes that were implemented.<br>
<p>
Briefly here:<br>
(a) I suppose those live inside regular subsections<br>
(b) I suppose they are marked as "[[", then"LINKED_CHUNK" or "LINKED_CHUNK_3",<br>
then  "literate copy of the node to clone", then "]]".<br>
    (one or more space chars after LINKED_SECTION or LINKED_CHUNK)<br>
(c) They live inside documentation chunks, and so I do not need to bypass them<br>
    in regular code processing, tangler or weaver, above (?)<br>
(d) In this final parsing of $chunkbuf str I must distinguish them from chunk<br>
    regular refs. But if I reserve LINKED_xxx as two unique identifiers, that's it.<br>
<p>
Seems, just an ordinary match inside the string will do.<br>
mm.. need to distinguish from a passing usage in docs, like in (b).<br>
Let's restrict syntax to ONLY MEANINGFUL CHARS ON THE LINE:<br>
<p>
(e) .. and finally, I need to subst the matching line, but pass through<br>
    and print out everything else.<br>
<p>
(f) The code is ugly because I am still debugging it and wish to keep the two cases<br>
(of CHUNKs and SECTIONs) completely separate in spite of duplicated code<br>
<p>
<p>
<p>
To take care of splinters of a chunk with the same name, I'll have to loop now over the <br>
list kept in the %chunks_id_hash, and repeat the same clone creation.<br>
<p>
I should do it the same way I did in Tangler, it's the same data structure.. done.<br>
<p>
<font class='lnum'>5476</font>   
                <div id=codechunk5476>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;sub print_chunk_link&gt;&gt<sub></sub>=</legend>
<font class='lnum'>5477</font>   
<font class='lnum'>5478</font>   sub print_chunk_link {
<font class='lnum'>5479</font>   
<font class='lnum'>5480</font>   (my $name_of_linked_chunk, $virtual_id, my $created_clone_div_id, my $shown_splinter_num) = @_;
<font class='lnum'>5481</font>   
<font class='lnum'>5482</font>   print &lt;&lt;"end_of_clone_sect";
<font class='lnum'>5483</font>   
<font class='lnum'>5484</font>       &lt;fieldset class='linked_chunk'&gt;
<font class='lnum'>5485</font>       &lt;legend class='linked_chunk_legend'&gt;
<font class='lnum'>5486</font>       $lt_esc$lt_esc$name_of_linked_chunk$gt_esc$gt_esc $shown_splinter_num
<font class='lnum'>5487</font>       &lt;font size=-2&gt;&lt;i&gt;
<font class='lnum'>5488</font>       &lt;a href="javascript:;"
<font class='lnum'>5489</font>       onmousedown="CreateVirtualNode('$virtual_id', '$created_clone_div_id');"
<font class='lnum'>5490</font>       &gt; [open] &lt;/a&gt;
<font class='lnum'>5491</font>       &lt;a href="javascript:;"
<font class='lnum'>5492</font>       onmousedown="DeleteVirtualNode('$created_clone_div_id');"
<font class='lnum'>5493</font>       &gt; [close]&lt;/a&gt;&lt;/i&gt;&lt;/font&gt;
<font class='lnum'>5494</font>       &lt;/legend&gt;
<font class='lnum'>5495</font>       &lt;div id="$created_clone_div_id"&gt;
<font class='lnum'>5496</font>       &lt;/div&gt;
<font class='lnum'>5497</font>       &lt;/fieldset&gt;
<font class='lnum'>5498</font>   
<font class='lnum'>5499</font>   end_of_clone_sect
<font class='lnum'>5500</font>   
<font class='lnum'>5501</font>       # a DEBUG printout:
<font class='lnum'>5502</font>       #for (keys %chunks_id_hash) {print "[$_] =&gt; $chunks_id_hash{$_}&lt;br&gt;\n"}
<font class='lnum'>5503</font>   
<font class='lnum'>5504</font>       #&lt;br&gt;DEBUG: trying to clone [[$1]] whose id is [$virtual_id] 
<font class='lnum'>5505</font>       #OR [$chunks_id_hash{$name_of_linked_chunk}]
<font class='lnum'>5506</font>   
<font class='lnum'>5507</font>   } # bus -- printing out formatted CHUNK_LINK cloning line
<font class='lnum'>5508</font>   
<font class='lnum'>5509</font>   </fieldset></pre>
</div><p>
<p>
<p>
<font class='lnum'>5513</font>   
                <div id=codechunk5513>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;if LINKED_CHUNK, create clone-destructclone fieldset&gt;&gt<sub></sub>=</legend>
<font class='lnum'>5514</font>   
<font class='lnum'>5515</font>   if ($printed_line =~ m!^\s*\[\[LINKED_CHUNK(_\d+)?\s+(.*\S)\s*\]\]\s*&lt;br&gt;$!) { # -- CHUNK LINKS --
<font class='lnum'>5516</font>   
<font class='lnum'>5517</font>       my $name_of_linked_chunk = $2;
<font class='lnum'>5518</font>   
<font class='lnum'>5519</font>       unless ( exists $chunks_id_hash{$name_of_linked_chunk} ) {
<font class='lnum'>5520</font>   
<font class='lnum'>5521</font>   print &lt;&lt;"end_of_clone_sect";
<font class='lnum'>5522</font>       &lt;fieldset class='linked_chunk'&gt;
<font class='lnum'>5523</font>       &lt;legend class='linked_chunk_legend'&gt;
<font class='lnum'>5524</font>       &amp;lt;&amp;lt;$name_of_linked_chunk&amp;gt;&amp;gt;&lt;font color=darkred&gt;&lt;sub&gt;&lt;i&gt;broken_link&lt;/i&gt;&lt;/sub&gt;&lt;/font&gt;
<font class='lnum'>5525</font>       &lt;/legend&gt;
<font class='lnum'>5526</font>       &lt;/fieldset&gt;
<font class='lnum'>5527</font>   end_of_clone_sect
<font class='lnum'>5528</font>   
<font class='lnum'>5529</font>       next;
<font class='lnum'>5530</font>       }
<font class='lnum'>5531</font>   
<font class='lnum'>5532</font>       if ($1) { # printing a single splinter LINKED_CHUNK_N of a given number
<font class='lnum'>5533</font>   
<font class='lnum'>5534</font>           my $splinter_cnt = (substr $1, 1);
<font class='lnum'>5535</font>           my $virtual_id = $chunks_id_hash{$name_of_linked_chunk}[$splinter_cnt-1]; 
<font class='lnum'>5536</font>           my $created_clone_div_id = "clonebody" . $clonebody_cnt;
<font class='lnum'>5537</font>           $clonebody_cnt++;
<font class='lnum'>5538</font>   
<font class='lnum'>5539</font>           my $shown_splinter_num = "(" . $splinter_cnt . ")" ;
<font class='lnum'>5540</font>   
<font class='lnum'>5541</font>           print_chunk_link($name_of_linked_chunk, $virtual_id, $created_clone_div_id, $shown_splinter_num);
<font class='lnum'>5542</font>   
<font class='lnum'>5543</font>       }
<font class='lnum'>5544</font>       else { # regular case: printing all splinters of a LINKED_CHUNK
<font class='lnum'>5545</font>           for (my $splinter_cnt=0;
<font class='lnum'>5546</font>                   exists $chunks_id_hash{$name_of_linked_chunk}[$splinter_cnt]; )
<font class='lnum'>5547</font>           {
<font class='lnum'>5548</font>   
<font class='lnum'>5549</font>           my $virtual_id = $chunks_id_hash{$name_of_linked_chunk}[$splinter_cnt++];   
<font class='lnum'>5550</font>           my $created_clone_div_id = "clonebody" . $clonebody_cnt;
<font class='lnum'>5551</font>           $clonebody_cnt++;
<font class='lnum'>5552</font>   
<font class='lnum'>5553</font>           my $shown_splinter_num = 
<font class='lnum'>5554</font>                   "(" . $splinter_cnt . ")" 
<font class='lnum'>5555</font>                           if $splinter_cnt &gt; 1;
<font class='lnum'>5556</font>   
<font class='lnum'>5557</font>           print_chunk_link($name_of_linked_chunk, $virtual_id, $created_clone_div_id, $shown_splinter_num);
<font class='lnum'>5558</font>   
<font class='lnum'>5559</font>   
<font class='lnum'>5560</font>           } # rof over chunk splinters
<font class='lnum'>5561</font>   
<font class='lnum'>5562</font>       } # fi-esle
<font class='lnum'>5563</font>       
<font class='lnum'>5564</font>   } # fi treatment of LINKED_CHUNKs
<font class='lnum'>5565</font>      
<font class='lnum'>5566</font>   </fieldset></pre>
</div><p>
This creates "flinks" functionality: a link of this kind points to a<br>
local ancor in the LitSource document ("#blabla"), and it will<br>
open all parents of a section/element, then jump right there.<br>
Browser "back" button to return to the location of previous <br>
reading works.<br>
<p>
One thing is this: while in the TOC I need to use "onmousedown" when<br>
I call "open_all_above" JS function, here I must use "onclick".<br>
Looks like a timing problem (?? not sure), and "onclick" seems to heal<br>
it.<br>
"Onclick" for the TOC func fails: it opens the parents on the first click,<br>
then jumps on the second one. The (exact?) opposite of behaviour of the <br>
"flink".<br>
<p>
<font class='lnum'>5582</font>   
                <div id=codechunk5582>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;elsif create FLINKs&gt;&gt<sub></sub>=</legend>
<font class='lnum'>5583</font>   
<font class='lnum'>5584</font>   elsif ($printed_line =~ m!^(.*)\[\[FLINK\s+(.*\S)\s*\]\](.*)$!) { # --FLINKS--
<font class='lnum'>5585</font>   
<font class='lnum'>5586</font>       print $1;
<font class='lnum'>5587</font>   
<font class='lnum'>5588</font>       unless ( exists $headings_id_hash{$2} ) {
<font class='lnum'>5589</font>       print "&lt;u&gt;&lt;font color=blue&gt;$2&lt;/font&gt;&lt;/u&gt;";
<font class='lnum'>5590</font>       print "&lt;font color=darkred&gt;&lt;sup&gt;&lt;b&gt;&lt;i&gt;broken_flink&lt;/i&gt;&lt;/b&gt;&lt;/sup&gt;&lt;/font&gt;&lt;br&gt;\n";
<font class='lnum'>5591</font>       next;
<font class='lnum'>5592</font>       }
<font class='lnum'>5593</font>   
<font class='lnum'>5594</font>       my $virtual_id_ancor = $headings_id_hash{$2};    # this works with sections
<font class='lnum'>5595</font>       my $virtual_id_ancor_href = "#" . $virtual_id_ancor; 
<font class='lnum'>5596</font>   print &lt;&lt;"end_of_clone_sect";
<font class='lnum'>5597</font>           &lt;a href="$virtual_id_ancor_href"
<font class='lnum'>5598</font>           onclick="open_all_above($virtual_id_ancor);" 
<font class='lnum'>5599</font>           &gt;&lt;i&gt;($virtual_id_ancor)&lt;/i&gt; $2&lt;sup&gt;flink&lt;/sup&gt;&lt;/a&gt;
<font class='lnum'>5600</font>   end_of_clone_sect
<font class='lnum'>5601</font>   
<font class='lnum'>5602</font>       print $3,"\n";
<font class='lnum'>5603</font>   
<font class='lnum'>5604</font>       # a DEBUG printout:
<font class='lnum'>5605</font>       #for (keys %headings_id_hash) {print "[$_] =&gt; $headings_id_hash{$_}&lt;br&gt;\n"}
<font class='lnum'>5606</font>       #&lt;br&gt;DEBUG: trying to clone [[$2]] whose id is [$virtual_id_ancor] 
<font class='lnum'>5607</font>       #OR [$headings_id_hash{$2}] and ancor is $virtual_id_ancor_href
<font class='lnum'>5608</font>   } # fisle - end of FLINKs
<font class='lnum'>5609</font>   
<font class='lnum'>5610</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('101');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('102');">
<font class='lnum'><i>(102)</i></font>&nbsp; Three chunks excluded from final printing</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 5615)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='102'></a></legend></fieldset>
<p>
<div id="102" style="display:none">   
<ul>

<p>
<p>
This is a working copy without splinter handling<br>
<p>
<font class='lnum'>5620</font>   
                <div id=codechunk5620>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;if LINKED_CHUNK, create clone-destructclone fieldset - dis - no splinters&gt;&gt<sub></sub>=</legend>
<font class='lnum'>5621</font>   
<font class='lnum'>5622</font>       if ($printed_line =~ m!^\s*\[\[LINKED_CHUNK\s+(.*\S)\s*\]\]\s*&lt;br&gt;$!) { # -- CHUNK LINKS --
<font class='lnum'>5623</font>   
<font class='lnum'>5624</font>           my $name_of_linked_chunk = $lt_esc . $lt_esc . $1 . $gt_esc . $gt_esc;
<font class='lnum'>5625</font>   
<font class='lnum'>5626</font>           my $virtual_id = $chunks_id_hash{$name_of_linked_chunk};   
<font class='lnum'>5627</font>           my $created_clone_div_id = "clonebody" . $clonebody_cnt;
<font class='lnum'>5628</font>           $clonebody_cnt++;
<font class='lnum'>5629</font>   
<font class='lnum'>5630</font>   print &lt;&lt;"end_of_clone_sect";
<font class='lnum'>5631</font>   
<font class='lnum'>5632</font>           &lt;fieldset&gt;
<font class='lnum'>5633</font>           &lt;legend&gt;
<font class='lnum'>5634</font>           &lt;font color=green&gt; $lt_esc$lt_esc$1$gt_esc$gt_esc &lt;/font&gt;
<font class='lnum'>5635</font>           &lt;/legend&gt;
<font class='lnum'>5636</font>           &lt;div align=left&gt;&lt;b&gt;&lt;i&gt;&lt;font size=-2 color=darkblue&gt;---- Linked Chunk ---- 
<font class='lnum'>5637</font>           &lt;a href="javascript:;"
<font class='lnum'>5638</font>           onmousedown="CreateVirtualNode('$virtual_id', '$created_clone_div_id');" id="virttoc14"
<font class='lnum'>5639</font>           &gt;[open] &lt;/a&gt;
<font class='lnum'>5640</font>           &lt;a href="javascript:;"
<font class='lnum'>5641</font>           onmousedown="DeleteVirtualNode('$created_clone_div_id');" id="virttoc15"
<font class='lnum'>5642</font>           &gt; [close]&lt;/a&gt;
<font class='lnum'>5643</font>            ----&lt;/i&gt;&lt;/b&gt;&lt;/font&gt;
<font class='lnum'>5644</font>           &lt;/div&gt;
<font class='lnum'>5645</font>           &lt;div id="$created_clone_div_id" name="virtual_clone"&gt;
<font class='lnum'>5646</font>           &lt;/div&gt;
<font class='lnum'>5647</font>           &lt;/fieldset&gt;
<font class='lnum'>5648</font>   
<font class='lnum'>5649</font>   end_of_clone_sect
<font class='lnum'>5650</font>   
<font class='lnum'>5651</font>           # a DEBUG printout:
<font class='lnum'>5652</font>           #for (keys %chunks_id_hash) {print "[$_] =&gt; $chunks_id_hash{$_}&lt;br&gt;\n"}
<font class='lnum'>5653</font>   
<font class='lnum'>5654</font>           #&lt;br&gt;DEBUG: trying to clone [[$1]] whose id is [$virtual_id] 
<font class='lnum'>5655</font>           #OR [$chunks_id_hash{$name_of_linked_chunk}]
<font class='lnum'>5656</font>   
<font class='lnum'>5657</font>       }
<font class='lnum'>5658</font>       
<font class='lnum'>5659</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>
<p>
I dislike the cludginess of cloned sections and so disabled them for now.<br>
There is no way to easily change all IDs inside, and so any cloned sect.<br>
conflicts with any link or subsection that is also present and open.<br>
Clicking to close X will close it somewhere else in the document etc.<br>
<p>
<font class='lnum'>5670</font>   
                <div id=codechunk5670>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;elsif LINKED_SECTION, create clone-destructclone fieldset&gt;&gt<sub></sub>=</legend>
<font class='lnum'>5671</font>   
<font class='lnum'>5672</font>   =head I DO NOT LIKE SECTION LINKS. DISABLED (at least for now)
<font class='lnum'>5673</font>   
<font class='lnum'>5674</font>       elsif ($printed_line =~ m!^\s*\[\[LINKED_SECTION\s+(.*\S)\s*\]\]\s*&lt;br&gt;$!) { # --SECTION LINKS--
<font class='lnum'>5675</font>   
<font class='lnum'>5676</font>           my $virtual_id = $headings_id_hash{$1};    # this works with sections
<font class='lnum'>5677</font>           my $created_clone_div_id = "clonebody" . $clonebody_cnt;
<font class='lnum'>5678</font>           $clonebody_cnt++;
<font class='lnum'>5679</font>   
<font class='lnum'>5680</font>   print &lt;&lt;"end_of_clone_sect";
<font class='lnum'>5681</font>           &lt;fieldset&gt;&lt;legend&gt;
<font class='lnum'>5682</font>           &lt;b&gt;&lt;i&gt;&lt;font color=darkblue&gt;Linked Section:&lt;/i&gt;&lt;/b&gt;&lt;/font&gt;
<font class='lnum'>5683</font>           &lt;font color=green&gt; $lt_esc$lt_esc$1$gt_esc$gt_esc &lt;/font&gt;&lt;/i&gt;&lt;br&gt;
<font class='lnum'>5684</font>           &lt;font size=-2&gt;
<font class='lnum'>5685</font>           &lt;a href="javascript:;"
<font class='lnum'>5686</font>           onmousedown="CreateVirtualNode('$virtual_id', '$created_clone_div_id');" id="virttoc14"
<font class='lnum'>5687</font>           &gt;[open] &lt;/a&gt;
<font class='lnum'>5688</font>           &lt;a href="javascript:;" 
<font class='lnum'>5689</font>           onmousedown="DeleteVirtualNode('$created_clone_div_id');" id="virttoc15"
<font class='lnum'>5690</font>           &gt; [close]&lt;/a&gt;
<font class='lnum'>5691</font>           &lt;/font&gt;&lt;/legend&gt;
<font class='lnum'>5692</font>           &lt;div id="$created_clone_div_id" name="virtual_clone"&gt;&lt;/div&gt;
<font class='lnum'>5693</font>           &lt;/fieldset&gt;
<font class='lnum'>5694</font>   end_of_clone_sect
<font class='lnum'>5695</font>   
<font class='lnum'>5696</font>           # a DEBUG printout:
<font class='lnum'>5697</font>           #for (keys %headings_id_hash) {print "[$_] =&gt; $headings_id_hash{$_}&lt;br&gt;\n"}
<font class='lnum'>5698</font>           #&lt;br&gt;DEBUG: trying to clone [[$1]] whose id is [$virtual_id] OR [$headings_id_hash{$1}]
<font class='lnum'>5699</font>   
<font class='lnum'>5700</font>       }
<font class='lnum'>5701</font>   
<font class='lnum'>5702</font>   =cut
<font class='lnum'>5703</font>   
<font class='lnum'>5704</font>   </fieldset></pre>
</div><p>
This is how it was before chunk links, section links  and flinks:<br>
<p>
<font class='lnum'>5708</font>   
                <div id=codechunk5708>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out - simple&gt;&gt<sub></sub>=</legend>
<font class='lnum'>5709</font>   
<font class='lnum'>5710</font>   # The FULL OUTPUT, the file body:
<font class='lnum'>5711</font>           print $chunkbuf;
<font class='lnum'>5712</font>   
<font class='lnum'>5713</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('102');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('100');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('88');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('103');">
<font class='lnum'><i>(103)</i></font>&nbsp; </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 5722)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='103'></a></legend></fieldset>
<p>
<div id="103" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('103');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('104');">
<font class='lnum'><i>(104)</i></font>&nbsp;(VIRTUAL VIEW): Creation of Linked Chunk functionality</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 5725)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='104'></a></legend></fieldset>
<p>
<div id="104" style="display:none">   
<ul>


<p>
<i> This is (VIRTUAL VIEW) - a Virtual View on the code with LINKED_CHUNKs</i><br>
<p>
<b> The idea is </b> to create a complete analogue of a "soft link" on a file system,<br>
for code chunks and/or for sections of the Literate Document.<br>
<p>
<b> Why? </b> - to help a programmer work according to the logic of his thinking.<br>
Supposing the skeleton of a program has been created, and the prog is being further<br>
developed/enhanced. It means not only appending more code somewhere at the end,<br>
but modifications of already existing code.<br>
<p>
Same for later maintenance and debugging.<br>
<p>
Therefore, I'd like to create a sort of "Virtual Views" on my code, in which<br>
all relevant code chunks are visible, but the text (my thoughts, notes, etc)<br>
is different from the text put around that code before.<br>
Starting on a task, I will collect all needed code chunks, and work from this<br>
"virtual view" on my code.<br>
<p>
In other words, I'd like to create a sort of analogue of a new directory<br>
with soft links to existing files. <br>
<p>
The linked code chunks are 'clones' of their originals, and I will use the line<br>
numbers to jump to the relevant places in my editor (in which I "edit locally").<br>
So in the weaved document I logically combine pieces of code from many places<br>
and create a consistent logical View on parts of my code, relevant to some task.<br>
<p>
<b>Actual Implementation </b> below shows how it may work.<br>
<p>
        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('105');">
<font class='lnum'><i>(105)</i></font>&nbsp; First ideas, todo lists </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 5756)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='105'></a></legend></fieldset>
<p>
<div id="105" style="display:none">   
<ul>

<p>
1. <s> Test creating a node copy dynamically, copying contents of an existing node. </s><br>
2. Test improved navigation: new links/ancors and "jumps" btw TOC and the place.<br>
/3/ .. and how &lt;div&gt;, and &lt;pre&gt;&lt;code&gt;... work with my existing folding.<br>
<p>
<b> general how to do it </b><br>
<p>
    (a) keep a hash of "section name =&gt; id number" for all section <br>
    headings and all code chunks. 2 hashes, 2 independent unique namespaces.<br>
<p>
    (b) invent a code word to parse on (e.g. VIRTUAL as the first word in a<br>
    sect name or a chunk name?)<br>
    <ul><br>
    <i> <b> LINKED_SECTION or LINKED_CHUNK then space char(s) and the verbatim<br>
    name of the cloned chunk or section -- all in double square brackets </b> </i><br>
    </ul><br>
<p>
    (c) add cloning JS funcs into "JS functions" subsect in the Weaver<br>
<p>
    (d) cut into  $chunkbuf the needed refs to the new "clone" and "destroy<br>
    clone" JS functions <i> plus </i> some colour styling (green?)<br>
    This can be done in the "process code chunks" and "process section <br>
    headings"<br>
<p>
    (e) do something (not sure yet) to make sure the Virtual stuff gets<br>
    into the TOC and is the local clicks are tied to the TOC colouring..<br>
<p>
<p>
<b> How to do Virtual Nodes, better defined </b><br>
<ul><li> (a) add hashes (name =&gt; id) for chunks, sections in pass 1 <br>
</li><li> (b) ignore "Virtual" links in pass 1<br>
</li><li> (c) do the subst while'ing over the $chunkbuf in printing<br>
</li></ul><br>
<p>
So, take example from tangler, while'ing over a string and regexp matching.<br>
Test with a relevant string. Add to weaver-printer.<br>
Then add hashes and test with real matches, rather than a token line.<br>
<p>
<b> OK, as a result of first tests </b><br>
<p>
(a) Sections are discouraged, generally. Chunks are encouraged.<br>
(b) sections they clone the whole thread, which can be read from the clone (this is OK);<br>
sections foul up opening-closing other sections bcs clones IDs are the same.<br>
(c) Same true for code chunks, but they do not open the whole hierarchies, so they<br>
do not conflict as easily.<br>
Being flat, one-level clones they can be assigned unique IDs by adjusting their<br>
attribute on cloning<br>
<p>
(d) Behaviour with rasHTML marked file not tested yet; seems to have problems (?)<br>
<p>
(e) many splinters of one-chunk - not solved yet.<br>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('105');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('106');">
<font class='lnum'><i>(106)</i></font>&nbsp; Actual implementation (with links to affected code sections </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 5812)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='106'></a></legend></fieldset>
<p>
<div id="106" style="display:none">   
<ul>

<p>
<b> 1. </b> All implementation changes are done belowe "WEAVER" section<br>
<p>
<b> 2. </b> Two functions, to clone a given ID under a "div" with a known ID,<br>
    and to destroy the cloned (actually, all children) under a "div"<br>
    with a know id, <br>
    were tested separately.<br>
<p>
Then, a cut-in chunk was created in<br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;JS script functions&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk4451', 'clonebody8');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody8');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody8">
    </div>
    </fieldset>

<p>
where the functions themselves live in the subsection below this one<br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;Javascript: node clone and destroy clone&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk5937', 'clonebody9');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody9');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody9">
    </div>
    </fieldset>

<p>
The functions were created from some scrib, and can actually be combined<br>
<p>
<b> <i> todo </i> </b> The "create" function needs an addition of a unique ID for the cloned<br>
section. Otherwise the cloned section preserves the same ID as another clone,<br>
or the original section. If those are open, closing a later clone will close<br>
the first ones. Which is bery untidy and not possible to fix cleanly.<br>
<p>
The problem is much less in case of LINKED_CHUNKs, as the original chunks<br>
are not collapsible and aren't affected. Similar cnflict is poss only btw<br>
2 clones, if those are opened at the same time.<br>
<p>
Assignement of a unique Id upon creation will fix it.<br>
<p>
<b> 3. </b> Next, a number of changes was required in the code where formation of the<br>
output $chunkbuf takes place.<br>
<p>
(a) for code chunk links, I had to add creation of unique IDs and collecting<br>
a hash of "chunk name =&gt; ID", to use later as arguments to the JS funcs.<br>
<p>
this lives in <br>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;process code chunks&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk4819', 'clonebody10');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody10');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody10">
    </div>
    </fieldset>


    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;process code chunks&gt;&gt; (2)
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk4856', 'clonebody11');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody11');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody11">
    </div>
    </fieldset>

<p>
I trew away the idea of assigning IDs to the "fieldset" elements themselves, <br>
and wrapped all code sections in "div" elements, which got the unique IDs,<br>
generated from word "codechunk" and the line number.<br>
<p>
Matching on a chunk def puts in the div, and a match on the end of code section<br>
closes it.<br>
<p>
<b> Same for LINKED_SECTIONs </b> - in here:<br>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;process section headings&gt;&gt; (1)
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk4923', 'clonebody12');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody12');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody12">
    </div>
    </fieldset>

<p>
<p>
<b> 4. </b>  Next, a place to cut the interpolation in is needed.<br>
The algorithm of my weaver constructs an output string $chunkbuf as it goes<br>
down a literate source file, with all necessary formatting and calls to JS<br>
folding funcs.<br>
<p>
So, I decided to combine a second pass with the next stage, that of printout<br>
of $chunkbuf. <br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;print out&gt;&gt; (7)
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk5399', 'clonebody13');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody13');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody13">
    </div>
    </fieldset>

<p>
Again, a cut-in was created and a simple print-out renamed and put out of the way. <br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;print out - simple&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk5708', 'clonebody14');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody14');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody14">
    </div>
    </fieldset>

<p>
(Actually, I can switch btw them on a configuration var, sth like "enable virtual<br>
linking", but let's keep this functionality always on for now.<br>
<p>
Instead of just dumping it, I now iterate line by line on this buffer string<br>
in memory with regular expressions<br>
<p>
<b> <s>Two</s> words are reserved now, and the format is: </b> <br>
/i.e. to put a link into your Literate Source, which will then be prettyprinted/<br>
  <pre>[[LINKED_CHUNK|LINKED SECTION, space(s),name of chunk/sectin verbatim]]</pre><br>
This must be on a line by itself, no other nonspace chars are allowed. Space before<br>
and after is ignored.<br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;print out - with virtual nodes&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk5405', 'clonebody15');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody15');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody15">
    </div>
    </fieldset>

<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;if LINKED_CHUNK, create clone-destructclone fieldset&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk5513', 'clonebody16');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody16');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody16">
    </div>
    </fieldset>

<p>
I actually decided LINKED_SECTIONs were not good and disabled the feature.<br>
The code is put aside in here:<br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;elsif LINKED_SECTION, create clone-destructclone fieldset&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk5670', 'clonebody17');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody17');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody17">
    </div>
    </fieldset>

<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;elsif create FLINKs&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk5582', 'clonebody18');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody18');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody18">
    </div>
    </fieldset>

<p>
<b> 5. Putting links in the Chunks Indes </b><br>
is below in its own subsection<br>
<p>
<b> 6. FOLDING_LINKs </b><br>
<p>
.. are the same as "LINKED_SECTION", they just refer to a different JS function<br>
<p>
<b> FLINKs </b><br>
Instead of section links, which open a fieldset frame in which a clone of the<br>
section is visible, I decided to offer the user FLINKS.<br>
They work exactly like hyperlinks on ancors in the same document. However<br>
simple links are not accessible if they are in folded sections. FLINKs will<br>
open a section and all parents above it, so it becomes visible, then jump<br>
to it as with a normal link.<br>
Browser's "back" button works and allows one to return to the previously<br>
browsed spot. Make sure to close the flinked sections after reading, or have<br>
your nicely folded document unnecessary unfolded.<br>
<p>
<b> format</b> in Lit Source file is <br>
  <pre>[[FLINK, space(s),name of flinked section verbatim]]</pre><br>
<p>
<i><b> --- to be finished --- </b></i><br>
<p>
<p>
<b> bugs and unfinished stuff </b><br>
<ul><li> <s> splinters of the same chunk</s><br>
</li><li> <s> unique ID for just cloned div</s><br>
</li><li> <s> add first line number for sections (none there), </s> <i>-- sections disabled</i><br>
and for chunks <i> not needed , as all other lines of a chunk are numbered anyway</i><br>
</li><li> <s>add chunk splinter numbering in non-links, in real chunks</s><br>
</li><li> <s>add links to the chunk index</s><br>
</li></ul> <br>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('106');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('107');">
<font class='lnum'><i>(107)</i></font>&nbsp;  Node Cloning/destruction - JavaScript functions </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 5934)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='107'></a></legend></fieldset>
<p>
<div id="107" style="display:none">   
<ul>

Two Javascript functions do provide node cloning and destroying:<br>
<p>
<font class='lnum'>5937</font>   
                <div id=codechunk5937>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;Javascript: node clone and destroy clone&gt;&gt<sub></sub>=</legend>
<font class='lnum'>5938</font>   
<font class='lnum'>5939</font>   // DELETING a CLONE -- this works too:
<font class='lnum'>5940</font>   function DeleteVirtualNode(someid) {
<font class='lnum'>5941</font>       
<font class='lnum'>5942</font>       elem = document.getElementById(someid);
<font class='lnum'>5943</font>   
<font class='lnum'>5944</font>       while (elem.childNodes.length &gt; 0) {
<font class='lnum'>5945</font>       elem.removeChild(elem.firstChild);
<font class='lnum'>5946</font>       }  
<font class='lnum'>5947</font>   }
<font class='lnum'>5948</font>   
<font class='lnum'>5949</font>   // CREATING a CLONE - this works
<font class='lnum'>5950</font>   /* for clean execution - run "delete" before any creation */
<font class='lnum'>5951</font>   function CreateVirtualNode(clone_from_id, append_to_id){
<font class='lnum'>5952</font>           DeleteVirtualNode(append_to_id);
<font class='lnum'>5953</font>   
<font class='lnum'>5954</font>       if ( document.getElementById(append_to_id).childNodes.length == 0 ) {
<font class='lnum'>5955</font>       var elem = document.createElement("div");
<font class='lnum'>5956</font>   
<font class='lnum'>5957</font>       elem = document.getElementById(clone_from_id).cloneNode(1);
<font class='lnum'>5958</font>       elem.style.display = 'block';
<font class='lnum'>5959</font>       document.getElementById(append_to_id).appendChild(elem); 
<font class='lnum'>5960</font>   
<font class='lnum'>5961</font>       } /* fi - do not create duplicates of the cloned node */ 
<font class='lnum'>5962</font>       
<font class='lnum'>5963</font>   }
<font class='lnum'>5964</font>   
<font class='lnum'>5965</font>   </fieldset></pre>
</div><p>
Then, using them from an html doc is like this:<br>
<p>
<font class='lnum'>5969</font>   
                <div id=codechunk5969>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;Node clone/destroy - test.html&gt;&gt<sub></sub>=</legend>
<font class='lnum'>5970</font>   
<font class='lnum'>5971</font>   </fieldset></pre>
</div><p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('107');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('108');">
<font class='lnum'><i>(108)</i></font>&nbsp; Numbering Chunk Splinters and Putting Links in the Chunks Index </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 5975)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='108'></a></legend></fieldset>
<p>
<div id="108" style="display:none">   
<ul>

<p>
(a) <b> links in chunks index </b><br>
the format of the string accumulated in @indbuf<br>
is simple, a string<br>
    "&lt;&lt;chunk name&gt;&gt; 34" or "&lt;&lt;chunk name&gt;&gt; 45&lt;sub&gt;def&lt;/sub&gt;"<br>
and can be glimpsed above in <br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;process code chunks&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk4819', 'clonebody19');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody19');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody19">
    </div>
    </fieldset>


    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;process code chunks&gt;&gt; (2)
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk4856', 'clonebody20');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody20');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody20">
    </div>
    </fieldset>

<p>
That string is later disassembled in <br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;print out&gt;&gt; (5)
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk5332', 'clonebody21');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody21');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody21">
    </div>
    </fieldset>

<p>
Pretty much I used a string which later will be split on a space<br>
in place of a 2-member list or other such structure to keep 2<br>
pieces of information, a chunk name and the section where it is used.<br>
<p>
SO: all I have to do is form and push into @indbuf a string<br>
    "&lt;&lt;chunk name&gt;&gt; 22&lt;sub&gt;link&lt;/sub&gt;"<br>
and, because linked chunks are inside doc section bodies, this<br>
parsing must be added here:<br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;body HTML formatters&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk5110', 'clonebody22');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody22');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody22">
    </div>
    </fieldset>

<p>
outside any "markup formatters". Var $section_num is set in headings<br>
processing and is available for me in the docsection body.<br>
<p>
<p>
(b) <b>Adding numbering to splinters</b> of the same chunk is done trivially in<br>
"process code chunks" linked above, using the length of the list in <br>
%chunks_id_hash as the splinter number.<br>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('108');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('109');">
<font class='lnum'><i>(109)</i></font>&nbsp; Tests of a chunk link, section link and flink functionality </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 6011)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='109'></a></legend></fieldset>
<p>
<div id="109" style="display:none">   
<ul>

<p>
<b> 1. Section links </b><br>
<p>
[[LINKED_SECTION ADD-ON: Virtual Nodes]]<br>
<p>
and another section<br>
<p>
[[LINKED_SECTION Node Cloning/destruction - JavaScript functions]]<br>
<p>
<b> <i> ...disabled now... </i> </b><br>
<p>
<b> 2 and these are code chunks </b>  not sections<br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;Makefile for split MOLLY-top and MOLLY-bottom&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk2424', 'clonebody23');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody23');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody23">
    </div>
    </fieldset>

<p>
.. and another one with 2 splinters<br>
<p>
    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;accumulate result in a buffer - with error&gt;&gt;<font color=darkred><sub><i>broken_link</i></sub></font>
    </legend>
    </fieldset>
<p>
<b> 3. ..and FLINKs</b><br>
<p>
standalone flinks on their own lines:<br>
        <a href="#107"
        onclick="open_all_above(107);" 
        ><i>(107)</i> Node Cloning/destruction - JavaScript functions<sup>flink</sup></a>
<br>
        <a href="#10"
        onclick="open_all_above(10);" 
        ><i>(10)</i> My workflow - literate programming with Molly<sup>flink</sup></a>
  <br>
<p>
2. multiple flinks on teh same line<br>
<p>
Before the test line ...........<br>
OK, two flinks:         <a href="#111"
        onclick="open_all_above(111);" 
        ><i>(111)</i> (VIRTUAL VIEW): example of additional markup - dotHTML<sup>flink</sup></a>
 and<br>
         <a href="#119"
        onclick="open_all_above(119);" 
        ><i>(119)</i> test two - from realistic paper, partially failing<sup>flink</sup></a>
 on two lines<br>
......... after which another line is coming<br>
<p>
Seems without "while-ing" over matches on the same line (or "for"-ing over the list)<br>
it's not going to work.<br>
So: enclosing text OK, but ONE FLINK PER LINE until I bother to make the match better.<br>
(see tangler test script for the idea)<br>
<p>
..more to jump around.. <u><font color=blue>process code chunks --with error</font></u><font color=darkred><sup><b><i>broken_flink</i></b></sup></font><br>
        <a href="#29"
        onclick="open_all_above(29);" 
        ><i>(29)</i> Mathematical Formulae - MathML inside Mollified Literate source files<sup>flink</sup></a>
<br>
<p>
/end of the tests/<br>
<p>
<b> testing and bugginess </b><br>
Seems there is a <b><i>timing issue </i></b> with Javascript etc.<br>
Some things may take place "onmousedown" others (link following) - "onclick" (I am<br>
guessing). <br>
Seems to help to push the mouse button, keep it pressed for a fraction of a second,<br>
then release, rather than click with one quick movement.<br>
<p>
There may be another effect at play here: when I run my "open_all_above" in the body<br>
of the text, it <i>jerks</i> when new section becomes visible. Therefore changing <br>
position of the cursor (still kept pressed).<br>
Therefore when o_a_a func is run "onmousedown" in the body, the subsequent jump to <br>
the link, which is run internally  "onclick" or sth, falls on another line and fails.<br>
<p>
But timing seems to get into this, too.<br>
<p>
Seems to run in Firefox smoothier than in Opera.<br>
Tests in Opera on MS look the same as tests on Opera under Linux.<br>
MS Explorer fails to work with folding sections, as it opens all up, except the target<br>
one - it runs into an "error by one" somewhere in sections numbering..<br>
<p>
<b><i> A solution may be </i></b> to use form submit() method insead of relying on built-in<br>
browser implementation?<br>
http://www.javascript-coder.com/javascript-form/javascript-form-submit-example.html<br>
etc. etc.<br>
<p>
Nope, it'll reload the page. I do not want to turn Molly into an interactive CGI script<br>
that works on the server side. Or do I ?<br>
<p>
IE-only "click()" method ;)))))<br>
<p>
<b> OK, conclusion </b><br>
Seems to work in Firefox. Fails in one case on Opera.<br>
Opera failure: opens the parents, does not jump. <b><i> A second click </i></b> will jump<br>
you to the already open section - so it's a very minor issue. A user will try a second<br>
time automatically.<br>
<p>
I will start using flinks and see how browsers behave. So status: good enough for now.<br>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('109');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('104');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('110');">
<font class='lnum'><i>(110)</i></font>&nbsp; </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 6096)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='110'></a></legend></fieldset>
<p>
<div id="110" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('110');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('111');">
<font class='lnum'><i>(111)</i></font>&nbsp; (VIRTUAL VIEW): example of additional markup - dotHTML</a>&nbsp;<font class='lnum' size=-1><sub><i>(line 6099)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='111'></a></legend></fieldset>
<p>
<div id="111" style="display:none">   
<ul>


<p>
<i> This is (VIRTUAL VIEW) - a Virtual View on the code with LINKED_CHUNKs</i><br>
<p>
<i> This subsection is a good example of the "out-of-order" processing that is<br>
enabled in Literate Programming. Pieces for this subsection come from different<br>
parts of the script and are laid out logically rather than in the order imposed<br>
by the machine </i><br>
<p>
<p>
<b> 1. the elsif clause </b>The default "rawHTML" formatter opened an "if" clause, <br>
matching on the configuration variable $weave_markup. <br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;body HTML formatters&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk5110', 'clonebody24');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody24');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody24">
    </div>
    </fieldset>

<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;rawHTML formatter&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk5157', 'clonebody25');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody25');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody25">
    </div>
    </fieldset>

<p>
All other formatters (and this is extensible, of course) can be added here to the chunk<br>
below, and the actual implementation (in its own subsection, the regex line-by-line <br>
filters/susbtitutions in the  doc chunk bodies, must be wrapped in the same two lines:<br>
<p>
<font class='lnum'>6121</font>   
                <div id=codechunk6121>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;my_new_markup - disabled - add to "other body formatters" below&gt;&gt<sub></sub>=</legend>
<font class='lnum'>6122</font>   
<font class='lnum'>6123</font>           elsif( $weave_markup eq "name_of_your_markup" ) { # comment
<font class='lnum'>6124</font>   
<font class='lnum'>6125</font>                   #...........your line-by-line transforming.
<font class='lnum'>6126</font>                   #..........or filtering expressions here
<font class='lnum'>6127</font>   
<font class='lnum'>6128</font>                   #$chunkbuf .= $_;
<font class='lnum'>6129</font>   
<font class='lnum'>6130</font>           } #fisle for name_of_your_markup
<font class='lnum'>6131</font>   
<font class='lnum'>6132</font>   </fieldset></pre>
</div><p>
This new markup of your of course must be added to the 'other body formatters' chunk.<br>
<p>
<p>
<b> The actual working example</b> below implements a "dotHTML" formatter (this very <br>
file is marked with it rather than the default HTML).<br>
<p>
This is  my own kind of simple markdown for quick typing.  <br>
<p>
<font class='lnum'>6142</font>   
                <div id=codechunk6142>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;other body formatters&gt;&gt<sub></sub>=</legend>
<font class='lnum'>6143</font>   
<font class='lnum'>6144</font>   <font class='chunkref'>&lt;&lt;dotHTML formatter&gt;&gt;</font>
<font class='lnum'>6145</font>           
<font class='lnum'>6146</font>   </fieldset></pre>
</div><p>
<p>
<b> 2. Adding a new markup language involves  two more obligatory changes. </b><br>
<p>
1. You'll have to mention name of your new markup as an option to the user (no new vars <br>
are necessary) in  the "mollifying template" in part II <b> "HOW TO USE MOLLY.pl" </b><br>
<p>

    <fieldset class='linked_chunk'>
    <legend class='linked_chunk_legend'>
    &lt;&lt;full MOLLY template&gt;&gt; 
    <font size=-2><i>
    <a href="javascript:;"
    onmousedown="CreateVirtualNode('codechunk776', 'clonebody26');"
    > [open] </a>
    <a href="javascript:;"
    onmousedown="DeleteVirtualNode('clonebody26');"
    > [close]</a></i></font>
    </legend>
    <div id="clonebody26">
    </div>
    </fieldset>

<p>
2. And you'll have to add that into the "template project file" distributed with MOLLY.pl,<br>
again  for other people to know and notice.<br>
<p>
3. You might also add that new possible value for the config var  at the top of this very <br>
LitSource document, although it has been marked in dotHTML already and is not <br>
going to reform ;)) . You might want it because this file serves as the central example<br>
itself, and so some people might copy the config section from here to start their <br>
own projects.<br>
<p>
<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('112');">
<font class='lnum'><i>(112)</i></font>&nbsp; dotHTML formatter </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 6167)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='112'></a></legend></fieldset>
<p>
<div id="112" style="display:none">   
<ul>


<p>
<b> <i> <u> Note: </u> </i> </b><br>
<ul><br>
Implementation of a simple "dotHTML" markup  in which angle brackets are substituted<br>
with dots for some of the commonest HTML tags (to speed up typing and eliminate typos).<br>
<p>
To add your own markup, such as "wiki" or one of the "markdowns", copy this section<br>
and adjust contents. The idea is that MOLLY iterates over documentation sections<br>
line by line, so your filter can use regular expressions for a line-by-line processing<br>
of the documentation chunk text.<br>
<p>
Make sure your new "markdown" does not interfere with the 3 major escapes used in <br>
the "mollified" Literate Source file: the double angle brackets and the "at" symbol<br>
(imposed by "noweb" tools markup) and the double backticks ( MathML interpretation<br>
if you enable it) plus words "a m a t h" and "e n d a m a t h" without spaces btw letters.<br>
</ul><br>
<p>
<b> <i> ...original implementation notes below.. </i> </b><br>
<p>
It is quite simple, and I add needed markup "on the fly", as and when I need it.<br>
The idea is to eliminate angle brackets in html tags, which I cannot type without errors<br>
when typing fast, and substitute those with simple "dots", which do not requre switching<br>
keyboard registers.<br>
<p>
<s> This formatting also has problems with escapes.<br>
<p>
Whether it's the fault of HTML standards or their implementation, web browsers continue to<br>
react to html formatting <b>even inside the "pre" tags</b>, which is obviously insane.<br>
Therefore if your code chunks contain any HTML tags (e.g. processed by your code), you'll<br>
need to escape them to display correctly.<br>
And if you use sth like "&amp; g t ;" in your code, the web page will also lie to you.<br>
This is insane, and there is no good quick solution, one would have to use lengthy escape<br>
tables etc. etc. </s><br>
<p>
<ul> /* OFFTOPIC, ALSO: add &lt; &gt; and &amp; escapes to the weaved code chunks -- for proper display */<br>
    --- DONE ---<br>
    These escapes exist in two places in the Weaver code:<br>
    "process code sections"  and "body HTML formatters"<br>
</ul><br>
<p>
<br><br>
This prototype script fails in some (unimportant to me)  cases.<br>
dotHTML markup would also fail if your programming language uses dot-symbol-dot sequences<br>
Mine do not.<br>
<p>
The formatter is pretty straightforward, but sequencing of regexps is important.<br>
One also needs to remember that once escaped, angle brackets are non-existent any more, <br>
and so the subsequent regexps must match on "&amp; l t ;" not on the angle bracket in some<br>
cases.<br>
<p>
<font class='lnum'>6219</font>   
                <div id=codechunk6219>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;dotHTML formatter&gt;&gt<sub></sub>=</legend>
<font class='lnum'>6220</font>   
<font class='lnum'>6221</font>           elsif( $weave_markup eq "dotHTML" ) {   # dotHTML formatter here
<font class='lnum'>6222</font>   
<font class='lnum'>6223</font>                 s/^=begin.*$//;   # - eliminate perl escaping, start
<font class='lnum'>6224</font>                 s/^=cut.*$//;             # - eliminate perl escaping, end
<font class='lnum'>6225</font>                 #s/^{{{\d+(.*)$/$1/;      # - eliminate vim folding markup, start 
<font class='lnum'>6226</font>                                           # - dummy, as it is killed in "headings" processing 
<font class='lnum'>6227</font>                 s/^}}}\d+//;      # - eliminate vim folding markup, end
<font class='lnum'>6228</font>   
<font class='lnum'>6229</font>                   s/&amp;/&amp;amp;/g;    # escape &amp;
<font class='lnum'>6230</font>                   s/&lt;/&amp;lt;/g;     # escape &lt;
<font class='lnum'>6231</font>                   s/&gt;/&amp;gt;/g;     # escape &gt;
<font class='lnum'>6232</font>   
<font class='lnum'>6233</font>   
<font class='lnum'>6234</font>                 # Paragraphs and line breaks are automatic now:
<font class='lnum'>6235</font>                 # ... unless we are dealing with the "preformat" tag
<font class='lnum'>6236</font>                   #--note! that ranges do not work here
<font class='lnum'>6237</font>                   $in_pre_tag = 1 if (m!\.pre\.!);
<font class='lnum'>6238</font>                   $in_pre_tag = 0 if (m!\./pre\.!);;
<font class='lnum'>6239</font>   
<font class='lnum'>6240</font>                   s/\.(\/?)pre\./&lt;$1pre&gt;/g;
<font class='lnum'>6241</font>   
<font class='lnum'>6242</font>               unless ($in_pre_tag) {
<font class='lnum'>6243</font>               (m/^\s*$/) and s/$_/&lt;p&gt;\n/
<font class='lnum'>6244</font>               or s/\n/&lt;br&gt;\n/;
<font class='lnum'>6245</font>               }
<font class='lnum'>6246</font>   </fieldset></pre>
</div><p>
Now the regexps to cut out "#--------" lines and substitute "dot-notation" with angle brackets:<br>
<p>
<font class='lnum'>6250</font>   
                <div id=codechunk6250>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;dotHTML formatter&gt;&gt<sub>2</sub>=</legend>
<font class='lnum'>6251</font>   
<font class='lnum'>6252</font>                 # originally I separated header from the body with such a line
<font class='lnum'>6253</font>                 #s/^#-----.*/starting the table here/;
<font class='lnum'>6254</font>                 s/^#-----.*//;
<font class='lnum'>6255</font>   
<font class='lnum'>6256</font>   
<font class='lnum'>6257</font>                   # add more here
<font class='lnum'>6258</font>   
<font class='lnum'>6259</font>                   s/\.(\/?)b\./&lt;$1b&gt;/g;
<font class='lnum'>6260</font>                   s/\.(\/?)i\./&lt;$1i&gt;/g;
<font class='lnum'>6261</font>                   s/\.(\/?)ul\./&lt;$1ul&gt;/g;
<font class='lnum'>6262</font>                   s/\.(\/?)li\./&lt;$1li&gt;/g;
<font class='lnum'>6263</font>                   s/\.(\/?)ol\./&lt;$1ol&gt;/g;
<font class='lnum'>6264</font>                   s/\.(\/?)s\./&lt;$1s&gt;/g;
<font class='lnum'>6265</font>                   s/\.(\/?)div\./&lt;$1div&gt;/g;
<font class='lnum'>6266</font>                   s/\.br\./&lt;br&gt;/g;
<font class='lnum'>6267</font>                   s/\.p\./&lt;p&gt;/g;
<font class='lnum'>6268</font>                   s/\.sp\./&amp;nbsp;/g;
<font class='lnum'>6269</font>   
<font class='lnum'>6270</font>                   s/\.(\/?)tab\./&lt;$1ul&gt;/g;        # "tabbing" with "ul"
<font class='lnum'>6271</font>   
<font class='lnum'>6272</font>   
<font class='lnum'>6273</font>                   # this is some bullshit ???
<font class='lnum'>6274</font>                   s/\.hr\./&lt;hr /g;
<font class='lnum'>6275</font>                   s/\.\/hr\./&gt;/g;
<font class='lnum'>6276</font>   
<font class='lnum'>6277</font>                   s!\.a\.(.+?)\.\/a\.!&lt;a href=$1&gt;$1&lt;/a&gt;!g;
<font class='lnum'>6278</font>   
<font class='lnum'>6279</font>                   # rudimentary &amp;nbsp; s p a c i n g &amp;nbsp (one word only)
<font class='lnum'>6280</font>                   #s!\.x\.(.+?)\./x\.!join " ","&amp;nbsp;&amp;nbsp;",(split //, $1),"&amp;nbsp;&amp;nbsp;"!eg;
<font class='lnum'>6281</font>   
<font class='lnum'>6282</font>                   # slightly better spacing (phrases, too):
<font class='lnum'>6283</font>                   # although redundant  with more work than is needed
<font class='lnum'>6284</font>                   if ( m!(\.x\.)(.+?)(\./x\.)!g) {
<font class='lnum'>6285</font>                       s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>6286</font>                       s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>6287</font>                       s!  _  ! &amp;nbsp; !g;
<font class='lnum'>6288</font>                   } 
<font class='lnum'>6289</font>   </fieldset></pre>
</div><p>
<b> BUG! </b> This URL breaks my "ancor" dot-tags: <br>
     <pre> http://www.cs.tufts.edu/~nr/noweb </pre><br>
<b> Got it </b> The substitutions above must explicitly use "slash" for the closing HTML tag<br>
in the regexps - otherwise they match stuff like ".cs." inside URLs<br>
<p>
If an HTML tag is not in the above chunk, either add it or write with the two following generic<br>
tags (slow and not nice on your fingers, though). You might need to use them also when your HTML<br>
tag conntains some options, and so is not of generic simple type.<br>
<p>
<font class='lnum'>6300</font>   
                <div id=codechunk6300>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;dotHTML formatter&gt;&gt<sub>3</sub>=</legend>
<font class='lnum'>6301</font>   
<font class='lnum'>6302</font>                   # generic for all tags with options
<font class='lnum'>6303</font>                   s!\.&amp;lt;\. !&lt;!g;
<font class='lnum'>6304</font>                   s! \.&amp;gt;\.!&gt;!g;
<font class='lnum'>6305</font>   
<font class='lnum'>6306</font>   
<font class='lnum'>6307</font>                   $chunkbuf .= $_;
<font class='lnum'>6308</font>   
<font class='lnum'>6309</font>           } # fisle - end of "dotHTML" body formatter
<font class='lnum'>6310</font>   
<font class='lnum'>6311</font>   </fieldset></pre>
</div><p>
<p>
        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('113');">
<font class='lnum'><i>(113)</i></font>&nbsp; test of &nbsp;&nbsp; s p a c i n g &nbsp;&nbsp; regexp </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 6314)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='113'></a></legend></fieldset>
<p>
<div id="113" style="display:none">   
<ul>

<p>
1. Hell, the thing is multiple sp /sp markups on one line. I need to iterate over<br>
each separately and then put them in their right places, hedging with "nbsp"-ces each word.<br>
<p>
2. The invocation is OK for $str_sp, but for boundaries of the string and word boundaries, <br>
they must be hedged too<br>
<p>
3. Could subst spaces-betwen-words to sth like _ (space-underscore-space) as placeholders,<br>
then subst them into nbspx2 in a following regexp<br>
<p>
4. This tagging can be done cleanly and span severl lines if I do it in a different place - <br>
not while still reading the Literate Source file line by line,  &nbsp;  b u t  &nbsp;  l a t e r  &nbsp;  when<br>
$chunkbuf is completely formed in RAM.<br>
<p>
<p>
<font class='lnum'>6330</font>   
                <div id=codechunk6330>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;spacing.pl&gt;&gt<sub></sub>=</legend>
<font class='lnum'>6331</font>   #!/usr/bin/perl
<font class='lnum'>6332</font>   #
<font class='lnum'>6333</font>   $str = $ARGV[0];
<font class='lnum'>6334</font>   $str_sp = $ARGV[0];
<font class='lnum'>6335</font>   #print "string is $str\n";
<font class='lnum'>6336</font>   
<font class='lnum'>6337</font>       # "sp" dot-markup to intersperse spaces: the basic formula
<font class='lnum'>6338</font>       #$spaced_str =~ s!(asdf)!join " ", (split //, $1)!eg;
<font class='lnum'>6339</font>       #
<font class='lnum'>6340</font>       
<font class='lnum'>6341</font>       # -- idea 3 from above: this works but is cumbersome --
<font class='lnum'>6342</font>       #$str_sp =~ s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>6343</font>       #$str_sp =~ s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>6344</font>       #$str_sp =~ s! _ ! &amp;nbsp;&amp;nbsp; !g;
<font class='lnum'>6345</font>   
<font class='lnum'>6346</font>       # -- first get the matching string in "if", then massage it:
<font class='lnum'>6347</font>       if ($str_sp =~ m!(\.x\.)(.+?)(\./x\.)!g) {
<font class='lnum'>6348</font>           $str_sp =~ s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>6349</font>           $str_sp =~ s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>6350</font>           $str_sp =~ s!  _  ! &amp;nbsp; !g;
<font class='lnum'>6351</font>       }
<font class='lnum'>6352</font>   
<font class='lnum'>6353</font>       #print "\nthe string is $str\n";
<font class='lnum'>6354</font>       print "\nthe str_sp is $str_sp\n\n";
<font class='lnum'>6355</font>   </fieldset></pre>
</div><p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('113');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('112');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('111');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('114');">
<font class='lnum'><i>(114)</i></font>&nbsp; </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 6363)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='114'></a></legend></fieldset>
<p>
<div id="114" style="display:none">   
<ul>

<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('114');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('115');">
<font class='lnum'><i>(115)</i></font>&nbsp; ASCIIMathML and LaTeXMathML inside Molly  </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 6366)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='115'></a></legend></fieldset>
<p>
<div id="115" style="display:none">   
<ul>


<p>
<b> 1 </b> <i> STATUS </i> - Ok, but may be brittle if escapes (double backticks)<br>
get in conflict with the target prog language or some "markdown" <br>
introduced later into Molly.<br>
<p>
Also - need to double-backtick LaTeX snippets now  because of my need to<br>
preserve $ for programming language use.<br>
<p>
<b> WILL NEED TO DISTRIBUTE THE MODIFIED LIBRARY NOW with Molly </b><br>
<p>
<b> 2  Implementation </b><br>
.. was straightforward: I simply cut in an invocation of ASCIIMathML.js into the header of <br>
my generated output folding-HTML file. That's it.<br>
<p>
Then I tested the lib and found that it reacts to backticks and $ signs in my code sections etc.<br>
Then I made a customized copy.<br>
<p>
If some symbols are missing, you can customize it by simply adding a line to teh MOLLY.weave<br>
source code and re-tangling the MOLLY.pl<br>
<p>
Here is how:<br>
<p>
        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('116');">
<font class='lnum'><i>(116)</i></font>&nbsp; Extending the lib with missing LaTeX or HTML symbols </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 6390)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='116'></a></legend></fieldset>
<p>
<div id="116" style="display:none">   
<ul>

<p>
Documentation to the library explains how to add lines in JavaScript to your html file which will<br>
extend the list of symbols known to the library.<br>
<a href= http://www1.chapman.edu/~jipsen/mathml/asciimathextend.html  > http://www1.chapman.edu/~jipsen/mathml/asciimathextend.html  </a><br>
A copy of the page:<br>
<ul><br>
<b>ASCIIMathML.js: Extending the symbol table</b><br>
<p>
The standard symbol table of ASCIIMathML.js does not contain many symbols. <br>
It can be extended by adding additional symbols on any webpage that requires<br>
them. This is done by adding a few lines of JavaScript code.<br>
<p>
<b> 1. For example </b> , suppose we want to add symbols for "not less or equal"<br>
    and "not greater or equal".<br>
<p>
<ul> <li> We first have to find the four-digit hexadecimal Unicode value for these symbols<br>
by looking them up at, say, <br>
<a href= http://www.w3.org/TR/MathML2/chapter6.html#chars.entity.tables > http://www.w3.org/TR/MathML2/chapter6.html#chars.entity.tables </a><br>
<p>
</li> <li> Next we have to decide what input strings we want to associate with these<br>
symbols, say "!&lt;=" and "!&gt;=".<br>
<p>
</li> <li> Finally we add the following lines to the head or body of our HTML file:<br>
<pre>
&lt;script type="text/javascript"&gt;
define("!&lt;=","\u2270")
define("!&gt;=","\u2271")
&lt;/script&gt;
</pre><br>
</li> </ul><br>
<p>
Here we test the modified symbol table: a !&lt;= b !&gt;= c produces ``a !&lt;= b !&gt;= c``<br>
<p>
<b> 2. To add a symbol to the LaTeX commands </b>, use the following alternate syntax:<br>
<p>
<pre>
&lt;script type="text/javascript"&gt;
newcommand("\\nle","\u2270")
newcommand("\\nge","\u2271")
&lt;/script&gt;
</pre><br>
<p>
Now \$a \nle b \nge c\$ produces $a \nle b \nge c$.<br>
<p>
<p>
<b> 3. If you know the numeric entity reference </b>  of the symbol you want <br>
to use on an ASCIIMathML webpage, you can also refer to the symbol <b> directly </b> <br>
by using that reference. <br>
<p>
E.g &amp;#x2270; produces  ``&amp;#x2270;`` . If a symbol is only used occasionally, this is certainly <br>
the simplest way to include it. <br>
</ul><br>
<p>
<i> /error/ My copy of the page in MOLLY does not let ampersand invocations through <br>
ALSO: my copy of the lib, in which I mechanically changed single backticks to double backticks<br>
may have clobbered something, too.<br>
CHECK IT. </i><br>
<p>
Therefore, <b> to extend it in MOLLY </b>, just continue this chunk here (the "script .." --- "/script"<br>
tags are already provided in the code, do NOT retype them, input only the contents):<br>
<p>
<font class='lnum'>6452</font>   
                <div id=codechunk6452>
    <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;HTML head section javascript add-ons&gt;&gt<sub></sub>=</legend>
<font class='lnum'>6453</font>   
<font class='lnum'>6454</font>   //type in commands to extend ASCIIMathML.js here;
<font class='lnum'>6455</font>   // no "script" "/script" wrappers needed
<font class='lnum'>6456</font>   // ....NOT FUNCTIONAL YET.....
<font class='lnum'>6457</font>   
<font class='lnum'>6458</font>   </fieldset></pre>
</div><p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('116');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('117');">
<font class='lnum'><i>(117)</i></font>&nbsp; Testing ASCIIMathML.js -- OK partially </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 6463)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='117'></a></legend></fieldset>
<p>
<div id="117" style="display:none">   
<ul>


<p>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('118');">
<font class='lnum'><i>(118)</i></font>&nbsp; test one - simple </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 6467)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='118'></a></legend></fieldset>
<p>
<div id="118" style="display:none">   
<ul>


<p>
Let's test if it works by adding some formulae here:<br>
<b> I changed the ASCIIMathML.js to use <i> double backticks </i> as escapes </b><br>
So strings wrapped in double-backticks or chunks of text with formulae inside<br>
"a m a t h" .... "e n d a m a t h" are the only ones that should be interpreted.<br>
<p>
NOTE: they appear in blue, so errors, if the math lib picks up other parts of <br>
your LitProg file unnecessarily and mangles them, one could see it with<br>
"expand all" and checking for blue insertions.<br>
<p>
NOTE 2: the math lib stops working between the "pre" - "/pre" tags<br>
<p>
NOTE 3: Rolling the mouse over the interpreted formula will display<br>
a baloon with the ascii coding of the expression (very convenient)<br>
<p>
<ul><br>
Let's try some interesting formulas: ``E=m c^2``<br>
and ``e^(i pi)=-1`` <br>
and ``AA x in CC (sin^2x+cos^2x=1)`` <br>
and one more: ``sum_(i=1)^n i^3=((n(n+1))/2)^2``<br>
<p>
(add your own -- note that text-tokens are only recognized if separated by spaces)<br>
</ul><br>
OK, here we are - in between 2 math sections<br>
<p>
<ul><br>
<p>
amath<br>
Example: Solving the quadratic equation.<br>
Suppose a x^2+b x+c=0 and a!=0. We first divide by \a to get x^2+b/a x+c/a=0. <br>
<p>
Then we complete the square and obtain x^2+b/a x+(b/(2a))^2-(b/(2a))^2+c/a=0. <br>
The first three terms factor to give (x+b/(2a))^2=(b^2)/(4a^2)-c/a.<br>
Now we take square roots on both sides and get x+b/(2a)=+-sqrt((b^2)/(4a^2)-c/a).<br>
<p>
Finally we move the b/(2a) to the right and simplify to get <br>
the two solutions: x_(1,2)=(-b+-sqrt(b^2-4a c))/(2a) <br>
endamath<br>
<p>
</ul><br>
<p>
..and now let's check some LaTeX constants:<br>
<ul><br>
<pre> \int &nbsp; \oint &nbsp; \partial &nbsp; \nabla </pre> <br>
``\int`` &nbsp; ``\oint`` &nbsp; ``\partial`` &nbsp; ``\nabla``<br>
<pre> \pm &nbsp; \emptyset &nbsp; \infty &nbsp; \aleph </pre><br>
``\pm`` &nbsp; ``\emptyset`` &nbsp; ``\infty`` &nbsp; ``\aleph`` <br>
<pre> |\ldots| &nbsp; |\cdots| </pre><br>
``|\ldots|`` &nbsp; ``|\cdots|`` <br>
<pre> |\ | &nbsp; |\quad| &nbsp; \diamond </pre><br>
&nbsp; ``|\ |`` &nbsp; ``|\quad|`` &nbsp; ``\diamond`` <br>
</ul> <br>
<p>
<i> <b> end of math test </b> </i><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('118');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

        <fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('119');">
<font class='lnum'><i>(119)</i></font>&nbsp; test two - from realistic paper, partially failing  </a>&nbsp;<font class='lnum' size=-1><sub><i>(line 6527)</i></sub></font> <font size=-2><i><a href='#tocancor'>toc</a></i></font><a name='119'></a></legend></fieldset>
<p>
<div id="119" style="display:none">   
<ul>


<p>
<hr width=30% align=left><br>
<p>
<b> ..MORE from some paper: </b><br>
<p>
<b> 1. Freudental Formula </b><br>
``mult(\xi)=\frac{2}{(\mu+\rho|\mu+\rho)-(\xi+\rho|\xi+\rho)}\sum_{\alpha\in\Delta^{+}} mult(\alpha) \sum_{k=1}^{\infty}mult(\xi+k\alpha)(\xi+k\alpha|\alpha)``<br>
It includes roots ``\Delta=\left\{k\delta+\alpha|k\in Z,\; \alpha\in \Delta_0\right\}``<br>
positive roots ``\Delta^{+}=\{k\delta+\alpha|k\geq 0,\; \alpha\in \Delta_0^{+}\}\cup \{k\delta+\alpha|k\geq 1,\; \alpha\in \Delta_0\setminus \Delta_0^{+}\}``<br>
<p>
<b> The above is rendered correctly by ASCIIMathML.js and LaTeXMathML.js </b> <br>
libraries from the standalone Editor.It is rendered correctly with <br>
ASCIIMathML_with_modified_escapes.js from Molly <br>
(Testing with LaTeXMathML.js requires wrapping the formulas in dollar signs)<br>
<p>
<p>
<b> 2. The following long formulas <i> fail on both </i> ASCII and LaTeX libraries </b> tested<br>
from the standalone Editor and ASCII_with_modified_escapes from Molly<br>
The number of incorrect renderings is small (1 or 2 elements left unrendered), and<br>
suggests those elemens are simply missing in definitions.<br>
<p>
<p>
 The idea is to use recurrent relations for anomalous branching<br>
coefficients based on the summation over the special set of vectors <br>
``\Gamma_{\fr ak{a}\subset \fr ak{g}}``  called ````fan''. We<br>
need to introduce some notations. Let's consider the reduction of the<br>
representation of the affine Lie algebra ``\math \fr ak{g}`` to <br>
representations of affine Lie algebra ``\math \fr ak{a}``. By<br>
``\pi_{\math \fr ak{a}}`` we denote the projection of the root space<br>
``\fr ak{h}_{\fr ak{g}}^{\ast } to \fr ak{h}_{\fr ak{a}}^{\ast }``. The<br>
set ``\Gamma_{\fr ak{a}\subset \fr ak{g}}``  is introduced as the<br>
combination of projection of positive roots ``\Delta^{+}`` of algebra<br>
``\fr ak{g}`` using formulae:<br>
<p>
<b> <i> The above paragraph is OK </i> </b><br>
The following is rendered incompletely:<br>
<p>
{eq:7}<br>
<p>
 ``\prod_{\alpha \in \left( \pi _{\fr ak{a}}\circ \Delta ^{+}\right) }\left( 1-e^{-\alpha }\right) ^{\mathrm{{mult}\left( \alpha \right) -{mult}}_{\fr ak{a% }}\mathrm{\left( \alpha \right) }}=-\sum_{\gamma \in \Phi _{\fr ak{a}\subset \fr ak{g}}}s\left( \gamma \right) e^{-\gamma }``.  <br>
<p>
 {{{5<br>
<p>
{eq:18}<br>
<p>
 `` \Phi _{\frak{a}\subset \frak{g}}=\left\{ \gamma \in P_{\frak{a}}\mid s\left( \gamma \right) \neq 0\right\} ``;  <br>
<p>
<p>
{eq:19}<br>
<p>
 `` \Gamma_{\frak{a}\subset \frak{g}}=\left\{ \xi -\gamma _{0}|\xi \in \Phi _{% \frak{a}\subset \frak{g}}\right\} \setminus \left\{ 0\right\} .`` <br>
<p>
<p>
{recurrent-relation}<br>
<p>
``  k_{\xi }^{\left( \mu \right) }=-\frac{1}{s\left( \gamma _{0}\right) }\left( \sum_{w\in W}\epsilon \left( w\right) \delta _{\xi ,\pi _{\frak{a}}\circ \left( w\circ (\mu +\rho )-\rho \right) +\gamma _{0}}+\sum_{\gamma \in \Gamma _{\frak{a}\subset \frak{g}}}s\left( \gamma +\gamma _{0}\right) k_{\xi +\gamma }^{\left( \mu \right) }\right)   <br>
``<br>
{{{5<br>
<p>
Fan doesn't depend on the module, but<br>
is determined by the injection of sub-algebra into the algebra. If <br>
sub-algebra is Cartan sub-algebra, this relation gives...<br>
<p>
<p>
<p>
<p>
<hr width=30% align=left><br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('119');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('117');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('115');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('45');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('1');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>


</td></tr></table></center></body></html>

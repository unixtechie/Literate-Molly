<html>  
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" /> 

<script language="javascript">


function toggleDiv(divid) {
var el = document.getElementById(divid);
el.style.display = (el.style.display == 'block') ? 'none' : 'block';
}


function toggleCombined(divid){
    if(document.getElementById(divid).style.display == 'none'){
      document.getElementById(divid).style.display = 'block';
	document.getElementById("toc"+divid).className="hilited";
    }
    else{
      document.getElementById(divid).style.display = 'none';
	document.getElementById("toc"+divid).className="unhilited";
    }
}


function showAll(){
for(i=1; i <= 10000; i++){
    document.getElementById(i).style.display = 'block';
    document.getElementById("toc"+i).className="hilited";
    };
}

function hideAll(){
for(i=1; i <= 10000; i++){
    document.getElementById(i).style.display = 'none';
    document.getElementById("toc"+i).className="unhilited";
    };
}

</script>
<style type="text/css" media="screen">


BODY {
	FONT-SIZE: 10pt;
	<!--FONT-FAMILY: sans-serif -->
	background: #f0f0f0;
	}
FIELDSET {
	BORDER-RIGHT: #000000 1px solid; 
	BORDER-TOP: #000000 1px solid; 
	BORDER-LEFT: #000000 1px solid; 
	BORDER-BOTTOM: #000000 1px solid; 
	PADDING-RIGHT: 5px; 
	PADDING-LEFT: 5px; 
	PADDING-BOTTOM: 2px; 
	PADDING-TOP: 5px;
	MARGIN-BOTTOM: 1px; 
	background: #f5f5f5; 
	color: #000000;
	}
LEGEND {
	BORDER-RIGHT: #a9a9a9 1px solid; 
	BORDER-BOTTOM: #a9a9a9 1px solid;
	BORDER-TOP: #a9a9a9 1px solid; 
	BORDER-LEFT: #a9a9a9 1px solid; 
	PADDING-RIGHT: 20px; 
	PADDING-LEFT: 20px; 
	PADDING-BOTTOM: 5px; 
	PADDING-TOP: 5px; 
	FONT-WEIGHT: bold;  
	BACKGROUND: #fdfdfd; 
	color: #000000;
	}
PRE	{
        PADDING-LEFT: 20px; 
        PADDING-RIGHT: 5px; 
        padding-top: 0px; 
        padding-bottom: 6px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
	background: #fefefe;
	}


.tocfieldset {
	background: #ffffff; 
	color: #000000;
	}

.codefieldset {
	BORDER-RIGHT: #000 1px solid; 
	BORDER-TOP: #000 1px solid; 
	BORDER-LEFT: #000 1px solid; 
	BORDER-BOTTOM: #000 1px solid; 
	background: #ffffff; 
	color: #000;
	MARGIN-BOTTOM: 1px; 
	PADDING-LEFT: 15px; 
	PADDING-RIGHT: 5px; 
	PADDING-BOTTOM: 10px; 
	PADDING-TOP: 1px;
	}
.codelegend {
	BORDER-RIGHT: #777 1px solid; 
	BORDER-TOP: #777 1px solid; 
	BORDER-LEFT: #777 1px solid; 
	BORDER-BOTTOM: #777 1px solid
	PADDING-RIGHT: 10px; 
	PADDING-LEFT: 10px; 
	PADDING-TOP: 2px; 
	PADDING-BOTTOM: 2px; 
	background: #ffffff; 
	color: #00b;
	FONT-WEIGHT: bold;  
	/font-variant: small-caps;
	/font-style: italic;
	}



.chunkref {
        color: #00b;	
        background: #f6f6f6;
        /font-style: italic;
        font-weight: bold;
        /font-variant: small-caps;
	}


.outertable {
	width: 99%; 
	cellpadding: 25; 
	background: #ffffff; 
	border: 1px solid;
	}

.hl	{
	 ;
        PADDING-LEFT: 5px; PADDING-RIGHT: 5px; 
        padding-top: 5px; padding-bottom: 5px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
        background: #f5f5f5;	
        width: 70%;
	}

.hl-wide {
	 ;
        PADDING-LEFT: 5px; 
        PADDING-RIGHT: 5px; 
        padding-top: 15px; 
        padding-bottom: 15px;
        MARGIN-BOTTOM: 1px; 
        BORDER-TOP: #a9a9a9 0px solid;
        BORDER-RIGHT: #a9a9a9 0px solid; 
        BORDER-LEFT: #a9a9a9 0px solid;
        BORDER-BOTTOM: #a9a9a9 0px solid;        
        background: #fbfbfb;	
	}

.lnum {

	color: #a0a0a0;
	/background: #fbfbfb;
	}

.unhilited {background-color:white}
.hilited {background-color:#c0c0ff}


</STYLE>

</head>
 <body>  <center><table class='outertable'><tr><td> 
<p><fieldset class='tocfieldset'><legend><b>TABLE OF CONTENTS: outline of the document structure</b></legend>

<ul>
<p>
<br>
<div class='hl' align=center>
<a href="javascript:;" onmousedown="toggleDiv('tochowto');">
<b>HOW TO USE THE FOLDING DOCUMENT [expand/collapse]</b></a>
</div>
<div id='tochowto' style='display:none' style='background:#ffffff'> 
<p>
<ul>
<li><b>Collapsing is necessary when</b> you work on some code and must exclude 
<br>irrelevant sections of the rest of the literate project file. This 
<br>greatly helps to clear thinking by eliminating a general feeling of 
<br>being in a maze of code and unnecessary "housekeeping" tasks.
<br>One can say that there is a limited "buffer capacity" in the human
<br>mind, and relieving it of the need to remember where things are in a 
<br>larger file, at which other points one must fill in values or adjust
<br>invocation etc. <i>immediately makes the user "more intelligent"</i>
</li><li><b>To toggle</b> a section open/closed, click on the corresponding link
<br>Remember to open <i>all sections above it</i> for it to become visible.
</li><li><b>To restore the default view</b> reload the page in the browser.
</li><li>
<b>To keep some sections open</b> upon each reload - 
<br>e.g. you work on the code, update it constantly and cannot reopen it 
<br>again and again - mark their sections in the source file with a plus, 
<br>i.e. write the opening tag (only)  as +h2, +h3 (in &lt; &gt;  or in dots
<br>for dotHTML). Again, all sections above must be marked open too. 
<p><b>Note that</b> "expand all" and "collapse all" disregard these settings.
<br>Reload the page after using those options to again view the text according 
<br>to your preferences.
</li><li>
<b> To use the Index </b>, click on the numbered sections in the TOC above
<br>(opening them; use highlighting as a guide; when sections are visible,
<br>the slider on your browser window  will shorten too), or "expand all", 
<br>and then use your browser's Find function to highlight all chunk name 
<br>instances in the visible text
</li><li>
<b>To search for variables etc.</b>, "expand all" text - or manually 
<br>expand needed sections - and then use your browser's Find function to 
<br>highlight all and jump between the found items.
<p></li>

</div> 
<p>
<br>
<p>
<div class='hl' align=center>
<!--i><font size=-3> expand all -- collapse all</font></i-->
<a href="javascript:;" onmousedown="toggleDiv('tocmain');">
<b>TABLE OF CONTENTS [expand/collapse]</b></a>
</div>

<div id='tocmain' style='display:block' style='background:#ffffff'> 
<p>
<br>
<p>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>1</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(1);" id="toc1"><b> MOLLY MODULE </a>&nbsp;<a><font class='lnum' size=-1><i>(line 38)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>2</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(2);" id="toc2"><b> ---- THE CHUNK TO TANGLE BY  DEFAULT ---- </a>&nbsp;<a><font class='lnum' size=-1><i>(line 75)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>3</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(3);" id="toc3"><b> History and concepts. "Management of thinking" </a>&nbsp;<a><font class='lnum' size=-1><i>(line 108)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>4</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(4);" id="toc4"><b> What is Literate Programming? </a>&nbsp;<a><font class='lnum' size=-1><i>(line 111)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>5</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(5);" id="toc5"><b> Controlling human attention </a>&nbsp;<a><font class='lnum' size=-1><i>(line 157)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>6</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(6);" id="toc6"><b> ---- HOW TO USE MOLLY.pl ---- </a>&nbsp;<a><font class='lnum' size=-1><i>(line 324)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>7</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(7);" id="toc7"><b> What is MOLLY.pl ? </a>&nbsp;<a><font class='lnum' size=-1><i>(line 328)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>8</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(8);" id="toc8"><b> My workflow - literate programming with Molly </a>&nbsp;<a><font class='lnum' size=-1><i>(line 348)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>9</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(9);" id="toc9"><b> SET UP a Literate Source file and project </a>&nbsp;<a><font class='lnum' size=-1><i>(line 400)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>10</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(10);" id="toc10"><b> Prerequisites: "noweb" tools By Norman Ramsey </a>&nbsp;<a><font class='lnum' size=-1><i>(line 406)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>11</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(11);" id="toc11"><b> Setting up the file </a>&nbsp;<a><font class='lnum' size=-1><i>(line 422)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>12</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(12);" id="toc12"><b> Markup of code and documentation sections </a>&nbsp;<a><font class='lnum' size=-1><i>(line 501)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>13</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(13);" id="toc13"><b> Tangling from LSFile </a>&nbsp;<a><font class='lnum' size=-1><i>(line 538)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>14</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(14);" id="toc14"><b> Sample minimal configuration of thttpd </a>&nbsp;<a><font class='lnum' size=-1><i>(line 569)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>15</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(15);" id="toc15"><b> "Mollification" - full template </a>&nbsp;<a><font class='lnum' size=-1><i>(line 636)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>16</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(16);" id="toc16"><b> CREATE a Literate Source file -- markup of documentation chunks </a>&nbsp;<a><font class='lnum' size=-1><i>(line 686)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>17</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(17);" id="toc17"><b> Markup </a>&nbsp;<a><font class='lnum' size=-1><i>(line 690)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>18</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(18);" id="toc18"><b> Markup and Escaping </a>&nbsp;<a><font class='lnum' size=-1><i>(line 752)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>19</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(19);" id="toc19"><b> READ and SEARCH inside a Folding Literate Source file </a>&nbsp;<a><font class='lnum' size=-1><i>(line 774)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>20</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(20);" id="toc20"><b> Opening many relevant subsections together, TOC highlighting </a>&nbsp;<a><font class='lnum' size=-1><i>(line 780)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>21</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(21);" id="toc21"><b> TOC and Code Chunks Index </a>&nbsp;<a><font class='lnum' size=-1><i>(line 796)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>22</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(22);" id="toc22"><b> Searching for symbols, chunks, phrases </a>&nbsp;<a><font class='lnum' size=-1><i>(line 820)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>23</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(23);" id="toc23"><b> Keeping some sections of the LSFile permanently open </a>&nbsp;<a><font class='lnum' size=-1><i>(line 836)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>24</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(24);" id="toc24"><b> TOC/Index unfolding and collapsing </a>&nbsp;<a><font class='lnum' size=-1><i>(line 891)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>25</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(25);" id="toc25"><b> Use for printing </a>&nbsp;<a><font class='lnum' size=-1><i>(line 900)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>26</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(26);" id="toc26"><b> Text browsers and JavaScript </a>&nbsp;<a><font class='lnum' size=-1><i>(line 915)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>27</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(27);" id="toc27"><b> SUGGESTED USES: Work with Folding LSFiles</a>&nbsp;<a><font class='lnum' size=-1><i>(line 933)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>28</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(28);" id="toc28"><b> scrap </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1026)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>29</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(29);" id="toc29"><b> ---- LITERATE SOURCE OF THE SCRIPT ---- </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1061)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>30</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(30);" id="toc30"><b> Bugs, status, changes </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1066)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>31</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(31);" id="toc31"><b> versions - changes </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1070)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>32</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(32);" id="toc32"><b>Todo -  current</a>&nbsp;<a><font class='lnum' size=-1><i>(line 1225)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>33</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(33);" id="toc33"><b>Done </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1282)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>34</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(34);" id="toc34"><b> PRELIMINARIES: The script layout and idea </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1345)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>35</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(35);" id="toc35"><b> MOLLY.pl - top of the script </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1423)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>36</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(36);" id="toc36"><b> general settings </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1446)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>37</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(37);" id="toc37"><b> main despatcher </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1551)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>38</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(38);" id="toc38"><b> With tanglediffs as an option </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1568)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>39</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(39);" id="toc39"><b> a skeleton script to test this snippet </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1601)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>40</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(40);" id="toc40"><b> With wavediff and tanglediff?? </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1666)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>41</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(41);" id="toc41"><b> "Main despatcher kludgy" - first version - no tanglediffs </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1769)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>42</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(42);" id="toc42"><b> Tangler </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1807)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>43</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(43);" id="toc43"><b> pass-through tangler </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1841)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>44</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(44);" id="toc44"><b> Built-in tangler </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1936)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>45</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(45);" id="toc45"><b> tangler around "tsort" and string expansion </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1941)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>46</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(46);" id="toc46"><b> Main tangler framework </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1947)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>47</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(47);" id="toc47"><b> Generalities </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1950)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>48</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(48);" id="toc48"><b> Main, outline </a>&nbsp;<a><font class='lnum' size=-1><i>(line 1995)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>49</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(49);" id="toc49"><b> Processing particular sections </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2114)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>50</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(50);" id="toc50"><b> Topological Sort </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2227)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>51</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(51);" id="toc51"><b> Strange var and hash key names plus string interpolation </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2311)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>52</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(52);" id="toc52"><b> Scrap pieces for tangler </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2395)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>53</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(53);" id="toc53"><b> 1. Use MD5 for chunk titles? </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2400)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>54</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(54);" id="toc54"><b> 2. ver 1 -- skeleton for tangling </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2444)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>55</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(55);" id="toc55"><b> 4. Another idea for tangling </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2568)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>56</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(56);" id="toc56"><b> 6. Lazy iteration over strings in a memory buf </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2594)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>57</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(57);" id="toc57"><b> Weaver </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2668)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>58</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(58);" id="toc58"><b> How formatting is done in the weaver </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2691)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>59</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(59);" id="toc59"><b> actual working test.html </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2727)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>60</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(60);" id="toc60"><b> changing text style - the basic JS recipy </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2859)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>61</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(61);" id="toc61"><b> Reference - Javascript and DOM </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2910)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>62</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(62);" id="toc62"><b> set formatting strings for weaver </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2926)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>63</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(63);" id="toc63"><b> JS functions </a>&nbsp;<a><font class='lnum' size=-1><i>(line 2994)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>64</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(64);" id="toc64"><b> Stylesheet </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3039)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>65</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(65);" id="toc65"><b> Accumulate the result </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3190)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>66</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(66);" id="toc66"><b> process code chunks </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3271)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>67</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(67);" id="toc67"><b> process section headings </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3326)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>68</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(68);" id="toc68"><b> dotHTML formatter and rawHTML </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3461)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>69</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(69);" id="toc69"><b> test of &nbsp;&nbsp; s p a c i n g &nbsp;&nbsp; regexp </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3633)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>70</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(70);" id="toc70"><b> Print out the resulting page </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3684)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>71</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(71);" id="toc71"><b> ADD-ON: Context diffs and sections editing </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3894)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>72</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(72);" id="toc72"><b> Outline of the idea </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3898)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>73</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(73);" id="toc73"><b> Editing - javascript versus external editor </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3930)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>74</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(74);" id="toc74"><b> Patch details and probs </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3951)</i></font></b></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>75</i>&nbsp;<a href="javascript:;" onmousedown="toggleCombined(75);" id="toc75"><b> Implementation steps </a>&nbsp;<a><font class='lnum' size=-1><i>(line 3987)</i></font></b></a><br>
</div>
<p>
<br>
<p>
<!--fieldset><legend-->
<div class='hl' align=center>
<a href="javascript:;" onmousedown="toggleDiv('indbuf');">
<b>INDEX of Code Chunks [expand/collapse]</b></a>
</div>
<!--/legend></fieldset-->
<p>
<div id='indbuf' style='display:none' style='background:#ffffff'> 
<ul>
<p>
<b>"Def" subscript</b> means the chunk is defined, while a bare number means 
<br>the chunk is being used in the given section.
<p>
<br>
<b>&lt;&lt;</b><font class='chunkref'>*</font><b>&gt;&gt;</b> -- <b> 2<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>*-dis</font><b>&gt;&gt;</b> -- <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b>  <b> 2<sub>def</sub></b>  <b> 42<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>Article</font><b>&gt;&gt;</b> -- <b> 4<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>Intro</font><b>&gt;&gt;</b> -- <b> 4</b>  <b> 4<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>JS script functions</font><b>&gt;&gt;</b> -- <b> 62</b>  <b> 63<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>MOLLY.pl module</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 35<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>a thousand-line-long piece of code</font><b>&gt;&gt;</b> -- <b> 5</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>accumulate result in a buffer</font><b>&gt;&gt;</b> -- <b> 57</b>  <b> 65<sub>def</sub></b>  <b> 65<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>another thousand-line-long piece of code</font><b>&gt;&gt;</b> -- <b> 5</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>body HTML formatters</font><b>&gt;&gt;</b> -- <b> 65</b>  <b> 68<sub>def</sub></b>  <b> 68<sub>def</sub></b>  <b> 68<sub>def</sub></b>  <b> 68<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>built-in tangler skeleton</font><b>&gt;&gt;</b> -- <b> 54<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>ch*nk n@me wh&amp;ch q(i$$ a p#r@se)</font><b>&gt;&gt;</b> -- <b> 51<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>check strings expansion</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 42</b>  <b> 48<sub>def</sub></b>  <b> 48<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>check topo sort</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 50<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>condition A</font><b>&gt;&gt;</b> -- <b> 5</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>first pass of tangling - accumulate in RAM</font><b>&gt;&gt;</b> -- <b> 54</b>  <b> 54<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>full MOLLY template</font><b>&gt;&gt;</b> -- <b> 15<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>general settings</font><b>&gt;&gt;</b> -- <b> 35</b>  <b> 36<sub>def</sub></b>  <b> 36<sub>def</sub></b>  <b> 36<sub>def</sub></b>  <b> 36<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>logical switch</font><b>&gt;&gt;</b> -- <b> 5<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher kludgy</font><b>&gt;&gt;</b> -- <b> 37</b>  <b> 41<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher with tanglediffs</font><b>&gt;&gt;</b> -- <b> 38<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>main despatcher</font><b>&gt;&gt;</b> -- <b> 35</b>  <b> 37<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>matchstring2.pl</font><b>&gt;&gt;</b> -- <b> 56<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>md5 hashing from perl</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 53<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>minimal MOLLY template</font><b>&gt;&gt;</b> -- <b> 11<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>minimal thttpd configuration</font><b>&gt;&gt;</b> -- <b> 14<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>opinions: public and officials' reactions</font><b>&gt;&gt;</b> -- <b> 4</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>print out</font><b>&gt;&gt;</b> -- <b> 57</b>  <b> 70<sub>def</sub></b>  <b> 70<sub>def</sub></b>  <b> 70<sub>def</sub></b>  <b> 70<sub>def</sub></b>  <b> 70<sub>def</sub></b>  <b> 70<sub>def</sub></b>  <b> 70<sub>def</sub></b>  <b> 70<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process chunk body - tangler</font><b>&gt;&gt;</b> -- <b> 48</b>  <b> 49<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process chunk ref - tangler - TWO</font><b>&gt;&gt;</b> -- <b> 49<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process chunk ref - tangler</font><b>&gt;&gt;</b> -- <b> 48</b>  <b> 49<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process chunk title - tangler -TWO</font><b>&gt;&gt;</b> -- <b> 49<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process chunk title - tangler</font><b>&gt;&gt;</b> -- <b> 48</b>  <b> 49<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process code chunks</font><b>&gt;&gt;</b> -- <b> 65</b>  <b> 66<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process end of code chunk - tangler - TWO</font><b>&gt;&gt;</b> -- <b> 49<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process end of code chunk - tangler</font><b>&gt;&gt;</b> -- <b> 48</b>  <b> 49<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>process section headings</font><b>&gt;&gt;</b> -- <b> 65</b>  <b> 67<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>run.thttpd.sh</font><b>&gt;&gt;</b> -- <b> 14<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>second pass of tangling - print out</font><b>&gt;&gt;</b> -- <b> 54</b>  <b> 54<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>set formatting strings for weaver</font><b>&gt;&gt;</b> -- <b> 57</b>  <b> 62<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>spacing.pl</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 69<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>stylesheet</font><b>&gt;&gt;</b> -- <b> 62</b>  <b> 64<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tangle me straight</font><b>&gt;&gt;</b> -- <b> 43<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tangle me with filtering</font><b>&gt;&gt;</b> -- <b> 43</b>  <b> 43<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tangle me</font><b>&gt;&gt;</b> -- <b> 35</b>  <b> 43<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tanglediff test 1</font><b>&gt;&gt;</b> -- <b> 39<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tanglediff.test2.pl</font><b>&gt;&gt;</b> -- <b> 2</b>  <b> 40<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>test names and deref</font><b>&gt;&gt;</b> -- <b> 51<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>test.html</font><b>&gt;&gt;</b> -- <b> 59<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>throw in some stats and end on a grand note</font><b>&gt;&gt;</b> -- <b> 4</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>tsort sub in perl</font><b>&gt;&gt;</b> -- <b> 48</b>  <b> 50</b>  <b> 50<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>weave me</font><b>&gt;&gt;</b> -- <b> 35</b>  <b> 57<sub>def</sub></b> <br>
<b>&lt;&lt;</b><font class='chunkref'>witness:  a personal side -- gist of story, splinter 2</font><b>&gt;&gt;</b> -- <b> 4</b> <br>
<b>&lt;&lt;</b><font class='chunkref'>witness: a personal side, splinter 1</font><b>&gt;&gt;</b> -- <b> 4</b> <br>
</div>
<p>
<br>
<p><div class='hl' align=center><i>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</i></div><p>
</ul></fieldset><p>
<br><p>

<p>
<center> <b> Licensing </b><br>
MOLLY is licensed under GNU Public License version 3. </center><br>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('1');">
<font class='lnum'><i>(1)</i></font>&nbsp; MOLLY MODULE </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 38)</i></sub></font></a></legend></fieldset>
<p>
<div id="1" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 1).className='hilited';
		    </script>   
<ul>


<p>
<b> What is it? </b><br>
<p>
<i> Answer A: </i> this is an attempt to combine Literate Programming (as practiced with "noweb"<br>
    tools by Norman Ramsey) and autogenerated document folding/outlining with Javascript<br>
    and HTML -- to escape scalability limitation of pure L.P. and enable a number of new<br>
    source file management techniques.<br>
<p>
<i> Answer B: </i> Technically, this is "MOLLY.pl", a MO-dule for LI-terate programming, a small<br>
perl script that implements a new type of "weaver" for Literate Programming, which:<br>
    <ul> <li> is HTML-based,<br>
    </li><li> can produce formatted documents automatically, as a CGI script, as well as in <br>
    a separate step, as a classical weaver and<br>
    </li> <li> creates <i>folding</i> documents</li> </ul><br>
<b>Why?</b><br>
    <ul><li> This greatly simplifies markup, ridding it of TeX entanglement and reducing it <br>
    to basic HTML tagging. No more "writing and debugging two programs in place of one". <br>
    </li><li> while folding, as already stated, allows the programmer to apply a number of<br>
    code management techiniques not possible before with flat Literate Programming source <br>
    files. </li></ul><br>
<p>
<p>
<b>Below</b> you will find <br>
(a) an explanation of the concepts involved <br>
(b) usage information and <br>
(c) the annotated literate source of the script<br>
<p>
<p>
<br><br>
If you are not familiar with concepts behind LIterate Programming, please read an introductory<br>
article, such as the one below or <a href= http://en.wikipedia.org/wiki/Literate_Programming > http://en.wikipedia.org/wiki/Literate_Programming </a><br>
<p>
<p>
<br><br>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('2');">
<font class='lnum'><i>(2)</i></font>&nbsp; ---- THE CHUNK TO TANGLE BY  DEFAULT ---- </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 75)</i></sub></font></a></legend></fieldset>
<p>
<div id="2" style="display:none">   
<ul>


<p>
<p>
<font class='lnum'>79</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*&gt;&gt;=</legend>
<font class='lnum'>80</font>   <font class='chunkref'>&lt;&lt;MOLLY.pl module&gt;&gt</font>;
<font class='lnum'>81</font>   </fieldset></pre>
<p>
<font class='lnum'>83</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>84</font>   <font class='chunkref'>&lt;&lt;spacing.pl&gt;&gt</font>;
<font class='lnum'>85</font>   </fieldset></pre>
<font class='lnum'>86</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>87</font>   <font class='chunkref'>&lt;&lt;tanglediff.test2.pl&gt;&gt</font>;
<font class='lnum'>88</font>   </fieldset></pre>
<p>
<font class='lnum'>90</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>91</font>   <font class='chunkref'>&lt;&lt;md5 hashing from perl&gt;&gt</font>;
<font class='lnum'>92</font>   </fieldset></pre>
<p>
<font class='lnum'>94</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>95</font>   <font class='chunkref'>&lt;&lt;check topo sort&gt;&gt</font>;
<font class='lnum'>96</font>   </fieldset></pre>
<p>
<p>
<font class='lnum'>99</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>100</font>   <font class='chunkref'>&lt;&lt;check strings expansion&gt;&gt</font>;
<font class='lnum'>101</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('2');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('3');">
<font class='lnum'><i>(3)</i></font>&nbsp; History and concepts. "Management of thinking" </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 108)</i></sub></font></a></legend></fieldset>
<p>
<div id="3" style="display:none">   
<ul>


<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('4');">
<font class='lnum'><i>(4)</i></font>&nbsp; What is Literate Programming? </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 111)</i></sub></font></a></legend></fieldset>
<p>
<div id="4" style="display:none">   
<ul>

<p>
<b> <i> This is a techinique for "management of thinking", which has nothing to do with programming. </i> </b><br>
<p>
Let's suppose you are an editor of some local newspaper which wants to kick up sales.<br>
So one day you get an email that says:<br>
<ul> 'Don't know if this is true or not, but I received it from a good friend, so... <br>
    you never know... <br>
    Just a small warning of the latest way criminals operate - very inventive!! <br>
    They dress in black &amp; cover themselves in black refuse bags and wait on the<br>
    pavement. When <s> SAPS </s> police or the neighbourhood watch drive pass they<br>
    crouch down on the ground to make it look like a full black rubbish bag. <s> SAPS </s><br>
    police etc ignore the "black bags" &amp; drive past. The criminals then either wait<br>
    for the home owner to come home ---to hijack them or proceed to break into the<br>
    house.<br>
    Please be aware &amp; beware of "moving" black bags!!! --particularly on rubbish<br>
    removal days.<br>
    PS: The neighbourhood watch member who noticed this wouldn't have known any<br>
    different if one of the bags hadn't moved &amp; if he wasn't vigilant.'<br>
    <i> /* this example of a real urban legend obtained via http://thoselegends.blogspot.com/<br>
    Entry of Thursday 30 October 2008 */ </i><br>
</ul><br>
You call a meeting and say to your stuff:<br>
"Guys,  &nbsp;   &nbsp;  t h i s  &nbsp;  e e e z  &nbsp;  a  &nbsp;  b o m b ! !  &nbsp; " - (and read them the e-mail) -  "Get down to it! <br>
You write your parts, I will edit the whole thing.  Let's see..."<br>
<p>
<font class='lnum'>137</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;Intro&gt;&gt;=</legend>
<font class='lnum'>138</font>   
<font class='lnum'>139</font>   
<font class='lnum'>140</font>   </fieldset></pre>
<p>
Then after collecting the materials  the editor produces a skeleton for the article.<br>
<p>
<font class='lnum'>144</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;Article&gt;&gt;=</legend>
<font class='lnum'>145</font>   <font class='chunkref'>&lt;&lt;Intro&gt;&gt</font>;
<font class='lnum'>146</font>   <font class='chunkref'>&lt;&lt;witness: a personal side, splinter 1&gt;&gt</font>;
<font class='lnum'>147</font>   <font class='chunkref'>&lt;&lt;opinions: public and officials' reactions&gt;&gt</font>;
<font class='lnum'>148</font>   <font class='chunkref'>&lt;&lt;witness:  a personal side -- gist of story, splinter 2&gt;&gt</font>;
<font class='lnum'>149</font>   <font class='chunkref'>&lt;&lt;throw in some stats and end on a grand note&gt;&gt</font>;
<font class='lnum'>150</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('4');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('5');">
<font class='lnum'><i>(5)</i></font>&nbsp; Controlling human attention </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 157)</i></sub></font></a></legend></fieldset>
<p>
<div id="5" style="display:none">   
<ul>

<p>
<p>
<br><br>
<b> LP as "management of thinking" </b> <br>
<p>
    <b> <i> L.P. is a technique for "management of thinking" that help to unload short-term memory<br>
    and "splits levels" for 'global thinking" and "local changing" </i> </b><br>
<p>
    The biggest problem in managing complex texts of any kind - programming simply being the most<br>
    complicated one, where the text is not supposed contain errors at all - is in holding it all<br>
    together in one's mind.<br>
<p>
    Human short-term memory is surprisingly tiny, up to 7 to 9 objects simultaneously at any one<br>
    time, psychologists tell us. Therefore, when faced with larger tasks, humans need to use a number<br>
    of "aoivdance techniques" to dance around the limitation.<br>
<p>
    First, we constantly switch. E.g. I need to change my program. I remember the general outline of<br>
    it (as no more than several largish chunks), so I use that to figure out where to go. On each<br>
    level I would probably remember details "inside" each of those largish blocks etc.<br>
<p>
    In my experience a script or a program longer than, say 1000 to 1200 lines long becomes a major<br>
    problem unless special techniques are used to help one's mind.<br>
<p>
    In programming, probably 90% of "chunking", i.e. division into procedures, or "object" or<br>
    "functions" are not needed for the machine. They are done <b> simply for the humans not<br>
    to lose thread. </b> Things would simply become totally unmanageable otherwise.<br>
<p>
    Here comes also the idea of "writing domain-specific languages": humans chunk lower-level<br>
    operations into a new 'unit' or 'abstraction', then manipulate with higher-level abstractions<br>
    over abstractions over abstractions over abstractions..<br>
<p>
    "Literate Programming" is not a programming-specific technique that allows us to create arbitrary<br>
    systems of abstractions <i> with phrases in a human language </i> - "in pseudocode" - while staying<br>
    precise in our specification opf the final product.<br>
    In this L.P. <b> is an alternative to procedures and subroutines in the machine language </b><br>
<p>
    For example, I can easily write and maintain na LPSource file with<br>
<p>
<font class='lnum'>196</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;logical switch&gt;&gt;=</legend>
<font class='lnum'>197</font>   if (<font class='chunkref'>&lt;&lt;condition A&gt;&gt</font>;) {
<font class='lnum'>198</font>       <font class='chunkref'>&lt;&lt;a thousand-line-long piece of code&gt;&gt</font>;}
<font class='lnum'>199</font>   else { 
<font class='lnum'>200</font>       <font class='chunkref'>&lt;&lt;another thousand-line-long piece of code&gt;&gt</font>;}
<font class='lnum'>201</font>   </fieldset></pre>
<p>
    (and specify all those references elsewhere), while such code written directly would be<br>
    unmaintainable and almost impossible to understand to a human. As a result, a human would<br>
    <i> have to </i> wrap his code into some subs, with inherent limitations and complications<br>
    on their parameters and return result, built into his programming language.<br>
    The machine would slow down its execution because internally it will maintain environment<br>
    to switch to when returning etc.<br>
    Isnt't it ironic that "hand-made optimisations" include "unrolling" programming constructs<br>
    programmers introduced on the first place? The reason most probably was that otherwise<br>
    a human mind would not be able to keep the thread, they would have lost it without that<br>
    unnecessary for the machine mental chunking.<br>
<p>
<p>
    So, <ul> <i> <b> Literate Programming is a system of free-form macros in a natural human language<br>
    used as an alternative to programming language procedures used as props to limit load on<br>
    human attention span, and totally unnecessary for machine language in themselves </b> </i> </ul><br>
<p>
<p>
<br><br>
<b> Three problems with L.P. -- unification of L.P. and folding </b><br>
<p>
    Donald Knuth first was thinking of how to document his code when he created a mish-mash of<br>
    previous attempts at similar management techniques with macros, which he called "WEB" (at<br>
    the time when no "www-web" existed yet).<br>
    Then he proclaimed this is the best way to write programs he knows, and repositioned it<br>
    as "a programming paradigm", in direct competition to the "structural programming",<br>
    introduced in the previous decade.<br>
<p>
    Acceptance of this new method of program writing however was disappointing. I believe, there<br>
    were and still are three factors at play, which hurt it, even though the name of L.P. creator<br>
    ensured L.P. never fell into complete obscurity.<br>
<p>
    <ul><br>
	<li> First, L.P. used TeX as a formatting tool, which is a sort of programming language in<br>
	itself. Therefore, the first thing to blame L.P. for became "but I'd need to write - <i> and <br>
	debug! </i> - two programs at the same time, in TeX and in my own machine language.<br>
<p>
	Today when much, much simpler markup languages abound - "html" or even "markdown html"<br>
	or even "wiki" for the majority of uses that do not require typesetting complicated<br>
	equations or graphs - this problem has long been solved.<br>
	You do not need to "debug" basic HTML markup - any error is displayed in your browser as a<br>
	distortion of the web page, I do not need to "debug" html when writing with my Molly script<br>
	which uses html markup.<br>
<p>
	</li> <li> Secondly, the first generation of L.P. tools was language-specific. You could <br>
	do Pascal, but not Fortran. Later "C" and "Fortran" literate tools were added, but you could<br>
	not do Lisp or Ada etc.<br>
<p>
	Today with tools like "noweb" by Norman Ramsey this problem has long been solved. Simplified<br>
	to its core idea Literate Programming is now totally language-independent to the degree that<br>
	you can write books or essays with L.P. tools not even knowing how to program for the computer.<br>
<p>
	</li> <li> And the third problem is the flat file structure of Literate Source files and<br>
	(probably that could be listed as the fourth, psychological stumbling block) the insistence<br>
	on "producing clean documentation" or "polished essays" of one's programs other could read<br>
	and enjoy.<br>
<p>
	Flat files continue to limit the size of the literate source files: your mind still <i> has to<br>
	keep internally the overall structure of your program </i> and switch from it to doing concrete<br>
	tasks.<br>
	Technically a Literate Source file can include <i> many </i> program files ( e.g. project.h,<br>
	project.c, a makefile and a README). In reality the size is limited by your "attention horizon"<br>
    </li> </ul><br>
<p>
    <b> I propose to solve </b> this last problem by combining L.P. with folding or outlining, using html and<br>
    javascript as the simplest and ubiquitous tools.<br>
<p>
    The Literate Source file is written in basic HTML, or even in "markdown" or "wiki"-style markup<br>
    notation. The script then automatically creates a document with folds at each heading line<br>
    (i.e. "h1", "h2", ...). The file can be "weaved" from command line or dynamically under a web <br>
    server as a CGI document.<br>
<p>
    Folding must allow opening an arbitrary number of sections from any place in the file to create<br>
    a sub-view of the document, a small document which is relevant to some particular sub-task.<br>
    These sub-views must persist for the time of this particular work, i.e. the user should not<br>
    be forced to reopen his subview over and over again.<br>
<p>
    Common practice in IDEs and outlining editors, when a programmer is allowed to see only one<br>
    section at a time is the death of the idea of folding.<br>
<p>
    <i> As an example of totally wrong presentation, </i> which  fragments perception into poorly<br>
    connected pieces and does not allow a reader to see the forest for the trees and see <br>
    documentation of GNU libavl <a href= http://adtinfo.org/libavl.html/ > http://adtinfo.org/libavl.html/ </a> <br>
    It is not humanly possible to follow the train of logic from such a presentation: one has to<br>
    keep an internal mental map of the document BEFORE reading it and inability to see more than<br>
    one snippet puts a stop to perception: once the snippet is left, one has to rely on memory of<br>
    previously read pieces to relate things to each other.<br>
    Nor the split HTML, not the flat file format provide for human-friendly perception of the code<br>
    if it is not a small self-contained piece.<br>
<p>
<p>
    <i> A document that is based on a structure of folding subsections </i> drastically increases one's<br>
    attention span, allows to manage easily thousands and thousands of lines of text, and makes<br>
    inclusion of many different types of files into what becomes one Literate Source Project file<br>
    "a cinch".<br>
<p>
    A number of techniques becomes possible which have not been possible before in a flat file. <br>
    Snippets testing language constructs, doubling certain "chunks" while keeping a pointer in a<br>
    "dummy chunk" to preserve the previous working version of your program while experimenting<br>
    with a new one (previously one would have to use version control or rename files for that), <br>
    making collections of loosely related documents and script, each still obtainable, such as<br>
    a collection of system administration policies, readmes, config files and many scripts -- all<br>
    become easy with a folding literate source file.<br>
<p>
    And consequently emphasis moves from the creation of usually comparatively compact programs<br>
    exposed as a sort of polished essays (or documented for their logic in the order of thinking)<br>
    -- and to using Literate Source folding files as your "work log" or "a log of thinking" when<br>
    developing a program, like a scientist might keep a log of his experiments.<br>
<p>
    Clean version of documentation or program presentation might emerge from it, later, but at the<br>
    moment of conception the most urgent task is to preserve your thinking, however "clever" or<br>
    "stupid" that might be.<br>
    It does become good documentation, it seems, even without further polishing, however.<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('5');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('3');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('6');">
<font class='lnum'><i>(6)</i></font>&nbsp; ---- HOW TO USE MOLLY.pl ---- </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 324)</i></sub></font></a></legend></fieldset>
<p>
<div id="6" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 6).className='hilited';
		    </script>   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('7');">
<font class='lnum'><i>(7)</i></font>&nbsp; What is MOLLY.pl ? </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 328)</i></sub></font></a></legend></fieldset>
<p>
<div id="7" style="display:none">   
<ul>


<p>
Traditionally literate programming tools include two major ones, one to "tangle" (i.e. create<br>
machine code from a Literate Source file), and another one to "weave" (formatted <br>
documentation from the same LSFile).<br>
The developer is supposed to run the tangler after each change to be able to re-run (or recompile)<br>
the code.<br>
<p>
This script is a "weaver", and a "pass-through" tangler for use with "noweb" tools by Norman Ramsey,<br>
(by default it passes tangling to the the "notangle" utility).<br>
<p>
Starting from some version it also includes a  simple built-in tangler.<br>
<p>
I called the script "Molly" because I think of it as a "MO-dule for LI-terate programming".<br>
<p>
<p>
<p>
<br><br>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('7');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('8');">
<font class='lnum'><i>(8)</i></font>&nbsp; My workflow - literate programming with Molly </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 348)</i></sub></font></a></legend></fieldset>
<p>
<div id="8" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 8).className='hilited';
		    </script>   
<ul>


<p>
 <img src=eeerotate.jpg align=right hspace=5 width=200 border=2><br>
<i> <b> A prerequisite of sorts </b><br>
Use a vertically rotated screen (with an external keyboard and mouse on<br>
a notebook) or a large  enough screen to see a vertically positioned A4<br>
sheet of paper to obtain full advantages of outlining and folding <br>
Psychologically, the more we see, the more "clever" we are. Stop reading<br>
compicated documents through a slit: with mental perception crippled, <br>
you'll just jump between fragments, and never truly "get" them in whole. </i> <b> &gt;&gt;&gt; </b><br>
<p>
Rotation on Linux is done by running <pre> xrandr -o right|left|normal </pre><br>
from an X terminal window. Most modern video cards support this.<br>
<p>
<b> The Workflow </b> :<br>
<ol><br>
    <li> I run a web server on localhost:8000, for myself only. My<br>
    development directory is under the web server - or is linked to<br>
    the web server document tree.<br>
<p>
    </li> <li> I write my Literate Source file in a vim editor. I mark up<br>
    the documentation section (i.e. not code) with most basic HTML tags<br>
    (e.g. &lt;h2&gt;, &lt;b&gt;, &lt;ul&gt; ...). <br>
    The code sections live between "&lt; &lt; section name &gt; &gt; =" and "@" <br>
    (in the first position in the line), as is required by "noweb"<br>
    literate programming tools.<br>
<p>
    </li> <li> I view my file in a web browser, and reload the page after editing updates.<br>
    Because I write my Literate Source with help from the MOLLY.pl script (see below how to <br>
    include it in the file and set it up), every "heading" in HTML (i.e.  h1,  h2  etc. )<br>
    automatically becomes a <b> folding subsection </b> of the document I see in the browser,<br>
    and every code section is automatically formatted with line numbers and a frame.<br>
<p>
    </li> <li> When I think ("globally"), I look at the formatted, immediately updating document<br>
    in the browser, keeping open only the sections relevant to my thinking.<br>
    When I edit, I refer to the line numbers, and avoid navigating "blindly" in the programming<br>
    editor, stressing my memory. I edit "locally".<br>
<p>
    </li> <li> Automatically created folding documents allow me a number of techniques and<br>
    uses impossible previously with flat "literate programming" files.<br>
<p>
    </li> <li> I tangle the created code either directly with "notangle" tools from "noweb", or<br>
    by running "MyProject.tangle", which is a link to "MyProject.weave", the Literate Source file<br>
    turned into a perl script by inclusion of the MOLLY.pl into it in the first lines of the file.<br>
</ol><br>
<p>
See details about this setup and possible uses of it below.<br>
<p>
<p>
<br><br>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('8');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('9');">
<font class='lnum'><i>(9)</i></font>&nbsp; SET UP a Literate Source file and project </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 400)</i></sub></font></a></legend></fieldset>
<p>
<div id="9" style="display:none">   
<ul>


<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('10');">
<font class='lnum'><i>(10)</i></font>&nbsp; Prerequisites: "noweb" tools By Norman Ramsey </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 406)</i></sub></font></a></legend></fieldset>
<p>
<div id="10" style="display:none">   
<ul>


<p>
    The first version of the script uses a "pass-through" tangler, i.e. delegates actual tangling to <br>
    the "notangle" utility from the "noweb" suite.<br>
<p>
    Please obtain and install it. <b> <i> Make sure the tangler is in your path </i> </b><br>
     <a href= http://www.cs.tufts.edu/~nr/noweb > http://www.cs.tufts.edu/~nr/noweb </a><br>
<p>
    Any version will do, e.g. the one based on shell and awk. I created the MOLLY script to work with<br>
    the overall markup of the "noweb" tools. It means your project file(s) can be directly processed<br>
    with "noweb" tools. MOLLY is just an alternative weaver which creates folding HTML documents <br>
    on the fly.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('10');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('11');">
<font class='lnum'><i>(11)</i></font>&nbsp; Setting up the file </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 422)</i></sub></font></a></legend></fieldset>
<p>
<div id="11" style="display:none">   
<ul>


<p>
<p>
    I aimed at simplifying and eliminating unnecessary steps, and wanted to automate some others.<br>
    Therefore practical work with MOLLY.pl looks like this:<br>
<p>
    <ol> <li> <b> <i> Your Literate Source file must be "mollified" </i> </b>, i.e. you have to add an invocation<br>
    of MOLLY.pl in the first lines of it. Think of it as a template. You will write your Literate Source text<br>
    right after these initial lines.  The minimal template is this:<br>
<p>
<font class='lnum'>433</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;minimal MOLLY template&gt;&gt;=</legend>
<font class='lnum'>434</font>       #!/full/path/to/perl
<font class='lnum'>435</font>       do /full/path/to/script/MOLLY.pl
<font class='lnum'>436</font>   
<font class='lnum'>437</font>       # delete first space in the next line
<font class='lnum'>438</font>       __DATA__
<font class='lnum'>439</font>   
<font class='lnum'>440</font>   
<font class='lnum'>441</font>       &lt;h1&gt; And here I start My Project &lt;/h1&gt;
<font class='lnum'>442</font>       Your Literate Source file can be typed here
<font class='lnum'>443</font>   
<font class='lnum'>444</font>       &lt;h2&gt; Subsection &lt;/h2&gt;
<font class='lnum'>445</font>       level 0-9 of subsections are allowed now.
<font class='lnum'>446</font>   
<font class='lnum'>447</font>       Each subsection will be automatically created as "folding". Javascript must be
<font class='lnum'>448</font>       enabled in your browser to use this functionality
<font class='lnum'>449</font>   </fieldset></pre>
<p>
    The perl invocaton and the "__DATA__"  line must start  &nbsp;   &nbsp;  a t  &nbsp;  t h e  &nbsp;  f i r s t  &nbsp;  p o s i t i o n  &nbsp; <br>
<p>
    You do not need any extra perl modules  as pre-requsites, the script uses core perl.  <br>
<p>
    Full template will also set configuration variables between calling the perl interpreter and<br>
    the inclusion of the MOLLY.pl script, which adjust its behaviour.<br>
<p>
    Save this under some name, e.g. MyProject.txt. This turns your Literate Source file into<br>
    a perl script<br>
<p>
    </li> <li> <b> <i> Make it executable. </i> </b> <br>
	<pre> chmod 755 MyProject.txt </pre><br>
<p>
    </li> <li>  <b> <i> The script behaves according to its name extension </i> </b><br>
    The script will produce HTML-formatted documentation, if its name ends with "weave" <br>
    (default - or whatever you selected when setting configuration variables in the "mollification"<br>
    template). Invoked under any different name (default) it will "tangle", i.e. create machine code.<br>
    So,  name or rename your LSFile "MyProject.weave" and link it to "MyProject.tangle" (or whatever):<br>
    <pre>
	mv MyProject.txt MyProject.weave
	ln -s MyProject.weave MyProject.tangle </pre><br>
<p>
    Now if you run MyProject.weave, it will dump HTML-formatted documentation of your work to STDOUT<br>
	<pre> ./MyProject.weave &gt; MyProject-formatted.foldingdocument.html </pre><br>
    It you run MyProject.tangle, it will dump machine code from your Literate Source file to STDOUT.<br>
	<pre> ./MyProject.tangle &gt; MyProject-runnable.script.pl </pre><br>
    ( Of course, tangling is independent of the language you program in )<br>
<p>
    For example, if you develop in perl, you can run the resulting script like this:<br>
	<pre> ./MyProject.tangle | perl [perl options here] - </pre><br>
<p>
    Additionally, as the markup is the same as that of "noweb" tools. one can use them directly<br>
    on the My.Project.weave file, with all of their flexibility and extra options.<br>
<p>
    However the idea was even to avoid running some of these commands after each change in<br>
    the file and to avoid saving the weaved docs: STDOUT can be picked up by your local web<br>
    server as CGI, and you will have an HTML-formatted and which is more important, <i> folding </i><br>
    document in your browser by simply reloading the page (usually with Ctrt+R or a mouse click)<br>
<p>
    </li> <li> Now, <b> <i>  the only other step  is to run a local web server </i> </b> <br>
    (on localhost, any tiny very simple httpd will do), and tell it to treat "*.weave" as valid cgi <br>
    file extension. (Alternatively, I can set "weaving" to files that end in '*.cgi" or "*.pl" etc. <br>
    in the configuration part of my MOLLY template)<br>
<p>
    One of the simplest WWW servers for such use could be "thttpd", and I will provide you with its<br>
    minimal configuration file below.<br>
    </li> </ol><br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('11');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('12');">
<font class='lnum'><i>(12)</i></font>&nbsp; Markup of code and documentation sections </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 501)</i></sub></font></a></legend></fieldset>
<p>
<div id="12" style="display:none">   
<ul>


<p>
First, <br>
    <ul> <li>  code sections begin with "&lt; &lt;name of the section&gt; &gt;="<br>
    in the first position in the line and end with "@"  in the first position<br>
<p>
    References to other code sections are done with "&lt; &lt;name of the ref sect&gt; &gt;"<br>
    inside the code sections<br>
<p>
    The rest is "documentation chunks" which must be marked up with some formatting tags.<br>
<p>
    </li> <li> <i> [ no spaces between the double angle brackets - I used spaces as escapes here ] </i><br>
<p>
    </li> <li> I do not insert examples here, as the file you are reading provides them ad nauseam.<br>
    </li> </ul><br>
<p>
    THIS IS THE BASIC MARKUP OF THE LITERATE SOURCE FILE, as used by the "noweb" tools.<br>
<p>
    Secondly, how do we format the documentation sections?<br>
    <ul> <li> In the simplest case, with straight HTML markup (default)<br>
<p>
    </li> <li> If a simple subsection is added to the MOLLY.pl script to process it, in any<br>
    markup lingo of your choice (e.g. "wiki") <br>
<p>
    Currently I provide a "dotHTML" formatting subsection as an example. It implements<br>
    a few of the most common HTML tags but with "dots" around them, in place of angle brackets <br>
    "&lt;" and "&gt;" (which is faster, as one does not need to switch register, so is less prone <br>
    to typos). See below for more detailed explanations<br>
    </li> </ul><br>
<p>
    <b> <i> The only difference </i> </b> from the truly "raw" HTML is that except in "pre" sections the MOLLY.pl script will <br>
    add automatic &lt;br&gt; tags at the end of each line of your Literate Source file.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('12');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('13');">
<font class='lnum'><i>(13)</i></font>&nbsp; Tangling from LSFile </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 538)</i></sub></font></a></legend></fieldset>
<p>
<div id="13" style="display:none">   
<ul>


<p>
    <ol> <li> Usually only one file needs to be tangled constantly, the file the developer<br>
    is working on.  It's easiest to do by using the "default root", which is a code chunk<br>
    called "*". When you run <br>
    <pre> MyProject.tangle &gt; source.pl </pre> <br>
    MOLLY will pass the command to "notangle" from Ramsey's "noweb" tools, and print code<br>
    chunks starting from the one named "*". Therefore, I drag along the default root to<br>
    wherever I am editing now and reassigning to it the chunk I need to tangle currently.<br>
    I usually keep the pointer subsection at the top of the Literate Source file. See <br>
    "THE CHUNK TO TANGLE BY DEFAULT" in the file you are reading as an example of this<br>
    technique.<br>
<p>
    This is the task for which MOLLY quick "pass-through tangling" is designed.<br>
<p>
    </li> <li> If, however, you need to tangle out non-"*" root, you might need to run<br>
    "notangle" directly on your MyProject.weave. This is the most flexible way.<br>
<p>
    </li> <li> If you need to tangle out many source files, then probably the easiest way<br>
    to arrange it is through many invocations of "notangle" in a makefile.<br>
    Include "Makefile" subsection into your Literate Source file and create a target that<br>
    combines several "notangle -R ... " commands in it.<br>
    Assing default root "*" to the Makefile, then run "MyProject.tangle &gt; Makefile" to create<br>
    it and next run "make targetname" to tangle (and compile, run etc) many files included<br>
    into your Literate Source project file.<br>
    </li> </ol><br>
<p>
<br><br>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('13');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('14');">
<font class='lnum'><i>(14)</i></font>&nbsp; Sample minimal configuration of thttpd </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 569)</i></sub></font></a></legend></fieldset>
<p>
<div id="14" style="display:none">   
<ul>


<p>
"THTTPD" home is <a href= http://www.acme.com/software/thttpd/ > http://www.acme.com/software/thttpd/ </a> <br>
<p>
From the distro README:<br>
<ul> thttpd is a simple, small, portable, fast, and secure HTTP server. <br>
<b> Simple: </b> It handles only the minimum necessary to implement HTTP/1.1. Well, maybe a <br>
little more than the minimum. <br>
<b> Small: </b>  See the comparison chart. It also has a very small run-time size, since it <br>
does not fork and is very careful about memory allocation. <br>
<b> Portable: </b>  It compiles cleanly on most any Unix-like OS, specifically including FreeBSD, <br>
SunOS 4, Solaris 2, BSD/OS, Linux, OSF. <br>
<b> Fast:  </b>  In typical use it's about as fast as the best full-featured servers (Apache, <br>
NCSA, Netscape). Under extreme load it's much faster. <br>
<b> Secure: </b>  It goes to great lengths to protect the web server machine against attacks and <br>
breakins from other sites. <br>
<p>
It also has one extremely useful feature (URL-traffic-based throttling) that no other server <br>
currently has. Plus, it supports IPv6 out of the box, no patching required.<br>
</ul><br>
<p>
Its compilation is very quick. Its configuration is simpler than that of Apache. <br>
<p>
Supposing I'd like to point my browser at "http://localhost:8000/path/to/MyProject.weave"<br>
Then the minimal configuration will look something like this:<br>
<p>
<p>
<font class='lnum'>597</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;minimal thttpd configuration&gt;&gt;=</legend>
<font class='lnum'>598</font>   #
<font class='lnum'>599</font>   host=localhost
<font class='lnum'>600</font>   port=8000
<font class='lnum'>601</font>   dir=/my/home/00trash/tmp/literate.perl/WORKDIR
<font class='lnum'>602</font>   data_dir=/my/home/00trash/tmp/literate.perl/WORKDIR
<font class='lnum'>603</font>   #chroot
<font class='lnum'>604</font>   
<font class='lnum'>605</font>   # extensions understood as valid "cgi" scripts:
<font class='lnum'>606</font>   #cgipat=/**.cgi|/**.weave|/**.pl
<font class='lnum'>607</font>   #cgipat=/**.tangle
<font class='lnum'>608</font>   cgipat=/**.weave
<font class='lnum'>609</font>   
<font class='lnum'>610</font>   #logfile=/my/home/00trash/tmp/literate.perl/WWW.server/thttpd.log
<font class='lnum'>611</font>   logfile=/dev/null
<font class='lnum'>612</font>   
<font class='lnum'>613</font>   #pidfile=./thttpd.pid
<font class='lnum'>614</font>   pidfile=/home/vedmed/00trash/tmp/literate.perl/WWW.server/thttpd.pid
<font class='lnum'>615</font>   
<font class='lnum'>616</font>   # uncomment this to be able to link from anywhere to your web server document dir 
<font class='lnum'>617</font>   # (unsecure, for local development only)
<font class='lnum'>618</font>   nosymlink
<font class='lnum'>619</font>   #
<font class='lnum'>620</font>   </fieldset></pre>
<b> NOTE </b> that "nosymlink" schizophrenically <i> allows </i> symbolic links in spite of what<br>
thttpd documentation tells you<br>
<p>
The script to start thttpd (it will detach and run as a daemon) is something like this:<br>
<p>
<font class='lnum'>626</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;run.thttpd.sh&gt;&gt;=</legend>
<font class='lnum'>627</font>   #!/bin/sh
<font class='lnum'>628</font>   PROJECT_ADMIN_DIR="/my/home/00trash/tmp/literate.perl/WWW.server";
<font class='lnum'>629</font>   #./thttpd -p 8000 -h localhost -C ./thttpd.config
<font class='lnum'>630</font>   #$PROJECT_ADMIN_DIR/thttpd -nos -C $PROJECT_ADMIN_DIR/thttpd.config
<font class='lnum'>631</font>   $PROJECT_ADMIN_DIR/thttpd -C $PROJECT_ADMIN_DIR/thttpd.config
<font class='lnum'>632</font>   </fieldset></pre>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('14');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('15');">
<font class='lnum'><i>(15)</i></font>&nbsp; "Mollification" - full template </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 636)</i></sub></font></a></legend></fieldset>
<p>
<div id="15" style="display:none">   
<ul>


Should be self-explanatory. May add to this section later.<br>
Uncomment to set, otherwise defaults apply.<br>
<p>
<font class='lnum'>641</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;full MOLLY template&gt;&gt;=</legend>
<font class='lnum'>642</font>   #!/usr/bin/perl
<font class='lnum'>643</font>   
<font class='lnum'>644</font>   # print TOC? 1:0
<font class='lnum'>645</font>   #$print_toc=1;	# default is to print
<font class='lnum'>646</font>   
<font class='lnum'>647</font>   # keep TOC expanded? "block":"none"
<font class='lnum'>648</font>   #$toc_expanded="block";	# default is to unfold
<font class='lnum'>649</font>   
<font class='lnum'>650</font>   # keep Chunks Index expanded? "block":"none"
<font class='lnum'>651</font>   #$ind_expanded="none";	# default is to keep folded
<font class='lnum'>652</font>   
<font class='lnum'>653</font>   # number lines in code sections? 1 : else
<font class='lnum'>654</font>   #$line_numbering = 1;	# default is to number
<font class='lnum'>655</font>   
<font class='lnum'>656</font>   # what is the file extention to weave it? (perms must allow execution!)
<font class='lnum'>657</font>   # e.g. "scriptname.weave" or "scriptname.cgi" etc.
<font class='lnum'>658</font>   #$weave_extension = "weave";	# default is "weave"
<font class='lnum'>659</font>   
<font class='lnum'>660</font>   # what is the file extention to tangle it? (perms must allow execution!)
<font class='lnum'>661</font>   # e.g. "scriptname.tangle",  "scriptname.pl" etc.
<font class='lnum'>662</font>   #$tangle_extension = "tangle";	# default is "tangle"
<font class='lnum'>663</font>   
<font class='lnum'>664</font>   
<font class='lnum'>665</font>   # how are doc sections marked? "dotHTML":"rawHTML"
<font class='lnum'>666</font>   # $weave_markup = "rawHTML"; # default is "rawHTML"
<font class='lnum'>667</font>   
<font class='lnum'>668</font>   
<font class='lnum'>669</font>   # old name of the module
<font class='lnum'>670</font>   #do "LPM-0.53.ffpl" ;
<font class='lnum'>671</font>   
<font class='lnum'>672</font>   do "MOLLY.pl";
<font class='lnum'>673</font>   exit;
<font class='lnum'>674</font>   
<font class='lnum'>675</font>   # delete the space before the __DATA__ marker
<font class='lnum'>676</font>    __DATA__
<font class='lnum'>677</font>   #---------------start of script-------------
<font class='lnum'>678</font>   
<font class='lnum'>679</font>   </fieldset></pre>
<p>
<b> "__DATA__" must start at the first position in its line </b><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('15');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('9');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('16');">
<font class='lnum'><i>(16)</i></font>&nbsp; CREATE a Literate Source file -- markup of documentation chunks </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 686)</i></sub></font></a></legend></fieldset>
<p>
<div id="16" style="display:none">   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('17');">
<font class='lnum'><i>(17)</i></font>&nbsp; Markup </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 690)</i></sub></font></a></legend></fieldset>
<p>
<div id="17" style="display:none">   
<ul>


<p>
<ol> <li> The default is to use ordinary 'html' markup in the document sections<br>
The only difference from "true raw" HTML is that MOLLY adds automatic <br>
&lt;br&gt; linebreaks unless lines are inside the &lt;pre&gt;..&lt;/pre&gt; sections<br>
The script also cuts out vim folding marks -- { { { number ... } } } number<br>
-- without spaces  and "#------------" lines.<br>
<p>
<p>
</li> <li> Any "markdown" or "wiki"-style markup can be added to MOLLY. Another reasonable<br>
suggestion could be a simple translator from basic TeX markup etc.<br>
Some of this functionality is unnecessary to reimplement, as "noweb" or third-party <br>
filters can be run on the document after MOLLY weaving or from inside MOLLY.<br>
<p>
</li> <li> As an example of a simple markup which can be done with regular expressions<br>
I added  "dotHTML", which is several most basic HTML tags inside "dots" instead<br>
of angle brackets.<br>
<p>
Dots do not require switcing the keyboard register, and therefore I can speed up<br>
typing and avoid annoying repeating typos.<br>
<p>
Please see the "dotHTML" subsection below where the source of MOLLY is listed.<br>
<p>
Currently implemented tags are (write them inside "dots", not "&lt;..&gt;"):<br>
<ul> &lt;br&gt; &lt;p&gt; <br>
&lt;s&gt; - &lt;/s&gt;<br>
&lt;pre&gt; - ..<br>
&lt;b&gt; - &lt;/b&gt;<br>
&lt;i&gt; - ..<br>
&lt;ul&gt; - ..<br>
&lt;ol&gt; - ..<br>
&lt;li&gt; - ..<br>
<p>
Special marks are dot-&lt;-dot and dot-&gt;-dot (no dashes, like ". &lt; ." <br>
without spaces) which are needed if the tag includes some options or<br>
is not among the tags "dotHTML" understands already.<br>
These will be converted to single &lt; and &gt; respectively.<br>
This is clumsy, but for quick sample and to speed up typing I found<br>
it sufficient. So far.<br>
<p>
<p>
And there are two special, non-HTML marks I introduced for convenience.<br>
(a) dot-x-dot ... dot-/x-dot <i>on one line only </i> will  &nbsp;   &nbsp;  f o r m a t  &nbsp;  t h e  &nbsp;  p h r a s e  &nbsp;  as spaced<br>
(b) dot-a-dot http://some/URL dot-/a-dot will create a hyperlink <a href= http://some/URL > http://some/URL </a> <br>
<p>
</ul><br>
<p>
etc. I add them as I go, whenever I need them for my current document.<br>
<p>
This formatting also adds &lt;br&gt; linebreaks unless lines are inside the <br>
&lt;pre&gt;..&lt;/pre&gt; sections.<br>
"dotHTML" also cuts out vim folding marks <br>
<pre> { { { number ... } } } number </pre><br>
without spaces, and  comment lines with dashes<br>
<pre> "#------------" </pre><br>
<p>
<p>
</li> </ol><br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('17');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('18');">
<font class='lnum'><i>(18)</i></font>&nbsp; Markup and Escaping </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 752)</i></sub></font></a></legend></fieldset>
<p>
<div id="18" style="display:none">   
<ul>


<p>
As clumsiness in inserting "dot-tags" in the previous subsection proves, a problem of <br>
escaping exists with any markup languages.<br>
<p>
This is not resolved cleanly by MOLLY (at least for now).<br>
In particular, a difficulty exists with double angle brackets (&lt; &lt; ... &gt; &gt;) which make "notangle"<br>
stumble, wherever in the document it finds them. As a result, I usually use "spaces" to break<br>
the bad symbols. For example, this document is written in "dotHTML" notation (not "rawHTML"), so<br>
in explanations I could write the escaped dot-tags as ". b . asdasf . /b ."<br>
<p>
Another side of the same problem is that browsers <i> do </i> interpret HTML tags even inside the<br>
&lt;pre&gt;...&lt;/pre&gt; (which is insane). Therefore if your code processes some HTML (e.g. in regular <br>
expressions), the formatted document in your browser may substitute/spoil the code.<br>
I solved this problem only in part for now.<br>
<p>
Clean escaping in MOLLY still needs work.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('18');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('16');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('19');">
<font class='lnum'><i>(19)</i></font>&nbsp; READ and SEARCH inside a Folding Literate Source file </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 774)</i></sub></font></a></legend></fieldset>
<p>
<div id="19" style="display:none">   
<ul>


<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('20');">
<font class='lnum'><i>(20)</i></font>&nbsp; Opening many relevant subsections together, TOC highlighting </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 780)</i></sub></font></a></legend></fieldset>
<p>
<div id="20" style="display:none">   
<ul>


<p>
One advantage of the folding format is that - in contrast to most other tools - it allows<br>
    the programmer to open <i> many </i> relevant sections from any parts of the file <i> at the <br>
    same time </i><br>
<p>
    This can be done by "walking" the Literate Source file, as its sections and subsections are a <br>
    kind of TOC of themselves.<br>
    This can be done from the TOC section as well. The open sections get a highlighted background,<br>
    and highlighting appears irrespective of whether the section was opened from the TOC or in the<br>
    body of the text.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('20');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('21');">
<font class='lnum'><i>(21)</i></font>&nbsp; TOC and Code Chunks Index </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 796)</i></sub></font></a></legend></fieldset>
<p>
<div id="21" style="display:none">   
<ul>


<p>
Traditional literate programming tools create extensive indeces of variables and code chunks.<br>
<p>
    The approach in this script is as follows:<br>
<p>
    Index of all code chunks in your LSFile exists (unless a configuration opton in the <br>
    template tells MOLLY to skip it) right under TOC. Click on teh line to expand it, and then use<br>
    TOC section numbers to click open the sections which contain or define the chunks you need.<br>
<p>
    Remember that <i> all parent sections </i> above the needed one must be open for you to see <br>
    the innermost subsection in your browser. This is easy to control through TOC highlighting, and<br>
    as an additional indicator, the slider on your web browser will visibly jerk and shorten when <br>
    new sections will become visible in the browser window.<br>
<p>
    It's also convenient to keep some inner subsections open, but click closed the topmost section to<br>
    quickly hide and unhide larger pieces of code (e.g.complete files which live inside the Literate<br>
    Source File when it is used as a common Project file for many source files, test files, makefile(s)<br>
    etc.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('21');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('22');">
<font class='lnum'><i>(22)</i></font>&nbsp; Searching for symbols, chunks, phrases </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 820)</i></sub></font></a></legend></fieldset>
<p>
<div id="22" style="display:none">   
<ul>


<p>
Web browsers "search" functions  will work on open sections only, at least that's the behaviour of<br>
    Opera and Mozilla browsers.<br>
    This means that instead of creating exhaustive indeces of symbols, which clutter program text, <br>
    especially when they display as HTML links in the output of Weaver tools, one can ensure only the<br>
    interesting subsections are open and then search using the built-in browser function. It usually<br>
    highlights the results and iterates over the found items, which is a nice behaviour.<br>
<p>
    To search in the whole of the LSFile, simply click on the "expand all" under any of the subsections,<br>
    and then again use the browser search function.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('22');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('23');">
<font class='lnum'><i>(23)</i></font>&nbsp; Keeping some sections of the LSFile permanently open </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 836)</i></sub></font></a></legend></fieldset>
<p>
<div id="23" style="display:none">   
<ul>


<p>
The behaviour of folding sections in the mollified LSFile is as follows:<br>
    <ul> <li> If you click on the <b> "expand all" </b> link anywhere in the document, all folding <br>
    sections in the body (not TOC/Index) will open. The limitation is 10000 objects per document,<br>
    hardcoded.<br>
    </li> <li> If you click on <b> "collapse all" </b>, all folding sections in the body will fold. <br>
    The limit is 10k objects per document<br>
    </li> <li> If you <b> reload the document </b> in your browser ("Ctrl-R" or an icon click), the<br>
    document will be shown with sections open or closed <b> as marked </b> in the document itself.<br>
    </li> </ul><br>
<p>
    The markup is simple: if you'd like a section to stay open upon load/reload,  add a "+" before<br>
    "h" in the opening  heading tag:<br>
    <pre> &lt;+h1&gt;, or &lt;+h2&gt;, ... </pre><br>
<p>
    This is important when you work on a section or many sections of your LIterate Source file for<br>
    a longer period and could not click them open in teh browser time and time again, after each <br>
    minor code change when you reload the "project.weave" in your browser to see the updates.<br>
<p>
    Such changes - adding or deleting a "+" - can often be done with one command in a programming editor.<br>
    For example, to open the whole subthread in vim, issue a range command, sth like<br>
    <pre> 1024,1150s/&lt;h/&lt;+h/ </pre> (i.e. substitute between lines 1024 and 1150 of your Literate Source file)<br>
<p>
    Another suggestion is, when you, for example, work with several program files inside your LIterate<br>
    Source (project) file, you might keep subthreads marked open, while changing only the topmost <br>
    heading to show/hide the whole of that file/subthread code and notes.<br>
<p>
    Even when you handpick the sections to keep open, I found, this arrangement suits me well, at least<br>
    for medium-sized LSFiles up to several thousand lines long.<br>
    I also use folding inside "vim", and so line ranges are visible at one glance: "z-a" to collapse the<br>
    vim fold, and then see the range and issue the range command.<br>
<p>
    <i> Note </i> <br>
	<ul> Use of folding inside your programming editor  &nbsp;   &nbsp;  i s  &nbsp;  n o t  &nbsp;  a  &nbsp;  s u b s t i t u t e  &nbsp;  for reading <br>
	a well-laid out formatted document in the browser. Vim folding is still "blind" and  navigation<br>
	inside such a file still has to rely on your memory of the full layout. This is a burden one <br>
	wishes to escape when programming, to be able to dedicate attention to thinking and<br>
	programming while avoiding unnecessary "housekeeping" tasks. Short-term memory of humans<br>
	is very small, and switching between remembering where things are and doing programming<br>
	becomes exhausting when your program exceeds a thousand lines or so.<br>
<p>
	MOLLY numbers lines in the code sections by default, making jumps from reading in your browser<br>
	to editing a particular line in your editor painless. I could also put it like this: I view<br>
	the file globally in my browser as a folding document when I am thinking, while editing <br>
	"locally" in a programming editor, without thinking about the overall layout of the file.<br>
<p>
	</ul><br>
<p>
    MOLLY.pl is written to filter out vim folding markups ( {{{number ... }}}number ) and t hose will not<br>
    show on your web page.<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('23');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('24');">
<font class='lnum'><i>(24)</i></font>&nbsp; TOC/Index unfolding and collapsing </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 891)</i></sub></font></a></legend></fieldset>
<p>
<div id="24" style="display:none">   
<ul>


<p>
    The TOC and Index at the top of the document can be kept folded or expanded upon initial load<br>
    depending on the configuration variables in the "mollifying" template you add at the top of <br>
    your Literate Project file. Please see the subsection titled '"Mollification" - full template' above<br>
    Of course, those subsections can always be opened/closed manually at any time<br>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('24');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('25');">
<font class='lnum'><i>(25)</i></font>&nbsp; Use for printing </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 900)</i></sub></font></a></legend></fieldset>
<p>
<div id="25" style="display:none">   
<ul>


<p>
Unfolding only the needed sections also seems to work well with printing from the browser window.<br>
    You can therefore avoid picking certain pages manually from "print preview". You'll print only<br>
    the visible part(s) - i.e. the open sections and the topmost folded section names, which do not<br>
    take place if your document is marked in a sane way, and rather help the reader to orient himself<br>
    while looking at the printout.<br>
<p>
    Just remember to check the font size in the "print preview" when preparing to print for the first <br>
    time.<br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('25');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('26');">
<font class='lnum'><i>(26)</i></font>&nbsp; Text browsers and JavaScript </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 915)</i></sub></font></a></legend></fieldset>
<p>
<div id="26" style="display:none">   
<ul>


<p>
Web page folding seems to work well with text-only www browsers, such as  "lynx" or 'w3m': they do not <br>
understand javascript folding, and so display the whole document.<br>
<p>
Here's an example invocation with w3m:<br>
<pre>  ./MOLLY.weave | w3m -T text/html  </pre><br>
<i> Note </i>MOLLY does not issue HTTP headers, and this may affect browser behaviour. The web server<br>
 and/or browser may add them or not, or ignore them or not. I might need to correct that.<br>
<p>
If JavaScript in your GUI browser is turned off, you'll see only the sections marked in the body<br>
of the Literate Source file as open.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('26');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('19');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('27');">
<font class='lnum'><i>(27)</i></font>&nbsp; SUGGESTED USES: Work with Folding LSFiles</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 933)</i></sub></font></a></legend></fieldset>
<p>
<div id="27" style="display:none">   
<ul>


<i> <b>  section unfinished; an outline of major points for now </b> </i><br>
<p>
I do not show examples below, as the document you are reading itself is an example of the<br>
techniques (and that may be the reason it is too bloated and somewhat unorderly ;)) ).<br>
<p>
<ol> <li> Literate Programming proper.<br>
<p>
    Emphasis on note-taking rather than producing a polished "essay" or "documentation"<br>
<p>
    Traditional Literate Programming texts place much emphasis on the fact that it is a means of <br>
    providing <i> documentation </i> (albeit with source code, and reflecting the thinking rather<br>
    than machine-imposed order).<br>
    Knuth first thought of LP as a documentation tool, then upgraded it to a "programming paradigm",<br>
    but insisted on writing programs "like literary essays".<br>
<p>
    However I would like to suggest placing emphasis on NOT documenting and NOT producing <br>
    polished code or an essay in thinking. The first use of this programming technique is <br>
    to  <i> keep a full log of your thinking </i> irrespective of how polished or stupid it is.<br>
<p>
    This is most precious. When you first attack a problem, several directions might come to mind,<br>
    but once you began to work out one of then in detail, everything else is lost. This is the<br>
    way human mind works. Keeping even briefest notes is more valuable than attempting to produce<br>
    polished exposition.<br>
<p>
    Psychological restrain people feel when they are compelled to prepare something for other people<br>
    is probably the third major hurdle to wide spreading of L.P. (the first two were flat file <br>
    structure and formatting languages which doubled the effort of programming and debugging).<br>
<p>
    My MOLLY Literate Source file is a log of my thinking, trials and experiments. I might later offer<br>
    a cleaned version to other people, but I do not give a damn about them in the beginning.<br>
<p>
    Non-folding L.P. source files could not accomodate inclusion of old versions, test files, bad<br>
    versions and skeletons without polutting the file to the degree of becoming unusable.<br>
<p>
    Folding version of L.P. source allows one to relegate bad trials into subsections  nicely folded<br>
    out of the way by merely adding a single header line.<br>
<p>
    When creating documentation, I could double the content of some sections, by copy-pasting the<br>
    "cleaned" versions, and then save a version with the original snippets bypassed, which is<br>
    easy and mechanical with tools like "gema", "awk" or "perl", just put a code word like<br>
    "scrap" in the beginning and end of those sections you'd like to avoid.<br>
<p>
    This ability to bypass marked sections when weaving, by the way, might be incorporated as an<br>
    option into a future version of MOLLY, to produce both 'clean' and 'dirty' versions of the<br>
   formatted Literate Source doc from one file.<br>
<p>
</li> <li> Use as a combined Project file<br>
    <ul> <li> to include tests and snippets that implement skeleton functionality to<br>
    be embedded into the main program<br>
    </li> <li> to include versioning and changes in the way  that does not break what<br>
    has been working so far (there was even a special term for that as a programming <br>
    principle). Keep the old version, put it into a subsection, and rename the chunk<br>
    to bypass it. The newer version of the piece of code that is being reworked will<br>
    get the old chunk name to be included into the chain to tangle out.<br>
    </li> <li> To keep a makefile (split, to which I can add lines from many places in<br>
    my Literate Source as I grow it) together with source file(s)<br>
    </li> <li> To keep several source files related logically in teh same Literate Source file.<br>
    </li> </ul><br>
<p>
    <i> Folding meta-files </i> could be used for larger projects, in which <br>
    the meta-file, a folding document, would describe teh topmost level layout of the <br>
    project, and contain ordinary HTML links to partial Folding Literate Sourcefiles, which<br>
    will keep all the junk as described above.<br>
<p>
    In any case, the use of Folding Literate Source files would considerably simplify tracking<br>
    of the project files in a version control system.<br>
<p>
</li> <li> Use for system administration etc. - as a single file to keep many sysadmin scripts, <br>
    descriptions of conventions and procedures, bugs and changes in the system <b> <i> in one place </i> </b><br>
    from which any of the included source (or texts, if they are kept in the "source chunks") <br>
    can be obtained easily with a single command.<br>
    ALSO: combine LIterate Source project file with a makefile as a simple means to keep <br>
    one-command tangling of multiple targets.<br>
<p>
    This Literate Source can live in a central place (e.g. root home) and be under version control.<br>
    The tangled pieces, config files or scripts could be copied to files on one or many machines.<br>
<p>
</li> <li> Use for non-programming tasks:<br>
    <ul> <li> as a note-keeper. E.g. I kept job listings and followi-up info in a folding<br>
   MOLLY file and found it quite convenient. <br>
    </li> <li> as an outliner for general purpose texts.<br>
    </li> <li> for keeping documentation, books etc. I keep documentation for a number of<br>
    software tools (e.g. "awk", "newlisp", "monotone") in folding format. It <i> is </i> helpful.<br>
    </li> <li> for editorial work on larger texts. The text itself will become "code chunks", <br>
    and editorial remarks and meta-thinking will remain as "documentation" in a Literate <br>
    Source file.<br>
    </li> </ul><br>
<p>
</li> </ol><br>
<p>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('28');">
<font class='lnum'><i>(28)</i></font>&nbsp; scrap </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1026)</i></sub></font></a></legend></fieldset>
<p>
<div id="28" style="display:none">   
<ul>

(a) //CGI and CL invocations - compared to "noweb"<br>
    // dotHTML tagging; alternative tagging, translations<br>
    // alternative tanglers and pass-through tangler; makefile problem<br>
<p>
(b) ideas - how to incorporate tests; how to keep a single project file;<br>
how to set up dummy plugs and alternatives (i.e. to develop without destroying<br>
the old working version)<br>
Maybe: for distribution of a lot of small scripts (admin etc), the  way I used<br>
Makefiles?<br>
<p>
(c) It's possible even to do development in smallest chunks -- and later (e.g. for<br>
outside clients or for higher-level documentation, etc.) to consolidate the tiny fractured <br>
bits and pieces, with plenty of alternatives, dummies, plugs and trials etc. etc.<br>
How? - by tangling those from some certain level and copy-pasting the result into the<br>
Literate Project File.<br>
One could even keep the actual development fractions in a subsection, while retaining<br>
higher-level and cleaner view in higher level sections. I do not care about doubling the<br>
text at all.<br>
<p>
<b>suggestion from a Slashdot 2002 discussion </b>(see ref above) about style or approach:<br>
do not document what the code does (which is redundant, as can be seen from the code itself),<br>
document rather WHY it does it (what's the purpose or the idea).<br>
<p>
<b> Also </b> use this file itself as an example of all illustrated techniques.<br>
<p>
Use <b>"mollify"</b> as  a technical term (insert MOLLY.pl invocation into the LitProject file)<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('28');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('27');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('6');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('29');">
<font class='lnum'><i>(29)</i></font>&nbsp; ---- LITERATE SOURCE OF THE SCRIPT ---- </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1061)</i></sub></font></a></legend></fieldset>
<p>
<div id="29" style="display:block">   <script language=javascript> 
		    document.getElementById("toc"+ 29).className='hilited';
		    </script>   
<ul>


<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('30');">
<font class='lnum'><i>(30)</i></font>&nbsp; Bugs, status, changes </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1066)</i></sub></font></a></legend></fieldset>
<p>
<div id="30" style="display:none">   
<ul>


<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('31');">
<font class='lnum'><i>(31)</i></font>&nbsp; versions - changes </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1070)</i></sub></font></a></legend></fieldset>
<p>
<div id="31" style="display:none">   
<ul>


<p>
Current version:<br>
<ul><br>
    <li> creates folding documents on the fly..<br>
    </li><li> ..based on dotHTML or rawHTML markup <br>
    (i.e. either to create new docs or convert existing HTML into folding format);<br>
    </li><li> and generates dynamically TOC and code chunks index;<br>
    </li><li> ties collapsing/expandind of sections with TOC highlighting;<br>
    </li><li> .. and provides pass-through tangling with "noweb".<br>
    </li></ul><br>
<p>
    This script is a test of the concept (LitProg+folding+dynamic web formatting)<br>
    Options for future versions --  3 ideas for now:<br>
    <ul><li> add a built-in tangler (while retaining the possibility to tangle<br>
    through an external tool, such as "notangle" with all its options and filters).<br>
<p>
    </li><li>  &nbsp;  c r e a t e  &nbsp;  a  &nbsp;  f u l l y  &nbsp;  s e l f - c o n t a i n e d  &nbsp;  folding web-based  &nbsp;  w e a v e r  &nbsp; <br>
    ("Lilit") (plus possibly a built-in tangler).<br>
    This can be done in newlisp (www.newlisp.org), which has a built-in httpd<br>
    and allows creation of 250k+(size of script) standalone executables on all<br>
    major platforms (unix/linux, windows mac).<br>
<p>
    </li><li> maybe -  &nbsp;  a d d  &nbsp;  " v i e w s "  &nbsp;  ( a  &nbsp;  l a  &nbsp;  L e o  &nbsp;  v i e w s )  &nbsp;  and maybe editing of single<br>
    subsections (in a pop-up term window with a running editor).<br>
    This - as I see it now - may/will involve storing each subsection in its <br>
    own little file and dynamically concatenating them both for dynamic weaving<br>
    and for tangling ( keep a third name, some "scriptname.src" for dumping the<br>
    full file to STDOUT?? )<br>
    This can be done dynamically: a huge project file will be displayed fully<br>
    collapsed, and then only the sections marked open will be dumped to the web<br>
    browser dynamically.<br>
    The whole thingy can be kept either as a bunch of section-files in a subdir,<br>
    or (and/or) in a tar file (gzipped or not, indexed or not).<br>
<p>
    <b> One possible implementation </b> is with <a href= http://www.wikiwyg.net > http://www.wikiwyg.net </a><br>
    - the "wikiwyg" library, which can turn any "div" into an editable section.<br>
<p>
    The lib as it is distribted does not save (no sub that saves, actually), but<br>
    one can "save in the browser" and next save the page from the browser to a <br>
    local file<br>
<p>
    For a local programming setup ( thttpd on localhost:8000 for example) this<br>
    will do. However one still needs to figure out if there is a possible post-<br>
    processing of the dynamically created (and then saved from the browser) page<br>
    with some script that would strip back the "frameset" decorations and the <br>
    invocations of folding plus the html head and TOC/chunks index sections.<br>
<p>
    I might say, I need the "reverse weaver" (although not as thorough ?)<br>
<p>
    .. and, secondly, after post-processing, if there is an invocation op "patch"<br>
    which would apply the diffs back to the Literate SOurce file.<br>
<p>
    <ul> <li> Will a "context patch" do? Can I postprocess<br>
    </li> <li> Can I postprocess the dynamically generated HTML to mimic some<br>
    sort of diff markup (unified? Context? ...)<br>
    </li> <li> Third, the exact invocation to apply it to an LSF.<br>
    Is manual restoration of this kind possible? Is it poss to run through a GUI<br>
    merge tool? An "apply all left to the right one" automatic tool?<br>
    </li> <li> This can be presented as buttons on the page (when the wikiwyg<br>
    option is enabled) etc.<br>
    The script then would take another option (your_filename?apply_changes) to<br>
    run this, and fail with a request to do a manual merge if not possible.<br>
    </li> </ul><br>
<p>
    Then the question   remains, how practically useful/convenient that is.<br>
<p>
<p>
    <i>How to do it</i><br>
    /* Basically, to manage sectionfiles I'd have to code as if those are comments<br>
    to a blog entry (and dynamic gathering of them is the same, too. Should be<br>
    rather obvious and possibly quite easy*/<br>
    This 'views_enabled' mode will switch to sect-files in a ./.molly/ and will<br>
    add dynamic links to each section: "edit section" (in an external editor);<br>
    "update Literate Source Project file". And the script will start to check the<br>
    subdir and dynamically reconstruct its HTML output in this mode.<br>
    Same must be true for the "tangler" pre-filter, too - it will reconstruct<br>
    the whole before passing it to the "notangle" utility.<br>
<p>
    </li><li> Is it possible to do  &nbsp;  " p r o m o t i n g / d e m o t i n g "  &nbsp;   &nbsp;  o f  &nbsp;  b r a n c h e s ? ?  &nbsp; <br>
    Is it possible in the view-enabled weaver?<br>
<p>
    </li><li>  &nbsp;  a d d  &nbsp;  " w e b  &nbsp;  t a n g l e  &nbsp;  m o d e "  &nbsp; , in which MOLLY will dump coloured diff<br>
    of the subsections (or the whole file if not too large), of the current version,<br>
    tangled via the browser form versus a file on disk.<br>
    (I do it all the time firing fldiff after each tangle - would be convenient to<br>
    have the functionality before tangling to disk (with file renaming etc), just<br>
    by reloading a page in a browser.<br>
    Will need to allow saving files (or some branch of chunks) from the browser, then.<br>
<p>
    Do I underuse  &nbsp;   &nbsp;  V i m  &nbsp;  ? - it does have <b> some "diff" mode </b> for side-to-side<br>
    display. Just open 2 files, current and prev. vers. and toggle btw one-file<br>
    view and edit or side-by-side coloured diff ???<br>
<p>
    <i>How to do it</i><br>
    .. by first (poss) checking that the files are not identical, and then by<br>
    filtering into "diff":<br>
    <pre> MOLLY.tangle|diff -y -w --left-column xxz - |less </pre><br>
    Just wrap it into html-body-pre tags and colour if there's something in the <br>
    right half (not necessary, really)<br>
<p>
</li> <li> <b> context diffs and sections editing </b>   <br>
<p>
<p>
<p>
<p>
<p>
</li> </ul><br>
<p>
<p>
<p>
<p>
<p>
<b> More ideas: </b><br>
<p>
<b> 1. Maybe </b>  have the  &nbsp;   &nbsp;  " c o m p o s i t e  &nbsp;  d o c u m e n t "  &nbsp;  (or "fragmented document") <br>
    option for  &nbsp;   &nbsp;  t h e  &nbsp;  s e c o n d - l e v e l  &nbsp;  meta-management  &nbsp;   &nbsp;  o f  &nbsp;  p r o j e c t  &nbsp;  f i l e s  &nbsp; <br>
    I.e. one project could be split into many file-sections, and MOLLY weaver will <br>
    assemble them into the doc.<br>
    OR: I maintain logically consistent pieces in medium-size project files, and<br>
    keep a meta-project file with the split option enabled.<br>
    The "edit" links from it will pop up gvim or another editor of choice with<br>
    the full piece in it.<br>
    While viewing will present it all as if one LIterate Source project file.<br>
    I'll need only to mark the pieces in the TOC, possibly, as a separate doc,<br>
    and -- <b> how will I treat TOC compilation then ? </b><br>
<p>
<b> 2. Maybe </b> - if I find an ASCII script (ascii art from commands and <br>
    descriptions), I could automatically generate  &nbsp;   &nbsp;  a s c i i - a r t  &nbsp;  " m a p s "  &nbsp;  <br>
    of the chunks ??<br>
<p>
<p>
<b> 3. introduce horizontal/vertical layouts? </b> <br>
    I.e. TOC and Chunks Index either on top of the file or on the left of it for<br>
    "wide screens", like those on notebooks ??<br>
    Changes are in  "Print out the resulting page" (currently line 3359)<br>
     - plus options, of course<br>
<p>
    Note: will require gluing TOC or the body to stick at the top, not simple table<br>
    cells, which will center and resize depending on relative cell content sizes.<br>
    May require separate scrolling for the two panes?<br>
<p>
OR: <b> TOC/Index in a floating window? </b> -- should be easy, just  name the<br>
    output windows.<br>
<p>
<b> 4. Maybe </b> add ancors to folding section names to be able to 'hyperlink' <br>
    and refer to them from other parts of the document??<br>
    // no jumps from the TOC? or with a separate 'jump' icon? //<br>
    // no jumps to closed sections will work anyway, then what to do? //<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('31');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('32');">
<font class='lnum'><i>(32)</i></font>&nbsp;Todo -  current</a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1225)</i></sub></font></a></legend></fieldset>
<p>
<div id="32" style="display:none">   
<ul>


<p>
<b>1. Problem of double diamonds in doc chunks </b><br>
<ul><br>
    change the pass-through tangler to isolate the "notangle" from docs sections???<br>
    (will squash the prob of double angle brackets in documentation chunks)<br>
<p>
    OR - introduce a sort of escape?? Because sol 1 would clobber correct line numbering??<br>
    But I do not number lines in the default pass-through invocation..<br>
    The standalone will be affected, anyway.<br>
<p>
    I could add regex conversion to hexadecimals in the pass-through tangler.<br>
    However it would still break the "notangle" when run standalone.<br>
<p>
    I could collect command-line options in case of "scriptname.tangle" invocation<br>
    and pass them to "notangle" - that could be a sort of solution.<br>
</ul><br>
<p>
2. Change logic of "weave-tangle" ("main despatcher"), as it is stupidly convoluted <br>
and ugly now<br>
<p>
3 and 8. (++) rawHTML mode, done<br>
<p>
4. (++-) see below in "done"<br>
<p>
5. <b> BUG of sorts </b><br>
the "lt" and "gt" escapes in the code chunks right above ("tangle me with filtering") are not <br>
displayed correctly  by the web weaver: the browser displays them as real angle brackets.<br>
<p>
6. <s>TMLize the error message in the main despatcher (if "I am a module", print it as<br>
an html file). Otherwise it won't look good in the browser. </s> <br>
<b> NOT NEEDED </b> as "tangling" is done from CL only<br>
<p>
7. Add another mode - if file ext is "src" - "scriptname.src" - do not pass to "notangle", but<br>
dump the pre-filtered source to STDOUT.<br>
May be needed in some cases, who knows?? - i.e. to escape special symbols, such as double-&lt;'s <br>
etc in documentation chunks.<br>
Ordinarily, this is not needed and the file can be processed by "notangle" directly.<br>
This step is needed to tangle some non-default pieces or to use some extra tangling options.<br>
<p>
9 (++). DATA or ---start of script-- to filter?? - done<br>
<p>
10. Add "expand subthread" ?? - to open only the current branch of the L.T.File?<br>
<p>
11. Add auto-href creation (i.e. posting a URL with minimal markup must create a valid<br>
    HTML link with URL as the name of it.<br>
<p>
12 (+--). and checking <br>
qwer qwer  &nbsp;  s p a c i n g  &nbsp;  of one word and <i> &nbsp;  o f  &nbsp;   &nbsp;  m a n y  &nbsp;   &nbsp;  o n  &nbsp;   &nbsp;  t h e  &nbsp;   &nbsp;  s a m e  &nbsp;  l i n e  &nbsp; </i> asdf asd  <br>
SO: to do word boundaries properly.<br>
DONE although not very cleanly. The tag will break across several lines<br>
<p>
13. Add a full set of HTML escapes to "dotHTML" and "rawHTML" ?<br>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('32');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('33');">
<font class='lnum'><i>(33)</i></font>&nbsp;Done </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1282)</i></sub></font></a></legend></fieldset>
<p>
<div id="33" style="display:none">   
<ul>


<p>
<b> 1. Adding TOC open/collapsed section indication </b><br>
Changes must be made in:<br>
"weave me" ==&gt; "JS script functions" &amp;&amp; "stylesheet"<br>
// as expl in the ref section below <br>
<p>
AND in<br>
"Accumulate the result" ==&gt; "process section headings"<br>
// the actual invocation "onmousedown"<br>
<p>
<p>
<b> 2. Synchronize TOC and sections </b><br>
I have done highlighting; now two more steps:<br>
    <ul> (a) make body sections run "toggleCombined" rather that directly<br>
    open/close the "div"s/sections - to highlight the TOC at the moment<br>
    of change<br>
    (b) make TOC bg. highlighting recognize the "+" signs in the html headings<br>
    markup.<br>
    </ul><br>
This is not difficult, just needs a little attention.<br>
<p>
To do (b) NEED to rewrite <br>
<pre> &lt;div id="$section_num" style="display:$fold_state"&gt;  </pre><br>
in line appr. 370 to add inline javascript invocation of expandDiv<br>
<p>
3. see 8.<br>
Add "pass-through" direct HTML dummy encoder (plus a switch btw rawHTML and dotHTML)<br>
Explain  the user can expand the script in any way he wishes (e.g. with a "wiki" syntax)<br>
<p>
(++-)4. I still need to do at least a <b> stub in tangler </b> to do some pre-filtering before<br>
calling "notangle".<br>
E.g. I might want to reassign the double-&lt; and double-&gt; or other symbols for some esoteric<br>
languages, or filter out escapes from documentation chunks for the notangle not to choke.<br>
<p>
NO SWITCH yet to select from pre-tangle filters or built-in tangler.<br>
<p>
(++) 8. Weaving -- "dotHTML" versus "rawHTML".<br>
Version MOLLY-0.62-BAD.pl is incorrect. It's "dot" markup is OK, but for "raw" to work <br>
<i> regexps must be changed </i> in the main filtering "if - elsif - else", as headers<br>
will too be in angle brackets, not in dots.<br>
<p>
<b> May be a good idea to extract those regexps </b> and assign them to vars, as now<br>
they are coded in, bad.<br>
<p>
9. See "accumulate result in a buffer"<br>
Should I make the "----start of script--" line unnecessary (relying on __DAT A__ ) ??<br>
Or =- both? or no "data" (as it throws off editors highlighting) ???<br>
<b> set to react to DATA not "start of script"</b><br>
<p>
<p>
<b> Bug with setting default for $print_toc fixed</b> --  must check for "defined", the perl operator<br>
xx?aa:bb checks for 0 or non-0, and so if the var equals 0 it will never set it to 0.<br>
Changed and tested.<br>
Maybe should use "yes" and "no" instead of "1" and "0"?<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('33');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('30');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('34');">
<font class='lnum'><i>(34)</i></font>&nbsp; PRELIMINARIES: The script layout and idea </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1345)</i></sub></font></a></legend></fieldset>
<p>
<div id="34" style="display:none">   
<ul>


<p>
.. are very simple.<br>
<p>
<b>1. </b> It is possible to include an invocation of a  perl script with <br>
<pre> "do script.pl" or "use script.pl"  </pre><br>
as the first lines in a Literate Source file.  This turns the source into a standalone perl script. <br>
If we write the script to process the L.Source file itself ($0 in perl parlance) then the script can do <br>
weaving and tangling of it. The output, which is formatted documentation (which was "weaved" from L.P.) <br>
or the sources usable by a computer ("tangled") can be  saved in a file, as with traditional "literate <br>
programming" tools. But which is more convenient, the formatted documentation can be  picked up by a web  <br>
server, and thus allow us to see work in progress immediately and automatically. <br>
<p>
When I think, I prefer to look at the formatted document, and when I change, I do it "locally" in a good<br>
programming editor (such as "vim"). Even with vim folding the difference in perception is enormous.<br>
<p>
<b> 2. </b>I see three advantages to such an arrangement:  <br>
<ul><li>first, web markup is ubiquitous today, and it is quite sufficient for most publishing needs. <br>
So Literate Programming with HTML will free us from a tie to TeX which so negatively affected <br>
perception of L.P. by the masses of programmers. The markup becomes very, very simple. <br>
<p>
This eliminates a source of one major complaint about the traditional L.P. - that the programmer has <br>
to maintain not one, but two "programming languages" while working with LP, the target one<br>
and the formatting one. This - the complaint goes - becomes a source of errors from an additional layer <br>
of programming in addition to writing the code itself. It taxes the programmer's mind rather than relieving<br>
it.<br>
<p>
In fact, simple HTML is almost self-correcting, as wrong markup becomes immediately obvious in the <br>
browser. <br>
<p>
</li> <li> secondly, this eliminates "weaving" as a separate step during development, but more<br>
importantly, such an arrangement allows a programmer to think about his program while looking<br>
at a <i>folding</i> document, in which only relevant sections are open.<br>
<p>
I perceive <i> folding </i> as a major advantage<br>
<p>
With <i>folding</i> the Literate Source file becomes manageable even for really large texts. This in turn<br>
allows the programmer to keep <i> many files </i> inside the LPSource, including test snippets, the makefile,<br>
preserve old versions of parts of the source etc. etc.<br>
Literate Source file is painlessely turned into a Project File, one file, from which anything can be<br>
easily generated.<br>
It is this one file that my version control system must track now. For really large projects, we can keep<br>
a meta-file (also in the folding format) with largish partial files as links, corresponding to logical <br>
pieces of the project, which will open in the browser as automatically weaved Literate Source Files.<br>
<p>
I attempted to explain this at length in introductory sections above.<br>
</li></ul><br>
<p>
<b>3. </b> The script that programs this functionality can assemble all pieces as buffered strings in RAM: today's <br>
machines routinely contain RAM in Gigabytes, therefore processing in memory a very large source or <br>
project file  in Megabytes, even in tens of Megabytes is not a problem. <br>
<p>
<b>4. </b> How the script works overall<br>
<p>
After figuring out how it was invoked, the script:<br>
<ul><li> <b>when it is supposed to weave</b>, scans into memory the Literate Source file, marked up in "noweb" <br>
notation (and its document sections marked with raw HTML or in "dotHTML") doing necessary substitutions <br>
and conversions along the way.<br>
Then the buffered string thus formed and several auxilliary buffers (for document TOC and Index <br>
sections) are printed out to STDOUT. They can be redirected into files, if LPSource, now also an executable<br>
script itself, is run from command line, or they can be picked up by a local personal web server that is<br>
used by the developer, which  should recognize the LPSource as a valid CGI script<br>
<p>
After any changes in the script, the user can reload the page in his web browser and immediately see the<br>
changes.<br>
<p>
</li><li> <b>If invoked to tangle</b> the source of the program, this version of the script will refer the <br>
actual  tangling to the "notangle" utility from "noweb" suite of tools by Ramsey.<br>
</li></ul><br>
<b>5. </b>  &nbsp;   &nbsp;  A  &nbsp;  f u t u r e  &nbsp;  v e r s i o n  &nbsp;  of the script may be made completely self-contained, i.e. include a mini-web <br>
server as well as a folding weaver and a tangler.<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('34');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('35');">
<font class='lnum'><i>(35)</i></font>&nbsp; MOLLY.pl - top of the script </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1423)</i></sub></font></a></legend></fieldset>
<p>
<div id="35" style="display:none">   
<ul>


<p>
<font class='lnum'>1426</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;MOLLY.pl module&gt;&gt;=</legend>
<font class='lnum'>1427</font>   #!/usr/bin/perl
<font class='lnum'>1428</font>   
<font class='lnum'>1429</font>   #---------------------------------------------------------------------------------    
<font class='lnum'>1430</font>   #
<font class='lnum'>1431</font>   #	This script is licensed under GPL version 3
<font class='lnum'>1432</font>   #
<font class='lnum'>1433</font>   #----------------------Script proper----------------------------------------------
<font class='lnum'>1434</font>   
<font class='lnum'>1435</font>   
<font class='lnum'>1436</font>   <font class='chunkref'>&lt;&lt;general settings&gt;&gt</font>;
<font class='lnum'>1437</font>   <font class='chunkref'>&lt;&lt;main despatcher&gt;&gt</font>;
<font class='lnum'>1438</font>   <font class='chunkref'>&lt;&lt;tangle me&gt;&gt</font>;
<font class='lnum'>1439</font>   <font class='chunkref'>&lt;&lt;weave me&gt;&gt</font>;
<font class='lnum'>1440</font>   
<font class='lnum'>1441</font>   # END OF SCRIPT
<font class='lnum'>1442</font>   </fieldset></pre>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('36');">
<font class='lnum'><i>(36)</i></font>&nbsp; general settings </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1446)</i></sub></font></a></legend></fieldset>
<p>
<div id="36" style="display:none">   
<ul>


<p>
<p>
Some internal script parameters are set here.<br>
E.g. "noweb" tangler gets confused if it finds double angle brackets<br>
anywhere, so sometimes it's possible to fool it by setting a var in the<br>
perl script like this:<br>
<p>
<font class='lnum'>1455</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1456</font>     # need to fool the noweb "notangle" utility, switch markup modes etc.
<font class='lnum'>1457</font>     $lt = "&lt;";
<font class='lnum'>1458</font>     $gt = "&gt;";
<font class='lnum'>1459</font>     $lt_esc = "&amp;lt;";
<font class='lnum'>1460</font>     $gt_esc = "&amp;gt;";
<font class='lnum'>1461</font>     $dash = "-";
<font class='lnum'>1462</font>     $dot = "\.";
<font class='lnum'>1463</font>   </fieldset></pre>
<p>
But more importantly:<br>
There are a number of parameters that can be set from the literate source file<br>
at the very top before loading the module with "do MOLLY.pl" (or "use MOLLY.pl").<br>
These are assigned defaults here. You can refer to this portion of the script<br>
to find out what parameters are settable in your document template and expand the<br>
tunings if you modify MOLLY.pl<br>
<p>
<font class='lnum'>1472</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1473</font>   
<font class='lnum'>1474</font>     # ----- GENERAL settings -----
<font class='lnum'>1475</font>     
<font class='lnum'>1476</font>     # am I a module? 1:0
<font class='lnum'>1477</font>     $i_am_module = 1;
<font class='lnum'>1478</font>   
<font class='lnum'>1479</font>     # print toc? 1:0
<font class='lnum'>1480</font>     $print_toc = 1 unless defined $print_toc;
<font class='lnum'>1481</font>       
<font class='lnum'>1482</font>     # keep TOC expanded on initial load? "block":"none"
<font class='lnum'>1483</font>     $toc_expanded = $toc_expanded || "block";
<font class='lnum'>1484</font>   
<font class='lnum'>1485</font>     # keep TOC expanded in initial load? "block":"none"
<font class='lnum'>1486</font>     $ind_expanded = $ind_expanded || "none";
<font class='lnum'>1487</font>   </fieldset></pre>
<p>
The script will behave differently depending on its own name. One "major" name<br>
can be used with others existing as soft links (although an "thttpd" lightweight<br>
web server insisted on a hard link in one case).<br>
The modes are detected by file extensions, which are set here.<br>
'Weaving' = creating a formatted HTML documentation file on STDOUT<br>
'Tangling' = creating the program/script source on STDOUT<br>
<p>
<font class='lnum'>1496</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1497</font>     # what is the file extention to weave it? (perms must allow execution!)
<font class='lnum'>1498</font>     # e.g. "scriptname.weave" or "scriptname.cgi" etc.
<font class='lnum'>1499</font>     $weave_extension = $weave_extension || "weave";	# default is "weave"
<font class='lnum'>1500</font>   
<font class='lnum'>1501</font>       # what is the file extention to tangle it? (perms must allow execution!)
<font class='lnum'>1502</font>       # e.g. "scriptname.tangle",  "scriptname.pl" etc.
<font class='lnum'>1503</font>       $tangle_extension = $tangle_extension || "tangle";	# default is "tangle"
<font class='lnum'>1504</font>   
<font class='lnum'>1505</font>   
<font class='lnum'>1506</font>   
<font class='lnum'>1507</font>     # tangle? Or run? (perms must allow execution)
<font class='lnum'>1508</font>     $tangle_me = 1;
<font class='lnum'>1509</font>   
<font class='lnum'>1510</font>         # -- not implemented yet --
<font class='lnum'>1511</font>         #
<font class='lnum'>1512</font>         #$run_me = 0;
<font class='lnum'>1513</font>         # what interpreter to run the tangle output with?
<font class='lnum'>1514</font>         #$run_me_with="/usr/bin/perl";
<font class='lnum'>1515</font>   
<font class='lnum'>1516</font>   
<font class='lnum'>1517</font>   # number lines ? 1 : else
<font class='lnum'>1518</font>   $line_numbering = 1;
<font class='lnum'>1519</font>   </fieldset></pre>
<p>
The document sections ("chunks") can be marked with actual HTML tags ("rawHTML") or<br>
with a smaller number of the same tags in "dots" in place of "angle brackets", i.e.<br>
dot-br-dot, not open.angle-br-closing.angle<br>
This is selected here:<br>
<p>
<font class='lnum'>1526</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;general settings&gt;&gt;=</legend>
<font class='lnum'>1527</font>   # how are doc sections marked? "dotHTML":"rawHTML"
<font class='lnum'>1528</font>   $weave_markup = $weave_markup || "rawHTML"; # default is "rawHTML"
<font class='lnum'>1529</font>   
<font class='lnum'>1530</font>       if ($weave_markup eq "dotHTML") {
<font class='lnum'>1531</font>   	$tag_open_symbol = $dot;	# this will take care of default
<font class='lnum'>1532</font>   	$tag_close_symbol = $dot;	# when no var is set in the Lit Src file
<font class='lnum'>1533</font>       }
<font class='lnum'>1534</font>       elsif ($weave_markup eq "rawHTML") { 
<font class='lnum'>1535</font>   	$tag_open_symbol = $lt;
<font class='lnum'>1536</font>   	$tag_close_symbol = $gt;
<font class='lnum'>1537</font>       } #fi
<font class='lnum'>1538</font>   
<font class='lnum'>1539</font>   </fieldset></pre>
<p>
It would make sense to add a few more markups to the program, i.e. some "wiki" many use,<br>
and some TeX basic tags for automatic translation, if the doc is tagged as a TeX file.<br>
<p>
In more detail dotHTML is explained in its own section<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('36');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('37');">
<font class='lnum'><i>(37)</i></font>&nbsp; main despatcher </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1551)</i></sub></font></a></legend></fieldset>
<p>
<div id="37" style="display:none">   
<ul>


<p>
The script figures out how it was invoked and then starts either a tangler<br>
or a weaver, or fails with a usage line.<br>
<p>
If the script name ends in "weave" (e.g. script.weave), it will be weaved to STDOUT.<br>
If the name ends in "tangle", the source starting from the default chunk &lt; &lt;*&gt; &gt;<br>
(without spaces) will be dumped to STDOUT:<br>
<p>
<font class='lnum'>1561</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher&gt;&gt;=</legend>
<font class='lnum'>1562</font>   <font class='chunkref'>&lt;&lt;main despatcher kludgy&gt;&gt</font>;
<font class='lnum'>1563</font>   </fieldset></pre>
<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('38');">
<font class='lnum'><i>(38)</i></font>&nbsp; With tanglediffs as an option </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1568)</i></sub></font></a></legend></fieldset>
<p>
<div id="38" style="display:none">   
<ul>


<p>
<b>To add "tangled diffs"</b>  through a broser - i.e. output of <br>
<pre>  MOLLY.tangle | diff -y -w --left-column xxz - |less </pre><br>
<p>
1. To colour the script must hard-set "width":<br>
<pre> diff -W130 ......... # 130 is the default </pre><br>
The separation line runs at &lt; width/2 (e.g. at pos 63 if W=130, at 87 if W=190 etc<br>
So I can recognize "changed" lines to colour if length($line) &gt;= Width/2 ?? (or strictly more)<br>
But figuring out at which pos the separation line runs without hardcoding W is not obvious to me.<br>
<p>
Another alternative might be to use an external code colourizer, such as vim ??<br>
<p>
<p>
<p>
2. I'll have to redo the despatcher's logic:<br>
    <ul> check REQUEST_METHOD if it si GET, then weave for "xx.weave" extensions, <br>
    do tanglediffs for the "scriptname.tangle" extension, and do real tangle if <br>
    REQUEST_METHOD is not set.<br>
    The tanglediffs will be controlled by cgi query string (i.e. disassemble and<br>
    match QUERY_STRING).<br>
    The tanglediffs will present a form to select a disk file to tanglediff against;<br>
    subsequent views of output can be done by reloading the page in a browser.<br>
    </ul><br>
<p>
<font class='lnum'>1594</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher with tanglediffs&gt;&gt;=</legend>
<font class='lnum'>1595</font>   ;
<font class='lnum'>1596</font>   
<font class='lnum'>1597</font>   </fieldset></pre>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('39');">
<font class='lnum'><i>(39)</i></font>&nbsp; a skeleton script to test this snippet </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1601)</i></sub></font></a></legend></fieldset>
<p>
<div id="39" style="display:none">   
<ul>


<p>
To test: <br>
    <ol><li>save as test.weave, hard link to test.tangle and test.pl<br>
    </li><li> and set thttpd.conf to treat x.tangle as cgi<br>
    </li></ol><br>
<p>
<font class='lnum'>1609</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tanglediff test 1&gt;&gt;=</legend>
<font class='lnum'>1610</font>   #!/usr/bin/perl
<font class='lnum'>1611</font>   
<font class='lnum'>1612</font>   if ( $0 =~ m!\.tangle$! ) { 
<font class='lnum'>1613</font>       if ($ENV{'REQUEST_METHOD'}){ goto TANGLEDIFF_ME }
<font class='lnum'>1614</font>       else { goto TANGLE_ME; }
<font class='lnum'>1615</font>   }
<font class='lnum'>1616</font>   elsif ( $0 =~ m!\.weave$! ) {
<font class='lnum'>1617</font>       goto WEAVE_ME
<font class='lnum'>1618</font>   }
<font class='lnum'>1619</font>   else {
<font class='lnum'>1620</font>       #output error message and usage 
<font class='lnum'>1621</font>       exit;
<font class='lnum'>1622</font>   }
<font class='lnum'>1623</font>   
<font class='lnum'>1624</font>   TANGLE_ME:
<font class='lnum'>1625</font>       print "I am being tangled\n";
<font class='lnum'>1626</font>       exit;
<font class='lnum'>1627</font>   
<font class='lnum'>1628</font>   TANGLEDIFF_ME:
<font class='lnum'>1629</font>       #disassemble and check the query string here
<font class='lnum'>1630</font>       #and accordingly do a primitive protocol:
<font class='lnum'>1631</font>   	# output file selection form of none
<font class='lnum'>1632</font>   	# show the diff if selected, e.g. 
<font class='lnum'>1633</font>   	#   "script.tangle?filename_on_disk_to_tanglediff_against"
<font class='lnum'>1634</font>       
<font class='lnum'>1635</font>       #debug:
<font class='lnum'>1636</font>       print "I am in a tanglediffer\n";
<font class='lnum'>1637</font>       exit;
<font class='lnum'>1638</font>   
<font class='lnum'>1639</font>   WEAVE_ME:
<font class='lnum'>1640</font>       print "I am in a weaver\n";
<font class='lnum'>1641</font>       exit;
<font class='lnum'>1642</font>   
<font class='lnum'>1643</font>   </fieldset></pre>
<p>
<b>also</b> where there were "weaver" and "tangler" before, I'll have one more "tanglediff"<br>
subsection below to set the "diff" invocation and dumping its output.<br>
<p>
<i>Question for the tanglediffe</i>r - should I have an option to directly dump the result <br>
of tangling into a browser, or is it unnecessary?<br>
<p>
<i> NOTE </i> the tanglediffer and tangler may share some pre-processing part needed for<br>
clean tangling. Then the separation will be different:<br>
the tangle-tanglediff switch will live inside TANGLE_ME<br>
<p>
<b><i>NOTE 2</i></b> Should I simplify it even more? -- rather than making distinction by the name<br>
extension and forcing the user to create hard links and reconfigure the web server (imposs.<br>
if it is not a local server, but say an html-served subdir in his home dir) -- why don't I<br>
<i>start the mode from a hyperlink</i> ??<br>
The mode will be identified from the QUERY_STRING (or CL options), and the code providing<br>
it is of course still inside MOLLY.pl.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('39');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('40');">
<font class='lnum'><i>(40)</i></font>&nbsp; With wavediff and tanglediff?? </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1666)</i></sub></font></a></legend></fieldset>
<p>
<div id="40" style="display:none">   
<ul>


<p>
I could also do "weavediff" and "tanglediff" for ease of checking in the browser.<br>
<p>
<ul>     &nbsp;  w e a v e d i f f  &nbsp;  - checked, looks bad: huge and not well-readable after a few changes.<br>
    Main prob: executing "weave" produces HTML, so I'll need to execute the other file on<br>
    disk too, or save HTMLs, both are cumbersome options<br>
    SO: no "weavediff"<br>
</ul><br>
<p>
In that case the despatcher will be different:<br>
<p>
<font class='lnum'>1679</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tanglediff.test2.pl&gt;&gt;=</legend>
<font class='lnum'>1680</font>   #!/usr/bin/perl
<font class='lnum'>1681</font>   
<font class='lnum'>1682</font>   $weave_extension = "weave";
<font class='lnum'>1683</font>   $tangle_extension = "tangle";
<font class='lnum'>1684</font>   
<font class='lnum'>1685</font>   
<font class='lnum'>1686</font>   # -- a call for the weaver --
<font class='lnum'>1687</font>   if ( $0 =~ m!\.$weave_extension$! ) {
<font class='lnum'>1688</font>   
<font class='lnum'>1689</font>       # --- a call from CGI ---
<font class='lnum'>1690</font>       if ($ENV{'REQUEST_METHOD'}){
<font class='lnum'>1691</font>   
<font class='lnum'>1692</font>   	print "\nFIRST OF ALL, THIS IS A CALL TO WEAVER\n";
<font class='lnum'>1693</font>   
<font class='lnum'>1694</font>   	#pull and process QUERY_STRING to weave or tanglediff
<font class='lnum'>1695</font>   	
<font class='lnum'>1696</font>   	if ( $ENV{'QUERY_STRING'} eq "" ) {
<font class='lnum'>1697</font>   
<font class='lnum'>1698</font>   	    print "&lt;html&gt;&lt;body&gt;\n";
<font class='lnum'>1699</font>   	    print "a CGI call for weaving&lt;br&gt;\n";
<font class='lnum'>1700</font>   	    print "&lt;/body&gt;&lt;/html";
<font class='lnum'>1701</font>   	}
<font class='lnum'>1702</font>   
<font class='lnum'>1703</font>   
<font class='lnum'>1704</font>   	elsif ( $ENV{'QUERY_STRING'} eq "diff") {
<font class='lnum'>1705</font>   	    print "here I should output the file selection form for tangle-diff\n"
<font class='lnum'>1706</font>   	}
<font class='lnum'>1707</font>   	elsif ($ENV{'QUERY_STRING'} =~ m!^diff&amp;(.*)$! ) {
<font class='lnum'>1708</font>   
<font class='lnum'>1709</font>   	    # check the supposed filename is an allowed alphanumeric:
<font class='lnum'>1710</font>   	    # convert spaces into underscores and check for match to "\w+"
<font class='lnum'>1711</font>   	    print "a call from CGI for a diff with some file.. going to check if it exists..\n";
<font class='lnum'>1712</font>   
<font class='lnum'>1713</font>   	    # for the test - just get the file
<font class='lnum'>1714</font>   	    # /if the file with such a name exists, of course/
<font class='lnum'>1715</font>   	    if (-f $1) {
<font class='lnum'>1716</font>   
<font class='lnum'>1717</font>   		# then run the piped command like
<font class='lnum'>1718</font>   		# scriptname.tangle | diff -y -w --left-column xxz -
<font class='lnum'>1719</font>   		print "here tanglediff pipe will be with the given file\n"
<font class='lnum'>1720</font>   
<font class='lnum'>1721</font>   	    } # fi rung the tanglediff pipe
<font class='lnum'>1722</font>   	} # fi this is CGI GET args for tanglediffing
<font class='lnum'>1723</font>   	else {
<font class='lnum'>1724</font>   	    print "a call from CGI to the weaver -- with unknown arguments&lt;br&gt;\n";
<font class='lnum'>1725</font>   	}
<font class='lnum'>1726</font>   
<font class='lnum'>1727</font>       } # this was a call from CGI
<font class='lnum'>1728</font>   
<font class='lnum'>1729</font>       # --- a call from CL ---
<font class='lnum'>1730</font>       else {
<font class='lnum'>1731</font>   	#process command-line args
<font class='lnum'>1732</font>   	# to weave or weavediff or tanglediff
<font class='lnum'>1733</font>   	print "this is a call from CL\n";
<font class='lnum'>1734</font>   	print " arg1 is $ARGV[0] -- arg2 is $ARGV[1]\n";
<font class='lnum'>1735</font>   	print "The same 3 options will apply: weave, ask for selection and tanglediff\n";
<font class='lnum'>1736</font>       } # esle, fi -- this was a call from command line
<font class='lnum'>1737</font>   }
<font class='lnum'>1738</font>   
<font class='lnum'>1739</font>   # -- a call for the tangler -- 
<font class='lnum'>1740</font>   elsif ( $0 =~ m!\.$tangle_extension$! ) {
<font class='lnum'>1741</font>   
<font class='lnum'>1742</font>       # do direct tangling
<font class='lnum'>1743</font>       # will not execute in the browser, as the web server
<font class='lnum'>1744</font>       # does not allow it?? -- or filter on REQUEST_METHOD, too?
<font class='lnum'>1745</font>       print "a CL call for tangling\n";
<font class='lnum'>1746</font>   
<font class='lnum'>1747</font>   }
<font class='lnum'>1748</font>   
<font class='lnum'>1749</font>   # -- a call for other extensions --
<font class='lnum'>1750</font>   else {
<font class='lnum'>1751</font>       #print usage
<font class='lnum'>1752</font>       print "a call with an unknown extension or a call to 'tangle' from under CGI\n";
<font class='lnum'>1753</font>       print "Not allowed, printing usage..\n";
<font class='lnum'>1754</font>   }
<font class='lnum'>1755</font>   
<font class='lnum'>1756</font>   </fieldset></pre>
<p>
<p>
<b> So </b> this one seems to be Ok, although I still dislike its cludginess. I'd like a<br>
better options processing skeleton script.<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('40');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('38');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('41');">
<font class='lnum'><i>(41)</i></font>&nbsp; "Main despatcher kludgy" - first version - no tanglediffs </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1769)</i></sub></font></a></legend></fieldset>
<p>
<div id="41" style="display:none">   
<ul>


<p>
<p>
<i> To add here: </i><br>
command line options parsing??<br>
Error/usage message should be html-ized too??<br>
<p>
<font class='lnum'>1777</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;main despatcher kludgy&gt;&gt;=</legend>
<font class='lnum'>1778</font>     # -- MAIN DESPATCHER ----
<font class='lnum'>1779</font>   
<font class='lnum'>1780</font>     # check if $i_am_module and set filenames to $0 - or 
<font class='lnum'>1781</font>     # process CL options otherwise
<font class='lnum'>1782</font>   
<font class='lnum'>1783</font>     # (temp) - 2 options, to weave and to tangle in module mode:
<font class='lnum'>1784</font>     #
<font class='lnum'>1785</font>     if ( $0 =~ m!\w+\.$weave_extension$! ) { goto WEAVE_ME }
<font class='lnum'>1786</font>     elsif ( $tangle_me) {goto TANGLE_ME}
<font class='lnum'>1787</font>     else {
<font class='lnum'>1788</font>     print &lt;&lt;end_of_print;
<font class='lnum'>1789</font>   
<font class='lnum'>1790</font>   	USAGE:
<font class='lnum'>1791</font>   	Not set to tangle.
<font class='lnum'>1792</font>   	Set variables at the beginning of the script properly.  
<font class='lnum'>1793</font>   
<font class='lnum'>1794</font>   end_of_print
<font class='lnum'>1795</font>     }
<font class='lnum'>1796</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('41');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('37');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('35');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('42');">
<font class='lnum'><i>(42)</i></font>&nbsp; Tangler </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1807)</i></sub></font></a></legend></fieldset>
<p>
<div id="42" style="display:none">   
<ul>


<p>
    This version of the script does not include a built-in tangler, and therefore<br>
    if you set "$tangle_me" to 1 in the settings, the script will pass ithe request through<br>
    the "notangle" utility of the "noweb" Literate Programming tool to tangle starting with <br>
    <i>the default chunk &lt; &lt;*&gt; &gt;</i>   and without other options passed. I only set "notangle" <br>
    below to preserve the tabs in case you are tangling Makefiles.<br>
<p>
    So, when the script is invoked as "script.tangle" (which can be a link or a soft<br>
    link to something like "script.weave", it's "real" name), it will dump the source<br>
    to STDOUT, very convenient for development.<br>
<p>
    I usually move the root chunk &lt; &lt;*&gt; &gt; along inside the LIterate Source project<br>
    file and assign it to the test script or the part I am working on. The Literate Source<br>
    project file includes several actual source files usually. By the way, it's quite<br>
    nice to be able to keep all partial tests that you do before including those into<br>
    the target program all in one place, your common project file.<br>
<p>
    To tangle with more specific options, run "notangle" directly on your "mollified"<br>
    literate source file, e.g.<br>
    <pre>notangle -R my_root_chunk -L script.weave </pre><br>
<p>
    Later other modes of operation may be incorporated here.<br>
<p>
<p>
<font class='lnum'>1833</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;*-dis&gt;&gt;=</legend>
<font class='lnum'>1834</font>   <font class='chunkref'>&lt;&lt;check strings expansion&gt;&gt</font>;
<font class='lnum'>1835</font>   
<font class='lnum'>1836</font>   </fieldset></pre>
<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('43');">
<font class='lnum'><i>(43)</i></font>&nbsp; pass-through tangler </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1841)</i></sub></font></a></legend></fieldset>
<p>
<div id="43" style="display:none">   
<ul>


<p>
    Passes the request to "notangle" from the "noweb" literate tools suite.<br>
<p>
<font class='lnum'>1846</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tangle me&gt;&gt;=</legend>
<font class='lnum'>1847</font>   <font class='chunkref'>&lt;&lt;tangle me with filtering&gt;&gt</font>;
<font class='lnum'>1848</font>   </fieldset></pre>
<p>
<p>
<font class='lnum'>1851</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tangle me straight&gt;&gt;=</legend>
<font class='lnum'>1852</font>   
<font class='lnum'>1853</font>   
<font class='lnum'>1854</font>   TANGLE_ME:
<font class='lnum'>1855</font>   
<font class='lnum'>1856</font>   	open TANGLE_PIPE, "| notangle -t4 -";
<font class='lnum'>1857</font>   
<font class='lnum'>1858</font>   	open MYSELF, "&lt;$0";
<font class='lnum'>1859</font>   	while  (&lt;MYSELF&gt;) {
<font class='lnum'>1860</font>   	    # filter here
<font class='lnum'>1861</font>   	    # filter here and
<font class='lnum'>1862</font>   	print TANGLE_PIPE $_;
<font class='lnum'>1863</font>   	}
<font class='lnum'>1864</font>   
<font class='lnum'>1865</font>   	close TANGLE_PIPE;
<font class='lnum'>1866</font>   	close MYSELF;
<font class='lnum'>1867</font>   exit;
<font class='lnum'>1868</font>   
<font class='lnum'>1869</font>   </fieldset></pre>
<p>
<p>
    Pre-filtering might need to bo done. E.g. "notangle" gets confused by double angle brackets<br>
    even when those are inside the document chunks.<br>
    Therefore I could escape those before passing them to the tangler.<br>
<p>
    This of course is kind of stupid, as running 'notangle' without this pre-filter will still<br>
    break it, e.g.<br>
    if I want to do it from command-line with some special options or for a non-root chunk,<br>
<p>
    This is not a full solution in itself. Consider it as a template for pre-filtering, sort of.<br>
<p>
<p>
<font class='lnum'>1883</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tangle me with filtering&gt;&gt;=</legend>
<font class='lnum'>1884</font>   
<font class='lnum'>1885</font>   
<font class='lnum'>1886</font>   TANGLE_ME:
<font class='lnum'>1887</font>   
<font class='lnum'>1888</font>   	open TANGLE_PIPE, "| notangle -t4 -";
<font class='lnum'>1889</font>   
<font class='lnum'>1890</font>   	open MYSELF, "&lt;$0";
<font class='lnum'>1891</font>   	while  (&lt;MYSELF&gt;) {
<font class='lnum'>1892</font>   
<font class='lnum'>1893</font>   	    if ( m!^(goto)?&lt;\&lt;(.*)&gt;\&gt;=! ... m!^@\s*$! ) { # -- CODE CHUNKS -- 
<font class='lnum'>1894</font>   		print TANGLE_PIPE $_;
<font class='lnum'>1895</font>   	    }
<font class='lnum'>1896</font>   	    else {  # -- DOC CHUNKS /and beginning of file, irrelevant / --
<font class='lnum'>1897</font>   
<font class='lnum'>1898</font>   		# filter double angle brackets that confuse "notangle"
<font class='lnum'>1899</font>   		s/&lt;&lt;/$lt_esc$lt_esc/g;
<font class='lnum'>1900</font>   		s/&gt;&gt;/$gt_esc$gt_esc/g;
<font class='lnum'>1901</font>   		print TANGLE_PIPE $_;
<font class='lnum'>1902</font>   	    }
<font class='lnum'>1903</font>   
<font class='lnum'>1904</font>   	} # elihw
<font class='lnum'>1905</font>   
<font class='lnum'>1906</font>   	close TANGLE_PIPE;
<font class='lnum'>1907</font>   	close MYSELF;
<font class='lnum'>1908</font>   exit;
<font class='lnum'>1909</font>   
<font class='lnum'>1910</font>   </fieldset></pre>
<p>
<p>
    <b> BUG of sorts </b><br>
    the "lt" and "gt" escapes in the code chunks right above ("tangle me with filtering") are not <br>
    displayed correctly  by the web weaver: the browser displays them as real angle brackets.<br>
    <s>I could avoid this  by using $lt and $gt perl vars defined in "general settings" for exactly<br>
    cases like this.</s><br>
    I <i>cannot</i> avoid this without setting another couple of perl vars: $gt_esc = "&amp; gt;" etc. ...<br>
<p>
    I do have lines with the same problem in the "dotHTML formatter" chunk as well.<br>
<p>
<p>
<p>
    <b> Immediate execution of the script </b><br>
    It did not work exactly, but then I did not try it for real -- if it is needed and if your<br>
    language supports taking input from STDIN, it may be possible also to immediately run your<br>
    script skipping the stage of "tangling-into-a-file" before running.<br>
    To be added (possibly).<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('43');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('44');">
<font class='lnum'><i>(44)</i></font>&nbsp; Built-in tangler </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1936)</i></sub></font></a></legend></fieldset>
<p>
<div id="44" style="display:none">   
<ul>


<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('45');">
<font class='lnum'><i>(45)</i></font>&nbsp; tangler around "tsort" and string expansion </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1941)</i></sub></font></a></legend></fieldset>
<p>
<div id="45" style="display:none">   
<ul>


<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('46');">
<font class='lnum'><i>(46)</i></font>&nbsp; Main tangler framework </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1947)</i></sub></font></a></legend></fieldset>
<p>
<div id="46" style="display:none">   
<ul>


<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('47');">
<font class='lnum'><i>(47)</i></font>&nbsp; Generalities </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1950)</i></sub></font></a></legend></fieldset>
<p>
<div id="47" style="display:none">   
<ul>

<p>
This version is line-by-line, not "strings in memory" (another option/version<br>
to test next, possibly)<br>
<p>
Need to test 3 things:<br>
    <ol> <li> name of a chunk equal to a multiword string -- DONE<br>
    </li> <li> need to eval the strings -- DONE<br>
    </li> <li> regexp to pick up pieces of a line cleanly -- START with ONE ref per line<br>
    </li> <li> \n during line-by-line appending needed??<br>
    </li> </ol><br>
<p>
<b> OK, philosophy </b><br>
    Perl allows one to have multi-word strings with "line noise" symbols <i> as variable names </i><br>
    and as the names of the keys of a hash.<br>
    Therefore, I am not going to rename the code chunks at all: I'll keep the literal text of the<br>
    chunk as the value of a var, whose name is its title (a free-flowing phrase, too).<br>
    I'll keep a hash like that, too.<br>
    I will next interpolate the literal text of the code chunk interspersed with <br>
    <pre> "'some code text' . $name_of_another_chunk . 'some more text'" </pre><br>
    with "eval" when printing the chunk finally out - and that will give me the sought outcome,<br>
    the properly re-arranged text of the whole program.<br>
<p>
    Now, for this interpolation to happen, perl must know values/definitions of all included vars<br>
    before it attempts the final "eval".<br>
    That will be done with the "topological sort" thingy, which will help me to form another<br>
    string, of the raw splinters without any refs in them.<br>
<p>
    The final output then will be<br>
    <pre> eval($raw_splinters);
    print eval($name_of_my_root_chunk); </pre><br>
<p>
    <i> It is quite possible </i> to do tangling with a half dozen other methods, but I think this<br>
    monstrocity will save me some coding: I relegate all unravelling and interpolation to the<br>
    language interpreter. <br>
    Let the box work, and me relax. Laziness is the supreme virtue ;))))<br>
<p>
<p>
<b> <i> Memory usage </i> </b> will be equal to the size of all program chunks in a given Literate<br>
Source project file (plus whatever perl adds on its own internally) -- maybe double of that because<br>
of interpolation, but with single project files in 10MiB are a rarity, while computer RAM is now<br>
routinely comes to 1-2 GiB, this is not a problem at all<br>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('47');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('48');">
<font class='lnum'><i>(48)</i></font>&nbsp; Main, outline </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 1995)</i></sub></font></a></legend></fieldset>
<p>
<div id="48" style="display:none">   
<ul>

<p>
<p>
The standalone test tangler script<br>
<p>
<b> (1) Pass 1: collect the info </b><br>
<p>
<p>
<font class='lnum'>2003</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;check strings expansion&gt;&gt;=</legend>
<font class='lnum'>2004</font>   #!/usr/bin/perl -w
<font class='lnum'>2005</font>   
<font class='lnum'>2006</font>       $default_target = '*';
<font class='lnum'>2007</font>   
<font class='lnum'>2008</font>       <font class='chunkref'>&lt;&lt;tsort sub in perl&gt;&gt</font>;
<font class='lnum'>2009</font>   
<font class='lnum'>2010</font>       open LITSOURCE, "&lt; $ARGV[0]" || die "could not open the file to tangle\n";
<font class='lnum'>2011</font>   
<font class='lnum'>2012</font>       $chunk_beg_pattern = q(^&lt;\&lt;(.*)&gt;\&gt;=);
<font class='lnum'>2013</font>       $chunk_end_pattern = q(^@\s*$);
<font class='lnum'>2014</font>       $chunk_ref_pattern = q(&lt;\&lt;(.*?)&gt;\&gt;[^=]); # can be used several times in a line
<font class='lnum'>2015</font>   
<font class='lnum'>2016</font>   
<font class='lnum'>2017</font>       $beg_ref_quote = q(\n . ${');
<font class='lnum'>2018</font>       $end_ref_quote = q('} . \n);
<font class='lnum'>2019</font>   
<font class='lnum'>2020</font>       #%code_chunks_buf = (); # accumulating chunks bodies
<font class='lnum'>2021</font>       #%code_chunks_index = (); # like "goto" stack per chunk
<font class='lnum'>2022</font>   
<font class='lnum'>2023</font>       %code_chunk_splinters_raw = ();
<font class='lnum'>2024</font>       @parents_list = ();
<font class='lnum'>2025</font>   
<font class='lnum'>2026</font>       $line_num = 0;
<font class='lnum'>2027</font>   
<font class='lnum'>2028</font>     while (&lt;LITSOURCE&gt;) {
<font class='lnum'>2029</font>   
<font class='lnum'>2030</font>       $line_num++;
<font class='lnum'>2031</font>   
<font class='lnum'>2032</font>       if ( m!$chunk_beg_pattern! .. m!$chunk_end_pattern! ) { # -- CODE CHUNKS -- 
<font class='lnum'>2033</font>   
<font class='lnum'>2034</font>   	if ( $_ =~ m!$chunk_beg_pattern! ) {
<font class='lnum'>2035</font>   	    <font class='chunkref'>&lt;&lt;process chunk title - tangler&gt;&gt</font>;
<font class='lnum'>2036</font>   	}
<font class='lnum'>2037</font>   	elsif ( $_ =~ m!$chunk_end_pattern! )  {
<font class='lnum'>2038</font>   	    <font class='chunkref'>&lt;&lt;process end of code chunk - tangler&gt;&gt</font>;
<font class='lnum'>2039</font>   	    }
<font class='lnum'>2040</font>   	elsif ( $_ =~ m!$chunk_ref_pattern! ) {
<font class='lnum'>2041</font>   	    <font class='chunkref'>&lt;&lt;process chunk ref - tangler&gt;&gt</font>;
<font class='lnum'>2042</font>   	}
<font class='lnum'>2043</font>   	else { # chunk body: accumulate
<font class='lnum'>2044</font>   	    <font class='chunkref'>&lt;&lt;process chunk body - tangler&gt;&gt</font>;
<font class='lnum'>2045</font>   	    }
<font class='lnum'>2046</font>       } #fi
<font class='lnum'>2047</font>   
<font class='lnum'>2048</font>   
<font class='lnum'>2049</font>     } #eliwh
<font class='lnum'>2050</font>   
<font class='lnum'>2051</font>   </fieldset></pre>
<p>
<p>
...next, after we've collected the string, let's <b> <br>
(2) topo-sort them and print out </b><br>
<p>
    /* debug: just print out, first of all */<br>
    /* debug2: print out hte topo-sorted sequence */<br>
    /* debug3: eval all toposorted until Target; print out the Target */<br>
<p>
<p>
<font class='lnum'>2062</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;check strings expansion&gt;&gt;=</legend>
<font class='lnum'>2063</font>   
<font class='lnum'>2064</font>   for $i (keys %code_chunk_splinters_raw){
<font class='lnum'>2065</font>   
<font class='lnum'>2066</font>       #debug: - print chunks content --  seems OK
<font class='lnum'>2067</font>       print "for key $i the content is\n", $code_chunk_splinters_raw{$i}, "\n-----------\n";
<font class='lnum'>2068</font>   
<font class='lnum'>2069</font>   }
<font class='lnum'>2070</font>   
<font class='lnum'>2071</font>   
<font class='lnum'>2072</font>       # debug: print topo-sorted chunk names -- seems OK
<font class='lnum'>2073</font>   for my $i (topological_sort( @parents_list )){ 
<font class='lnum'>2074</font>   
<font class='lnum'>2075</font>       #print "$i\n";
<font class='lnum'>2076</font>   
<font class='lnum'>2077</font>   };
<font class='lnum'>2078</font>   
<font class='lnum'>2079</font>   
<font class='lnum'>2080</font>       # debug: this does not work now
<font class='lnum'>2081</font>       # Complains the "eval" in else is on an empty string
<font class='lnum'>2082</font>   for my $i (topological_sort( @parents_list )){ 
<font class='lnum'>2083</font>       
<font class='lnum'>2084</font>       $output_line .= $code_chunk_splinters_raw{$i};
<font class='lnum'>2085</font>   
<font class='lnum'>2086</font>   }
<font class='lnum'>2087</font>   
<font class='lnum'>2088</font>   $output_line .= q(print $code_chunk_splinters_raw{'*'};);
<font class='lnum'>2089</font>   eval $output_line;
<font class='lnum'>2090</font>   
<font class='lnum'>2091</font>    print "\n====one======\n",
<font class='lnum'>2092</font>    eval($code_chunk_splinters_raw{'ref2'}),
<font class='lnum'>2093</font>    "\n====two======\n",
<font class='lnum'>2094</font>    eval($code_chunk_splinters_raw{'chunk 1'}),
<font class='lnum'>2095</font>   "\n------three------\n",
<font class='lnum'>2096</font>    eval($code_chunk_splinters_raw{'*'}),
<font class='lnum'>2097</font>    "\n=============\n";
<font class='lnum'>2098</font>   
<font class='lnum'>2099</font>   print eval ( $code_chunk_splinters_raw{$default_target} ), "\n";
<font class='lnum'>2100</font>   
<font class='lnum'>2101</font>   
<font class='lnum'>2102</font>   </fieldset></pre>
<p>
<b> First impression </b> - even manually the "eval prebuilt string" does not seem<br>
to work. Either the approach is not valid (what I missed in my primitive tests), or<br>
I think of it in an overcomplicated way, and in fact it's much simpler...<br>
<p>
<i> Looks like </i> "eval"-ed code does not come to the current "namespace" or sth:<br>
it evals and remains there. I.e. eval'ed vars are not available later from the calling<br>
namespace.<br>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('48');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('49');">
<font class='lnum'><i>(49)</i></font>&nbsp; Processing particular sections </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2114)</i></sub></font></a></legend></fieldset>
<p>
<div id="49" style="display:none">   
<ul>

<p>
<b> We got the first line of a chunk, its title </b><br>
    # form the name and push into the hash-stack<br>
    # ..after checking it's not a continuation of an already def-d chunk<br>
    #   $current_chunk_title_ref = ${$1};<br>
<p>
    ?? - what happens in the "else" when I do not hit the "unless" clause ??<br>
    !! - <b> logical ERROR </b> - a continued chunk (another 'installment') requires <br>
    separate treatment<br>
<p>
<b> Version two - rewrite </b> <br>
<s> Nothing needs t be done sith the first line, can keep it as a NOP, actually. </s><br>
<p>
<font class='lnum'>2128</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process chunk title - tangler -TWO&gt;&gt;=</legend>
<font class='lnum'>2129</font>   
<font class='lnum'>2130</font>       $current_chunk_name = $1;
<font class='lnum'>2131</font>       $code_chunk_splinters_raw{$current_chunk_name} .= "" . " q( " ;
<font class='lnum'>2132</font>   
<font class='lnum'>2133</font>   </fieldset></pre>
<p>
<p>
<font class='lnum'>2136</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process chunk title - tangler&gt;&gt;=</legend>
<font class='lnum'>2137</font>       # placeholder
<font class='lnum'>2138</font>       $current_chunk_name = $1;
<font class='lnum'>2139</font>       unless (defined $code_chunk_splinters_raw{$current_chunk_name} ) {
<font class='lnum'>2140</font>   	$code_chunk_splinters_raw{$current_chunk_name} =  "\n" . q(  $output_text{') . 
<font class='lnum'>2141</font>   	$current_chunk_name . q('} ) . "= q( "
<font class='lnum'>2142</font>       };
<font class='lnum'>2143</font>   
<font class='lnum'>2144</font>   
<font class='lnum'>2145</font>   </fieldset></pre>
<p>
<b> Secondly, if the chunk ended </b><br>
<p>
    ..then append the closing symbols of the quoted string, poss. reset some vars.<br>
<p>
<font class='lnum'>2151</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process end of code chunk - tangler - TWO&gt;&gt;=</legend>
<font class='lnum'>2152</font>   
<font class='lnum'>2153</font>       $code_chunk_splinters_raw{$current_chunk_name} .= ' );' . "\n";
<font class='lnum'>2154</font>   </fieldset></pre>
<p>
<font class='lnum'>2156</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process end of code chunk - tangler&gt;&gt;=</legend>
<font class='lnum'>2157</font>       # placeholder
<font class='lnum'>2158</font>       $code_chunk_splinters_raw{$current_chunk_name} .= ' );' . "\n";
<font class='lnum'>2159</font>   
<font class='lnum'>2160</font>   
<font class='lnum'>2161</font>   </fieldset></pre>
<p>
<p>
<b> If it is raw code </b><br>
<p>
    no refs to other chunks - i.e. if it's a pure code body line,<br>
    then just append it<br>
<p>
    (a) mm.. do I need to quote and append??? Or is it OK already??<br>
    (b) I did not "chomp" the line, so the "\n" should be present<br>
<p>
<font class='lnum'>2172</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process chunk body - tangler&gt;&gt;=</legend>
<font class='lnum'>2173</font>   
<font class='lnum'>2174</font>   $code_chunk_splinters_raw{$current_chunk_name} .= $_;
<font class='lnum'>2175</font>   
<font class='lnum'>2176</font>   </fieldset></pre>
<p>
<p>
<p>
<b> Now: if we got a chunk ref </b><br>
    # 1. (a) append the pre-ref string to the curr_chunk_namevar<br>
    #   (b) .. concat the ref_chunk_namevar to it<br>
    #   (c) .. and concat the rest of the line<br>
    # 2. ...and make sure the $ref_chunk_namevar string is defined before<br>
    #   this chunk is processed -- for the strings based subst. and expansion.<br>
    #   - i.e. (a) push (parent, child) pair into a list to be topo-sorted later.<br>
    #   and (b) append to ..<br>
<p>
    Ok, here's a small hitch: I'd better keep bare string defs, without refs, in a<br>
    separate string buffer, and the composite ones in a second one.<br>
<p>
    So I'd need to generate consequtive names current_chunk-1, current_chunk-2 etc. <br>
    and keep their defs in buffer_string_1, while the composite name like<br>
    <pre> $current_chunk =  $current_chunk-1 . $chunk_ref . $current_chunk_2 </pre> <br>
    in buffer_string_2<br>
<p>
<font class='lnum'>2197</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process chunk ref - tangler - TWO&gt;&gt;=</legend>
<font class='lnum'>2198</font>   
<font class='lnum'>2199</font>       $chunk_ref_name = $1;
<font class='lnum'>2200</font>       $code_chunk_splinters_raw{$current_chunk_name} .= q( \) . ) . "\n" . 
<font class='lnum'>2201</font>   	q( . $code_chunk_splinters_raw{') . $chunk_ref_name . q('} . ) . "\n q(" ;
<font class='lnum'>2202</font>   
<font class='lnum'>2203</font>       unshift @parents_list, ($current_chunk_name, $chunk_ref_name);
<font class='lnum'>2204</font>   
<font class='lnum'>2205</font>   
<font class='lnum'>2206</font>   </fieldset></pre>
<p>
<p>
<font class='lnum'>2209</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process chunk ref - tangler&gt;&gt;=</legend>
<font class='lnum'>2210</font>       # placeholder
<font class='lnum'>2211</font>       $chunk_ref_name = $1;
<font class='lnum'>2212</font>   
<font class='lnum'>2213</font>       #$code_chunk_splinters_raw{$current_chunk_name} .= "\n" . q( . ${') . $chunk_ref_name . 
<font class='lnum'>2214</font>       #   q('} . ) . "\n";
<font class='lnum'>2215</font>   
<font class='lnum'>2216</font>       $code_chunk_splinters_raw{$current_chunk_name} .= q(\) . ) . "\n" . 
<font class='lnum'>2217</font>   	q( . $code_chunk_splinters_raw{') . $chunk_ref_name . q('} . ) . "\n q(";
<font class='lnum'>2218</font>   
<font class='lnum'>2219</font>       unshift @parents_list, ($current_chunk_name, $chunk_ref_name);
<font class='lnum'>2220</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('49');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('46');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('50');">
<font class='lnum'><i>(50)</i></font>&nbsp; Topological Sort </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2227)</i></sub></font></a></legend></fieldset>
<p>
<div id="50" style="display:none">   
<ul>


<p>
<p>
takes a list of (flattened) pairs ( (node_1, depends_on_1), (node_1, depends_on_2), ....)<br>
-- and produces a list of ordered precursors: ( depends_on_2 , depends_on_1, node_1, .....)<br>
for the whole tree of nodes and their dependencies.<br>
<p>
If I do "strings interpolation" tanger, I will need it to define the inned simple strings<br>
<i> before </i>  the complex ones which represent chunks, so they get interpolated without<br>
perl complaining about unknown strings.<br>
<p>
<p>
I will modify in-place this sub yanked from "tcsort.txt", a perl implementation of<br>
the unix "tsort" utility (originally from a Knuth algorithm) by Jeffrey S. Haemer in<br>
his project that reimplements unix utils in pure perl.<br>
<a href= http://cpansearch.perl.org/src/CWEST/ppt-0.14/README > http://cpansearch.perl.org/src/CWEST/ppt-0.14/README </a><br>
<p>
<p>
<font class='lnum'>2246</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;tsort sub in perl&gt;&gt;=</legend>
<font class='lnum'>2247</font>   
<font class='lnum'>2248</font>   #use strict;
<font class='lnum'>2249</font>   
<font class='lnum'>2250</font>   sub topological_sort {
<font class='lnum'>2251</font>   
<font class='lnum'>2252</font>       my %pairs;	# all pairs ($l, $r)
<font class='lnum'>2253</font>       my %npred;	# number of predecessors
<font class='lnum'>2254</font>       my %succ;	# list of successors
<font class='lnum'>2255</font>       my $opt_b = 0;
<font class='lnum'>2256</font>   
<font class='lnum'>2257</font>       my @topo_list_out = '';
<font class='lnum'>2258</font>   
<font class='lnum'>2259</font>       while ( @_ ) {
<font class='lnum'>2260</font>   	my $l = shift @_;
<font class='lnum'>2261</font>   	my $r = shift @_;
<font class='lnum'>2262</font>   	my @l = ($l, $r);
<font class='lnum'>2263</font>   	#my ($l, $r) = my @l = split;
<font class='lnum'>2264</font>   	next unless @l == 2;
<font class='lnum'>2265</font>   	next if defined $pairs{$l}{$r};
<font class='lnum'>2266</font>   	$pairs{$l}{$r}++;
<font class='lnum'>2267</font>   	$npred {$l} += 0;
<font class='lnum'>2268</font>   	++$npred{$r};
<font class='lnum'>2269</font>   	push @{$succ{$l}}, $r;
<font class='lnum'>2270</font>       }
<font class='lnum'>2271</font>   
<font class='lnum'>2272</font>       # create a list of nodes without predecessors
<font class='lnum'>2273</font>       my @list = grep {!$npred{$_}} keys %npred;
<font class='lnum'>2274</font>   
<font class='lnum'>2275</font>       while (@list) {
<font class='lnum'>2276</font>   	$_ = pop @list;
<font class='lnum'>2277</font>   	unshift @topo_list_out, $_;
<font class='lnum'>2278</font>   	#print "$_\n";
<font class='lnum'>2279</font>   	foreach my $child (@{$succ{$_}}) {
<font class='lnum'>2280</font>   	    if ($opt_b) {	# breadth-first
<font class='lnum'>2281</font>   		unshift @list, $child unless --$npred{$child};
<font class='lnum'>2282</font>   	    } else {	# depth-first (default)
<font class='lnum'>2283</font>   		push @list, $child unless --$npred{$child};
<font class='lnum'>2284</font>   	    }
<font class='lnum'>2285</font>   
<font class='lnum'>2286</font>   	}
<font class='lnum'>2287</font>       }
<font class='lnum'>2288</font>   
<font class='lnum'>2289</font>       warn "cycle detected\n" if grep {$npred{$_}} keys %npred;
<font class='lnum'>2290</font>   
<font class='lnum'>2291</font>       return @topo_list_out;
<font class='lnum'>2292</font>   }
<font class='lnum'>2293</font>   
<font class='lnum'>2294</font>   </fieldset></pre>
<p>
<font class='lnum'>2296</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;check topo sort&gt;&gt;=</legend>
<font class='lnum'>2297</font>   
<font class='lnum'>2298</font>   <font class='chunkref'>&lt;&lt;tsort sub in perl&gt;&gt</font>;
<font class='lnum'>2299</font>   
<font class='lnum'>2300</font>   # let's check if it works now -- this should print it
<font class='lnum'>2301</font>   
<font class='lnum'>2302</font>   my @parents_list = ( ("a",  "b"),  ("a",  "d"),  ("a",  "c"),  ("b",  "c"),  ("d",  "e") );
<font class='lnum'>2303</font>   
<font class='lnum'>2304</font>   for my $i (topological_sort( @parents_list )){ print "$i\n";};
<font class='lnum'>2305</font>   
<font class='lnum'>2306</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('50');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('51');">
<font class='lnum'><i>(51)</i></font>&nbsp; Strange var and hash key names plus string interpolation </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2311)</i></sub></font></a></legend></fieldset>
<p>
<div id="51" style="display:none">   
<ul>


<p>
    For reference for the main tangler script below. This script has been tested and<br>
    it works as intended.<br>
<p>
<font class='lnum'>2317</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;test names and deref&gt;&gt;=</legend>
<font class='lnum'>2318</font>   # 1. Dereferencing and using long bad strings as varnames and keys in hashes
<font class='lnum'>2319</font>   
<font class='lnum'>2320</font>   $hash{q(a long $strange #tring wi# symbols)} = q(another long string @$%^ with strange symbols);
<font class='lnum'>2321</font>   
<font class='lnum'>2322</font>   while (($a, $b) = each %hash) {
<font class='lnum'>2323</font>   	print qq(key is -- $a -- and value is -- $b --\n);
<font class='lnum'>2324</font>   	}
<font class='lnum'>2325</font>   
<font class='lnum'>2326</font>   ${q(a long $strange #tring wi# symbols)} = "hehehe";
<font class='lnum'>2327</font>   print "AND NEXT IS ${q(a long $strange #tring wi# symbols)} \n";
<font class='lnum'>2328</font>   
<font class='lnum'>2329</font>   $$c = "a am a string whose name is a bad string";
<font class='lnum'>2330</font>   print "dereffing: $$c\n";
<font class='lnum'>2331</font>   
<font class='lnum'>2332</font>   
<font class='lnum'>2333</font>   
<font class='lnum'>2334</font>   # 2.  Interpolation.
<font class='lnum'>2335</font>   ${q(A chunk with a long name?!)} = q('some string @#$%^ with noise');
<font class='lnum'>2336</font>   ${q(A chunk with a long name?!)} .= q( . " ||| " . $hash{q(a long $strange #tring wi# symbols)} );
<font class='lnum'>2337</font>   
<font class='lnum'>2338</font>   print "\nFIRST, the string as I keep it in my buffer:\n\t${q(A chunk with a long name?!)}\n";
<font class='lnum'>2339</font>   print "NOW THE TRICK::\n\t", eval(${q(A chunk with a long name?!)}), "\n";
<font class='lnum'>2340</font>   
<font class='lnum'>2341</font>   
<font class='lnum'>2342</font>   # 3. Picking up chunk name from a regexp
<font class='lnum'>2343</font>   #   .. no refs are needed at all, actually, the vars do it anyway, it seems.
<font class='lnum'>2344</font>   
<font class='lnum'>2345</font>   $line1_test3 = q(&lt;&lt;ch*nk n@me wh&amp;ch q(i$$ a p#r@se)&gt;&gt;=);
<font class='lnum'>2346</font>   $line2_test3 = q(some text from the chunk body);
<font class='lnum'>2347</font>   $line3_test3 = q(second line of the same chunk body);
<font class='lnum'>2348</font>   $chunk_beg_pattern_test3 = "^&lt;\&lt;(.*)&gt;\&gt;=";
<font class='lnum'>2349</font>   %chunks_hash_test3 = ();
<font class='lnum'>2350</font>   
<font class='lnum'>2351</font>   if ( $line1_test3 =~ $chunk_beg_pattern_test3 ) {
<font class='lnum'>2352</font>   
<font class='lnum'>2353</font>     $chunk_name = $1;
<font class='lnum'>2354</font>     print "\n\n............\n$line1_test3\n\n";
<font class='lnum'>2355</font>     print "HHHHHHHHHHH $chunk_name HHHHHHHHHHHH\n";
<font class='lnum'>2356</font>     print "$chunk_name\n";
<font class='lnum'>2357</font>     $chunks_hash_test3{$chunk_name} .= $line2_test3 . "\n";
<font class='lnum'>2358</font>     $chunks_hash_test3{$chunk_name} .= $line3_test3;
<font class='lnum'>2359</font>   
<font class='lnum'>2360</font>   }
<font class='lnum'>2361</font>   else {print "\n
<font class='lnum'>2362</font>       \n===========\ncould not match it\n"};
<font class='lnum'>2363</font>   
<font class='lnum'>2364</font>     print "\n----------\n$chunks_hash_test3{$chunk_name}\n-------------\n";
<font class='lnum'>2365</font>   
<font class='lnum'>2366</font>   
<font class='lnum'>2367</font>   
<font class='lnum'>2368</font>   
<font class='lnum'>2369</font>   #---end---
<font class='lnum'>2370</font>   
<font class='lnum'>2371</font>   </fieldset></pre>
<p>
Script output (from 1,2):<br>
-------------------------------------<br>
    <pre>
    bash-3.1$ perl xxx
    key is -- a long $strange #tring wi# symbols -- and value is -- another long string @$%^ with strange symbols --
    AND NEXT IS hehehe
    dereffing: a am a string whose name is a bad string

    FIRST, the string as I keep it in my buffer:
	    'some string @#$%^ with noise' . " ||| " . $hash{q(a long $strange #tring wi# symbols)}
    NOW THE TRICK::
	    some string @#$%^ with noise ||| another long string @$%^ with strange symbols
    bash-3.1$ 
    </pre><br>
-------------------------------------<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('51');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('45');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('52');">
<font class='lnum'><i>(52)</i></font>&nbsp; Scrap pieces for tangler </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2395)</i></sub></font></a></legend></fieldset>
<p>
<div id="52" style="display:none">   
<ul>


<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('53');">
<font class='lnum'><i>(53)</i></font>&nbsp; 1. Use MD5 for chunk titles? </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2400)</i></sub></font></a></legend></fieldset>
<p>
<div id="53" style="display:none">   
<ul>


<p>
    Chunk names are free phrases in a human lang. I need poss. to make a hash of contents with<br>
    the title as  the key. A phrase is not good for that, so could I use MD5 hashes of the titles<br>
    instead??<br>
<p>
    PErl will require a module then:<br>
<p>
<p>
<font class='lnum'>2410</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;md5 hashing from perl&gt;&gt;=</legend>
<font class='lnum'>2411</font>   #!/usr/bin/perl
<font class='lnum'>2412</font>   # Functional style
<font class='lnum'>2413</font>    use Digest::MD5 qw(md5 md5_hex md5_base64);
<font class='lnum'>2414</font>   
<font class='lnum'>2415</font>    #$digest = md5($data);
<font class='lnum'>2416</font>    #$digest = md5_hex($data);
<font class='lnum'>2417</font>    #$digest = md5_base64($data);
<font class='lnum'>2418</font>   
<font class='lnum'>2419</font>    # my test:
<font class='lnum'>2420</font>    $digest1 = md5_base64("md5 hashing from perl");
<font class='lnum'>2421</font>    $digest2 = md5_base64("Chunk names are free phrases in a human lang. I need poss. to make a hash 
<font class='lnum'>2422</font>       of contents with the title as  the key. A phrase is not good for that, so could I use MD5 
<font class='lnum'>2423</font>       hashes of the title");
<font class='lnum'>2424</font>    print "$digest1\n$digest2\n";
<font class='lnum'>2425</font>   </fieldset></pre>
<p>
<b> Nope, it's much simpler </b><br>
<b> 1. </b> In fact, perl can digest "chunk names made of whole phrases" as hash keys - one just <br>
needs to quote them. There may be limitations on the special symbols inside the chunk titles, I<br>
do not know. <br>
Seen in Conway's book, first chapters recapitulating main point of perl<br>
<p>
<b> 2. </b> A more restrictive option can be left as settable in the "mollifying" part of the<br>
script -- use_chunk_names_of_alphanumerics_only with underscores in place of spaces.<br>
Then I could programmatically match for alphanumeric chars during a first tangle pass and<br>
complain if chunk names mismatch. <br>
<p>
So <b> no MD5 is needed after all, it seems </b><br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('53');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('54');">
<font class='lnum'><i>(54)</i></font>&nbsp; 2. ver 1 -- skeleton for tangling </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2444)</i></sub></font></a></legend></fieldset>
<p>
<div id="54" style="display:none">   
<ul>


<p>
<p>
    <i>Cut out code chunks; <br>
    create hash; <br>
    ..concatting parts of the same chunk. </i><br>
<p>
    I will get here if I am "scriptname.tangle" and $builtin_tangler = 1<br>
<p>
<p>
<font class='lnum'>2455</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;built-in tangler skeleton&gt;&gt;=</legend>
<font class='lnum'>2456</font>   #!/usr/bin/perl
<font class='lnum'>2457</font>       use Digest::MD5 qw(md5_base64);
<font class='lnum'>2458</font>   
<font class='lnum'>2459</font>       $use_builtin_tangler = 1;
<font class='lnum'>2460</font>       unless ($use_builtin_tangler) {print "not set to tangle in the options\n"; exit}
<font class='lnum'>2461</font>   
<font class='lnum'>2462</font>       <font class='chunkref'>&lt;&lt;first pass of tangling - accumulate in RAM&gt;&gt</font>;
<font class='lnum'>2463</font>       <font class='chunkref'>&lt;&lt;second pass of tangling - print out&gt;&gt</font>;
<font class='lnum'>2464</font>   </fieldset></pre>
<p>
<p>
    <b> <i> note 1 </i> </b><br>
    The following works with implicit understanting of the correct sequencing of the symbols in the<br>
    Literate SOurce file. If those are mangled, results are not guaranteed. <br>
    I mean, no check is done to complain in case "&lt; &lt;  blabla &gt; &gt;=" and "@" do not follow each other<br>
    or if those nest etc.<br>
<p>
    <b> <i> note 2 </i> </b><br>
    Besides accumulating code, I also need to do indeces (also hashes)?<br>
    One idea is to have immediate access to "parent roots", because I foresee 3 modes of tangling:<br>
    <ul> <li>the default chunk "*"<br>
    </li><li>the specified chunk<br>
    </li><li>and "all root chunks" to kind of "check out the whole project" from the Literate Source<br>
    </li></ul><br>
    If I do not maintain the 3 modes and tangle from the "*" specified in the LitSource file, I won't<br>
    need the indeces, I think.<br>
<p>
<p>
<font class='lnum'>2484</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;first pass of tangling - accumulate in RAM&gt;&gt;=</legend>
<font class='lnum'>2485</font>       open LITSOURCE, "&lt; $ARGV[$1]" || die "could not open the file to tangle\n";
<font class='lnum'>2486</font>   
<font class='lnum'>2487</font>       $chunk_beg_pattern = "^&lt;\&lt;(.*)&gt;\&gt;=";
<font class='lnum'>2488</font>       $chunk_end_pattern = "^@\s*$";
<font class='lnum'>2489</font>       $chunk_ref_pattern = "&lt;\&lt;(.*?)&gt;\&gt;[^=]"; # can be used several times in a line
<font class='lnum'>2490</font>   
<font class='lnum'>2491</font>       %code_chunks_buf = (); # accumulating chunks bodies
<font class='lnum'>2492</font>       %code_chunks_index = (); # like "goto" stack per chunk
<font class='lnum'>2493</font>   
<font class='lnum'>2494</font>     while (&lt;LITSOURCE&gt;) {
<font class='lnum'>2495</font>   
<font class='lnum'>2496</font>       if ( m!$chunk_beg_pattern! .. m!$chunk_end_pattern! ) { # -- CODE CHUNKS -- 
<font class='lnum'>2497</font>   
<font class='lnum'>2498</font>   	if ( $_ =~ m!$chunk_beg_pattern! ) {
<font class='lnum'>2499</font>   	    # form md5 and push into the hash-stack
<font class='lnum'>2500</font>   	    $title_hash = md5_base64($1);
<font class='lnum'>2501</font>   	    }
<font class='lnum'>2502</font>   	elsif ( $_ =~ m!$chunk_end_pattern! )  {
<font class='lnum'>2503</font>   	    # end of code chunk
<font class='lnum'>2504</font>   	    }
<font class='lnum'>2505</font>   	elsif ( $_ =~ m!$chunk_ref_pattern! ) {
<font class='lnum'>2506</font>   	    # 1. form and push "goto" and "cont" into the hash-stack
<font class='lnum'>2507</font>   	    #	.. which are a concatenation of strings
<font class='lnum'>2508</font>   	    # 2. ...and make sure the $ref_chunkname string is defined before
<font class='lnum'>2509</font>   	    # this chunk is processed -- for the strings based subst. and expansion.
<font class='lnum'>2510</font>   	    }
<font class='lnum'>2511</font>   	else { # chunk body: accumulate
<font class='lnum'>2512</font>   	    $code_chunks_buf{$title_hash} .= $_;
<font class='lnum'>2513</font>   	    }
<font class='lnum'>2514</font>       } #fi
<font class='lnum'>2515</font>   
<font class='lnum'>2516</font>   
<font class='lnum'>2517</font>     } #eliwh
<font class='lnum'>2518</font>   </fieldset></pre>
<p>
<p>
    Now all code chunks, concatenated if they have the same name, are in RAM (inside %title_hash), <br>
    I can do the second pass and unravel them.<br>
<p>
<p>
<p>
<p>
<b> 3. Second pass of tangling </b><br>

<p>
    Let's do tangling  from "*" only in this skeleton version<br>
<p>
    The chunks now are in RAM as a string; I need to match &lt; &lt; chunk refs &gt; &gt; and continue right<br>
    after processing them.<br>
    Seems it can be done with a regexp which marks the place of its last match.<br>
<p>
    err.. multiline matching; only-once + continuation -- the regexp options needed -- ??<br>
<p>
    Secondly, it creates a recursive function.<br>
<p>
<font class='lnum'>2540</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;second pass of tangling - print out&gt;&gt;=</legend>
<font class='lnum'>2541</font>    # second pass - tangling from %code_chunks_buf using %code_chunks_index for directions
<font class='lnum'>2542</font>   
<font class='lnum'>2543</font>    $default_root = md5_base64("*");
<font class='lnum'>2544</font>   
<font class='lnum'>2545</font>       # bullshit
<font class='lnum'>2546</font>       #$code_chunks_buf{$default_root} =~ m!!;
<font class='lnum'>2547</font>   
<font class='lnum'>2548</font>   </fieldset></pre>
<p>
    <b> ...STOP... </b><br>
<p>
    <b> Basically, if we use the strings expansion/subst, the call to print out is just<br>
    "print $firstchunkname;" - the rest will work out automatically???<br>
    Or do I  need to "eval" the formed re-ordered strings first??  </b><br>
<p>
    <b> ALSO: </b> "tsort" in pure perl implementing a Don Knuth's algorithm:<br>
    <a href= http://cpansearch.perl.org/src/CWEST/ppt-0.14/html/commands/tsort/index.html > http://cpansearch.perl.org/src/CWEST/ppt-0.14/html/commands/tsort/index.html </a><br>
    It's part of "Perl Power Tools" project, reimplementing Unix tools in perl:<br>
    (or, rather a "Unix Reconstruction Project"):<br>
    <a href= http://cpansearch.perl.org/src/CWEST/ppt-0.14/README > http://cpansearch.perl.org/src/CWEST/ppt-0.14/README </a><br>
<p>
    Actually, I downloaded the whole bundle, 3.9MiB compressed.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('54');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('55');">
<font class='lnum'><i>(55)</i></font>&nbsp; 4. Another idea for tangling </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2568)</i></sub></font></a></legend></fieldset>
<p>
<div id="55" style="display:none">   
<ul>


<p>
    Basically, I should create more chunks in $code_chunks_buf than the number of those <br>
    existing in reality.<br>
<p>
    The idea is to split them at each &lt; &lt;  chunk ref &gt; &gt; to print out without parsing <br>
    the string at all.<br>
    Then all I need is a parent-child index, that's all??<br>
<p>
    The parent-child index must be able to keep multiple offspring then (in case some <br>
    chunk is reused, say if it is a func used in several contexts.<br>
<p>
    <b> and for <i> srings substutution </i> which is done with lazy regexp thingy below<br>
    the first pass is just ........ </b><br>
<p>
<b> 5. One more idea </b> <br>

    if I cannot iterate strings lazily, why not iterate over the file twice?<br>
    Operators which work on the files are by their nature lazy both in perl and in newlisp.<br>
    I.e. first pass - get offsets, form the "goto-index" hash, second pass - unravel.<br>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('55');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('56');">
<font class='lnum'><i>(56)</i></font>&nbsp; 6. Lazy iteration over strings in a memory buf </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2594)</i></sub></font></a></legend></fieldset>
<p>
<div id="56" style="display:none">   
<ul>


<p>
    ..seems possible after all, check <br>
    <a href=http://localhost:8000/perl.docs/perlretut-perldoc.perl.org.weave >http://localhost:8000/perl.docs/perlretut-perldoc.perl.org.weave </a><br>
    as a cumbersome combination of "g" option, "pos()" function and \G ancor<br>
    see "global matching" subsection in the above doc (under "using regexp in Perl")<br>
<p>
<p>
    HEre's a snippet that seems to work:<br>
<p>
<font class='lnum'>2605</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;matchstring2.pl&gt;&gt;=</legend>
<font class='lnum'>2606</font>   #!/usr/bin/perl
<font class='lnum'>2607</font>   
<font class='lnum'>2608</font>   #------JUST a string to test the regexps on ------------
<font class='lnum'>2609</font>   $string = &lt;&lt;end_of_string;
<font class='lnum'>2610</font>   bla-bla-bla /leaving it out/
<font class='lnum'>2611</font>   end_of_string
<font class='lnum'>2612</font>   
<font class='lnum'>2613</font>   #---------------end of string--------------
<font class='lnum'>2614</font>   
<font class='lnum'>2615</font>   =head
<font class='lnum'>2616</font>   # first test, bad:
<font class='lnum'>2617</font>   # match-prematch work, but on the WHOLE string. BAD:
<font class='lnum'>2618</font>     while ( $string =~ m!&lt;\&lt;(.*?)&gt;\&gt;[^=]!gc) {
<font class='lnum'>2619</font>       print "\n\n---PREMATCH---\n$`\n\n";
<font class='lnum'>2620</font>       print "MATCH\n$1\n\n";
<font class='lnum'>2621</font>       }
<font class='lnum'>2622</font>   =cut
<font class='lnum'>2623</font>   
<font class='lnum'>2624</font>   
<font class='lnum'>2625</font>   # --HERE'S ANOTHER IDEA--
<font class='lnum'>2626</font>   # the use of \G ancor and poss the pos() function
<font class='lnum'>2627</font>   #pos($string) = 0;
<font class='lnum'>2628</font>   while ( $string =~ m!\G(.*?)&lt;\&lt;(.*?)&gt;\&gt;!gs) {
<font class='lnum'>2629</font>     
<font class='lnum'>2630</font>     $off = length($2);
<font class='lnum'>2631</font>     $position = pos($string);
<font class='lnum'>2632</font>     #pos($string) = $position + $off;
<font class='lnum'>2633</font>     print "\n\t---title---\n$2 of length $off at $position \n\t----after----\n$1\n========\n";
<font class='lnum'>2634</font>   
<font class='lnum'>2635</font>   }
<font class='lnum'>2636</font>   
<font class='lnum'>2637</font>   </fieldset></pre>
<p>
     ONE PROBLEM:<br>
     last piece, post-chunk ?? OR not a prob when reading from a file??<br>
<p>
     Looks like this can solve the prob of parsing a code chunk with included &lt; &lt;references&gt; &gt;<br>
    when hitting a match:<br>
    <ul>		- append $1 to the chunk buffer<br>
		    - get md5, push it into the index<br>
		    - form an md5 for the continuation and start that new chunk<br>
		    - .. and push "goto" this continuation into the prev chunk index<br>
    </ul><br>
     Do this linearly on all cut out code chunks of the Literate Source file (appending those <br>
     with the same names)<br>
     and print out from memory on pass 2 according to the goto index.<br>
<p>
     Should preserve all offsets as well.<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('56');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('52');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('44');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('42');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('57');">
<font class='lnum'><i>(57)</i></font>&nbsp; Weaver </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2668)</i></sub></font></a></legend></fieldset>
<p>
<div id="57" style="display:none">   
<ul>


<p>
<p>
The idea of the weaver is simple, again.<br>
<p>
<font class='lnum'>2674</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;weave me&gt;&gt;=</legend>
<font class='lnum'>2675</font>   
<font class='lnum'>2676</font>   
<font class='lnum'>2677</font>   WEAVE_ME:
<font class='lnum'>2678</font>   
<font class='lnum'>2679</font>   #1. Set formatting strings for weaver
<font class='lnum'>2680</font>   <font class='chunkref'>&lt;&lt;set formatting strings for weaver&gt;&gt</font>;
<font class='lnum'>2681</font>   
<font class='lnum'>2682</font>   #2. accumulate result in a buffer
<font class='lnum'>2683</font>   <font class='chunkref'>&lt;&lt;accumulate result in a buffer&gt;&gt</font>;
<font class='lnum'>2684</font>   
<font class='lnum'>2685</font>   #3. print out the TOC, the Chunks Index, the output buffer and close the page.
<font class='lnum'>2686</font>   <font class='chunkref'>&lt;&lt;print out&gt;&gt</font>;
<font class='lnum'>2687</font>   </fieldset></pre>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('58');">
<font class='lnum'><i>(58)</i></font>&nbsp; How formatting is done in the weaver </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2691)</i></sub></font></a></legend></fieldset>
<p>
<div id="58" style="display:none">   
<ul>


<p>
<b>1 The first formatting element </b>  that is  part of the <i> function </i> of the script<br>
rather than formatting decorations is the<br>
<pre> frameset - legend - /legend - /frameset </pre><br>
which create the distinctive look of the documents generated by MOLLY. I do not wish to<br>
change them (although strictly speaking they are not obligatory).<br>
<p>
What can be changed is the Stylesheet (a part of the script, it has its own subsection), so<br>
other people could play with fonts and colors and margins and such by throwing in a simple<br>
switch and copying their alternative stylesheet into the script.<br>
<p>
I do not wish to use external files for any configuration, as the whole idea of MOLLY is to<br>
be a single self-contained script, which does not require any "installation" of many files to<br>
many places.<br>
<p>
<b>2  Secondly,</b> the "actual working test.html" subsection below probably explains best how<br>
<b> text folding and background highlighting </b> which is tied to it (i.e. a TOC click will open the <br>
section + highlight; and click on the section in the body of the doc will toggle it + highlight <br>
the TOC line ) work.<br>
<p>
Actual implementation is spread between several subsections - they are<br>
coded in in the hard way, as I do not expect them to change ever, they are a functional element<br>
not a changeable "skin" or decoration.<br>
<ul><li> vars, JS and styles are set in the weaver "set formatting strings for weaver" subsections;<br>
</li><li> invocations can be seen in "accumulate the result", esp in the "section headings"<br>
</li><li> and more are applied in the "print out the result"<br>
</li></ul><br>
<p>
Some of the vars are set to pieces of formatting strings in the beginning, and later variables<br>
in them are interpolated with "executable" regexs ( the "e" flag at the end of the regex) - see <br>
"process section headings"<br>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('59');">
<font class='lnum'><i>(59)</i></font>&nbsp; actual working test.html </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2727)</i></sub></font></a></legend></fieldset>
<p>
<div id="59" style="display:none">   
<ul>


<p>
Here's the actual script that was used to test the JS folding and<br>
tying of folding to the TOC section highlighting:<br>
<p>
<p>
<font class='lnum'>2734</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;test.html&gt;&gt;=</legend>
<font class='lnum'>2735</font>   
<font class='lnum'>2736</font>   &lt;html&gt;
<font class='lnum'>2737</font>   &lt;head&gt;
<font class='lnum'>2738</font>   
<font class='lnum'>2739</font>   
<font class='lnum'>2740</font>   &lt;style type="text/css"&gt;
<font class='lnum'>2741</font>   
<font class='lnum'>2742</font>   
<font class='lnum'>2743</font>   .unhilited {background-color:white}
<font class='lnum'>2744</font>   .hilited {background-color:yellow; text-decoration:underline}
<font class='lnum'>2745</font>   &lt;/style&gt;
<font class='lnum'>2746</font>   
<font class='lnum'>2747</font>   
<font class='lnum'>2748</font>   &lt;script type="text/javascript"&gt;
<font class='lnum'>2749</font>   
<font class='lnum'>2750</font>       function setHilite(evt) {
<font class='lnum'>2751</font>   	evt = (evt) ? evt : ((window.event) ? window.event : null);
<font class='lnum'>2752</font>   	if (evt) {
<font class='lnum'>2753</font>   	    var elem = (evt.srcElement) ? evt.srcElement : evt.target;
<font class='lnum'>2754</font>   	    elem.className = "hilited";
<font class='lnum'>2755</font>   	}
<font class='lnum'>2756</font>       }
<font class='lnum'>2757</font>   
<font class='lnum'>2758</font>   
<font class='lnum'>2759</font>   function setUnHilite(evt) {
<font class='lnum'>2760</font>       evt = (evt) ? evt : ((window.event) ? window.event : null);
<font class='lnum'>2761</font>   	if (evt) {
<font class='lnum'>2762</font>       	    var elem = (evt.srcElement) ? evt.srcElement : evt.target;
<font class='lnum'>2763</font>       	    elem.className = "unhilited";
<font class='lnum'>2764</font>   	}
<font class='lnum'>2765</font>   }
<font class='lnum'>2766</font>   
<font class='lnum'>2767</font>   function toggleDiv(divid) {
<font class='lnum'>2768</font>   var el = document.getElementById(divid);
<font class='lnum'>2769</font>   el.style.display = (el.style.display == 'block') ? 'none' : 'block';
<font class='lnum'>2770</font>   }
<font class='lnum'>2771</font>   
<font class='lnum'>2772</font>   function toggleCombined(divid){
<font class='lnum'>2773</font>       if(document.getElementById(divid).style.display == 'none'){
<font class='lnum'>2774</font>         document.getElementById(divid).style.display = 'block';
<font class='lnum'>2775</font>   	document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>2776</font>       }
<font class='lnum'>2777</font>       
<font class='lnum'>2778</font>       else{
<font class='lnum'>2779</font>         document.getElementById(divid).style.display = 'none';
<font class='lnum'>2780</font>   	document.getElementById("toc"+divid).className="unhilited";
<font class='lnum'>2781</font>       }
<font class='lnum'>2782</font>   }
<font class='lnum'>2783</font>   
<font class='lnum'>2784</font>   
<font class='lnum'>2785</font>   function expandDiv(divid){
<font class='lnum'>2786</font>   	document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>2787</font>   }
<font class='lnum'>2788</font>   
<font class='lnum'>2789</font>   
<font class='lnum'>2790</font>   
<font class='lnum'>2791</font>   &lt;/script&gt;
<font class='lnum'>2792</font>   &lt;/head&gt;
<font class='lnum'>2793</font>   
<font class='lnum'>2794</font>   &lt;body &gt;
<font class='lnum'>2795</font>   &lt;h2&gt;Here's the tested element&lt;/h2&gt;
<font class='lnum'>2796</font>   Here is some ordinary text&lt;br&gt;
<font class='lnum'>2797</font>   &lt;span class="unhilited" onmouseover="setHilite(event)" 
<font class='lnum'>2798</font>       onmouseout="setUnHilite(event)"&gt; 
<font class='lnum'>2799</font>       &lt;a href="javascript:;" onmousedown="toggleDiv(15);"&gt;&lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>2800</font>       and this is some potentially hot spot text.&lt;/span&gt;
<font class='lnum'>2801</font>   
<font class='lnum'>2802</font>   &lt;div id=15&gt;
<font class='lnum'>2803</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>2804</font>       that should be hidden/collapsed
<font class='lnum'>2805</font>   
<font class='lnum'>2806</font>   &lt;/div&gt;
<font class='lnum'>2807</font>   
<font class='lnum'>2808</font>   
<font class='lnum'>2809</font>   &lt;h2&gt;Here's the tested element 0&lt;/h2&gt;
<font class='lnum'>2810</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>2811</font>   &lt;a href="javascript:;" onmousedown="toggleCombined(13);" id="toc13"&gt;
<font class='lnum'>2812</font>       &lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>2813</font>   
<font class='lnum'>2814</font>   &lt;div id=13 &gt;&lt;script language=javascript&gt; document.getElementById("toc"+13).className='hilited';&lt;/script&gt;
<font class='lnum'>2815</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>2816</font>       that should be hidden/collapsed
<font class='lnum'>2817</font>   
<font class='lnum'>2818</font>   &lt;/div&gt;
<font class='lnum'>2819</font>   
<font class='lnum'>2820</font>   
<font class='lnum'>2821</font>   
<font class='lnum'>2822</font>   
<font class='lnum'>2823</font>   &lt;h2&gt;Here's the tested element 1&lt;/h2&gt;
<font class='lnum'>2824</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>2825</font>   &lt;a href="javascript:;" onmousedown="toggleCombined(14);" id="toc14"&gt;
<font class='lnum'>2826</font>       &lt;script language=javascript&gt; document.getElementById("toc"+14).className='hilited';&lt;/script&gt;
<font class='lnum'>2827</font>       &lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>2828</font>   
<font class='lnum'>2829</font>   &lt;div id=14 &gt;
<font class='lnum'>2830</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>2831</font>       that should be hidden/collapsed
<font class='lnum'>2832</font>   
<font class='lnum'>2833</font>   &lt;/div&gt;
<font class='lnum'>2834</font>   
<font class='lnum'>2835</font>   
<font class='lnum'>2836</font>   &lt;h2&gt;Here's the tested element 2&lt;/h2&gt;
<font class='lnum'>2837</font>   HHHHere is some ordinary text&lt;br&gt;
<font class='lnum'>2838</font>   &lt;span  id="toc16"&gt; 
<font class='lnum'>2839</font>       &lt;a href="javascript:;" onmousedown="toggleCombined(16);"&gt;&lt;b&gt; process section headings &lt;/b&gt;&lt;/a&gt;&lt;br&gt;
<font class='lnum'>2840</font>       and this is some potentially hot spot text.&lt;/span&gt;
<font class='lnum'>2841</font>   
<font class='lnum'>2842</font>   &lt;div id=16&gt;
<font class='lnum'>2843</font>       .. and this is the text&lt;br&gt;
<font class='lnum'>2844</font>       that should be hidden/collapsed
<font class='lnum'>2845</font>   
<font class='lnum'>2846</font>   &lt;/div&gt;
<font class='lnum'>2847</font>   
<font class='lnum'>2848</font>   
<font class='lnum'>2849</font>   
<font class='lnum'>2850</font>   &lt;/body&gt;
<font class='lnum'>2851</font>   &lt;/html&gt;
<font class='lnum'>2852</font>   
<font class='lnum'>2853</font>   </fieldset></pre>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('59');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('60');">
<font class='lnum'><i>(60)</i></font>&nbsp; changing text style - the basic JS recipy </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2859)</i></sub></font></a></legend></fieldset>
<p>
<div id="60" style="display:none">   
<ul>


<p>
I used this snippet for a start then reworked it into the "working test script" below.<br>
<p>
<ul> <pre>
11.8.2 Solution
First, define two style sheet rules, each with a different class selector. Then design 
an event handler for the element to change the element's className property to the desired 
class selector's identifier: 

		&lt;style type="text/css"&gt;
		.unhilited {background-color:white}
		.hilited {background-color:yellow; text-decoration:underline}
		&lt;/style&gt;
		...
		&lt;script type="text/javascript"&gt;
		function setHilite(evt) {
			evt = (evt) ? evt : ((window.event) ? window.event : null);
			if (evt) {
				var elem = (evt.srcElement) ? evt.srcElement : evt.target;
				elem.className = "hilited";
			}
		}
		function setUnHilite(evt) {
			evt = (evt) ? evt : ((window.event) ? window.event : null);
			if (evt) {
				var elem = (evt.srcElement) ? evt.srcElement : evt.target;
				elem.className = "unhilited";
			}
		}
		...
		&lt;span class="unhilited" onmouseover="setHilite(event)" 
			onmouseout="setUnHilite(event)"&gt;Some potentially hot spot text.&lt;/span&gt;

Adjusting the className property of an element as shown here is a more stable approach 
for early versions of Netscape 6 instead of manipulating styleSheet objects and their 
properties. It is perhaps the most widely used and supported way to implement dynamic styles. 
</pre> </ul><br>
<p>
If I enclose one "onmousedown" inside another, JScript will most probably not pass it into the inner one.<br>
So I should add:<br>
(a) the TOC line IDs ?? Like "toc.1", "toc.2" etc<br>
(b) keep a separate func, not "toggleDiv", but something else like "toggleTOCandDIV", and run 2 things<br>
from there ??<br>
<p>
<b> So, 2 tests: enclosing and if not, then rewriting the collapsing JS func </b><br>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('60');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('61');">
<font class='lnum'><i>(61)</i></font>&nbsp; Reference - Javascript and DOM </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2910)</i></sub></font></a></legend></fieldset>
<p>
<div id="61" style="display:none">   
<ul>


<p>
<p>
I'll need some javascript and DOM reference for further work;<br>
<p>
a/ http://w3schools.com/htmldom/dom_reference.asp  -- ref from W3C<br>
b/ http://w3schools.com/htmldom/default.asp -- might also be useful<br>
c/ http://www.howtocreate.co.uk/tutorials/javascript/domcss --javascript tutorial (not necessarily best) <br>
d/ http://www.pageresource.com/dhtml/ryan/part4-1.html - another tutorial<br>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('61');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('58');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('62');">
<font class='lnum'><i>(62)</i></font>&nbsp; set formatting strings for weaver </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2926)</i></sub></font></a></legend></fieldset>
<p>
<div id="62" style="display:none">   
<ul>


<p>
<font class='lnum'>2929</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;set formatting strings for weaver&gt;&gt;=</legend>
<font class='lnum'>2930</font>   
<font class='lnum'>2931</font>     #----SETTING FORMATTING STRINGS-----------
<font class='lnum'>2932</font>     
<font class='lnum'>2933</font>   $html_head = &lt;&lt;head_end;  
<font class='lnum'>2934</font>   
<font class='lnum'>2935</font>   &lt;head&gt;
<font class='lnum'>2936</font>   &lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" /&gt; 
<font class='lnum'>2937</font>   
<font class='lnum'>2938</font>   <font class='chunkref'>&lt;&lt;JS script functions&gt;&gt</font>;
<font class='lnum'>2939</font>   <font class='chunkref'>&lt;&lt;stylesheet&gt;&gt</font>;
<font class='lnum'>2940</font>   
<font class='lnum'>2941</font>   &lt;/head&gt;
<font class='lnum'>2942</font>   head_end
<font class='lnum'>2943</font>   
<font class='lnum'>2944</font>   $html_body_table = "&lt;center&gt;&lt;table class='outertable'&gt;&lt;tr&gt;&lt;td&gt;";
<font class='lnum'>2945</font>   $html_body_table_end = "\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;\n";
<font class='lnum'>2946</font>   
<font class='lnum'>2947</font>   
<font class='lnum'>2948</font>   	
<font class='lnum'>2949</font>   
<font class='lnum'>2950</font>   $folding_section_start1_str = &lt;&lt;'fold_sect_start_1_xxx';
<font class='lnum'>2951</font>   	&lt;fieldset&gt;&lt;legend&gt;&lt;a href="javascript:;" onmousedown="toggleCombined('$section_num');"&gt;
<font class='lnum'>2952</font>   fold_sect_start_1_xxx
<font class='lnum'>2953</font>   
<font class='lnum'>2954</font>   
<font class='lnum'>2955</font>   $folding_section_start2_str = &lt;&lt;'fold_sect_start_2_xxx';
<font class='lnum'>2956</font>   &lt;/a&gt;&lt;/legend&gt;&lt;/fieldset&gt;
<font class='lnum'>2957</font>   &lt;p&gt;
<font class='lnum'>2958</font>   &lt;div id="$section_num" style="display:$fold_state"&gt; $highlight_state  
<font class='lnum'>2959</font>   &lt;ul&gt;
<font class='lnum'>2960</font>   
<font class='lnum'>2961</font>   fold_sect_start_2_xxx
<font class='lnum'>2962</font>   
<font class='lnum'>2963</font>   
<font class='lnum'>2964</font>   $folding_section_end_str = &lt;&lt;'folding_section_end_xxx';
<font class='lnum'>2965</font>   &lt;/ul&gt;
<font class='lnum'>2966</font>   &lt;p&gt;
<font class='lnum'>2967</font>   &lt;br&gt;
<font class='lnum'>2968</font>   &lt;i&gt;&lt;font size=-1&gt;
<font class='lnum'>2969</font>   &lt;a href="javascript:;"onmousedown="toggleCombined('$section_num_prev');"&gt;
<font class='lnum'>2970</font>   Close the subsection&lt;/a&gt;&lt;/font&gt;
<font class='lnum'>2971</font>   &lt;/i&gt; -- &lt;i&gt;&lt;font size=-1&gt;
<font class='lnum'>2972</font>   &lt;a href="javascript:;" onmousedown="showAll();"&gt;
<font class='lnum'>2973</font>   expand all&lt;/a&gt; -- 
<font class='lnum'>2974</font>   &lt;a href="javascript:;" onmousedown="hideAll();"&gt;
<font class='lnum'>2975</font>   collapse all&lt;/a&gt;
<font class='lnum'>2976</font>   &lt;/font&gt;&lt;/i&gt;
<font class='lnum'>2977</font>   
<font class='lnum'>2978</font>   &lt;p&gt;
<font class='lnum'>2979</font>   &lt;/div&gt;
<font class='lnum'>2980</font>   
<font class='lnum'>2981</font>   folding_section_end_xxx
<font class='lnum'>2982</font>   
<font class='lnum'>2983</font>   
<font class='lnum'>2984</font>   $code_frameset_start_pre = "&lt;pre&gt;&lt;fieldset class='codefieldset'&gt;&lt;legend class='codelegend'&gt;";
<font class='lnum'>2985</font>   $code_frameset_start_post = "=&lt;/legend&gt;";
<font class='lnum'>2986</font>   $code_frameset_end = "&lt;/fieldset&gt;&lt;/pre&gt;\n";
<font class='lnum'>2987</font>   
<font class='lnum'>2988</font>   
<font class='lnum'>2989</font>   
<font class='lnum'>2990</font>   
<font class='lnum'>2991</font>   </fieldset></pre>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('63');">
<font class='lnum'><i>(63)</i></font>&nbsp; JS functions </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 2994)</i></sub></font></a></legend></fieldset>
<p>
<div id="63" style="display:none">   
<ul>


<p>
<font class='lnum'>2997</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;JS script functions&gt;&gt;=</legend>
<font class='lnum'>2998</font>   &lt;script language="javascript"&gt;
<font class='lnum'>2999</font>   
<font class='lnum'>3000</font>   
<font class='lnum'>3001</font>   function toggleDiv(divid) {
<font class='lnum'>3002</font>   var el = document.getElementById(divid);
<font class='lnum'>3003</font>   el.style.display = (el.style.display == 'block') ? 'none' : 'block';
<font class='lnum'>3004</font>   }
<font class='lnum'>3005</font>   
<font class='lnum'>3006</font>   
<font class='lnum'>3007</font>   function toggleCombined(divid){
<font class='lnum'>3008</font>       if(document.getElementById(divid).style.display == 'none'){
<font class='lnum'>3009</font>         document.getElementById(divid).style.display = 'block';
<font class='lnum'>3010</font>   	document.getElementById("toc"+divid).className="hilited";
<font class='lnum'>3011</font>       }
<font class='lnum'>3012</font>       else{
<font class='lnum'>3013</font>         document.getElementById(divid).style.display = 'none';
<font class='lnum'>3014</font>   	document.getElementById("toc"+divid).className="unhilited";
<font class='lnum'>3015</font>       }
<font class='lnum'>3016</font>   }
<font class='lnum'>3017</font>   
<font class='lnum'>3018</font>   
<font class='lnum'>3019</font>   function showAll(){
<font class='lnum'>3020</font>   for(i=1; i &lt;= 10000; i++){
<font class='lnum'>3021</font>       document.getElementById(i).style.display = 'block';
<font class='lnum'>3022</font>       document.getElementById("toc"+i).className="hilited";
<font class='lnum'>3023</font>       };
<font class='lnum'>3024</font>   }
<font class='lnum'>3025</font>   
<font class='lnum'>3026</font>   function hideAll(){
<font class='lnum'>3027</font>   for(i=1; i &lt;= 10000; i++){
<font class='lnum'>3028</font>       document.getElementById(i).style.display = 'none';
<font class='lnum'>3029</font>       document.getElementById("toc"+i).className="unhilited";
<font class='lnum'>3030</font>       };
<font class='lnum'>3031</font>   }
<font class='lnum'>3032</font>   
<font class='lnum'>3033</font>   &lt;/script&gt;
<font class='lnum'>3034</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('63');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('64');">
<font class='lnum'><i>(64)</i></font>&nbsp; Stylesheet </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3039)</i></sub></font></a></legend></fieldset>
<p>
<div id="64" style="display:none">   
<ul>


<p>
<font class='lnum'>3042</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;stylesheet&gt;&gt;=</legend>
<font class='lnum'>3043</font>   &lt;style type="text/css" media="screen"&gt;
<font class='lnum'>3044</font>   
<font class='lnum'>3045</font>   
<font class='lnum'>3046</font>   BODY {
<font class='lnum'>3047</font>   	FONT-SIZE: 10pt;
<font class='lnum'>3048</font>   	&lt;!--FONT-FAMILY: sans-serif --&gt;
<font class='lnum'>3049</font>   	background: #f0f0f0;
<font class='lnum'>3050</font>   	}
<font class='lnum'>3051</font>   FIELDSET {
<font class='lnum'>3052</font>   	BORDER-RIGHT: #000000 1px solid; 
<font class='lnum'>3053</font>   	BORDER-TOP: #000000 1px solid; 
<font class='lnum'>3054</font>   	BORDER-LEFT: #000000 1px solid; 
<font class='lnum'>3055</font>   	BORDER-BOTTOM: #000000 1px solid; 
<font class='lnum'>3056</font>   	PADDING-RIGHT: 5px; 
<font class='lnum'>3057</font>   	PADDING-LEFT: 5px; 
<font class='lnum'>3058</font>   	PADDING-BOTTOM: 2px; 
<font class='lnum'>3059</font>   	PADDING-TOP: 5px;
<font class='lnum'>3060</font>   	MARGIN-BOTTOM: 1px; 
<font class='lnum'>3061</font>   	background: #f5f5f5; 
<font class='lnum'>3062</font>   	color: #000000;
<font class='lnum'>3063</font>   	}
<font class='lnum'>3064</font>   LEGEND {
<font class='lnum'>3065</font>   	BORDER-RIGHT: #a9a9a9 1px solid; 
<font class='lnum'>3066</font>   	BORDER-BOTTOM: #a9a9a9 1px solid;
<font class='lnum'>3067</font>   	BORDER-TOP: #a9a9a9 1px solid; 
<font class='lnum'>3068</font>   	BORDER-LEFT: #a9a9a9 1px solid; 
<font class='lnum'>3069</font>   	PADDING-RIGHT: 20px; 
<font class='lnum'>3070</font>   	PADDING-LEFT: 20px; 
<font class='lnum'>3071</font>   	PADDING-BOTTOM: 5px; 
<font class='lnum'>3072</font>   	PADDING-TOP: 5px; 
<font class='lnum'>3073</font>   	FONT-WEIGHT: bold;  
<font class='lnum'>3074</font>   	BACKGROUND: #fdfdfd; 
<font class='lnum'>3075</font>   	color: #000000;
<font class='lnum'>3076</font>   	}
<font class='lnum'>3077</font>   PRE	{
<font class='lnum'>3078</font>           PADDING-LEFT: 20px; 
<font class='lnum'>3079</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>3080</font>           padding-top: 0px; 
<font class='lnum'>3081</font>           padding-bottom: 6px;
<font class='lnum'>3082</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>3083</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>3084</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>3085</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>3086</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>3087</font>   	background: #fefefe;
<font class='lnum'>3088</font>   	}
<font class='lnum'>3089</font>   
<font class='lnum'>3090</font>   
<font class='lnum'>3091</font>   .tocfieldset {
<font class='lnum'>3092</font>   	background: #ffffff; 
<font class='lnum'>3093</font>   	color: #000000;
<font class='lnum'>3094</font>   	}
<font class='lnum'>3095</font>   
<font class='lnum'>3096</font>   .codefieldset {
<font class='lnum'>3097</font>   	BORDER-RIGHT: #000 1px solid; 
<font class='lnum'>3098</font>   	BORDER-TOP: #000 1px solid; 
<font class='lnum'>3099</font>   	BORDER-LEFT: #000 1px solid; 
<font class='lnum'>3100</font>   	BORDER-BOTTOM: #000 1px solid; 
<font class='lnum'>3101</font>   	background: #ffffff; 
<font class='lnum'>3102</font>   	color: #000;
<font class='lnum'>3103</font>   	MARGIN-BOTTOM: 1px; 
<font class='lnum'>3104</font>   	PADDING-LEFT: 15px; 
<font class='lnum'>3105</font>   	PADDING-RIGHT: 5px; 
<font class='lnum'>3106</font>   	PADDING-BOTTOM: 10px; 
<font class='lnum'>3107</font>   	PADDING-TOP: 1px;
<font class='lnum'>3108</font>   	}
<font class='lnum'>3109</font>   .codelegend {
<font class='lnum'>3110</font>   	BORDER-RIGHT: #777 1px solid; 
<font class='lnum'>3111</font>   	BORDER-TOP: #777 1px solid; 
<font class='lnum'>3112</font>   	BORDER-LEFT: #777 1px solid; 
<font class='lnum'>3113</font>   	BORDER-BOTTOM: #777 1px solid
<font class='lnum'>3114</font>   	PADDING-RIGHT: 10px; 
<font class='lnum'>3115</font>   	PADDING-LEFT: 10px; 
<font class='lnum'>3116</font>   	PADDING-TOP: 2px; 
<font class='lnum'>3117</font>   	PADDING-BOTTOM: 2px; 
<font class='lnum'>3118</font>   	background: #ffffff; 
<font class='lnum'>3119</font>   	color: #00b;
<font class='lnum'>3120</font>   	FONT-WEIGHT: bold;  
<font class='lnum'>3121</font>   	/font-variant: small-caps;
<font class='lnum'>3122</font>   	/font-style: italic;
<font class='lnum'>3123</font>   	}
<font class='lnum'>3124</font>   
<font class='lnum'>3125</font>   
<font class='lnum'>3126</font>   
<font class='lnum'>3127</font>   .chunkref {
<font class='lnum'>3128</font>           color: #00b;	
<font class='lnum'>3129</font>           background: #f6f6f6;
<font class='lnum'>3130</font>           /font-style: italic;
<font class='lnum'>3131</font>           font-weight: bold;
<font class='lnum'>3132</font>           /font-variant: small-caps;
<font class='lnum'>3133</font>   	}
<font class='lnum'>3134</font>   
<font class='lnum'>3135</font>   
<font class='lnum'>3136</font>   .outertable {
<font class='lnum'>3137</font>   	width: 99%; 
<font class='lnum'>3138</font>   	cellpadding: 25; 
<font class='lnum'>3139</font>   	background: #ffffff; 
<font class='lnum'>3140</font>   	border: 1px solid;
<font class='lnum'>3141</font>   	}
<font class='lnum'>3142</font>   
<font class='lnum'>3143</font>   .hl	{
<font class='lnum'>3144</font>   	 ;
<font class='lnum'>3145</font>           PADDING-LEFT: 5px; PADDING-RIGHT: 5px; 
<font class='lnum'>3146</font>           padding-top: 5px; padding-bottom: 5px;
<font class='lnum'>3147</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>3148</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>3149</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>3150</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>3151</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>3152</font>           background: #f5f5f5;	
<font class='lnum'>3153</font>           width: 70%;
<font class='lnum'>3154</font>   	}
<font class='lnum'>3155</font>   
<font class='lnum'>3156</font>   .hl-wide {
<font class='lnum'>3157</font>   	 ;
<font class='lnum'>3158</font>           PADDING-LEFT: 5px; 
<font class='lnum'>3159</font>           PADDING-RIGHT: 5px; 
<font class='lnum'>3160</font>           padding-top: 15px; 
<font class='lnum'>3161</font>           padding-bottom: 15px;
<font class='lnum'>3162</font>           MARGIN-BOTTOM: 1px; 
<font class='lnum'>3163</font>           BORDER-TOP: #a9a9a9 0px solid;
<font class='lnum'>3164</font>           BORDER-RIGHT: #a9a9a9 0px solid; 
<font class='lnum'>3165</font>           BORDER-LEFT: #a9a9a9 0px solid;
<font class='lnum'>3166</font>           BORDER-BOTTOM: #a9a9a9 0px solid;        
<font class='lnum'>3167</font>           background: #fbfbfb;	
<font class='lnum'>3168</font>   	}
<font class='lnum'>3169</font>   
<font class='lnum'>3170</font>   .lnum {
<font class='lnum'>3171</font>   
<font class='lnum'>3172</font>   	color: #a0a0a0;
<font class='lnum'>3173</font>   	/background: #fbfbfb;
<font class='lnum'>3174</font>   	}
<font class='lnum'>3175</font>   
<font class='lnum'>3176</font>   .unhilited {background-color:white}
<font class='lnum'>3177</font>   .hilited {background-color:#c0c0ff}
<font class='lnum'>3178</font>   
<font class='lnum'>3179</font>   
<font class='lnum'>3180</font>   &lt;/STYLE&gt;
<font class='lnum'>3181</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('64');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('62');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('65');">
<font class='lnum'><i>(65)</i></font>&nbsp; Accumulate the result </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3190)</i></sub></font></a></legend></fieldset>
<p>
<div id="65" style="display:none">   
<ul>


<p>
Some of the vars may be unused later (run perl -wc to check?)<br>
<p>
<font class='lnum'>3195</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;accumulate result in a buffer&gt;&gt;=</legend>
<font class='lnum'>3196</font>   #2. accumulate result in a buffer
<font class='lnum'>3197</font>   
<font class='lnum'>3198</font>   
<font class='lnum'>3199</font>   # vars for the main loop over lines of the target file
<font class='lnum'>3200</font>   
<font class='lnum'>3201</font>    $chunkbuf = ''; # collects whole formatted project file in memory
<font class='lnum'>3202</font>    $tocbuf = "";	# will accumulate TOC contents, i.e. small
<font class='lnum'>3203</font>    @indbuf = ();  # accumulates index of code chunks, small
<font class='lnum'>3204</font>    #%indbuf = ();
<font class='lnum'>3205</font>    @headings = ();	# the stack for nested subsections numbers/ids
<font class='lnum'>3206</font>   
<font class='lnum'>3207</font>    $section_num = 0;
<font class='lnum'>3208</font>    $section_num_prev = 0;
<font class='lnum'>3209</font>    $section_level = 0;
<font class='lnum'>3210</font>    $prev_section_level = $section_level;
<font class='lnum'>3211</font>    $line_counter = 0;
<font class='lnum'>3212</font>    $in_pre_tag = 0;
<font class='lnum'>3213</font>   </fieldset></pre>
<p>
<p>
The logic is this: (a) all project files, unless they are machine-generated code, are<br>
much below the sizes of RAM on modern machines. So I accumulate in memoru (in a string<br>
$chunkbuf) a copy of the whole file, with necessary transformations and formatting.<br>
<p>
Only 3 distinctions need to be made while iterating over hte lines of the Literate Source<br>
file, between section headings, chunks of code and the lines from the body of documentation<br>
chunks.<br>
<p>
<font class='lnum'>3224</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;accumulate result in a buffer&gt;&gt;=</legend>
<font class='lnum'>3225</font>   
<font class='lnum'>3226</font>   open FF, "&lt; $0";
<font class='lnum'>3227</font>   
<font class='lnum'>3228</font>   
<font class='lnum'>3229</font>   while (&lt;FF&gt;) {
<font class='lnum'>3230</font>   
<font class='lnum'>3231</font>      $line_counter++;
<font class='lnum'>3232</font>   
<font class='lnum'>3233</font>       # cut out the MOLLY.pl invocation itself, the top of the Lit src file
<font class='lnum'>3234</font>       #if ( m%^#-+\s*?start of script% ... m%^xxxxxxxxxxxx% ) {  
<font class='lnum'>3235</font>       if ( m%^__DATA__% ... m%^xxxxxxxxxxxx% ) {
<font class='lnum'>3236</font>       s!^__DATA__\s*$!!;
<font class='lnum'>3237</font>   
<font class='lnum'>3238</font>   
<font class='lnum'>3239</font>   
<font class='lnum'>3240</font>   <font class='chunkref'>&lt;&lt;process code chunks&gt;&gt</font>;
<font class='lnum'>3241</font>   <font class='chunkref'>&lt;&lt;process section headings&gt;&gt</font>;
<font class='lnum'>3242</font>   <font class='chunkref'>&lt;&lt;body HTML formatters&gt;&gt</font>;
<font class='lnum'>3243</font>   
<font class='lnum'>3244</font>   
<font class='lnum'>3245</font>   	# debug
<font class='lnum'>3246</font>   	#print "---- $_";
<font class='lnum'>3247</font>   
<font class='lnum'>3248</font>      } # fi "start of script"
<font class='lnum'>3249</font>   
<font class='lnum'>3250</font>   } #elihw over the whole input file
<font class='lnum'>3251</font>   
<font class='lnum'>3252</font>   	
<font class='lnum'>3253</font>   
<font class='lnum'>3254</font>   
<font class='lnum'>3255</font>    foreach (@headings)  {
<font class='lnum'>3256</font>   
<font class='lnum'>3257</font>   	($section_level, $section_num_prev) = split /-/, $_;
<font class='lnum'>3258</font>   	$folding_section_end = $folding_section_end_str;
<font class='lnum'>3259</font>   	$folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>3260</font>   	$chunkbuf .= $folding_section_end; 
<font class='lnum'>3261</font>   
<font class='lnum'>3262</font>   	};
<font class='lnum'>3263</font>   
<font class='lnum'>3264</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('66');">
<font class='lnum'><i>(66)</i></font>&nbsp; process code chunks </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3271)</i></sub></font></a></legend></fieldset>
<p>
<div id="66" style="display:none">   
<ul>


<p>
"goto" is from an old version of this script, with perl-specific options, I'll delete it<br>
later.<br>
<p>
I use perl range operator to cut out the code section between &lt; &lt; chunkname &gt; &gt; and the<br>
closing "at" symbol, as is required in "noweb".<br>
This is a use of the "range" operator inside another "while" loop over each line of the<br>
Lit Source file, and they work together, the range just flips some status var ("in" - "out")<br>
while the outside loop continues over the lines.<br>
<p>
Once the section name is extracted with a regexp, the index buffer (indbuf) is formed and<br>
updated.<br>
Then "fieldset" formatting is written around the code chunk and line numbering (if set<br>
in an option var) is written too<br>
<p>
<font class='lnum'>3288</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process code chunks&gt;&gt;=</legend>
<font class='lnum'>3289</font>   
<font class='lnum'>3290</font>   	if ( m!^(goto)?&lt;\&lt;(.*)&gt;\&gt;=! ... m!^@\s*$! ) { # -- CODE CHUNKS -- 
<font class='lnum'>3291</font>   		$chunk_title = $2;
<font class='lnum'>3292</font>   
<font class='lnum'>3293</font>   		s/&amp;/&amp;amp;/g;	# escape &amp;
<font class='lnum'>3294</font>   		s/&lt;/&amp;lt;/g;	# escape &lt;
<font class='lnum'>3295</font>   		s/&gt;/&amp;gt;/g;	# escape &gt;
<font class='lnum'>3296</font>   
<font class='lnum'>3297</font>   		if (m!(&amp;lt;&amp;lt;(.+?)&amp;gt;&amp;gt);(=)?!) 
<font class='lnum'>3298</font>   		  {
<font class='lnum'>3299</font>   		  $reference = $1;
<font class='lnum'>3300</font>   		  $ind_str = "&amp;lt;&amp;lt;$2&amp;gt;&amp;gt; $section_num";
<font class='lnum'>3301</font>   		  if (defined $3) {$ind_str .= "&lt;sub&gt;def&lt;/sub&gt;"}
<font class='lnum'>3302</font>   		  else { s!$reference!&lt;font class='chunkref'&gt;$reference&lt;/font&gt;! }
<font class='lnum'>3303</font>   
<font class='lnum'>3304</font>   		  unshift @indbuf, $ind_str;
<font class='lnum'>3305</font>   
<font class='lnum'>3306</font>   		} # fi - chunks index accumulation
<font class='lnum'>3307</font>   
<font class='lnum'>3308</font>   		# simple fieldset frames around code snippets
<font class='lnum'>3309</font>   		s!^(goto)?&amp;lt;&amp;lt;(.+)&amp;gt;&amp;gt;=!$code_frameset_start_pre$1&amp;lt;&amp;lt;$2&amp;gt;&amp;gt;$code_frameset_start_post!;
<font class='lnum'>3310</font>   		s!^@\s*$!$code_frameset_end!;
<font class='lnum'>3311</font>   
<font class='lnum'>3312</font>   		if ( $line_numbering ) { 
<font class='lnum'>3313</font>   		$chunkbuf .= "&lt;font class='lnum'&gt;" . $line_counter . "&lt;/font&gt;   " . $_;
<font class='lnum'>3314</font>   		}
<font class='lnum'>3315</font>   		else{
<font class='lnum'>3316</font>   		$chunkbuf .= $_;
<font class='lnum'>3317</font>   		}
<font class='lnum'>3318</font>   
<font class='lnum'>3319</font>   	} # fi code chunks
<font class='lnum'>3320</font>   </fieldset></pre>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('66');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('67');">
<font class='lnum'><i>(67)</i></font>&nbsp; process section headings </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3326)</i></sub></font></a></legend></fieldset>
<p>
<div id="67" style="display:none">   
<ul>


<p>
This is where folding sectons are created.<br>
The more complicated logic is needed to <i>close</i> the sections properly, when subsections<br>
are included (i.e. creating a step and forming the "close subsection" at the end in the correct<br>
place.<br>
<p>
1. Several formats were possible for collapsing sections, I chose the one you can observe while<br>
reading the weaved document: subsections are completely enclosed by their supersections;<br>
once a child subsection is initiated, the parent subsection cannot continue its body after<br>
the end of the child.<br>
I.e. once you started 12.2.1 inside your 12.2, you cannot write into 12.2 after 12.2.1 is finished, <br>
but you can add 12.2.2, 12.2.3, 12.2.2.1 - etc. - inside the enclosing section.<br>
<p>
The logic was tested first in an external skeleton script.<br>
<p>
2. I may need to disassemble this code to create "view mode" for my script - see "versions - <br>
CHANGES" subsection<br>
<p>
<p>
<font class='lnum'>3347</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;process section headings&gt;&gt;=</legend>
<font class='lnum'>3348</font>   
<font class='lnum'>3349</font>   	# -- SECTION HEADINGS 
<font class='lnum'>3350</font>      #elsif ( m!\.(\+)?h(\d)\.(.*?)\./h\d\.! ) {	# old version, no "rawHTML" enabled yet
<font class='lnum'>3351</font>      elsif ( m!$tag_open_symbol(\+)?h(\d)$tag_close_symbol(.*?)$tag_open_symbol/h\d$tag_close_symbol! ) {	
<font class='lnum'>3352</font>   
<font class='lnum'>3353</font>   
<font class='lnum'>3354</font>   
<font class='lnum'>3355</font>   	# -- using split vars for substitution to avoid
<font class='lnum'>3356</font>   	#	regexps and need to keep old state --	
<font class='lnum'>3357</font>   
<font class='lnum'>3358</font>   	$section_num_prev = $section_num;
<font class='lnum'>3359</font>   	$section_num = $section_num + 1;
<font class='lnum'>3360</font>   
<font class='lnum'>3361</font>   
<font class='lnum'>3362</font>   		#default for fold state in "settings" ??
<font class='lnum'>3363</font>   		if ($1 eq "+") {
<font class='lnum'>3364</font>   		    $fold_state="block";
<font class='lnum'>3365</font>   		    $highlight_state = qq!  &lt;script language=javascript&gt; 
<font class='lnum'>3366</font>   		    document.getElementById("toc"+ $section_num).className='hilited';
<font class='lnum'>3367</font>   		    &lt;/script&gt; !;
<font class='lnum'>3368</font>   		} 
<font class='lnum'>3369</font>   		else {
<font class='lnum'>3370</font>   		    $fold_state="none";
<font class='lnum'>3371</font>   		    $highlight_state = "";
<font class='lnum'>3372</font>   		};
<font class='lnum'>3373</font>   		$section_level = $2;
<font class='lnum'>3374</font>   		$section_title = $3;
<font class='lnum'>3375</font>   
<font class='lnum'>3376</font>   
<font class='lnum'>3377</font>   	
<font class='lnum'>3378</font>   
<font class='lnum'>3379</font>   	
<font class='lnum'>3380</font>   
<font class='lnum'>3381</font>   	$folding_section_start1 = $folding_section_start1_str;
<font class='lnum'>3382</font>   	$folding_section_start2 = $folding_section_start2_str;
<font class='lnum'>3383</font>   	$folding_section_end = $folding_section_end_str;
<font class='lnum'>3384</font>   
<font class='lnum'>3385</font>   
<font class='lnum'>3386</font>   	$folding_section_start1 =~ s!(\$section_num)!$1!ee;
<font class='lnum'>3387</font>   	$folding_section_start2 =~ s!(\$section_num)!$1!ee;
<font class='lnum'>3388</font>   	$folding_section_start2 =~ s!(\$fold_state)!$1!ee;
<font class='lnum'>3389</font>   	$folding_section_start2 =~ s!(\$highlight_state)!$1!ee;
<font class='lnum'>3390</font>   	$folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>3391</font>   
<font class='lnum'>3392</font>   
<font class='lnum'>3393</font>   	$section_id = $section_level . '-' . $section_num;
<font class='lnum'>3394</font>   
<font class='lnum'>3395</font>   
<font class='lnum'>3396</font>   	# finish previous subsection if not the first section in the file
<font class='lnum'>3397</font>   	# ..and deal with nesting of sections according to their "depth level"
<font class='lnum'>3398</font>   
<font class='lnum'>3399</font>   	# this is NOT the first section:
<font class='lnum'>3400</font>   	if ( exists $headings[0] ){
<font class='lnum'>3401</font>   
<font class='lnum'>3402</font>   		($prev_section_level, $prev_section_num)  = split /-/, $headings[0];
<font class='lnum'>3403</font>   
<font class='lnum'>3404</font>   		if ($section_level == $prev_section_level){
<font class='lnum'>3405</font>   
<font class='lnum'>3406</font>   		# close prev, start new
<font class='lnum'>3407</font>   		$chunkbuf .= $folding_section_end;
<font class='lnum'>3408</font>   		shift @headings;
<font class='lnum'>3409</font>   		
<font class='lnum'>3410</font>   		}
<font class='lnum'>3411</font>   
<font class='lnum'>3412</font>   		elsif($section_level &lt; $prev_section_level){
<font class='lnum'>3413</font>   		
<font class='lnum'>3414</font>   		  # close a bunch of them, in a loop -- THEN start a new one.
<font class='lnum'>3415</font>   		  do  {
<font class='lnum'>3416</font>   			($prev_section_level, $section_num_prev) = split /-/, shift @headings;
<font class='lnum'>3417</font>   			
<font class='lnum'>3418</font>   			$folding_section_end = $folding_section_end_str;
<font class='lnum'>3419</font>   			$folding_section_end =~ s!(\$section_num_prev)!$1!ee;
<font class='lnum'>3420</font>   			$chunkbuf .= $folding_section_end;
<font class='lnum'>3421</font>   
<font class='lnum'>3422</font>   		   } while ( $section_level &lt; $prev_section_level );
<font class='lnum'>3423</font>   		}
<font class='lnum'>3424</font>   	} # fi not the first section
<font class='lnum'>3425</font>   
<font class='lnum'>3426</font>   
<font class='lnum'>3427</font>   	# common operations		
<font class='lnum'>3428</font>   	unshift @headings, $section_id ;
<font class='lnum'>3429</font>   	$chunkbuf .= $folding_section_start1;
<font class='lnum'>3430</font>   	$chunkbuf .= "&lt;font class='lnum'&gt;&lt;i&gt;(" . $section_num . ")&lt;/i&gt;&lt;/font&gt;" . "&amp;nbsp;" . $section_title .
<font class='lnum'>3431</font>   	    "&lt;/a&gt;&amp;nbsp;&lt;a&gt;&lt;font class='lnum' size=-1&gt;&lt;sub&gt;&lt;i&gt;(line " .
<font class='lnum'>3432</font>   	    $line_counter . ")&lt;/i&gt;&lt;/sub&gt;&lt;/font&gt;"; 
<font class='lnum'>3433</font>   	$chunkbuf .= $folding_section_start2;
<font class='lnum'>3434</font>   
<font class='lnum'>3435</font>   	#$chunkbuf .= "\n" . "&lt;font class='lnum'&gt;&lt;i&gt;------ line " . $line_counter . 
<font class='lnum'>3436</font>   	#	    " ------&lt;/i&gt;&lt;/font&gt;&lt;br&gt;\n";
<font class='lnum'>3437</font>   
<font class='lnum'>3438</font>   
<font class='lnum'>3439</font>   	$toc_indent = "&amp;nbsp;" x ($section_level * 7);
<font class='lnum'>3440</font>   	#$toc_indent = "&amp;nbsp;" x (($section_level-1) * 7 );
<font class='lnum'>3441</font>   	#$tocbuf .= "\n&lt;p&gt;\n" if ( $section_level == 1 ); 
<font class='lnum'>3442</font>   	$tocbuf .= $toc_indent . 
<font class='lnum'>3443</font>   		"&lt;i&gt;" . $section_num . "&lt;/i&gt;" .
<font class='lnum'>3444</font>   		qq/&amp;nbsp;&lt;a href="javascript:;" onmousedown="toggleCombined(/ .  
<font class='lnum'>3445</font>   		$section_num . 
<font class='lnum'>3446</font>   		qq/);" id="toc/ . $section_num .
<font class='lnum'>3447</font>   		qq/"&gt;&lt;b&gt;/ .
<font class='lnum'>3448</font>   		$section_title . "&lt;/a&gt;&amp;nbsp;&lt;a&gt;&lt;font class='lnum' size=-1&gt;&lt;i&gt;(line " .
<font class='lnum'>3449</font>   		    $line_counter . ")&lt;/i&gt;&lt;/font&gt;" .
<font class='lnum'>3450</font>   		    "&lt;/b&gt;&lt;/a&gt;&lt;br&gt;\n";
<font class='lnum'>3451</font>   
<font class='lnum'>3452</font>      } #; fisle: end elif headings
<font class='lnum'>3453</font>   
<font class='lnum'>3454</font>   	
<font class='lnum'>3455</font>   
<font class='lnum'>3456</font>   </fieldset></pre>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('67');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('68');">
<font class='lnum'><i>(68)</i></font>&nbsp; dotHTML formatter and rawHTML </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3461)</i></sub></font></a></legend></fieldset>
<p>
<div id="68" style="display:none">   
<ul>


<p>
It is primitive, and I add needed markup "on the fly", as and when I need it.<br>
The idea is to eliminate angle brackets in html tags, which I cannot type without errors<br>
when typing fast, and substitute those with simple "dots", which do not requre switching<br>
keyboard registers.<br>
<p>
<s> This formatting also has problems with escapes.<br>
<p>
Whether it's the fault of HTML standards or their implementation, web browsers continue to<br>
react to html formatting <b>even inside the "pre" tags</b>, which is obviously insane.<br>
Therefore if your code chunks contain any HTML tags (e.g. processed by your code), you'll<br>
need to escape them to display correctly.<br>
And if you use sth like "&amp; g t ;" in your code, the web page will also lie to you.<br>
This is insane, and there is no good quick solution, one would have to use lengthy escape<br>
tables etc. etc. </s><br>
<p>
<ul> /* OFFTOPIC, ALSO: add &lt; &gt; and &amp; escapes to the weaved code chunks -- for proper display */<br>
    --- DONE ---<br>
    These escapes exist in two places in the Weaver code:<br>
    "process code sections"  and "body HTML formatters"<br>
</ul><br>
<p>
<br><br>
This prototype script fails in some (unimportant to me)  cases.<br>
dotHTML markup would also fail if your programming language uses dot-symbol-dot sequences<br>
Mine do not.<br>
<p>
The formatter is pretty straightforward, but sequencing of regexps is important.<br>
One also needs to remember that once escaped, angle brackets are non-existent any more, <br>
and so the subsequent regexps must match on "&amp; l t ;" not on the angle bracket in some<br>
cases.<br>
<p>
<p>
<font class='lnum'>3496</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>3497</font>   
<font class='lnum'>3498</font>   	elsif( $weave_markup eq "dotHTML" ) {	# dotHTML formatter here
<font class='lnum'>3499</font>   
<font class='lnum'>3500</font>   	      s/^=begin.*$//;	# - eliminate perl escaping, start
<font class='lnum'>3501</font>   	      s/^=cut.*$//;		# - eliminate perl escaping, end
<font class='lnum'>3502</font>      	      #s/^{{{\d+(.*)$/$1/;	# - eliminate vim folding markup, start 
<font class='lnum'>3503</font>   					# - dummy, as it is killed in "headings" processing 
<font class='lnum'>3504</font>   	      s/^}}}\d+//;	# - eliminate vim folding markup, end
<font class='lnum'>3505</font>   
<font class='lnum'>3506</font>   		s/&amp;/&amp;amp;/g;	# escape &amp;
<font class='lnum'>3507</font>   		s/&lt;/&amp;lt;/g;	# escape &lt;
<font class='lnum'>3508</font>   		s/&gt;/&amp;gt;/g;	# escape &gt;
<font class='lnum'>3509</font>   
<font class='lnum'>3510</font>   
<font class='lnum'>3511</font>   	      # Paragraphs and line breaks are automatic now:
<font class='lnum'>3512</font>   	      # ... unless we are dealing with the "preformat" tag
<font class='lnum'>3513</font>   		#--note! that ranges do not work here
<font class='lnum'>3514</font>   		$in_pre_tag = 1 if (m!\.pre\.!);
<font class='lnum'>3515</font>   		$in_pre_tag = 0 if (m!\./pre\.!);;
<font class='lnum'>3516</font>   
<font class='lnum'>3517</font>   		s/\.(\/?)pre\./&lt;$1pre&gt;/g;
<font class='lnum'>3518</font>   
<font class='lnum'>3519</font>   	    unless ($in_pre_tag) {
<font class='lnum'>3520</font>   	    (m/^\s*$/) and s/$_/&lt;p&gt;\n/
<font class='lnum'>3521</font>   	    or s/\n/&lt;br&gt;\n/;
<font class='lnum'>3522</font>   	    }
<font class='lnum'>3523</font>   </fieldset></pre>
<p>
Now the regexps to cut out "#--------" lines and substitute "dot-notation" with angle brackets:<br>
<p>
<font class='lnum'>3527</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>3528</font>   	      # originally I separated header from the body with such a line
<font class='lnum'>3529</font>   	      #s/^#-----.*/starting the table here/;
<font class='lnum'>3530</font>   	      s/^#-----.*//;
<font class='lnum'>3531</font>   
<font class='lnum'>3532</font>   
<font class='lnum'>3533</font>   		# add more here
<font class='lnum'>3534</font>   
<font class='lnum'>3535</font>   		s/\.(\/?)b\./&lt;$1b&gt;/g;
<font class='lnum'>3536</font>   		s/\.(\/?)i\./&lt;$1i&gt;/g;
<font class='lnum'>3537</font>   		s/\.(\/?)ul\./&lt;$1ul&gt;/g;
<font class='lnum'>3538</font>   		s/\.(\/?)li\./&lt;$1li&gt;/g;
<font class='lnum'>3539</font>   		s/\.(\/?)ol\./&lt;$1ol&gt;/g;
<font class='lnum'>3540</font>   		s/\.(\/?)s\./&lt;$1s&gt;/g;
<font class='lnum'>3541</font>   		s/\.(\/?)div\./&lt;$1div&gt;/g;
<font class='lnum'>3542</font>   		s/\.br\./&lt;br&gt;/g;
<font class='lnum'>3543</font>   		s/\.p\./&lt;p&gt;/g;
<font class='lnum'>3544</font>   
<font class='lnum'>3545</font>   
<font class='lnum'>3546</font>   		s/\.(\/?)tab\./&lt;$1ul&gt;/g;	# "tabbing" with "ul"
<font class='lnum'>3547</font>   
<font class='lnum'>3548</font>   
<font class='lnum'>3549</font>   		# this is some bullshit ???
<font class='lnum'>3550</font>   		s/\.hr\./&lt;hr /g;
<font class='lnum'>3551</font>   		s/\.\/hr\./&gt;/g;
<font class='lnum'>3552</font>   
<font class='lnum'>3553</font>   		s!\.a\.(.+?)\.\/a\.!&lt;a href=$1&gt;$1&lt;/a&gt;!g;
<font class='lnum'>3554</font>   
<font class='lnum'>3555</font>   		# rudimentary &amp;nbsp; s p a c i n g &amp;nbsp (one word only)
<font class='lnum'>3556</font>   		#s!\.x\.(.+?)\./x\.!join " ","&amp;nbsp;&amp;nbsp;",(split //, $1),"&amp;nbsp;&amp;nbsp;"!eg;
<font class='lnum'>3557</font>   
<font class='lnum'>3558</font>   		# slightly better spacing (phrases, too):
<font class='lnum'>3559</font>   		# although redundant  with more work than is needed
<font class='lnum'>3560</font>   		if ( m!(\.x\.)(.+?)(\./x\.)!g) {
<font class='lnum'>3561</font>   		    s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>3562</font>   		    s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>3563</font>   		    s!  _  ! &amp;nbsp; !g;
<font class='lnum'>3564</font>   		}
<font class='lnum'>3565</font>   </fieldset></pre>
<p>
<b> BUG! </b> This URL breaks my "ancor" dot-tags: <br>
     <pre> http://www.cs.tufts.edu/~nr/noweb </pre><br>
<b> Got it </b> The substitutions above must explicitly use "slash" for the closing HTML tag<br>
in the regexps - otherwise they match stuff like ".cs." inside URLs<br>
<p>
If an HTML tag is not in the above chunk, either add it or write with the two following generic<br>
tags (slow and not nice on your fingers, though). You might need to use them also when your HTML<br>
tag conntains some options, and so is not of generic simple type.<br>
<p>
<font class='lnum'>3576</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>3577</font>   		# generic for all tags with options
<font class='lnum'>3578</font>   		s!\.&amp;lt;\. !&lt;!g;
<font class='lnum'>3579</font>   		s! \.&amp;gt;\.!&gt;!g;
<font class='lnum'>3580</font>   
<font class='lnum'>3581</font>   
<font class='lnum'>3582</font>   		$chunkbuf .= $_;
<font class='lnum'>3583</font>   
<font class='lnum'>3584</font>   	}
<font class='lnum'>3585</font>   </fieldset></pre>
<p>
<p>
<b> rawHTML formatter</b><br>
Raw HTML formatting can be done - either because it is non-restricted, compared to the stripped-down<br>
"dotHTML" of my invention, or because it allows one to convert existing HTML documentation into the<br>
folding format.<br>
I.e. if you have a longish manual in which section headings are marked with HTML h1, h2, h3, ... tags,<br>
you can convert it in 3 simple steps:<br>
<ul> <li> delete opening and closing "html" and "head" "body" tags at the very top and bottom of your <br>
document<br>
</li> <li> put perl invocation as the first line<br>
</li> <li> set up markup mode in a variable: "$weave_markup = "rawHTML";" and "mollify" the document,<br>
putting  "do MOLLY.pl" and DATA marker<br>
</li> </ul><br>
and if there are no interfering div section etc. - no complicated markup inside the headings, you'll get<br>
an automatically generated folding HTML document.<br>
<p>
If you do, it is sometimes easy to clean headings with a few regexps in a good editor like Vim<br>
<p>
It is very convenient and I keep large manuals as folding HTML documents.<br>
<p>
<p>
<font class='lnum'>3608</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;body HTML formatters&gt;&gt;=</legend>
<font class='lnum'>3609</font>   	elsif( $weave_markup eq "rawHTML" ) {	# if the doc chunks marked up with real HTML
<font class='lnum'>3610</font>   		s!^#-----.*!!;
<font class='lnum'>3611</font>   
<font class='lnum'>3612</font>   
<font class='lnum'>3613</font>   	      # Paragraphs and line breaks are automatic now:
<font class='lnum'>3614</font>   	      # ... unless we are dealing with the "preformat" tag
<font class='lnum'>3615</font>   		#--note! that ranges do not work here
<font class='lnum'>3616</font>   		$in_pre_tag = 1 if (m!&lt;pre&gt;!);
<font class='lnum'>3617</font>   		$in_pre_tag = 0 if (m!&lt;/pre&gt;!);;
<font class='lnum'>3618</font>   
<font class='lnum'>3619</font>   
<font class='lnum'>3620</font>   		unless ($in_pre_tag) {
<font class='lnum'>3621</font>   		(m/^\s*$/) and s/$_/&lt;p&gt;\n/
<font class='lnum'>3622</font>   		or s/\n/&lt;br&gt;\n/;
<font class='lnum'>3623</font>   		}
<font class='lnum'>3624</font>   
<font class='lnum'>3625</font>   
<font class='lnum'>3626</font>   		$chunkbuf .= $_;
<font class='lnum'>3627</font>   	} # esle -- for rest of the body
<font class='lnum'>3628</font>   
<font class='lnum'>3629</font>   
<font class='lnum'>3630</font>   
<font class='lnum'>3631</font>   </fieldset></pre>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('69');">
<font class='lnum'><i>(69)</i></font>&nbsp; test of &nbsp;&nbsp; s p a c i n g &nbsp;&nbsp; regexp </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3633)</i></sub></font></a></legend></fieldset>
<p>
<div id="69" style="display:none">   
<ul>

<p>
1. Hell, the thing is multiple sp /sp markups on one line. I need to iterate over<br>
each separately and then put them in their right places, hedging with "nbsp"-ces each word.<br>
<p>
2. The invocation is OK for $str_sp, but for boundaries of the string and word boundaries, <br>
they must be hedged too<br>
<p>
3. Could subst spaces-betwen-words to sth like _ (space-underscore-space) as placeholders,<br>
then subst them into nbspx2 in a following regexp<br>
<p>
4. This tagging can be done cleanly and span severl lines if I do it in a different place - <br>
not while still reading the Literate Source file line by line,  &nbsp;  b u t  &nbsp;  l a t e r  &nbsp;  when<br>
$chunkbuf is completely formed in RAM.<br>
<p>
<p>
<font class='lnum'>3649</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;spacing.pl&gt;&gt;=</legend>
<font class='lnum'>3650</font>   #!/usr/bin/perl
<font class='lnum'>3651</font>   #
<font class='lnum'>3652</font>   $str = $ARGV[0];
<font class='lnum'>3653</font>   $str_sp = $ARGV[0];
<font class='lnum'>3654</font>   #print "string is $str\n";
<font class='lnum'>3655</font>   
<font class='lnum'>3656</font>       # "sp" dot-markup to intersperse spaces: the basic formula
<font class='lnum'>3657</font>       #$spaced_str =~ s!(asdf)!join " ", (split //, $1)!eg;
<font class='lnum'>3658</font>       #
<font class='lnum'>3659</font>       
<font class='lnum'>3660</font>       # -- idea 3 from above: this works but is cumbersome --
<font class='lnum'>3661</font>       #$str_sp =~ s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>3662</font>       #$str_sp =~ s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>3663</font>       #$str_sp =~ s! _ ! &amp;nbsp;&amp;nbsp; !g;
<font class='lnum'>3664</font>   
<font class='lnum'>3665</font>       # -- first get the matching string in "if", then massage it:
<font class='lnum'>3666</font>       if ($str_sp =~ m!(\.x\.)(.+?)(\./x\.)!g) {
<font class='lnum'>3667</font>   	$str_sp =~ s!(\.x\.)(.+?)(\./x\.)!join " _ ", $1, (split / /, $2), $3!eg;
<font class='lnum'>3668</font>           $str_sp =~ s!\.x\.(.+?)\./x\.!join " ", (split //, $1)!eg;
<font class='lnum'>3669</font>   	$str_sp =~ s!  _  ! &amp;nbsp; !g;
<font class='lnum'>3670</font>       }
<font class='lnum'>3671</font>   
<font class='lnum'>3672</font>       #print "\nthe string is $str\n";
<font class='lnum'>3673</font>       print "\nthe str_sp is $str_sp\n\n";
<font class='lnum'>3674</font>   </fieldset></pre>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('69');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('68');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('65');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('70');">
<font class='lnum'><i>(70)</i></font>&nbsp; Print out the resulting page </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3684)</i></sub></font></a></legend></fieldset>
<p>
<div id="70" style="display:none">   
<ul>


<p>
Page and the outer formatting table:<br>
<p>
<font class='lnum'>3689</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>3690</font>   
<font class='lnum'>3691</font>     # begin the page:
<font class='lnum'>3692</font>     print "&lt;html&gt;  $html_head &lt;body&gt;  $html_body_table \n";
<font class='lnum'>3693</font>   
<font class='lnum'>3694</font>     # print out the TOC, the Chunks Index, the output buffer and close the page.
<font class='lnum'>3695</font>   
<font class='lnum'>3696</font>   </fieldset></pre>
<p>
Next print the short instructions section (collapsible) at the top:<br>
<p>
<font class='lnum'>3700</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>3701</font>   
<font class='lnum'>3702</font>   print &lt;&lt;end_of_print;
<font class='lnum'>3703</font>   &lt;p&gt;&lt;fieldset class='tocfieldset'&gt;&lt;legend&gt;&lt;b&gt;TABLE OF CONTENTS: outline of the document structure&lt;/b&gt;&lt;/legend&gt;
<font class='lnum'>3704</font>   
<font class='lnum'>3705</font>   &lt;ul&gt;
<font class='lnum'>3706</font>   &lt;p&gt;
<font class='lnum'>3707</font>   &lt;br&gt;
<font class='lnum'>3708</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>3709</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('tochowto');"&gt;
<font class='lnum'>3710</font>   &lt;b&gt;HOW TO USE THE FOLDING DOCUMENT [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>3711</font>   &lt;/div&gt;
<font class='lnum'>3712</font>   &lt;div id='tochowto' style='display:none' style='background:#ffffff'&gt; 
<font class='lnum'>3713</font>   &lt;p&gt;
<font class='lnum'>3714</font>   &lt;ul&gt;
<font class='lnum'>3715</font>   &lt;li&gt;&lt;b&gt;Collapsing is necessary when&lt;/b&gt; you work on some code and must exclude 
<font class='lnum'>3716</font>   &lt;br&gt;irrelevant sections of the rest of the literate project file. This 
<font class='lnum'>3717</font>   &lt;br&gt;greatly helps to clear thinking by eliminating a general feeling of 
<font class='lnum'>3718</font>   &lt;br&gt;being in a maze of code and unnecessary "housekeeping" tasks.
<font class='lnum'>3719</font>   &lt;br&gt;One can say that there is a limited "buffer capacity" in the human
<font class='lnum'>3720</font>   &lt;br&gt;mind, and relieving it of the need to remember where things are in a 
<font class='lnum'>3721</font>   &lt;br&gt;larger file, at which other points one must fill in values or adjust
<font class='lnum'>3722</font>   &lt;br&gt;invocation etc. &lt;i&gt;immediately makes the user "more intelligent"&lt;/i&gt;
<font class='lnum'>3723</font>   &lt;/li&gt;&lt;li&gt;&lt;b&gt;To toggle&lt;/b&gt; a section open/closed, click on the corresponding link
<font class='lnum'>3724</font>   &lt;br&gt;Remember to open &lt;i&gt;all sections above it&lt;/i&gt; for it to become visible.
<font class='lnum'>3725</font>   &lt;/li&gt;&lt;li&gt;&lt;b&gt;To restore the default view&lt;/b&gt; reload the page in the browser.
<font class='lnum'>3726</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>3727</font>   &lt;b&gt;To keep some sections open&lt;/b&gt; upon each reload - 
<font class='lnum'>3728</font>   &lt;br&gt;e.g. you work on the code, update it constantly and cannot reopen it 
<font class='lnum'>3729</font>   &lt;br&gt;again and again - mark their sections in the source file with a plus, 
<font class='lnum'>3730</font>   &lt;br&gt;i.e. write the opening tag (only)  as +h2, +h3 (in &amp;lt; &amp;gt;  or in dots
<font class='lnum'>3731</font>   &lt;br&gt;for dotHTML). Again, all sections above must be marked open too. 
<font class='lnum'>3732</font>   &lt;p&gt;&lt;b&gt;Note that&lt;/b&gt; "expand all" and "collapse all" disregard these settings.
<font class='lnum'>3733</font>   &lt;br&gt;Reload the page after using those options to again view the text according 
<font class='lnum'>3734</font>   &lt;br&gt;to your preferences.
<font class='lnum'>3735</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>3736</font>   &lt;b&gt; To use the Index &lt;/b&gt;, click on the numbered sections in the TOC above
<font class='lnum'>3737</font>   &lt;br&gt;(opening them; use highlighting as a guide; when sections are visible,
<font class='lnum'>3738</font>   &lt;br&gt;the slider on your browser window  will shorten too), or "expand all", 
<font class='lnum'>3739</font>   &lt;br&gt;and then use your browser's Find function to highlight all chunk name 
<font class='lnum'>3740</font>   &lt;br&gt;instances in the visible text
<font class='lnum'>3741</font>   &lt;/li&gt;&lt;li&gt;
<font class='lnum'>3742</font>   &lt;b&gt;To search for variables etc.&lt;/b&gt;, "expand all" text - or manually 
<font class='lnum'>3743</font>   &lt;br&gt;expand needed sections - and then use your browser's Find function to 
<font class='lnum'>3744</font>   &lt;br&gt;highlight all and jump between the found items.
<font class='lnum'>3745</font>   &lt;p&gt;&lt;/li&gt;
<font class='lnum'>3746</font>   
<font class='lnum'>3747</font>   &lt;/div&gt; 
<font class='lnum'>3748</font>   &lt;p&gt;
<font class='lnum'>3749</font>   &lt;br&gt;
<font class='lnum'>3750</font>   &lt;p&gt;
<font class='lnum'>3751</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>3752</font>   &lt;!--i&gt;&lt;font size=-3&gt; expand all -- collapse all&lt;/font&gt;&lt;/i--&gt;
<font class='lnum'>3753</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('tocmain');"&gt;
<font class='lnum'>3754</font>   &lt;b&gt;TABLE OF CONTENTS [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>3755</font>   &lt;/div&gt;
<font class='lnum'>3756</font>   
<font class='lnum'>3757</font>   &lt;div id='tocmain' style='display:$toc_expanded' style='background:#ffffff'&gt; 
<font class='lnum'>3758</font>   &lt;p&gt;
<font class='lnum'>3759</font>   &lt;br&gt;
<font class='lnum'>3760</font>   &lt;p&gt;
<font class='lnum'>3761</font>   end_of_print
<font class='lnum'>3762</font>   
<font class='lnum'>3763</font>   </fieldset></pre>
<p>
Table of Contents from the formed "tocbuf":<br>
<p>
<font class='lnum'>3767</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>3768</font>   
<font class='lnum'>3769</font>    print "$tocbuf" if $print_toc;
<font class='lnum'>3770</font>    #print "$tocbuf";
<font class='lnum'>3771</font>   
<font class='lnum'>3772</font>   print "&lt;/div&gt;\n";
<font class='lnum'>3773</font>   
<font class='lnum'>3774</font>   </fieldset></pre>
<p>
Start the "Index of code chunks", collapsible:<br>
<p>
<font class='lnum'>3778</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>3779</font>   
<font class='lnum'>3780</font>   print &lt;&lt;end_of_print;
<font class='lnum'>3781</font>   &lt;p&gt;
<font class='lnum'>3782</font>   &lt;br&gt;
<font class='lnum'>3783</font>   &lt;p&gt;
<font class='lnum'>3784</font>   &lt;!--fieldset&gt;&lt;legend--&gt;
<font class='lnum'>3785</font>   &lt;div class='hl' align=center&gt;
<font class='lnum'>3786</font>   &lt;a href="javascript:;" onmousedown="toggleDiv('indbuf');"&gt;
<font class='lnum'>3787</font>   &lt;b&gt;INDEX of Code Chunks [expand/collapse]&lt;/b&gt;&lt;/a&gt;
<font class='lnum'>3788</font>   &lt;/div&gt;
<font class='lnum'>3789</font>   &lt;!--/legend&gt;&lt;/fieldset--&gt;
<font class='lnum'>3790</font>   &lt;p&gt;
<font class='lnum'>3791</font>   &lt;div id='indbuf' style='display:$ind_expanded' style='background:#ffffff'&gt; 
<font class='lnum'>3792</font>   &lt;ul&gt;
<font class='lnum'>3793</font>   &lt;p&gt;
<font class='lnum'>3794</font>   &lt;b&gt;"Def" subscript&lt;/b&gt; means the chunk is defined, while a bare number means 
<font class='lnum'>3795</font>   &lt;br&gt;the chunk is being used in the given section.
<font class='lnum'>3796</font>   &lt;p&gt;
<font class='lnum'>3797</font>   end_of_print
<font class='lnum'>3798</font>   
<font class='lnum'>3799</font>   </fieldset></pre>
<p>
<p>
Index of code chunks; calculated in this snippet:<br>
<p>
<font class='lnum'>3804</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>3805</font>   
<font class='lnum'>3806</font>   	 $ind_outbuf = '';
<font class='lnum'>3807</font>   	 $prev_ch_name = '';
<font class='lnum'>3808</font>   
<font class='lnum'>3809</font>   	 #for (sort @indbuf){ print $_, "&lt;br&gt;";}
<font class='lnum'>3810</font>   
<font class='lnum'>3811</font>   	 for (sort @indbuf){
<font class='lnum'>3812</font>   
<font class='lnum'>3813</font>   	   ($ch_name, $closing_bracket, $ref_num) = split /&amp;gt;/, $_; 
<font class='lnum'>3814</font>   		#/ - for editor colouring bug
<font class='lnum'>3815</font>   
<font class='lnum'>3816</font>   	    if ( $ch_name eq $prev_ch_name ){ 
<font class='lnum'>3817</font>   	      $ind_outbuf .= " &lt;b&gt;" . $ref_num . "&lt;/b&gt; ";
<font class='lnum'>3818</font>   	    }
<font class='lnum'>3819</font>   	    else{
<font class='lnum'>3820</font>   	      print  $ind_outbuf, "&lt;br&gt;\n"; 
<font class='lnum'>3821</font>   	      $ch_namestr = $ch_name;
<font class='lnum'>3822</font>   	      $ch_namestr =~ s!&amp;lt;&amp;lt;!!;
<font class='lnum'>3823</font>   	      $ind_outbuf = 
<font class='lnum'>3824</font>   	      	"&lt;b&gt;&amp;lt;&amp;lt;&lt;/b&gt;&lt;font class='chunkref'&gt;" . 
<font class='lnum'>3825</font>   	      	$ch_namestr . 
<font class='lnum'>3826</font>   	      	"&lt;/font&gt;&lt;b&gt;&amp;gt;&amp;gt;&lt;/b&gt; -- &lt;b&gt;" . 
<font class='lnum'>3827</font>   	      	$ref_num . 
<font class='lnum'>3828</font>   	      	"&lt;/b&gt; ";
<font class='lnum'>3829</font>   	    }
<font class='lnum'>3830</font>   	    $prev_ch_name = $ch_name;
<font class='lnum'>3831</font>   
<font class='lnum'>3832</font>   	 }; # rof - forming the code chunks index
<font class='lnum'>3833</font>   
<font class='lnum'>3834</font>   	print $ind_outbuf, "&lt;br&gt;\n";
<font class='lnum'>3835</font>   
<font class='lnum'>3836</font>   </fieldset></pre>
<p>
<p>
"expand all" and "collapse all" at the end of the TOC/Chunk Index section <br>
at the top of the page:<br>
<p>
<font class='lnum'>3842</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>3843</font>   
<font class='lnum'>3844</font>     # The "expand all" "collapse all" control
<font class='lnum'>3845</font>   
<font class='lnum'>3846</font>   print &lt;&lt;end_of_print;
<font class='lnum'>3847</font>   &lt;/div&gt;\n&lt;p&gt;
<font class='lnum'>3848</font>   &lt;br&gt;
<font class='lnum'>3849</font>   &lt;p&gt;&lt;div class='hl' align=center&gt;&lt;i&gt;
<font class='lnum'>3850</font>   &lt;a href="javascript:;" onmousedown="showAll();"&gt;
<font class='lnum'>3851</font>   expand all&lt;/a&gt; -- 
<font class='lnum'>3852</font>   &lt;a href="javascript:;" onmousedown="hideAll();"&gt;
<font class='lnum'>3853</font>   collapse all&lt;/a&gt;
<font class='lnum'>3854</font>   &lt;/i&gt;&lt;/div&gt;&lt;p&gt;
<font class='lnum'>3855</font>   end_of_print
<font class='lnum'>3856</font>   
<font class='lnum'>3857</font>   
<font class='lnum'>3858</font>    print "&lt;/ul&gt;&lt;/fieldset&gt;&lt;p&gt;\n&lt;br&gt;";
<font class='lnum'>3859</font>   
<font class='lnum'>3860</font>   </fieldset></pre>
<p>
<p>
<p>
..and the document itself, formed earlier in the "chunkbuf" string in memory:<br>
<p>
<font class='lnum'>3866</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>3867</font>   
<font class='lnum'>3868</font>   # The FULL OUTPUT, the file body:
<font class='lnum'>3869</font>    	print $chunkbuf;
<font class='lnum'>3870</font>   
<font class='lnum'>3871</font>   </fieldset></pre>
<p>
Close the HTML formatting tags at the end of the page:<br>
<p>
<font class='lnum'>3875</font>   <pre><fieldset class='codefieldset'><legend class='codelegend'>&lt;&lt;print out&gt;&gt;=</legend>
<font class='lnum'>3876</font>   
<font class='lnum'>3877</font>   # close the page
<font class='lnum'>3878</font>   	print $html_body_table_end;
<font class='lnum'>3879</font>   	
<font class='lnum'>3880</font>   exit;
<font class='lnum'>3881</font>   
<font class='lnum'>3882</font>   #--- END OF SCRIPT ---
<font class='lnum'>3883</font>   
<font class='lnum'>3884</font>   </fieldset></pre>
<p>
End of the project file<br>
<p>
<p>
<p>
<p>
<p>
<p>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('70');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('57');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('71');">
<font class='lnum'><i>(71)</i></font>&nbsp; ADD-ON: Context diffs and sections editing </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3894)</i></sub></font></a></legend></fieldset>
<p>
<div id="71" style="display:none">   
<ul>


<p>
<p>
	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('72');">
<font class='lnum'><i>(72)</i></font>&nbsp; Outline of the idea </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3898)</i></sub></font></a></legend></fieldset>
<p>
<div id="72" style="display:none">   
<ul>

<p>
<ol> <li> Context diffs an be applied by "patch -c" even <i> without their header </i><br>
</li> <li> Secondly, I can ancor them with line numbers from the original "project.weave"<br>
</li> <li> I have to remember that the file the section from which  I edit in-browser <br>
(or in  an external editor) is NOT the original LIterate Source, but an "html-ified"<br>
Literate Source file.<br>
</li> </ol> <br>
<p>
Therefore, I can save a section edit saved under a unique name, like "line1234.patch"<br>
and the general outline of processing will be:<br>
    <ul> <li> (a) add line number references/ancors to the html-ified output of "molly.weave"<br>
    indicating lines in the Literate Source (modify the existing weaver)<br>
    </li> <li> (b) edit sections <br>
	<ol> <li> in a Javascript in=-browser editor, like "tinyMCE" etc.<br>
	which is applied to "div"s <br>
	</li> <li> or in an external editor, to which I cat the piece from<br>
	a subsection heading to the next subsection title; the editor is called with the default<br>
	name of the future patch </li> </ol><br>
    </li> <li> (c) Next, when processing/applying the patches (which should be incorporated into<br>
    a new routine/section of MOLLY.pl) I do the following<br>
    <ol> <li>  add the "****************" line needed to start a context diff without<br>
    a header<br>
    </li> <li> substitute teh context diff line numbers for the target file with the beginning<br>
    line number picked from the patch ancor </li> </ol><br>
    </li> <li> apply "patch -c" to MOLLY<br>
    </li> <li> I should probably add the timestamp into the patch name (or use file mtime) to <br>
    apply only the new patches to the Literate Source, and/or clean the old ones (might keep some<br>
    as a sort of version control for undoing ??? Does "patch" know how to revert itself ???)<br>
    </li> </ul><br>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('72');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('73');">
<font class='lnum'><i>(73)</i></font>&nbsp; Editing - javascript versus external editor </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3930)</i></sub></font></a></legend></fieldset>
<p>
<div id="73" style="display:none">   
<ul>

<p>
JS editors (wikiwyg, tinyMCE) are not OK: <br>
tinyMCE requires "textarea" tags;<br>
wikiwyg requires writing a save routine that would reverse the wikiwyg-ification.<br>
<p>
Therefore, I could do external editor calls (in an xterm or the GUI version, like<br>
"gvim", 'jedit', or 'bluefish'.<br>
<p>
Then my script - receiving a CGI call - should <br>
    <ul> <li> cat the section identified by the beginning line## (supplied during<br>
    MOLLY.weave html file generation) -- using a hyperlink (created by molly.weave).<br>
    </li> <li> and next cat the portion of Literate Source into an external editor,<br>
    called with the correct "patch-line##-timestamp" name.<br>
    </li> <li> The user edits the text and saves it (not "save as") - then <br>
    EITHER addressing the mollified LitSrc with a new CGI argument, <br>
    OR continuing the first CGI processing - after getting a return from the <br>
    external editor invocation<br>
    </li> </ul><br>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('73');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('74');">
<font class='lnum'><i>(74)</i></font>&nbsp; Patch details and probs </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3951)</i></sub></font></a></legend></fieldset>
<p>
<div id="74" style="display:none">   
<ul>

<p>
<i> If the entire diff is indented by a constant amount of white space, `patch' automatically<br>
ignores the indentation. </i><br>
<p>
... and this is good:<br>
<i>    For context diffs, and to a lesser extent normal diffs, `patch' can<br>
detect when the line numbers mentioned in the patch are incorrect, and<br>
it attempts to find the correct place to apply each hunk of the patch.<br>
As a first guess, it takes the line number mentioned in the hunk, plus<br>
or minus any offset used in applying the previous hunk.  If that is not<br>
the correct place, `patch' scans both forward and backward for a set of<br>
lines matching the context given in the hunk.<br>
</i><br>
<p>
.. there is an option "-F 3" or "--fuzz=3" setting "fuzz lines" for context &amp; unified diffs<br>
<p>
.. "reject files" -- check them for failed hunks.<br>
    and another possibility is the "--dry-run" option to check before applying.<br>
<p>
    and another possibility is the "--dry-run" option to check before applying.<br>
<p>
<b> Appending patch trunks </b> If I collect edits as "context patches", I do not need<br>
to keep them in many separate files. All edits before an application can be appended to<br>
the same file, the most recent collection of patch "trunks". After application to the<br>
Literate Source it can be renamed (for "undo"s or deleted.<br>
<p>
Actually, the same is true even for overwriting of sections, not patching.<br>
<p>
Patching may be more complicated and relying on external progs, but in some sense <br>
more "intelligent" and "undoable", while overwriting is not unless I keep the old<br>
versions explicitly.<br>
<p>
<i> Am I reinventing Knuth's 'change files' functionality ?? ;)))))) </i><br>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('74');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

	<fieldset><legend><a href="javascript:;" onmousedown="toggleCombined('75');">
<font class='lnum'><i>(75)</i></font>&nbsp; Implementation steps </a>&nbsp;<a><font class='lnum' size=-1><sub><i>(line 3987)</i></sub></font></a></legend></fieldset>
<p>
<div id="75" style="display:none">   
<ul>

<p>
(a) add line numbers to docs subsections. --- DONE---<br>
<p>
<p>
(b) This editing "from_the_browser" can be done:<br>
    <ul> <li> by addressing "MOLLY.update" - by extension<br>
    </li> <li> via a CL option -- or via CGI "?update=patch-lineno_ref-datestamp"<br>
    </li> <li> in a separate script (at least for the time of development and testing)<br>
    </li> </ul><br>
<p>
(c) So, step 1: add "edit" hyperlinks to each subsection.<br>
<p>
(d) Modify Despatcher to redirect to the "update" subsection (will be here)<br>
    ?? another extension? OR just args to "*.weave" ?<br>
<p>
<p>
(e) Make the script dump the subsection whose linenum was passed as CGI arguments<br>
<p>
(f) apply it either overwriting or using the diff/patch approach<br>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('75');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('71');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('29');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>

</ul>
<p>
<br>
<i><font size=-1>
<a href="javascript:;"onmousedown="toggleCombined('1');">
Close the subsection</a></font>
</i> -- <i><font size=-1>
<a href="javascript:;" onmousedown="showAll();">
expand all</a> -- 
<a href="javascript:;" onmousedown="hideAll();">
collapse all</a>
</font></i>

<p>
</div>


</td></tr></table></center></body></html>
